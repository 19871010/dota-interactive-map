function isBefore(e,t){return e>0&&0>t?!0:t>0&&0>e?!1:t>e}function isAfter(e,t){return!isBefore(e,t)}function isBetween(e,t,n){return n>t?e>=t&&n>=e:e>=t&&e<=Math.PI||-Math.PI<=e&&n>=e}function normalize(e){return e>Math.PI?-(2*Math.PI-e):e<-Math.PI?2*Math.PI+e:e}function diff(e,t){return e>0&&0>t?Math.abs(Math.PI-e-(-Math.PI-t)):t>0&&0>e?Math.abs(-e+t):0>=e&&0>=t?isAfter(e,t)?-e+Math.PI-(-Math.PI-t):Math.abs(t-e):isAfter(e,t)?Math.PI+(Math.PI-e)+t:Math.abs(t-e)}function diff_sum(e){for(var t=0,n=0;n<e.length;n++)t+=diff(e[n][0],e[n][1]);return t}var ROT={DIRS:{4:[[0,-1],[1,0],[0,1],[-1,0]],8:[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],6:[[-1,-1],[1,-1],[2,0],[1,1],[-1,1],[-2,0]]}};Number.prototype.mod=function(e){return(this%e+e)%e},Object.create||(Object.create=function(e){var t=function(){};return t.prototype=e,new t}),Function.prototype.extend=function(e){return this.prototype=Object.create(e.prototype),this.prototype.constructor=this,this},"undefined"!=typeof window&&(window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return setTimeout(e,1e3/60)},window.cancelAnimationFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||function(e){return clearTimeout(e)}),ROT.FOV=function(e,t){this._lightPasses=e,this._options={topology:8};for(var n in t)this._options[n]=t[n]},ROT.FOV.prototype.compute=function(){},ROT.FOV.prototype._getCircle=function(e,t,n){var r,o,a,i=[];switch(this._options.topology){case 4:o=1,a=[0,1],r=[ROT.DIRS[8][7],ROT.DIRS[8][1],ROT.DIRS[8][3],ROT.DIRS[8][5]];break;case 6:r=ROT.DIRS[6],o=1,a=[-1,1];break;case 8:r=ROT.DIRS[4],o=2,a=[-1,1]}for(var s=e+a[0]*n,l=t+a[1]*n,c=0;c<r.length;c++)for(var d=0;n*o>d;d++)i.push([s,l]),s+=r[c][0],l+=r[c][1];return i},ROT.FOV.PreciseShadowcasting=function(e,t){ROT.FOV.call(this,e,t)},ROT.FOV.PreciseShadowcasting.extend(ROT.FOV),ROT.FOV.PreciseShadowcasting.prototype.compute=function(e,t,n,r){if(r(e,t,0,1),r(e-1,t-1,0,1),r(e,t-1,0,1),r(e+1,t-1,0,1),r(e-1,t,0,1),r(e+1,t,0,1),r(e-1,t+1,0,1),r(e,t+1,0,1),r(e+1,t+1,0,1),r(e-1,t-2,0,1),r(e,t-2,0,1),r(e+1,t-2,0,1),r(e-2,t-1,0,1),r(e-2,t,0,1),r(e-2,t+1,0,1),r(e+2,t-1,0,1),r(e+2,t,0,1),r(e+2,t+1,0,1),r(e-1,t+2,0,1),r(e,t+2,0,1),r(e+1,t+2,0,1),this._lightPasses(e,t))for(var o,a,i,s,l,c,d,u,y,p,m,g,h,f,v,w,_=[],L={},O=1;n>=O;O++){var b=this._getCircle(e,t,O),x=b.length;L={};for(var F=0;x>F;F++){o=b[F][0],a=b[F][1];var I=o+","+a;if(w=this.walls[I],w&&"tree"==w[0]?(h=w[1],f=w[2],g=w[3]):(h=o,f=a,g=Math.SQRT2/2),d=h-e,u=f-t,y=Math.sqrt(d*d+u*u),y>.5)if(p=Math.asin(g/y),m=Math.atan2(u,d),s=normalize(m-p),l=normalize(m+p),i=!this._lightPasses(o,a),w&&"tree"==w[0])dx1=o-e,dy1=a-t,v=Math.sqrt(dx1*dx1+dy1*dy1),y>v&&(L[w[1]+","+w[2]]=[w[1],w[2]]),d=o-e,u=a-t,y=Math.sqrt(d*d+u*u),p=Math.asin(g/y),m=Math.atan2(u,d),s=normalize(m-p),l=normalize(m+p),c=this._checkVisibility(m,s,l,!1,_),c&&r(o,a,O,c);else if(c=this._checkVisibility(m,s,l,i,_),c&&r(o,a,O,c),this.done)return}for(k in L)if(h=L[k][0],f=L[k][1],d=h-e,u=f-t,y=Math.sqrt(d*d+u*u),g=Math.SQRT2-.01,y>.5&&(p=Math.asin(g/y),m=Math.atan2(u,d),s=normalize(m-p),l=normalize(m+p),c=this._checkVisibility(m,s,l,!0,_),this.done))return}},ROT.FOV.PreciseShadowcasting.prototype._checkVisibility=function(e,t,n,r,o){for(var a=!r,i=0;i<o.length;i++){var s=o[i];if(isBetween(e,s[0],s[1])){if(!r)return!1;a=!1}}return r&&(0>t&&n>=0?(this._mergeShadows(e,0,n,r,o),this.done=!1,this._mergeShadows(e,t,0,r,o)):this._mergeShadows(e,t,n,r,o),1!=o.length||isBetween(t,o[0][0],o[0][1])&&isBetween(n,o[0][0],o[0][1])||t==o[0][0]||n==o[0][1]||(this.done=!0)),a},ROT.FOV.PreciseShadowcasting.prototype._mergeShadows=function(e,t,n,r,o){for(var a=0,i=!1,s=0;a<o.length;){var l=o[a];if(s=a,isBetween(t,l[0],l[1])){i=!0;break}if(a>0&&isBetween(t,o[a-1][1],l[0])){i=!1;break}if(isBefore(t,l[1])){if(isBefore(t,l[0]))break;a++}else a++,s=a}for(var c=o.length-1,d=!1,u=0;c>=0;){var l=o[c];if(u=c,isBetween(n,l[0],l[1])){d=!0;break}if(isBefore(n,l[0]))c--,u=c;else{if(!isBefore(n,l[1]))break;c--}}if(s==o.length&&!i&&0==u&&d&&(s=0),0==o.length)o.push([t,n]);else{var y=[i?o[s][0]:t,d?o[u][1]:n];u=Math.max(s,u);var p=diff_sum(o),m=!1;isBetween(0,y[0],y[1])&&0!=y[0]&&0!=y[1]?(o.splice(s,s!=u||i!=d||i?u-s+1:0,[y[0],0]),0!=o[0][0]&&o[0][1]!=y[1]&&o.splice(s+1,0,[0,y[1]]),m=!0):o.splice(s,s!=u||i!=d||i?u-s+1:0,y);var g=diff_sum(o);if(p>g&&(this.done=!0),0==y[0]||m)for(var h=0;0!=o[0][0]&&(o.push(o.shift()),!(h>=o.length));)h++}},function(){function e(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),n=t.exec(location.search);return null==n?"":decodeURIComponent(n[1].replace(/\+/g," "))}function t(e,t){history.pushState(null,"",o(e,t))}function n(t,n){var r=e(t);r=qe(qe(r," ;")+";"+n," ;"),history.pushState(null,"",o(t,r))}function r(t,n){var r=e(t);r=qe(qe(r," ;").replace(n,"").replace(/;;/g,"")," ;"),history.pushState(null,"",o(t,""!=r?r:null))}function o(e,t,n){n||(n=window.location.href);var r,o=new RegExp("([?&])"+e+"=.*?(&|#|$)(.*)","gi");if(o.test(n))return"undefined"!=typeof t&&null!==t?n.replace(o,"$1"+e+"="+t+"$2$3"):(r=n.split("#"),n=r[0].replace(o,"$1$3").replace(/(&|\?)$/,""),"undefined"!=typeof r[1]&&null!==r[1]&&(n+="#"+r[1]),n);if("undefined"!=typeof t&&null!==t){var a=-1!==n.indexOf("?")?"&":"?";return r=n.split("#"),n=r[0]+a+e+"="+t,"undefined"!=typeof r[1]&&null!==r[1]&&(n+="#"+r[1]),n}return n}function a(e){return parseInt(Math.floor(e/64))}function i(e,t,n){return n*(t-e)+e}function s(e,t,n){return(n-e)/(t-e)}function l(e,t){var n=i(pe[0],pe[1],e/ue),r=i(me[0],me[1],(7168-t)/ye);return{x:n,y:r}}function d(e,t){var n=parseInt(s(pe[0],pe[1],e)*ue),r=7168-parseInt(s(me[0],me[1],t)*ye);return{x:n,y:r}}function u(e,t){return{x:Math.floor(e/64+128),y:Math.floor(247-(t/64+119))}}function p(e,t){return{x:parseInt(64*(e-128)),y:parseInt(64*(247-t-119))}}function m(e){return e/(pe[1]-pe[0])*ue}function g(e,t,n){return 1==e&&"km"==t?3214.07509338*n:3.21407509338*n}function h(e,t){if(null!=e)var t=ge.getLonLatFromPixel(e.xy);else var t=t;te=Math.floor(t.lon/448),ee=Math.floor((t.lat-354)/(4766/28)),te=Math.max(te,0),te=Math.min(te,15),ee=Math.max(ee,0),ee=Math.min(ee,27);var n=document.getElementById("laneViewImage");n.src=de+"lane/"+ee+"-"+te+".jpg";var r=document.getElementById("laneView");r.style.display="flex";var o=document.getElementById("laneViewImageContainer");o.appendChild(n);var a=document.getElementById("laneViewBackground");a.style.display="block",f(te,ee)}function f(e,n){var r=l(448*e,n*(4766/28)+354);t("lane_view",Math.floor(r.x)+","+Math.floor(r.y))}function v(e,t){var o,a,i;if(e.object.showInfo)we.removeFeatures(e.object.day_vision_feature),_e.removeFeatures(e.object.night_vision_feature),Le.removeFeatures(e.object.true_sight_feature),Oe.removeFeatures(e.object.attack_range_feature),event.object.vision_feature&&xe.removeFeatures(event.object.vision_feature),event.object.vision_center_feature&&xe.removeFeatures(event.object.vision_center_feature),t||r("tower_vision",e.object.tower_loc[0]+","+e.object.tower_loc[1]);else{i=new OpenLayers.Geometry.Point(e.object.lonlat.lon,e.object.lonlat.lat),o=OpenLayers.Geometry.Polygon.createRegularPolygon(i,m(e.object.day_vision_radius),30),a=new OpenLayers.Feature.Vector(o),we.addFeatures(a),e.object.day_vision_feature=a,o=OpenLayers.Geometry.Polygon.createRegularPolygon(i,m(e.object.true_sight_radius),30),a=new OpenLayers.Feature.Vector(o,null,Ee.lightblue),Le.addFeatures(a),e.object.true_sight_feature=a,o=OpenLayers.Geometry.Polygon.createRegularPolygon(i,m(e.object.night_vision_radius),30),a=new OpenLayers.Feature.Vector(o),_e.addFeatures(a),e.object.night_vision_feature=a,o=OpenLayers.Geometry.Polygon.createRegularPolygon(i,m(e.object.attack_range_radius),30),a=new OpenLayers.Feature.Vector(o,null,Ee.red),Oe.addFeatures(a),e.object.attack_range_feature=a,t||n("tower_vision",e.object.tower_loc[0]+","+e.object.tower_loc[1]);var s=d(e.object.tower_loc[0],e.object.tower_loc[1]);z(new OpenLayers.LonLat(s.x,s.y),e.object,ae)}e.object.showInfo=!e.object.showInfo}function w(e){return function(t){var r=ge.getLonLatFromPixel(t.xy),o=_(r,e);n(o.ward_type,o.ward_loc)}}function _(e,t,n){var r=oe[t],o=j(r.icon_path,e),a=OpenLayers.Geometry.Polygon.createRegularPolygon(new OpenLayers.Geometry.Point(o.lonlat.lon,o.lonlat.lat),m(r.radius),40),i=new OpenLayers.Feature.Vector(a);if(Fe.addMarker(o),ke.addFeatures(i),o.radius_feature=i,o.events.register("mousedown",this,L),o.ward_type=t,o.ward_loc=t,void 0==n){var s=l(e.lon,e.lat);s.x=s.x.toFixed(0),s.y=s.y.toFixed(0),o.ward_loc=s.x+","+s.y}else o.ward_loc=n;return"observer"==t&&z(e,o,r.radius),o}function L(e){e.object.radius_feature&&ke.removeFeatures(e.object.radius_feature),e.object.vision_feature&&xe.removeFeatures(e.object.vision_feature),e.object.vision_center_feature&&xe.removeFeatures(e.object.vision_center_feature),Fe.removeMarker(e.object),OpenLayers.Event.stop(e),r(e.object.ward_type,e.object.ward_loc)}function O(){}function b(e){var t="";t+=1==e.order?"Distance: "+g(e.order,e.units,e.measure).toFixed(0)+" units":"Distance: "+g(e.order,e.units,e.measure).toFixed(0)+" units<sup>2</sup>",document.getElementById("output").innerHTML=t,Z=g(e.order,e.units,e.measure),document.getElementById("traveltime").innerHTML=(Z/document.getElementById("movespeed").value).toFixed(2),document.getElementById("traveltime-container").style.display=""}function F(e){var t=document.getElementById("output"),n="";n+=1==e.order?"Radius: "+g(e.order,e.units,e.measure).toFixed(0)+" units":"Distance: "+g(e.order,e.units,e.measure).toFixed(0)+" units<sup>2</sup>",t.innerHTML=n}function I(e){var t,n,r=document.getElementById("output"),o="",a=this;Q.select.deactivate(),1==e.order?(e.measure>0&&(t="km"==e.units?OpenLayers.Geometry.Polygon.createRegularPolygon(new OpenLayers.Geometry.Point(e.geometry.components[0].x,e.geometry.components[0].y),1e3*e.measure,30):OpenLayers.Geometry.Polygon.createRegularPolygon(new OpenLayers.Geometry.Point(e.geometry.components[0].x,e.geometry.components[0].y),e.measure,30),n=new OpenLayers.Feature.Vector(t),be.removeFeatures(e.geometry.circle_features),"circle_features"in e.geometry?(e.geometry.circle_features.length=0,e.geometry.circle_features.push(n)):e.geometry.circle_features=[n],n.measure_control=this,n.is_measuring=!0,be.addFeatures(n),e.geometry.components.length>2&&setTimeout(function(){n.is_measuring=!1,Q.select.activate(),a.cancel()},0)),o+="Radius: "+g(e.order,e.units,e.measure).toFixed(0)+" units"):o+="Distance: "+g(e.order,e.units,e.measure).toFixed(0)+" units<sup>2</sup>",r.innerHTML=o}function E(e){var t=l(e.object.lonlat.lon,e.object.lonlat.lat),o=u(t.x,t.y);e.object.treeVisible=!e.object.treeVisible,e.object.setOpacity(e.object.treeVisible?1:.4),N(o.x,o.y),e.object.treeVisible?r("cut_trees",e.object.tree_loc):n("cut_trees",e.object.tree_loc)}function B(){var e;for(var t in Q)e=Q[t],this.value==t&&this.checked?e.activate():e.deactivate(),"polygonControl"!=this.value&&"circle"!=this.value||!this.checked?Q.select.deactivate():Q.select.activate();document.getElementById("output").innerHTML="",document.getElementById("traveltime-container").style.display="none"}function M(e,t,n,r,o,a){function i(e){null==this.popup?(this.popup=this.createPopup(this.closeBox),ge.addPopup(this.popup),this.popup.show()):this.popup.toggle(),currentPopup=this.popup,OpenLayers.Event.stop(e)}var s,l=new OpenLayers.Feature(e,t);return l.closeBox=o,l.popupClass=n,l.data.popupContentHTML=r,l.data.overflow=a?"auto":"hidden",s=l.createMarker(),("Towers"==e.name||"Trees"==e.name)&&(s.events.register("mouseover",l,i),s.events.register("mouseout",l,i)),e.addMarker(s),s}function j(e,t){var n=new OpenLayers.Size(21,25),r=new OpenLayers.Pixel(-(n.w/2),-n.h),o=new OpenLayers.Icon(e,n,r),a=new OpenLayers.Marker(t,o);return a}function P(e,t){var n=d(e.x,e.y),r=d(e.x+64,e.y),o=d(e.x+64,e.y-64),a=d(e.x,e.y-64),i=[new OpenLayers.Geometry.Point(n.x,n.y),new OpenLayers.Geometry.Point(r.x,r.y),new OpenLayers.Geometry.Point(o.x,o.y),new OpenLayers.Geometry.Point(a.x,a.y)],s=new OpenLayers.Geometry.LinearRing(i),l=new OpenLayers.Feature.Vector(s,null,t);return l}function R(e){var t=this.map.getResolution(),n=Math.round((e.left-this.maxExtent.left)/(t*this.tileSize.w)),r=Math.round((this.maxExtent.top-e.top)/(t*this.tileSize.h)),o=ge.getZoom(),a=o+"/tile_"+n+"_"+r+"."+this.type,i=this.url;return i instanceof Array&&(i=this.selectUrl(a,i)),i+a}function C(e){var n,r={},o=ge.getLayersByName("Placed Wards")[0];for(var a in e)if("trigger_multiple"!=a&&"ent_dota_tree"!=a&&"trigger_no_wards"!=a&&"ent_fow_blocker_node"!=a){r[a]=new OpenLayers.Layer.Markers(he[a]),ge.addLayer(r[a]),r[a].setVisibility(!1);for(var i=0;i<e[a].length;i++){var s=d(e[a][i][0],e[a][i][1]);n=M(r[a],new OpenLayers.LonLat(s.x,s.y),OpenLayers.Popup.FramedCloud,"Click to toggle range overlay",!1),n.day_vision_radius=ae,n.night_vision_radius=ie,n.true_sight_radius=se,n.attack_range_radius=le,n.showInfo=!1,"npc_dota_tower"==a&&(n.events.register("mousedown",r[a],v),n.tower_loc=e[a][i])}}else"ent_dota_tree"==a?(r[a]=new OpenLayers.Layer.Markers(he[a]),ge.addLayer(r[a]),r[a].setVisibility(!1),r[a].data=e[a]):"trigger_multiple"==a&&V(r,a,"npc_dota_neutral_spawner_box","trigger_multiple.kml");ge.raiseLayer(o,ge.layers.length),ge.events.register("changelayer",null,function(e){"visibility"!==e.property||e.layer.name!=he.ent_dota_tree||e.layer.loaded||T(),"visibility"===e.property&&t(e.layer.name.replace(/ /g,""),e.layer.visibility?!0:null)}),ze--,0==ze&&S()}function T(){for(var e=ge.getLayersByName(he.ent_dota_tree)[0],t=0;t<e.data.length;t++){var n=d(e.data[t][0],e.data[t][1]);marker=M(e,new OpenLayers.LonLat(n.x,n.y),OpenLayers.Popup.FramedCloud,"Click to toggle tree as alive or cut-down.<br>This will affect the simulated placed wards vision.<br>Tree coordinate: "+e.data[t][0]+", "+e.data[t][1],!1),marker.treeVisible=!0,marker.tree_loc=e.data[t][0]+","+e.data[t][1],marker.events.register("mousedown",e,E),Be[e.data[t][0]+","+e.data[t][1]]=marker}e.loaded=!e.loaded}function V(e,t,n,r){e[n]=new OpenLayers.Layer.Vector(he[t],{strategies:[new OpenLayers.Strategy.Fixed],protocol:new OpenLayers.Protocol.HTTP({url:r,format:new OpenLayers.Format.KML({extractStyles:!0,extractAttributes:!0})})}),ge.addLayer(e[n]),e[n].setVisibility(!1)}function S(){for(var t=["observer","sentry"],n=0;n<t.length;n++){var r=e(t[n]);r&&(ward_coordinates=qe(r," ;").split(";"),ward_coordinates.map(function(e){var r=e.split(","),o=d(parseFloat(r[0]),parseFloat(r[1]));_(new OpenLayers.LonLat(o.x,o.y),t[n],e)}))}for(k in he){var o=he[k].replace(/ /g,"");if(value=e(o),value){var a=ge.getLayersByName(he[k])[0];a.setVisibility("true"==value)}}var i=e("cut_trees");if(i){var a=ge.getLayersByName(he.ent_dota_tree)[0];a.loaded||T(),cut_tree_coordinates=qe(i," ;").split(";");for(var n=0;n<cut_tree_coordinates.length;n++)Be[cut_tree_coordinates[n]].treeVisible=!1,Be[cut_tree_coordinates[n]].setOpacity(.4)}var s=e("tower_vision");if(s){var a=ge.getLayersByName(he.npc_dota_tower)[0];tower_vision_coordinates=qe(s," ;").split(";");for(var n=0;n<tower_vision_coordinates.length;n++)for(var l=0;l<a.markers.length;l++)a.markers[l].tower_loc[0]+","+a.markers[l].tower_loc[1]==tower_vision_coordinates[n]&&v({object:a.markers[l]},!0)}var c=e("lane_view");if(c){document.getElementById("laneviewToggle").checked=!0,B.call(document.getElementById("laneviewToggle"));var u=c.split(","),y=d(parseFloat(u[0]),parseFloat(u[1]));h(null,new OpenLayers.LonLat(y.x,y.y))}}function A(e,t){var n=new XMLHttpRequest;return n.open("GET",e,!0),n.onload=function(){if(n.status>=200&&n.status<400){var e=JSON.parse(n.responseText);t(e)}else alert("Error loading page.")},n.onerror=function(){alert("Error loading page.")},n.send(),n}function G(e,t){var n=e+","+t,r=Re.getImageData(e,t,1,1),o=r.data;return Ge[n]?"invalid":255==o[0]&&255==o[1]&&255==o[2]?"invalid":153==o[0]?"high":102==o[0]?"middle":51==o[0]?"low":204==o[0]?"high2":255==o[0]?"uber":void 0}function D(e){return"invalid"==e||"low"==e?"invalid":"middle"==e?"low":"high"==e?"middle":"high2"==e?"high":"uber"==e?"high2":void 0}function H(e,t){for(Xe in De[t])if(Ve[Xe]){skey=Xe.split(","),x=parseFloat(skey[0]),y=parseFloat(skey[1]);var n=J[Xe];c=[0,0];for(var r=0;r<n.length;r++)c[0]+=parseFloat(n[r].split(",")[0]),c[1]+=parseFloat(n[r].split(",")[1]);c=[c[0]/n.length,c[1]/n.length],e[Xe]=["tree",c[0],c[1],Math.SQRT2],e[c[0]+","+c[1]]=["tree",c[0],c[1],Math.SQRT2]}}function z(e,t,n){if(re){var r,o,i=l(e.lon,e.lat),s=u(i.x,i.y),c=s.x,y=s.y,m=G(c,y),g=D(m),h=c+","+y,f=new ROT.FOV.PreciseShadowcasting(q,{topology:8}),v=[],w=null,_=a(n);if(r=P(p(s.x,s.y),"invalid"==m||Ve[h]?Ee.red:Ee.green),xe.addFeatures([r]),t.vision_center_feature=r,"invalid"==m||Ve[h])return Ce={},$(Ce,Ve),$(Ce,X),void(ne&&U());Ce={},$(Ce,Y[m]),$(Ce,X),H(Ce,m),"invalid"!=g&&H(Ce,g),Te={},f.walls=Ce,f.compute(c,y,_,function(e,t,r,o){var a=e+","+t;pt=p(e,t),pt2=p(c,y),pt.x+=32,pt.y-=32,pt2.x+=32,pt2.y-=32,(1==o&&!Ae[a]&&(pt2.x-pt.x)*(pt2.x-pt.x)+(pt2.y-pt.y)*(pt2.y-pt.y)<n*n||2>=r)&&(Te[a]=255,v.push(p(e,t)))});for(var L=0;L<v.length;L++){var O=v[L],n=d(O.x,O.y),b=d(O.x+64,O.y),k=d(O.x+64,O.y-64),x=d(O.x,O.y-64),F=je.createLinearRing([new jsts.geom.Coordinate(n.x,n.y),new jsts.geom.Coordinate(b.x,b.y),new jsts.geom.Coordinate(k.x,k.y),new jsts.geom.Coordinate(x.x,x.y),new jsts.geom.Coordinate(n.x,n.y)]),I=je.createPolygon(F);w=null==w?I:w.union(I)}w=Me.write(w),o=new OpenLayers.Feature.Vector(w,null,Ee.yellow),xe.addFeatures([o]),t.vision_feature=o,ne&&U()}}function q(e,t){return!(e+","+t in Ce)}function $(e,t){for(var n=0;n<t.length;n++)e[t[n][0]+","+t[n][1]]=["wall",t[n][0],t[n][1],Math.SQRT2/2]}function N(e,t){var n=e+","+t;if(J[n])for(var r=0;r<J[n].length;r++)Ve[J[n][r]]?delete Ve[J[n][r]]:Ve[J[n][r]]=1}function W(e){J=e.tree_relations,K=e.trees,Y=e.elevations,X=e.ent_fow_blocker_node,$(Ve,K),$(Ge,e.trigger_no_wards),$(Ae,e.ent_fow_blocker_node),$(Se,e.elevations.invalid),$(De.high2,e.tree_elevations.high2),$(De.high,e.tree_elevations.high),$(De.middle,e.tree_elevations.middle),$(De.low,e.tree_elevations.low),$(De.uber,e.tree_elevations.uber),ze--,0==ze&&S()}function U(){Ke.clearRect(0,0,Ke.canvas.width,Ke.canvas.height),Ke.fillStyle="rgb("+Ue.join(",")+")",Ke.fillRect(0,0,$e[0]*Ne[0],$e[1]*Ne[1]);for(var e=0;e<Ne[0];e++)for(var t=0;t<Ne[1];t++){var n=e+","+t,r=Te[n],o=[];r?(o=Qe,J[n]&&!Ve[n]&&(o=Je),Ke.fillStyle="rgb("+o.join(",")+")",Ke.fillRect(e*$e[0],t*$e[1],$e[0],$e[1])):!r&&J[n]?(o=Ve[n]?[0,255,0]:Ze,Ke.fillStyle="rgb("+o.join(",")+")",Ke.fillRect(e*$e[0],t*$e[1],$e[0],$e[1])):!r&&Se[n]&&(o=We,Ke.fillStyle="rgb("+o.join(",")+")",Ke.fillRect(e*$e[0],t*$e[1],$e[0],$e[1]))}}var Q,Z,J,K,X,Y,ee,te,ne=!1,re=!1,oe={observer:{icon_path:"ward_observer.png",radius:1600},sentry:{icon_path:"ward_sentry.png",radius:850}},ae=1900,ie=800,se=900,le=700,ce="data.json",de="tiles/",ue=6928,ye=6928,pe=[-8838.16537623,8838.16537623],me=[8837.78807947,-8837.78807947],ge=new OpenLayers.Map("map",{maxExtent:new OpenLayers.Bounds(0,0,7168,7168),numZoomLevels:3,maxResolution:4,units:"m",projection:"EPSG:900913",displayProjection:new OpenLayers.Projection("EPSG:900913")}),he={npc_dota_roshan_spawner:"Roshan",dota_item_rune_spawner:"Runes",ent_dota_tree:"Trees",npc_dota_fort:"Ancients",ent_dota_shop:"Shops",npc_dota_tower:"Towers",npc_dota_barracks:"Barracks",npc_dota_building:"Buildings",trigger_multiple:"Neutral Camps Spawn Boxes",npc_dota_neutral_spawner:"Neutral Camps",trigger_no_wards:"Invalid Ward Locations",ent_fow_blocker_node:"Vision Blocker"},fe=new OpenLayers.Layer.TMS("Dota 2 Map",de,{type:"png",getURL:R}),ve=new OpenLayers.Control.LayerSwitcher({ascending:!1}),we=new OpenLayers.Layer.Vector("Day Vision Range"),_e=new OpenLayers.Layer.Vector("Night Vision Range"),Le=new OpenLayers.Layer.Vector("True Sight Range"),Oe=new OpenLayers.Layer.Vector("Attack Range"),be=new OpenLayers.Layer.Vector("Drawn Circles"),ke=new OpenLayers.Layer.Vector("Ward Vision"),xe=new OpenLayers.Layer.Vector("Ward Vision with Fog"),Fe=new OpenLayers.Layer.Markers("Placed Wards"),Ie=OpenLayers.Util.getParameters(window.location.href).renderer,Ee={lightblue:{strokeColor:"#007FFF",strokeOpacity:1,strokeWidth:1,fillColor:"#007FFF",fillOpacity:.4},red:{strokeColor:"#FF0000",strokeOpacity:1,strokeWidth:1,fillColor:"#FF0000",fillOpacity:.4},green:{strokeColor:"#00FF00",strokeOpacity:1,strokeWidth:1,fillColor:"#00FF00",fillOpacity:.4},yellow:{strokeColor:"#FFFF00",strokeOpacity:1,strokeWidth:1,fillColor:"#FFFF00",fillOpacity:.4}},Be={},Me=new jsts.io.OpenLayersParser,je=new jsts.geom.GeometryFactory,Pe=document.getElementById("elevation-canvas"),Re=Pe.getContext("2d"),Ce={},Te={},Ve={},Se={},Ae={},Ge={},De={high2:{},high:{},middle:{},low:{},uber:{}},He=new Image,ze=2,qe=function(){"use strict";function e(e){return e.replace(/[\[\](){}?*+\^$\\.|\-]/g,"\\$&")}return function(t,n,r){if(r=r||"g","string"!=typeof t||"string"!=typeof n||"string"!=typeof r)throw new TypeError("argument must be string");if(!/^[gi]*$/.test(r))throw new TypeError("Invalid flags supplied '"+r.match(new RegExp("[^gi]*"))+"'");return n=e(n),t.replace(new RegExp("^["+n+"]+|["+n+"]+$",r),"")}}();if(document.getElementById("arrow-left").addEventListener("click",function(){te=Math.max(te-1,0);var e=document.getElementById("laneViewImage");e.src=de+"lane/"+ee+"-"+te+".jpg",f(te,ee)},!1),document.getElementById("arrow-right").addEventListener("click",function(){te=Math.min(te+1,15);var e=document.getElementById("laneViewImage");e.src=de+"lane/"+ee+"-"+te+".jpg",f(te,ee)},!1),document.getElementById("arrow-top").addEventListener("click",function(){ee=Math.min(ee+1,27);var e=document.getElementById("laneViewImage");e.src=de+"lane/"+ee+"-"+te+".jpg",f(te,ee)},!1),document.getElementById("arrow-bottom").addEventListener("click",function(){ee=Math.max(ee-1,0);var e=document.getElementById("laneViewImage");e.src=de+"lane/"+ee+"-"+te+".jpg",f(te,ee)},!1),document.getElementById("close").addEventListener("click",function(){var e=document.getElementById("laneView");e.style.display="none";var n=document.getElementById("laneViewBackground");n.style.display="none",t("lane_view",null)},!1),ne){var $e=[1,1],Ne=[256,248],We=[40,40,40],Ue=[160,160,160],Qe=[255,255,0],Ze=[102,51,0],Je=[167,173,47],Ke=document.getElementById("canvas").getContext("2d");Ke.canvas.width=$e[0]*Ne[0],Ke.canvas.height=$e[1]*Ne[1],Ke.fillStyle="black"}ge.addLayer(fe),ge.zoomToMaxExtent(),ge.addControl(ve),ve.maximizeControl(),ge.addLayer(we),ge.addLayer(_e),ge.addLayer(Le),ge.addLayer(Oe),ge.addLayer(be),ge.addLayer(ke),ge.addLayer(Fe),OpenLayers.Control.Click=OpenLayers.Class(OpenLayers.Control,{defaultHandlerOptions:{single:!0,"double":!1,pixelTolerance:0,stopSingle:!1,stopDouble:!1},initialize:function(){this.handlerOptions=OpenLayers.Util.extend({},this.defaultHandlerOptions),OpenLayers.Control.prototype.initialize.apply(this,arguments),this.handler=new OpenLayers.Handler.Click(this,{click:this.onClick,dblclick:this.onDblclick},this.handlerOptions)},onClick:O,onDblclick:function(e){var t=document.getElementById(this.key+"Output"),n="dblclick "+e.xy;t.value=t.value+n+"\n"}}),Ie=Ie?[Ie]:OpenLayers.Layer.Vector.prototype.renderers,Q={line:new OpenLayers.Control.Measure(OpenLayers.Handler.Path,{persist:!0,immediate:!0,handlerOptions:{layerOptions:{renderers:Ie}}}),circle:new OpenLayers.Control.Measure(OpenLayers.Handler.Path,{persist:!1,immediate:!0,handlerOptions:{layerOptions:{renderers:Ie}}}),observerclick:new OpenLayers.Control.Click({onClick:w("observer"),handlerOptions:{single:!0}}),sentryclick:new OpenLayers.Control.Click({onClick:w("sentry"),handlerOptions:{single:!0}}),laneviewclick:new OpenLayers.Control.Click({onClick:h,handlerOptions:{single:!0}}),polygonControl:new OpenLayers.Control.DrawFeature(be,OpenLayers.Handler.RegularPolygon,{handlerOptions:{sides:30}}),select:new OpenLayers.Control.SelectFeature(be,{hover:!0,highlightOnly:!1,callbacks:{click:function(e){var t=document.getElementById("output");e.measure_control&&e.is_measuring?(e.measure_control.cancel(),e.is_measuring=!1,this.highlight(e)):(t.innerHTML="",be.removeFeatures(e))}},overFeature:function(e){var t=document.getElementById("output"),n="Radius: "+(.565352*Math.sqrt(e.geometry.getArea())*3.21407509338).toFixed(0)+" units";t.innerHTML=n,this.highlight(e)},outFeature:function(e){var t=document.getElementById("output");t.innerHTML="",this.unhighlight(e)}})};for(var Xe in Q)"line"==Xe&&Q[Xe].events.on({measure:b,measurepartial:b}),"circle"==Xe&&Q[Xe].events.on({measure:F,measurepartial:I}),ge.addControl(Q[Xe]);ge.events.register("mousemove",ge,function(e){var t,n,r,o,a=this.events.getMousePosition(e),i=ge.getLonLatFromPixel(e.xy),s=l(i.lon,i.lat);a.x=s.x.toFixed(0),a.y=s.y.toFixed(0),OpenLayers.Util.getElement("coords").innerHTML=a,ke.cursor_marker&&ke.removeFeatures(ke.cursor_marker),document.getElementById("observerToggle").checked&&(t=u(s.x,s.y),n=t.x+","+t.y,r=G(t.x,t.y),o=P(p(t.x,t.y),"invalid"==r||Ve[n]?Ee.red:Ee.green),ke.addFeatures([o]),ke.cursor_marker=o)}),document.getElementById("controls-max").addEventListener("click",function(){document.getElementById("controls-list").style.display="",document.getElementById("output-panel").style.display="",document.getElementById("controls-min").style.display="block",this.style.display="none"},!1),document.getElementById("controls-min").addEventListener("click",function(){document.getElementById("controls-list").style.display="none",document.getElementById("output-panel").style.display="none",document.getElementById("controls-max").style.display="block",this.style.display="none"},!1),document.getElementById("coordControl").addEventListener("change",function(){document.getElementById("coords").style.display=this.checked?"block":"none"},!1),document.getElementById("movespeed").addEventListener("change",function(){document.getElementById("traveltime").innerHTML=(Z/document.getElementById("movespeed").value).toFixed(2)},!1),document.getElementById("noneToggle").addEventListener("click",B,!1),document.getElementById("lineToggle").addEventListener("click",B,!1),document.getElementById("circleToggle").addEventListener("click",B,!1),document.getElementById("observerToggle").addEventListener("click",B,!1),document.getElementById("sentryToggle").addEventListener("click",B,!1),He.src="elevation.png",He.onload=function(){A(ce,C),A("vision.json",W),Pe.width=He.width,Pe.height=He.height,Pe.getContext("2d").drawImage(He,0,0,He.width,He.height)}}();