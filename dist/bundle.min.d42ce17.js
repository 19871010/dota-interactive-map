var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){if(n.get||n.set)throw new TypeError("ES3 does not support getters and setters.");e!=Array.prototype&&e!=Object.prototype&&(e[t]=n.value)},$jscomp.getGlobal=function(e){return"undefined"!=typeof window&&window===e?e:"undefined"!=typeof global&&null!=global?global:e},$jscomp.global=$jscomp.getGlobal(this),$jscomp.polyfill=function(e,t,n,i){if(t){for(n=$jscomp.global,e=e.split("."),i=0;i<e.length-1;i++){var r=e[i];r in n||(n[r]={}),n=n[r]}e=e[e.length-1],i=n[e],t=t(i),t!=i&&null!=t&&$jscomp.defineProperty(n,e,{configurable:!0,writable:!0,value:t})}},$jscomp.polyfill("Array.prototype.fill",function(e){return e?e:function(e,t,n){var i=this.length||0;for(0>t&&(t=Math.max(0,i+t)),(null==n||n>i)&&(n=i),n=Number(n),0>n&&(n=Math.max(0,i+n)),t=Number(t||0);t<n;t++)this[t]=e;return this}},"es6-impl","es3");var OpenLayers={VERSION_NUMBER:"Release 2.14 dev",singleFile:!0,_getScriptLocation:function(){for(var e,t=/(^|(.*?\/))(OpenLayers[^\/]*?\.js)(\?|$)/,n=document.getElementsByTagName("script"),i="",r=0,s=n.length;r<s;r++)if((e=n[r].getAttribute("src"))&&(e=e.match(t))){i=e[1];break}return function(){return i}}(),ImgPath:""};OpenLayers.Class=function(){var e=arguments.length,t=arguments[0],n=arguments[e-1],i="function"==typeof n.initialize?n.initialize:function(){t.prototype.initialize.apply(this,arguments)};return 1<e?(e=[i,t].concat(Array.prototype.slice.call(arguments).slice(1,e-1),n),OpenLayers.inherit.apply(null,e)):i.prototype=n,i},OpenLayers.inherit=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n;var i,r,n=2;for(i=arguments.length;n<i;n++)r=arguments[n],"function"==typeof r&&(r=r.prototype),OpenLayers.Util.extend(e.prototype,r)},OpenLayers.Util=OpenLayers.Util||{},OpenLayers.Util.extend=function(e,t){if(e=e||{},t){for(var n in t){var i=t[n];void 0!==i&&(e[n]=i)}"function"==typeof window.Event&&t instanceof window.Event||!t.hasOwnProperty||!t.hasOwnProperty("toString")||(e.toString=t.toString)}return e},OpenLayers.String={startsWith:function(e,t){return 0==e.indexOf(t)},contains:function(e,t){return-1!=e.indexOf(t)},trim:function(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},camelize:function(e){e=e.split("-");for(var t=e[0],n=1,i=e.length;n<i;n++)var r=e[n],t=t+(r.charAt(0).toUpperCase()+r.substring(1));return t},format:function(e,t,n){return t||(t=window),e.replace(OpenLayers.String.tokenRegEx,function(e,i){for(var r,s=i.split(/\.+/),a=0;a<s.length&&(0==a&&(r=t),void 0!==r);a++)r=r[s[a]];return"function"==typeof r&&(r=n?r.apply(null,n):r()),"undefined"==typeof r?"undefined":r})},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(e){return OpenLayers.String.numberRegEx.test(e)},numericIf:function(e,t){var n=e;return!0===t&&null!=e&&e.replace&&(e=e.replace(/^\s*|\s*$/g,"")),OpenLayers.String.isNumeric(e)?parseFloat(e):n}},OpenLayers.Number={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(e,t){var n=0;return 0<t&&(n=parseFloat(e.toPrecision(t))),n},format:function(e,t,n,i){t="undefined"!=typeof t?t:0,n="undefined"!=typeof n?n:OpenLayers.Number.thousandsSeparator,i="undefined"!=typeof i?i:OpenLayers.Number.decimalSeparator,null!=t&&(e=parseFloat(e.toFixed(t)));var r=e.toString().split(".");if(1==r.length&&null==t&&(t=0),e=r[0],n)for(var s=/(-?[0-9]+)([0-9]{3})/;s.test(e);)e=e.replace(s,"$1"+n+"$2");return 0==t?t=e:(n=1<r.length?r[1]:"0",null!=t&&(n+=Array(t-n.length+1).join("0")),t=e+i+n),t},zeroPad:function(e,t,n){for(e=e.toString(n||10);e.length<t;)e="0"+e;return e}},OpenLayers.Function={bind:function(e,t){var n=Array.prototype.slice.call(arguments,2);return function(){var i=n.concat(Array.prototype.slice.call(arguments,0));return e.apply(t,i)}},bindAsEventListener:function(e,t){return function(n){return e.call(t,n||window.event)}},False:function(){return!1},True:function(){return!0},Void:function(){}},OpenLayers.Array={filter:function(e,t,n){var i=[];if(Array.prototype.filter)i=e.filter(t,n);else{var r=e.length;if("function"!=typeof t)throw new TypeError;for(var s=0;s<r;s++)if(s in e){var a=e[s];t.call(n,a,s,e)&&i.push(a)}}return i}},OpenLayers.Bounds=OpenLayers.Class({left:null,bottom:null,right:null,top:null,centerLonLat:null,initialize:function(e,t,n,i){OpenLayers.Util.isArray(e)&&(i=e[3],n=e[2],t=e[1],e=e[0]),null!=e&&(this.left=OpenLayers.Util.toFloat(e)),null!=t&&(this.bottom=OpenLayers.Util.toFloat(t)),null!=n&&(this.right=OpenLayers.Util.toFloat(n)),null!=i&&(this.top=OpenLayers.Util.toFloat(i))},clone:function(){return new OpenLayers.Bounds(this.left,this.bottom,this.right,this.top)},equals:function(e){var t=!1;return null!=e&&(t=this.left==e.left&&this.right==e.right&&this.top==e.top&&this.bottom==e.bottom),t},toString:function(){return[this.left,this.bottom,this.right,this.top].join()},toArray:function(e){return!0===e?[this.bottom,this.left,this.top,this.right]:[this.left,this.bottom,this.right,this.top]},toBBOX:function(e,t){null==e&&(e=6);var n=Math.pow(10,e),i=Math.round(this.left*n)/n,r=Math.round(this.bottom*n)/n,s=Math.round(this.right*n)/n,n=Math.round(this.top*n)/n;return!0===t?r+","+i+","+n+","+s:i+","+r+","+s+","+n},toGeometry:function(){return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(this.left,this.bottom),new OpenLayers.Geometry.Point(this.right,this.bottom),new OpenLayers.Geometry.Point(this.right,this.top),new OpenLayers.Geometry.Point(this.left,this.top)])])},getWidth:function(){return this.right-this.left},getHeight:function(){return this.top-this.bottom},getSize:function(){return new OpenLayers.Size(this.getWidth(),this.getHeight())},getCenterPixel:function(){return new OpenLayers.Pixel((this.left+this.right)/2,(this.bottom+this.top)/2)},getCenterLonLat:function(){return this.centerLonLat||(this.centerLonLat=new OpenLayers.LonLat((this.left+this.right)/2,(this.bottom+this.top)/2)),this.centerLonLat},scale:function(e,t){null==t&&(t=this.getCenterLonLat());var n,i;return"OpenLayers.LonLat"==t.CLASS_NAME?(n=t.lon,i=t.lat):(n=t.x,i=t.y),new OpenLayers.Bounds((this.left-n)*e+n,(this.bottom-i)*e+i,(this.right-n)*e+n,(this.top-i)*e+i)},add:function(e,t){if(null==e||null==t)throw new TypeError("Bounds.add cannot receive null values");return new OpenLayers.Bounds(this.left+e,this.bottom+t,this.right+e,this.top+t)},extend:function(e){if(e)switch(e.CLASS_NAME){case"OpenLayers.LonLat":this.extendXY(e.lon,e.lat);break;case"OpenLayers.Geometry.Point":this.extendXY(e.x,e.y);break;case"OpenLayers.Bounds":this.centerLonLat=null,(null==this.left||e.left<this.left)&&(this.left=e.left),(null==this.bottom||e.bottom<this.bottom)&&(this.bottom=e.bottom),(null==this.right||e.right>this.right)&&(this.right=e.right),(null==this.top||e.top>this.top)&&(this.top=e.top)}},extendXY:function(e,t){this.centerLonLat=null,(null==this.left||e<this.left)&&(this.left=e),(null==this.bottom||t<this.bottom)&&(this.bottom=t),(null==this.right||e>this.right)&&(this.right=e),(null==this.top||t>this.top)&&(this.top=t)},containsLonLat:function(e,t){"boolean"==typeof t&&(t={inclusive:t}),t=t||{};var n=this.contains(e.lon,e.lat,t.inclusive),i=t.worldBounds;return i&&!n&&(n=i.getWidth(),n=this.containsLonLat({lon:e.lon-Math.round((e.lon-(i.left+i.right)/2)/n)*n,lat:e.lat},{inclusive:t.inclusive})),n},containsPixel:function(e,t){return this.contains(e.x,e.y,t)},contains:function(e,t,n){return null==n&&(n=!0),null!=e&&null!=t&&(e=OpenLayers.Util.toFloat(e),t=OpenLayers.Util.toFloat(t),n?e>=this.left&&e<=this.right&&t>=this.bottom&&t<=this.top:e>this.left&&e<this.right&&t>this.bottom&&t<this.top)},intersectsBounds:function(e,t){if("boolean"==typeof t&&(t={inclusive:t}),t=t||{},t.worldBounds){var n=this.wrapDateLine(t.worldBounds);e=e.wrapDateLine(t.worldBounds)}else n=this;null==t.inclusive&&(t.inclusive=!0);var i=!1,r=n.left==e.right||n.right==e.left||n.top==e.bottom||n.bottom==e.top;if(t.inclusive||!r)var i=e.top>=n.bottom&&e.top<=n.top||n.top>e.bottom&&n.top<e.top,r=e.left>=n.left&&e.left<=n.right||n.left>=e.left&&n.left<=e.right,s=e.right>=n.left&&e.right<=n.right||n.right>=e.left&&n.right<=e.right,i=(e.bottom>=n.bottom&&e.bottom<=n.top||n.bottom>=e.bottom&&n.bottom<=e.top||i)&&(r||s);if(t.worldBounds&&!i){var a=t.worldBounds,r=a.getWidth(),s=!a.containsBounds(n),a=!a.containsBounds(e);s&&!a?(e=e.add(-r,0),i=n.intersectsBounds(e,{inclusive:t.inclusive})):a&&!s&&(n=n.add(-r,0),i=e.intersectsBounds(n,{inclusive:t.inclusive}))}return i},containsBounds:function(e,t,n){null==t&&(t=!1),null==n&&(n=!0);var i=this.contains(e.left,e.bottom,n),r=this.contains(e.right,e.bottom,n),s=this.contains(e.left,e.top,n);return e=this.contains(e.right,e.top,n),t?i||r||s||e:i&&r&&s&&e},determineQuadrant:function(e){var t="",n=this.getCenterLonLat(),t=t+(e.lat<n.lat?"b":"t");return t+=e.lon<n.lon?"l":"r"},transform:function(e,t){this.centerLonLat=null;var n=OpenLayers.Projection.transform({x:this.left,y:this.bottom},e,t),i=OpenLayers.Projection.transform({x:this.right,y:this.bottom},e,t),r=OpenLayers.Projection.transform({x:this.left,y:this.top},e,t),s=OpenLayers.Projection.transform({x:this.right,y:this.top},e,t);return this.left=Math.min(n.x,r.x),this.bottom=Math.min(n.y,i.y),this.right=Math.max(i.x,s.x),this.top=Math.max(r.y,s.y),this},wrapDateLine:function(e,t){t=t||{};var n=t.leftTolerance||0,i=t.rightTolerance||0,r=this.clone();if(e){for(var s=e.getWidth();r.left<e.left&&r.right-i<=e.left;)r=r.add(s,0);for(;r.left+n>=e.right&&r.right>e.right;)r=r.add(-s,0);n=r.left+n,n<e.right&&n>e.left&&r.right-i>e.right&&(r=r.add(-s,0))}return r},CLASS_NAME:"OpenLayers.Bounds"}),OpenLayers.Bounds.fromString=function(e,t){var n=e.split(",");return OpenLayers.Bounds.fromArray(n,t)},OpenLayers.Bounds.fromArray=function(e,t){return!0===t?new OpenLayers.Bounds(e[1],e[0],e[3],e[2]):new OpenLayers.Bounds(e[0],e[1],e[2],e[3])},OpenLayers.Bounds.fromSize=function(e){return new OpenLayers.Bounds(0,e.h,e.w,0)},OpenLayers.Bounds.oppositeQuadrant=function(e){var t;return t=""+("t"==e.charAt(0)?"b":"t"),t+="l"==e.charAt(1)?"r":"l"},OpenLayers.Element={visible:function(e){return"none"!=OpenLayers.Util.getElement(e).style.display},toggle:function(){for(var e=0,t=arguments.length;e<t;e++){var n=OpenLayers.Util.getElement(arguments[e]),i=OpenLayers.Element.visible(n)?"none":"";n.style.display=i}},remove:function(e){e=OpenLayers.Util.getElement(e),e.parentNode.removeChild(e)},getHeight:function(e){return e=OpenLayers.Util.getElement(e),e.offsetHeight},hasClass:function(e,t){var n=e.className;return!!n&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(n)},addClass:function(e,t){return OpenLayers.Element.hasClass(e,t)||(e.className+=(e.className?" ":"")+t),e},removeClass:function(e,t){var n=e.className;return n&&(e.className=OpenLayers.String.trim(n.replace(new RegExp("(^|\\s+)"+t+"(\\s+|$)")," "))),e},toggleClass:function(e,t){return OpenLayers.Element.hasClass(e,t)?OpenLayers.Element.removeClass(e,t):OpenLayers.Element.addClass(e,t),e},getStyle:function(e,t){e=OpenLayers.Util.getElement(e);var n=null;if(e&&e.style){n=e.style[OpenLayers.String.camelize(t)],n||(document.defaultView&&document.defaultView.getComputedStyle?n=(n=document.defaultView.getComputedStyle(e,null))?n.getPropertyValue(t):null:e.currentStyle&&(n=e.currentStyle[OpenLayers.String.camelize(t)]));var i=["left","top","right","bottom"];window.opera&&-1!=OpenLayers.Util.indexOf(i,t)&&"static"==OpenLayers.Element.getStyle(e,"position")&&(n="auto")}return"auto"==n?null:n}},OpenLayers.LonLat=OpenLayers.Class({lon:0,lat:0,initialize:function(e,t){OpenLayers.Util.isArray(e)&&(t=e[1],e=e[0]),this.lon=OpenLayers.Util.toFloat(e),this.lat=OpenLayers.Util.toFloat(t)},toString:function(){return"lon="+this.lon+",lat="+this.lat},toShortString:function(){return this.lon+", "+this.lat},clone:function(){return new OpenLayers.LonLat(this.lon,this.lat)},add:function(e,t){if(null==e||null==t)throw new TypeError("LonLat.add cannot receive null values");return new OpenLayers.LonLat(this.lon+OpenLayers.Util.toFloat(e),this.lat+OpenLayers.Util.toFloat(t))},equals:function(e){var t=!1;return null!=e&&(t=this.lon==e.lon&&this.lat==e.lat||isNaN(this.lon)&&isNaN(this.lat)&&isNaN(e.lon)&&isNaN(e.lat)),t},transform:function(e,t){var n=OpenLayers.Projection.transform({x:this.lon,y:this.lat},e,t);return this.lon=n.x,this.lat=n.y,this},wrapDateLine:function(e){var t=this.clone();if(e){for(;t.lon<e.left;)t.lon+=e.getWidth();for(;t.lon>e.right;)t.lon-=e.getWidth()}return t},CLASS_NAME:"OpenLayers.LonLat"}),OpenLayers.LonLat.fromString=function(e){return e=e.split(","),new OpenLayers.LonLat(e[0],e[1])},OpenLayers.LonLat.fromArray=function(e){var t=OpenLayers.Util.isArray(e);return new OpenLayers.LonLat(t&&e[0],t&&e[1])},OpenLayers.Pixel=OpenLayers.Class({x:0,y:0,initialize:function(e,t){this.x=parseFloat(e),this.y=parseFloat(t)},toString:function(){return"x="+this.x+",y="+this.y},clone:function(){return new OpenLayers.Pixel(this.x,this.y)},equals:function(e){var t=!1;return null!=e&&(t=this.x==e.x&&this.y==e.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(e.x)&&isNaN(e.y)),t},distanceTo:function(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))},add:function(e,t){if(null==e||null==t)throw new TypeError("Pixel.add cannot receive null values");return new OpenLayers.Pixel(this.x+e,this.y+t)},offset:function(e){var t=this.clone();return e&&(t=this.add(e.x,e.y)),t},CLASS_NAME:"OpenLayers.Pixel"}),OpenLayers.Size=OpenLayers.Class({w:0,h:0,initialize:function(e,t){this.w=parseFloat(e),this.h=parseFloat(t)},toString:function(){return"w="+this.w+",h="+this.h},clone:function(){return new OpenLayers.Size(this.w,this.h)},equals:function(e){var t=!1;return null!=e&&(t=this.w==e.w&&this.h==e.h||isNaN(this.w)&&isNaN(this.h)&&isNaN(e.w)&&isNaN(e.h)),t},CLASS_NAME:"OpenLayers.Size"}),OpenLayers.Console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},userError:function(e){alert(e)},assert:function(){},dir:function(){},dirxml:function(){},trace:function(){},group:function(){},groupEnd:function(){},time:function(){},timeEnd:function(){},profile:function(){},profileEnd:function(){},count:function(){},CLASS_NAME:"OpenLayers.Console"},function(){for(var e=document.getElementsByTagName("script"),t=0,n=e.length;t<n;++t)if(-1!=e[t].src.indexOf("firebug.js")&&console){OpenLayers.Util.extend(OpenLayers.Console,console);break}}(),OpenLayers.Lang={code:null,defaultCode:"en",getCode:function(){return OpenLayers.Lang.code||OpenLayers.Lang.setCode(),OpenLayers.Lang.code},setCode:function(e){var t;if(e||(e="msie"==OpenLayers.BROWSER_NAME?navigator.userLanguage:navigator.language),e=e.split("-"),e[0]=e[0].toLowerCase(),"object"==typeof OpenLayers.Lang[e[0]]&&(t=e[0]),e[1]){var n=e[0]+"-"+e[1].toUpperCase();"object"==typeof OpenLayers.Lang[n]&&(t=n)}t||(OpenLayers.Console.warn("Failed to find OpenLayers.Lang."+e.join("-")+" dictionary, falling back to default language"),t=OpenLayers.Lang.defaultCode),OpenLayers.Lang.code=t},translate:function(e,t){var n=OpenLayers.Lang[OpenLayers.Lang.getCode()];return(n=n&&n[e])||(n=e),t&&(n=OpenLayers.String.format(n,t)),n}},OpenLayers.i18n=OpenLayers.Lang.translate,OpenLayers.Util=OpenLayers.Util||{},OpenLayers.Util.getElement=function(){for(var e=[],t=0,n=arguments.length;t<n;t++){var i=arguments[t];if("string"==typeof i&&(i=document.getElementById(i)),1==arguments.length)return i;e.push(i)}return e},OpenLayers.Util.isElement=function(e){return!(!e||1!==e.nodeType)},OpenLayers.Util.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},OpenLayers.Util.removeItem=function(e,t){for(var n=e.length-1;0<=n;n--)e[n]==t&&e.splice(n,1);return e},OpenLayers.Util.indexOf=function(e,t){if("function"==typeof e.indexOf)return e.indexOf(t);for(var n=0,i=e.length;n<i;n++)if(e[n]==t)return n;return-1},OpenLayers.Util.dotless=/\./g,OpenLayers.Util.modifyDOMElement=function(e,t,n,i,r,s,a,o){t&&(e.id=t.replace(OpenLayers.Util.dotless,"_")),n&&(e.style.left=n.x+"px",e.style.top=n.y+"px"),i&&(e.style.width=i.w+"px",e.style.height=i.h+"px"),r&&(e.style.position=r),s&&(e.style.border=s),a&&(e.style.overflow=a),0<=parseFloat(o)&&1>parseFloat(o)?(e.style.filter="alpha(opacity="+100*o+")",e.style.opacity=o):1==parseFloat(o)&&(e.style.filter="",e.style.opacity="")},OpenLayers.Util.createDiv=function(e,t,n,i,r,s,a,o){var l=document.createElement("div");return i&&(l.style.backgroundImage="url("+i+")"),e||(e=OpenLayers.Util.createUniqueID("OpenLayersDiv")),r||(r="absolute"),OpenLayers.Util.modifyDOMElement(l,e,t,n,r,s,a,o),l},OpenLayers.Util.createImage=function(e,t,n,i,r,s,a,o){var l=document.createElement("img");return e||(e=OpenLayers.Util.createUniqueID("OpenLayersDiv")),r||(r="relative"),OpenLayers.Util.modifyDOMElement(l,e,t,n,r,s,null,a),o&&(t=function(){l.style.display="",OpenLayers.Event.stopObservingElement(l)},l.style.display="none",OpenLayers.Event.observe(l,"load",t),OpenLayers.Event.observe(l,"error",t)),l.style.alt=e,l.galleryImg="no",i&&(l.src=i),l},OpenLayers.IMAGE_RELOAD_ATTEMPTS=0,OpenLayers.Util.alphaHackNeeded=null,OpenLayers.Util.alphaHack=function(){if(null==OpenLayers.Util.alphaHackNeeded){var e=navigator.appVersion.split("MSIE"),e=parseFloat(e[1]),t=!1;try{t=!!document.body.filters}catch(e){}OpenLayers.Util.alphaHackNeeded=t&&5.5<=e&&7>e}return OpenLayers.Util.alphaHackNeeded},OpenLayers.Util.modifyAlphaImageDiv=function(e,t,n,i,r,s,a,o,l){OpenLayers.Util.modifyDOMElement(e,t,n,i,s,null,null,l),t=e.childNodes[0],r&&(t.src=r),OpenLayers.Util.modifyDOMElement(t,e.id+"_innerImage",null,i,"relative",a),OpenLayers.Util.alphaHack()&&("none"!=e.style.display&&(e.style.display="inline-block"),null==o&&(o="scale"),e.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+t.src+"', sizingMethod='"+o+"')",0<=parseFloat(e.style.opacity)&&1>parseFloat(e.style.opacity)&&(e.style.filter+=" alpha(opacity="+100*e.style.opacity+")"),t.style.filter="alpha(opacity=0)")},OpenLayers.Util.createAlphaImageDiv=function(e,t,n,i,r,s,a,o,l){var h=OpenLayers.Util.createDiv();return l=OpenLayers.Util.createImage(null,null,null,null,null,null,null,l),l.className="olAlphaImg",h.appendChild(l),OpenLayers.Util.modifyAlphaImageDiv(h,e,t,n,i,r,s,a,o),h},OpenLayers.Util.upperCaseObject=function(e){var t,n={};for(t in e)n[t.toUpperCase()]=e[t];return n},OpenLayers.Util.applyDefaults=function(e,t){e=e||{};var n,i="function"==typeof window.Event&&t instanceof window.Event;for(n in t)(void 0===e[n]||!i&&t.hasOwnProperty&&t.hasOwnProperty(n)&&!e.hasOwnProperty(n))&&(e[n]=t[n]);return!i&&t&&t.hasOwnProperty&&t.hasOwnProperty("toString")&&!e.hasOwnProperty("toString")&&(e.toString=t.toString),e},OpenLayers.Util.getParameterString=function(e){var t,n=[];for(t in e){var i=e[t];if(null!=i&&"function"!=typeof i){if("object"==typeof i&&i.constructor==Array){for(var r,s=[],a=0,o=i.length;a<o;a++)r=i[a],s.push(encodeURIComponent(null===r||void 0===r?"":r));i=s.join(",")}else i=encodeURIComponent(i);n.push(encodeURIComponent(t)+"="+i)}}return n.join("&")},OpenLayers.Util.urlAppend=function(e,t){var n=e;if(t)var i=(e+" ").split(/[?&]/),n=n+(" "===i.pop()?t:i.length?"&"+t:"?"+t);return n},OpenLayers.Util.getImagesLocation=function(){return OpenLayers.ImgPath||OpenLayers._getScriptLocation()+"img/"},OpenLayers.Util.getImageLocation=function(e){return OpenLayers.Util.getImagesLocation()+e},OpenLayers.Util.Try=function(){for(var e=null,t=0,n=arguments.length;t<n;t++){var i=arguments[t];try{e=i();break}catch(e){}}return e},OpenLayers.Util.getXmlNodeValue=function(e){var t=null;return OpenLayers.Util.Try(function(){t=e.text,t||(t=e.textContent),t||(t=e.firstChild.nodeValue)},function(){t=e.textContent}),t},OpenLayers.Util.mouseLeft=function(e,t){for(var n=e.relatedTarget?e.relatedTarget:e.toElement;n!=t&&null!=n;)n=n.parentNode;return n!=t},OpenLayers.Util.DEFAULT_PRECISION=14,OpenLayers.Util.toFloat=function(e,t){return null==t&&(t=OpenLayers.Util.DEFAULT_PRECISION),"number"!=typeof e&&(e=parseFloat(e)),0===t?e:parseFloat(e.toPrecision(t))},OpenLayers.Util.rad=function(e){return e*Math.PI/180},OpenLayers.Util.deg=function(e){return 180*e/Math.PI},OpenLayers.Util.VincentyConstants={a:6378137,b:6356752.3142,f:1/298.257223563},OpenLayers.Util.distVincenty=function(e,t){for(var n=OpenLayers.Util.VincentyConstants,i=n.a,r=n.b,n=n.f,s=OpenLayers.Util.rad(t.lon-e.lon),a=Math.atan((1-n)*Math.tan(OpenLayers.Util.rad(e.lat))),o=Math.atan((1-n)*Math.tan(OpenLayers.Util.rad(t.lat))),l=Math.sin(a),a=Math.cos(a),h=Math.sin(o),o=Math.cos(o),u=s,p=2*Math.PI,c=20;1e-12<Math.abs(u-p)&&0<--c;){var d=Math.sin(u),y=Math.cos(u),f=Math.sqrt(o*d*o*d+(a*h-l*o*y)*(a*h-l*o*y));if(0==f)return 0;var y=l*h+a*o*y,m=Math.atan2(f,y),g=Math.asin(a*o*d/f),v=Math.cos(g)*Math.cos(g),d=y-2*l*h/v,L=n/16*v*(4+n*(4-3*v)),p=u,u=s+(1-L)*n*Math.sin(g)*(m+L*f*(d+L*y*(-1+2*d*d)))}return 0==c?NaN:(i=v*(i*i-r*r)/(r*r),n=i/1024*(256+i*(-128+i*(74-47*i))),(r*(1+i/16384*(4096+i*(-768+i*(320-175*i))))*(m-n*f*(d+n/4*(y*(-1+2*d*d)-n/6*d*(-3+4*f*f)*(-3+4*d*d))))).toFixed(3)/1e3)},OpenLayers.Util.destinationVincenty=function(e,t,n){var i=OpenLayers.Util,r=i.VincentyConstants,s=r.a,a=r.b,r=r.f,o=e.lon,l=e.lat;e=i.rad(t),t=Math.sin(e),e=Math.cos(e);for(var h=(1-r)*Math.tan(i.rad(l)),l=1/Math.sqrt(1+h*h),u=h*l,p=Math.atan2(h,e),h=l*t,c=1-h*h,s=c*(s*s-a*a)/(a*a),d=1+s/16384*(4096+s*(-768+s*(320-175*s))),y=s/1024*(256+s*(-128+s*(74-47*s))),s=n/(a*d),f=2*Math.PI;1e-12<Math.abs(s-f);)var m=Math.cos(2*p+s),g=Math.sin(s),v=Math.cos(s),L=y*g*(m+y/4*(v*(-1+2*m*m)-y/6*m*(-3+4*g*g)*(-3+4*m*m))),f=s,s=n/(a*d)+L;return n=u*g-l*v*e,n=Math.atan2(u*v+l*g*e,(1-r)*Math.sqrt(h*h+n*n)),a=r/16*c*(4+r*(4-3*c)),new OpenLayers.LonLat(o+i.deg(Math.atan2(g*t,l*v-u*g*e)-(1-a)*r*h*(s+a*g*(m+a*v*(-1+2*m*m)))),i.deg(n))},OpenLayers.Util.getParameters=function(e,t){t=t||{},e=null===e||void 0===e?window.location.href:e;var n="";if(OpenLayers.String.contains(e,"?"))var i=e.indexOf("?")+1,n=OpenLayers.String.contains(e,"#")?e.indexOf("#"):e.length,n=e.substring(i,n);for(var i={},n=n.split(/[&;]/),r=0,s=n.length;r<s;++r){var a=n[r].split("=");if(a[0]){var o=a[0];try{o=decodeURIComponent(o)}catch(e){o=unescape(o)}a=(a[1]||"").replace(/\+/g," ");try{a=decodeURIComponent(a)}catch(e){a=unescape(a)}!1!==t.splitArgs&&(a=a.split(",")),1==a.length&&(a=a[0]),i[o]=a}}return i},OpenLayers.Util.lastSeqID=0,OpenLayers.Util.createUniqueID=function(e){return e=null==e?"id_":e.replace(OpenLayers.Util.dotless,"_"),OpenLayers.Util.lastSeqID+=1,e+OpenLayers.Util.lastSeqID},OpenLayers.INCHES_PER_UNIT={inches:1,ft:12,mi:63360,m:39.37,km:39370,dd:4374754,yd:36},OpenLayers.INCHES_PER_UNIT.in=OpenLayers.INCHES_PER_UNIT.inches,OpenLayers.INCHES_PER_UNIT.degrees=OpenLayers.INCHES_PER_UNIT.dd,OpenLayers.INCHES_PER_UNIT.nmi=1852*OpenLayers.INCHES_PER_UNIT.m,OpenLayers.METERS_PER_INCH=.0254000508001016,OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{Inch:OpenLayers.INCHES_PER_UNIT.inches,Meter:1/OpenLayers.METERS_PER_INCH,Foot:.3048006096012192/OpenLayers.METERS_PER_INCH,IFoot:.3048/OpenLayers.METERS_PER_INCH,ClarkeFoot:.3047972651151/OpenLayers.METERS_PER_INCH,SearsFoot:.30479947153867626/OpenLayers.METERS_PER_INCH,GoldCoastFoot:.3047997101815088/OpenLayers.METERS_PER_INCH,IInch:.0254/OpenLayers.METERS_PER_INCH,MicroInch:254e-7/OpenLayers.METERS_PER_INCH,Mil:2.54e-8/OpenLayers.METERS_PER_INCH,Centimeter:.01/OpenLayers.METERS_PER_INCH,Kilometer:1e3/OpenLayers.METERS_PER_INCH,Yard:.9144018288036576/OpenLayers.METERS_PER_INCH,SearsYard:.914398414616029/OpenLayers.METERS_PER_INCH,IndianYard:.9143985307444408/OpenLayers.METERS_PER_INCH,IndianYd37:.91439523/OpenLayers.METERS_PER_INCH,IndianYd62:.9143988/OpenLayers.METERS_PER_INCH,IndianYd75:.9143985/OpenLayers.METERS_PER_INCH,IndianFoot:.30479951/OpenLayers.METERS_PER_INCH,IndianFt37:.30479841/OpenLayers.METERS_PER_INCH,IndianFt62:.3047996/OpenLayers.METERS_PER_INCH,IndianFt75:.3047995/OpenLayers.METERS_PER_INCH,Mile:1609.3472186944373/OpenLayers.METERS_PER_INCH,IYard:.9144/OpenLayers.METERS_PER_INCH,IMile:1609.344/OpenLayers.METERS_PER_INCH,NautM:1852/OpenLayers.METERS_PER_INCH,"Lat-66":110943.31648893273/OpenLayers.METERS_PER_INCH,"Lat-83":110946.25736872235/OpenLayers.METERS_PER_INCH,Decimeter:.1/OpenLayers.METERS_PER_INCH,Millimeter:.001/OpenLayers.METERS_PER_INCH,Dekameter:10/OpenLayers.METERS_PER_INCH,Decameter:10/OpenLayers.METERS_PER_INCH,Hectometer:100/OpenLayers.METERS_PER_INCH,GermanMeter:1.0000135965/OpenLayers.METERS_PER_INCH,CaGrid:.999738/OpenLayers.METERS_PER_INCH,ClarkeChain:20.1166194976/OpenLayers.METERS_PER_INCH,GunterChain:20.11684023368047/OpenLayers.METERS_PER_INCH,BenoitChain:20.116782494375872/OpenLayers.METERS_PER_INCH,SearsChain:20.11676512155/OpenLayers.METERS_PER_INCH,ClarkeLink:.201166194976/OpenLayers.METERS_PER_INCH,GunterLink:.2011684023368047/OpenLayers.METERS_PER_INCH,BenoitLink:.20116782494375873/OpenLayers.METERS_PER_INCH,SearsLink:.2011676512155/OpenLayers.METERS_PER_INCH,Rod:5.02921005842012/OpenLayers.METERS_PER_INCH,IntnlChain:20.1168/OpenLayers.METERS_PER_INCH,IntnlLink:.201168/OpenLayers.METERS_PER_INCH,Perch:5.02921005842012/OpenLayers.METERS_PER_INCH,Pole:5.02921005842012/OpenLayers.METERS_PER_INCH,Furlong:201.1684023368046/OpenLayers.METERS_PER_INCH,Rood:3.778266898/OpenLayers.METERS_PER_INCH,CapeFoot:.3047972615/OpenLayers.METERS_PER_INCH,Brealey:375/OpenLayers.METERS_PER_INCH,ModAmFt:.304812252984506/OpenLayers.METERS_PER_INCH,Fathom:1.8288/OpenLayers.METERS_PER_INCH,"NautM-UK":1853.184/OpenLayers.METERS_PER_INCH,"50kilometers":5e4/OpenLayers.METERS_PER_INCH,"150kilometers":15e4/OpenLayers.METERS_PER_INCH}),OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{mm:OpenLayers.INCHES_PER_UNIT.Meter/1e3,cm:OpenLayers.INCHES_PER_UNIT.Meter/100,dm:100*OpenLayers.INCHES_PER_UNIT.Meter,km:1e3*OpenLayers.INCHES_PER_UNIT.Meter,kmi:OpenLayers.INCHES_PER_UNIT.nmi,fath:OpenLayers.INCHES_PER_UNIT.Fathom,ch:OpenLayers.INCHES_PER_UNIT.IntnlChain,link:OpenLayers.INCHES_PER_UNIT.IntnlLink,"us-in":OpenLayers.INCHES_PER_UNIT.inches,"us-ft":OpenLayers.INCHES_PER_UNIT.Foot,"us-yd":OpenLayers.INCHES_PER_UNIT.Yard,"us-ch":OpenLayers.INCHES_PER_UNIT.GunterChain,"us-mi":OpenLayers.INCHES_PER_UNIT.Mile,"ind-yd":OpenLayers.INCHES_PER_UNIT.IndianYd37,"ind-ft":OpenLayers.INCHES_PER_UNIT.IndianFt37,"ind-ch":20.11669506/OpenLayers.METERS_PER_INCH}),OpenLayers.DOTS_PER_INCH=72,OpenLayers.Util.normalizeScale=function(e){return 1<e?1/e:e},OpenLayers.Util.getResolutionFromScale=function(e,t){var n;return e&&(null==t&&(t="degrees"),n=1/(OpenLayers.Util.normalizeScale(e)*OpenLayers.INCHES_PER_UNIT[t]*OpenLayers.DOTS_PER_INCH)),n},OpenLayers.Util.getScaleFromResolution=function(e,t){return null==t&&(t="degrees"),e*OpenLayers.INCHES_PER_UNIT[t]*OpenLayers.DOTS_PER_INCH},OpenLayers.Util.pagePosition=function(e){var t=[0,0],n=OpenLayers.Util.getViewportElement();if(!e||e==window||e==n)return t;var i=OpenLayers.IS_GECKO&&document.getBoxObjectFor&&"absolute"==OpenLayers.Element.getStyle(e,"position")&&(""==e.style.top||""==e.style.left);if(e.getBoundingClientRect)e=e.getBoundingClientRect(),i=window.pageYOffset||n.scrollTop,t[0]=e.left+(window.pageXOffset||n.scrollLeft),t[1]=e.top+i;else if(document.getBoxObjectFor&&!i)e=document.getBoxObjectFor(e),n=document.getBoxObjectFor(n),t[0]=e.screenX-n.screenX,t[1]=e.screenY-n.screenY;else{if(t[0]=e.offsetLeft,t[1]=e.offsetTop,n=e.offsetParent,n!=e)for(;n;)t[0]+=n.offsetLeft,t[1]+=n.offsetTop,n=n.offsetParent;for(i=OpenLayers.BROWSER_NAME,("opera"==i||"safari"==i&&"absolute"==OpenLayers.Element.getStyle(e,"position"))&&(t[1]-=document.body.offsetTop),n=e.offsetParent;n&&n!=document.body;)t[0]-=n.scrollLeft,"opera"==i&&"TR"==n.tagName||(t[1]-=n.scrollTop),n=n.offsetParent}return t},OpenLayers.Util.getViewportElement=function(){var e=arguments.callee.viewportElement;return void 0==e&&(e="msie"==OpenLayers.BROWSER_NAME&&"CSS1Compat"!=document.compatMode?document.body:document.documentElement,arguments.callee.viewportElement=e),e},OpenLayers.Util.isEquivalentUrl=function(e,t,n){n=n||{},OpenLayers.Util.applyDefaults(n,{ignoreCase:!0,ignorePort80:!0,ignoreHash:!0,splitArgs:!1}),e=OpenLayers.Util.createUrlObject(e,n),t=OpenLayers.Util.createUrlObject(t,n);for(var i in e)if("args"!==i&&e[i]!=t[i])return!1;for(i in e.args){if(e.args[i]!=t.args[i])return!1;delete t.args[i]}for(i in t.args)return!1;return!0},OpenLayers.Util.createUrlObject=function(e,t){if(t=t||{},!/^\w+:\/\//.test(e)){var n=window.location,i=n.port?":"+n.port:"",i=n.protocol+"//"+n.host.split(":").shift()+i;0===e.indexOf("/")?e=i+e:(n=n.pathname.split("/"),n.pop(),e=i+n.join("/")+"/"+e)}t.ignoreCase&&(e=e.toLowerCase()),n=document.createElement("a"),n.href=e,i={},i.host=n.host.split(":").shift(),i.protocol=n.protocol,i.port=t.ignorePort80?"80"==n.port||"0"==n.port?"":n.port:""==n.port||"0"==n.port?"80":n.port,i.hash=t.ignoreHash||"#"===n.hash?"":n.hash;var r=n.search;return r||(r=e.indexOf("?"),r=-1!=r?e.substr(r):""),i.args=OpenLayers.Util.getParameters(r,{splitArgs:t.splitArgs}),i.pathname="/"==n.pathname.charAt(0)?n.pathname:"/"+n.pathname,i},OpenLayers.Util.removeTail=function(e){var t=e.indexOf("?"),n=e.indexOf("#");return-1==t?-1!=n?e.substr(0,n):e:-1!=n?e.substr(0,Math.min(t,n)):e.substr(0,t)},OpenLayers.IS_GECKO=function(){var e=navigator.userAgent.toLowerCase();return-1==e.indexOf("webkit")&&-1!=e.indexOf("gecko")}(),OpenLayers.CANVAS_SUPPORTED=function(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))}(),OpenLayers.BROWSER_NAME=function(){var e="",t=navigator.userAgent.toLowerCase();return-1!=t.indexOf("opera")?e="opera":-1!=t.indexOf("msie")?e="msie":-1!=t.indexOf("safari")?e="safari":-1!=t.indexOf("mozilla")&&(e=-1!=t.indexOf("firefox")?"firefox":"mozilla"),e}(),OpenLayers.Util.getBrowserName=function(){return OpenLayers.BROWSER_NAME},OpenLayers.Util.getRenderedDimensions=function(e,t,n){var i,r,s=document.createElement("div");s.style.visibility="hidden";for(var a=n&&n.containerElement?n.containerElement:document.body,o=!1,l=null,h=a;h&&"body"!=h.tagName.toLowerCase();){var u=OpenLayers.Element.getStyle(h,"position");if("absolute"==u){o=!0;break}if(u&&"static"!=u)break;h=h.parentNode}if(!o||0!==a.clientHeight&&0!==a.clientWidth||(l=document.createElement("div"),l.style.visibility="hidden",l.style.position="absolute",l.style.overflow="visible",l.style.width=document.body.clientWidth+"px",l.style.height=document.body.clientHeight+"px",l.appendChild(s)),s.style.position="absolute",t&&(t.w?(i=t.w,s.style.width=i+"px"):t.h&&(r=t.h,s.style.height=r+"px")),n&&n.displayClass&&(s.className=n.displayClass),t=document.createElement("div"),t.innerHTML=e,t.style.overflow="visible",t.childNodes)for(e=0,n=t.childNodes.length;e<n;e++)t.childNodes[e].style&&(t.childNodes[e].style.overflow="visible");return s.appendChild(t),l?a.appendChild(l):a.appendChild(s),i||(i=parseInt(t.scrollWidth),s.style.width=i+"px"),r||(r=parseInt(t.scrollHeight)),s.removeChild(t),l?(l.removeChild(s),a.removeChild(l)):a.removeChild(s),new OpenLayers.Size(i,r)},OpenLayers.Util.getScrollbarWidth=function(){var e=OpenLayers.Util._scrollbarWidth;if(null==e){var t,n;t=document.createElement("div"),t.style.position="absolute",t.style.top="-1000px",t.style.left="-1000px",t.style.width="100px",t.style.height="50px",t.style.overflow="hidden",n=document.createElement("div"),n.style.width="100%",n.style.height="200px",t.appendChild(n),document.body.appendChild(t),e=n.offsetWidth,t.style.overflow="scroll",t=n.offsetWidth,document.body.removeChild(document.body.lastChild),OpenLayers.Util._scrollbarWidth=e-t,e=OpenLayers.Util._scrollbarWidth}return e},OpenLayers.Util.getFormattedLonLat=function(e,t,n){n||(n="dms"),e=(e+540)%360-180;var i=Math.abs(e),r=Math.floor(i),s=i=(i-r)/(1/60),i=Math.floor(i),s=Math.round((s-i)/(1/60)*10),s=s/10;return 60<=s&&(s-=60,i+=1,60<=i&&(i-=60,r+=1)),10>r&&(r="0"+r),r+="°",0<=n.indexOf("dm")&&(10>i&&(i="0"+i),r+=i+"'",0<=n.indexOf("dms")&&(10>s&&(s="0"+s),r+=s+'"')),
r="lon"==t?r+(0>e?OpenLayers.i18n("W"):OpenLayers.i18n("E")):r+(0>e?OpenLayers.i18n("S"):OpenLayers.i18n("N"))},OpenLayers.Util.getConstructor=function(e){var t=e.split(".");e="OpenLayers"===t[0]?OpenLayers:window[t[0]];for(var n=1,i=t.length;n<i;++n)e=e[t[n]];return e},OpenLayers.Event={observers:!1,KEY_SPACE:32,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(e){return e.target||e.srcElement},isSingleTouch:function(e){return e.touches&&1==e.touches.length},isMultiTouch:function(e){return e.touches&&1<e.touches.length},isTouchEvent:function(e){return 0===(""+e.type).indexOf("touch")||"pointerType"in e&&(e.pointerType===e.MSPOINTER_TYPE_TOUCH||"touch"===e.pointerType)},isLeftClick:function(e){return e.which&&1==e.which||e.button&&1==e.button},isRightClick:function(e){return e.which&&3==e.which||e.button&&2==e.button},stop:function(e,t){t||OpenLayers.Event.preventDefault(e),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},preventDefault:function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},findElement:function(e,t){for(var n=OpenLayers.Event.element(e);n.parentNode&&(!n.tagName||n.tagName.toUpperCase()!=t.toUpperCase());)n=n.parentNode;return n},observe:function(e,t,n,i){if(e=OpenLayers.Util.getElement(e),i=i||!1,"keypress"==t&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||e.attachEvent)&&(t="keydown"),this.observers||(this.observers={}),!e._eventCacheID){var r="eventCacheID_";e.id&&(r=e.id+"_"+r),e._eventCacheID=OpenLayers.Util.createUniqueID(r)}r=e._eventCacheID,this.observers[r]||(this.observers[r]=[]),this.observers[r].push({element:e,name:t,observer:n,useCapture:i}),e.addEventListener?e.addEventListener(t,n,i):e.attachEvent&&e.attachEvent("on"+t,n)},stopObservingElement:function(e){e=OpenLayers.Util.getElement(e)._eventCacheID,this._removeElementObservers(OpenLayers.Event.observers[e])},_removeElementObservers:function(e){if(e)for(var t=e.length-1;0<=t;t--){var n=e[t];OpenLayers.Event.stopObserving.apply(this,[n.element,n.name,n.observer,n.useCapture])}},stopObserving:function(e,t,n,i){i=i||!1,e=OpenLayers.Util.getElement(e);var r=e._eventCacheID;"keypress"==t&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||e.detachEvent)&&(t="keydown");var s=!1,a=OpenLayers.Event.observers[r];if(a)for(var o=0;!s&&o<a.length;){var l=a[o];if(l.name==t&&l.observer==n&&l.useCapture==i){a.splice(o,1),0==a.length&&delete OpenLayers.Event.observers[r],s=!0;break}o++}return s&&(e.removeEventListener?e.removeEventListener(t,n,i):e&&e.detachEvent&&e.detachEvent("on"+t,n)),s},unloadCache:function(){if(OpenLayers.Event&&OpenLayers.Event.observers){for(var e in OpenLayers.Event.observers)OpenLayers.Event._removeElementObservers.apply(this,[OpenLayers.Event.observers[e]]);OpenLayers.Event.observers=!1}},CLASS_NAME:"OpenLayers.Event"},OpenLayers.Event.observe(window,"unload",OpenLayers.Event.unloadCache,!1),OpenLayers.Events=OpenLayers.Class({BROWSER_EVENTS:"mouseover mouseout mousedown mouseup mousemove click dblclick rightclick dblrightclick resize focus blur touchstart touchmove touchend keydown".split(" "),TOUCH_MODEL_POINTER:"pointer",TOUCH_MODEL_MSPOINTER:"MSPointer",TOUCH_MODEL_TOUCH:"touch",listeners:null,object:null,element:null,eventHandler:null,fallThrough:null,includeXY:!1,extensions:null,extensionCount:null,clearMouseListener:null,initialize:function(e,t,n,i,r){OpenLayers.Util.extend(this,r),this.object=e,this.fallThrough=i,this.listeners={},this.extensions={},this.extensionCount={},this._pointerTouches=[],null!=t&&this.attachToElement(t)},destroy:function(){for(var e in this.extensions)"boolean"!=typeof this.extensions[e]&&this.extensions[e].destroy();this.extensions=null,this.element&&(OpenLayers.Event.stopObservingElement(this.element),this.element.hasScrollEvent&&OpenLayers.Event.stopObserving(window,"scroll",this.clearMouseListener)),this.eventHandler=this.fallThrough=this.object=this.listeners=this.element=null},addEventType:function(e){},attachToElement:function(e){this.element?OpenLayers.Event.stopObservingElement(this.element):(this.eventHandler=OpenLayers.Function.bindAsEventListener(this.handleBrowserEvent,this),this.clearMouseListener=OpenLayers.Function.bind(this.clearMouseCache,this)),this.element=e;for(var t,n=this.getTouchModel(),i=0,r=this.BROWSER_EVENTS.length;i<r;i++)t=this.BROWSER_EVENTS[i],OpenLayers.Event.observe(e,t,this.eventHandler),n!==this.TOUCH_MODEL_POINTER&&n!==this.TOUCH_MODEL_MSPOINTER||0!==t.indexOf("touch")||this.addPointerTouchListener(e,t,this.eventHandler);OpenLayers.Event.observe(e,"dragstart",OpenLayers.Event.stop)},on:function(e){for(var t in e)"scope"!=t&&e.hasOwnProperty(t)&&this.register(t,e.scope,e[t])},register:function(e,t,n,i){if(e in OpenLayers.Events&&!this.extensions[e]&&(this.extensions[e]=new OpenLayers.Events[e](this)),null!=n){null==t&&(t=this.object);var r=this.listeners[e];r||(r=[],this.listeners[e]=r,this.extensionCount[e]=0),t={obj:t,func:n},i?(r.splice(this.extensionCount[e],0,t),"object"==typeof i&&i.extension&&this.extensionCount[e]++):r.push(t)}},registerPriority:function(e,t,n){this.register(e,t,n,!0)},un:function(e){for(var t in e)"scope"!=t&&e.hasOwnProperty(t)&&this.unregister(t,e.scope,e[t])},unregister:function(e,t,n){if(null==t&&(t=this.object),e=this.listeners[e],null!=e)for(var i=0,r=e.length;i<r;i++)if(e[i].obj==t&&e[i].func==n){e.splice(i,1);break}},remove:function(e){null!=this.listeners[e]&&(this.listeners[e]=[])},triggerEvent:function(e,t){var n=this.listeners[e];if(n&&0!=n.length){null==t&&(t={}),t.object=this.object,t.element=this.element,t.type||(t.type=e);for(var i,n=n.slice(),r=0,s=n.length;r<s&&(i=n[r],i=i.func.apply(i.obj,[t]),void 0==i||0!=i);r++);return this.fallThrough||OpenLayers.Event.stop(t,!0),i}},handleBrowserEvent:function(e){var t=e.type,n=this.listeners[t];if(n&&0!=n.length){if((n=e.touches)&&n[0]){for(var i,r=0,s=0,a=n.length,o=0;o<a;++o)i=this.getTouchClientXY(n[o]),r+=i.clientX,s+=i.clientY;e.clientX=r/a,e.clientY=s/a}this.includeXY&&(e.xy=this.getMousePosition(e)),this.triggerEvent(t,e)}},getTouchClientXY:function(e){var t=window.olMockWin||window,n=t.pageXOffset,t=t.pageYOffset,i=e.clientX,r=e.clientY;return 0===e.pageY&&Math.floor(r)>Math.floor(e.pageY)||0===e.pageX&&Math.floor(i)>Math.floor(e.pageX)?(i-=n,r-=t):(r<e.pageY-t||i<e.pageX-n)&&(i=e.pageX-n,r=e.pageY-t),e.olClientX=i,e.olClientY=r,{clientX:i,clientY:r}},clearMouseCache:function(){this.element.scrolls=null,this.element.lefttop=null,this.element.offsets=null},getMousePosition:function(e){if(this.includeXY?this.element.hasScrollEvent||(OpenLayers.Event.observe(window,"scroll",this.clearMouseListener),this.element.hasScrollEvent=!0):this.clearMouseCache(),!this.element.scrolls){var t=OpenLayers.Util.getViewportElement();this.element.scrolls=[window.pageXOffset||t.scrollLeft,window.pageYOffset||t.scrollTop]}return this.element.lefttop||(this.element.lefttop=[document.documentElement.clientLeft||0,document.documentElement.clientTop||0]),this.element.offsets||(this.element.offsets=OpenLayers.Util.pagePosition(this.element)),new OpenLayers.Pixel(e.clientX+this.element.scrolls[0]-this.element.offsets[0]-this.element.lefttop[0],e.clientY+this.element.scrolls[1]-this.element.offsets[1]-this.element.lefttop[1])},getTouchModel:function(){return"_TOUCH_MODEL"in OpenLayers.Events||(OpenLayers.Events._TOUCH_MODEL=window.PointerEvent&&"pointer"||window.MSPointerEvent&&"MSPointer"||"ontouchdown"in document&&"touch"||null),OpenLayers.Events._TOUCH_MODEL},addPointerTouchListener:function(e,t,n){function i(e){n(OpenLayers.Util.applyDefaults({stopPropagation:function(){for(var e=r.length-1;0<=e;--e)r[e].stopPropagation()},preventDefault:function(){for(var e=r.length-1;0<=e;--e)r[e].preventDefault()},type:t},e))}var r=this._pointerTouches;switch(t){case"touchstart":return this.addPointerTouchListenerStart(e,t,i);case"touchend":return this.addPointerTouchListenerEnd(e,t,i);case"touchmove":return this.addPointerTouchListenerMove(e,t,i);default:throw"Unknown touch event type"}},addPointerTouchListenerStart:function(e,t,n){var i=this._pointerTouches;OpenLayers.Event.observe(e,this.getTouchModel()===this.TOUCH_MODEL_MSPOINTER?"MSPointerDown":"pointerdown",function(e){if(OpenLayers.Event.isTouchEvent(e)){for(var t=!1,r=0,s=i.length;r<s;++r)if(i[r].pointerId==e.pointerId){t=!0;break}t||i.push(e),e.touches=i.slice(),n(e)}}),OpenLayers.Event.observe(e,this.getTouchModel()===this.TOUCH_MODEL_MSPOINTER?"MSPointerOut":"pointerout",function(e){if(OpenLayers.Event.isTouchEvent(e))for(var t=0,n=i.length;t<n;++t)if(i[t].pointerId==e.pointerId){0!=this.clientWidth&&0!=this.clientHeight&&(Math.ceil(e.clientX)>=this.clientWidth||Math.ceil(e.clientY)>=this.clientHeight)&&i.splice(t,1);break}})},addPointerTouchListenerMove:function(e,t,n){var i=this._pointerTouches;OpenLayers.Event.observe(e,this.getTouchModel()===this.TOUCH_MODEL_MSPOINTER?"MSPointerMove":"pointermove",function(e){if(OpenLayers.Event.isTouchEvent(e)&&(1!=i.length||i[0].pageX!=e.pageX||i[0].pageY!=e.pageY)){for(var t=0,r=i.length;t<r;++t)if(i[t].pointerId==e.pointerId){i[t]=e;break}e.touches=i.slice(),n(e)}})},addPointerTouchListenerEnd:function(e,t,n){var i=this._pointerTouches;OpenLayers.Event.observe(e,this.getTouchModel()===this.TOUCH_MODEL_MSPOINTER?"MSPointerUp":"pointerup",function(e){if(OpenLayers.Event.isTouchEvent(e)){for(var t=0,r=i.length;t<r;++t)if(i[t].pointerId==e.pointerId){i.splice(t,1);break}e.touches=i.slice(),n(e)}})},CLASS_NAME:"OpenLayers.Events"}),OpenLayers.Handler=OpenLayers.Class({id:null,control:null,map:null,keyMask:null,active:!1,evt:null,touch:!1,initialize:function(e,t,n){OpenLayers.Util.extend(this,n),this.control=e,this.callbacks=t,(e=this.map||e.map)&&this.setMap(e),this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},setMap:function(e){this.map=e},checkModifiers:function(e){return null==this.keyMask||((e.shiftKey?OpenLayers.Handler.MOD_SHIFT:0)|(e.ctrlKey?OpenLayers.Handler.MOD_CTRL:0)|(e.altKey?OpenLayers.Handler.MOD_ALT:0)|(e.metaKey?OpenLayers.Handler.MOD_META:0))==this.keyMask},activate:function(){if(this.active)return!1;for(var e=OpenLayers.Events.prototype.BROWSER_EVENTS,t=0,n=e.length;t<n;t++)this[e[t]]&&this.register(e[t],this[e[t]]);return this.active=!0},deactivate:function(){if(!this.active)return!1;for(var e=OpenLayers.Events.prototype.BROWSER_EVENTS,t=0,n=e.length;t<n;t++)this[e[t]]&&this.unregister(e[t],this[e[t]]);return this.active=this.touch=!1,!0},startTouch:function(){if(!this.touch){this.touch=!0;for(var e="mousedown mouseup mousemove click dblclick mouseout".split(" "),t=0,n=e.length;t<n;t++)this[e[t]]&&this.unregister(e[t],this[e[t]])}},callback:function(e,t){e&&this.callbacks[e]&&this.callbacks[e].apply(this.control,t)},register:function(e,t){this.map.events.registerPriority(e,this,t),this.map.events.registerPriority(e,this,this.setEvent)},unregister:function(e,t){this.map.events.unregister(e,this,t),this.map.events.unregister(e,this,this.setEvent)},setEvent:function(e){return this.evt=e,!0},destroy:function(){this.deactivate(),this.control=this.map=null},CLASS_NAME:"OpenLayers.Handler"}),OpenLayers.Handler.MOD_NONE=0,OpenLayers.Handler.MOD_SHIFT=1,OpenLayers.Handler.MOD_CTRL=2,OpenLayers.Handler.MOD_ALT=4,OpenLayers.Handler.MOD_META=8,OpenLayers.Icon=OpenLayers.Class({url:null,size:null,offset:null,calculateOffset:null,imageDiv:null,px:null,initialize:function(e,t,n,i){this.url=e,this.size=t||{w:20,h:20},this.offset=n||{x:-(this.size.w/2),y:-(this.size.h/2)},this.calculateOffset=i,e=OpenLayers.Util.createUniqueID("OL_Icon_"),this.imageDiv=OpenLayers.Util.createAlphaImageDiv(e)},destroy:function(){this.erase(),OpenLayers.Event.stopObservingElement(this.imageDiv.firstChild),this.imageDiv.innerHTML="",this.imageDiv=null},clone:function(){return new OpenLayers.Icon(this.url,this.size,this.offset,this.calculateOffset)},setSize:function(e){null!=e&&(this.size=e),this.draw()},setUrl:function(e){null!=e&&(this.url=e),this.draw()},draw:function(e){return OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,this.size,this.url,"absolute"),this.moveTo(e),this.imageDiv},erase:function(){null!=this.imageDiv&&null!=this.imageDiv.parentNode&&OpenLayers.Element.remove(this.imageDiv)},setOpacity:function(e){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,null,null,null,null,null,e)},moveTo:function(e){null!=e&&(this.px=e),null!=this.imageDiv&&(null==this.px?this.display(!1):(this.calculateOffset&&(this.offset=this.calculateOffset(this.size)),OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,{x:this.px.x+this.offset.x,y:this.px.y+this.offset.y})))},display:function(e){this.imageDiv.style.display=e?"":"none"},isDrawn:function(){return this.imageDiv&&this.imageDiv.parentNode&&11!=this.imageDiv.parentNode.nodeType},CLASS_NAME:"OpenLayers.Icon"}),OpenLayers.Marker=OpenLayers.Class({icon:null,lonlat:null,events:null,map:null,initialize:function(e,t){this.lonlat=e;var n=t?t:OpenLayers.Marker.defaultIcon();null==this.icon?this.icon=n:(this.icon.url=n.url,this.icon.size=n.size,this.icon.offset=n.offset,this.icon.calculateOffset=n.calculateOffset),this.events=new OpenLayers.Events(this,this.icon.imageDiv)},destroy:function(){this.erase(),this.map=null,this.events.destroy(),this.events=null,null!=this.icon&&(this.icon.destroy(),this.icon=null)},draw:function(e){return this.icon.draw(e)},erase:function(){null!=this.icon&&this.icon.erase()},moveTo:function(e){null!=e&&null!=this.icon&&this.icon.moveTo(e),this.lonlat=this.map.getLonLatFromLayerPx(e)},isDrawn:function(){return this.icon&&this.icon.isDrawn()},onScreen:function(){var e=!1;return this.map&&(e=this.map.getExtent().containsLonLat(this.lonlat)),e},inflate:function(e){this.icon&&this.icon.setSize({w:this.icon.size.w*e,h:this.icon.size.h*e})},setOpacity:function(e){this.icon.setOpacity(e)},setUrl:function(e){this.icon.setUrl(e)},display:function(e){this.icon.display(e)},CLASS_NAME:"OpenLayers.Marker"}),OpenLayers.Marker.defaultIcon=function(){return new OpenLayers.Icon(OpenLayers.Util.getImageLocation("marker.png"),{w:21,h:25},{x:-10.5,y:-25})},OpenLayers.Util=OpenLayers.Util||{},OpenLayers.Util.vendorPrefix=function(){function e(e){return e?e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()}).replace(/^ms-/,"-ms-"):null}function t(e,t){if(void 0===a[t]){var n,r=0,s=i.length,o="undefined"!=typeof e.cssText;for(a[t]=null;r<s;r++)if((n=i[r])?(o||(n=n.toLowerCase()),n=n+t.charAt(0).toUpperCase()+t.slice(1)):n=t,void 0!==e[n]){a[t]=n;break}}return a[t]}function n(e){return t(r,e)}var i=["","O","ms","Moz","Webkit"],r=document.createElement("div").style,s={},a={};return{css:function(t){if(void 0===s[t]){var i=t.replace(/(-[\s\S])/g,function(e){return e.charAt(1).toUpperCase()}),i=n(i);s[t]=e(i)}return s[t]},js:t,style:n,cssCache:s,jsCache:a}}(),OpenLayers.Animation=function(e){var t=OpenLayers.Util.vendorPrefix.js(e,"requestAnimationFrame"),n=!!t,i=function(){var n=e[t]||function(t,n){e.setTimeout(t,16)};return function(t,i){n.apply(e,[t,i])}}(),r=0,s={};return{isNative:n,requestFrame:i,start:function(e,t,n){t=0<t?t:Number.POSITIVE_INFINITY;var a=++r,o=+new Date;return s[a]=function(){s[a]&&+new Date-o<=t?(e(),s[a]&&i(s[a],n)):delete s[a]},i(s[a],n),a},stop:function(e){delete s[e]}}}(window),OpenLayers.Kinetic=OpenLayers.Class({threshold:0,deceleration:.0035,nbPoints:100,delay:200,points:void 0,timerId:void 0,initialize:function(e){OpenLayers.Util.extend(this,e)},begin:function(){OpenLayers.Animation.stop(this.timerId),this.timerId=void 0,this.points=[]},update:function(e){this.points.unshift({xy:e,tick:(new Date).getTime()}),this.points.length>this.nbPoints&&this.points.pop()},end:function(e){for(var t,n,i=(new Date).getTime(),r=0,s=this.points.length;r<s&&(n=this.points[r],!(i-n.tick>this.delay));r++)t=n;if(t&&(r=(new Date).getTime()-t.tick,i=Math.sqrt(Math.pow(e.x-t.xy.x,2)+Math.pow(e.y-t.xy.y,2)),r=i/r,!(0==r||r<this.threshold)))return i=Math.asin((e.y-t.xy.y)/i),t.xy.x<=e.x&&(i=Math.PI-i),{speed:r,theta:i}},move:function(e,t){var n=e.speed,i=Math.cos(e.theta),r=-Math.sin(e.theta),s=(new Date).getTime(),a=0,o=0;this.timerId=OpenLayers.Animation.start(OpenLayers.Function.bind(function(){if(null!=this.timerId){var e,l,h=(new Date).getTime()-s,u=-this.deceleration*Math.pow(h,2)/2+n*h,p=u*i,u=u*r;e=!1,0>=-this.deceleration*h+n&&(OpenLayers.Animation.stop(this.timerId),this.timerId=null,e=!0),h=p-a,l=u-o,a=p,o=u,t(h,l,e)}},this))},CLASS_NAME:"OpenLayers.Kinetic"}),OpenLayers.Tween=OpenLayers.Class({easing:null,begin:null,finish:null,duration:null,callbacks:null,time:null,minFrameRate:null,startTime:null,animationId:null,playing:!1,initialize:function(e){this.easing=e?e:OpenLayers.Easing.Expo.easeOut},start:function(e,t,n,i){this.playing=!0,this.begin=e,this.finish=t,this.duration=n,this.callbacks=i.callbacks,this.minFrameRate=i.minFrameRate||30,this.time=0,this.startTime=(new Date).getTime(),OpenLayers.Animation.stop(this.animationId),this.animationId=null,this.callbacks&&this.callbacks.start&&this.callbacks.start.call(this,this.begin),this.animationId=OpenLayers.Animation.start(OpenLayers.Function.bind(this.play,this))},stop:function(){this.playing&&(this.callbacks&&this.callbacks.done&&this.callbacks.done.call(this,this.finish),OpenLayers.Animation.stop(this.animationId),this.animationId=null,this.playing=!1)},play:function(){var e,t={};for(e in this.begin){var n=this.begin[e],i=this.finish[e];if(null==n||null==i||isNaN(n)||isNaN(i))throw new TypeError("invalid value for Tween");t[e]=this.easing.apply(this,[this.time,n,i-n,this.duration])}this.time++,this.callbacks&&this.callbacks.eachStep&&((new Date).getTime()-this.startTime)/this.time<=1e3/this.minFrameRate&&this.callbacks.eachStep.call(this,t),this.time>this.duration&&this.stop()},CLASS_NAME:"OpenLayers.Tween"}),OpenLayers.Easing={CLASS_NAME:"OpenLayers.Easing"},OpenLayers.Easing.Linear={easeIn:function(e,t,n,i){return n*e/i+t},easeOut:function(e,t,n,i){return n*e/i+t},easeInOut:function(e,t,n,i){return n*e/i+t},CLASS_NAME:"OpenLayers.Easing.Linear"},OpenLayers.Easing.Expo={easeIn:function(e,t,n,i){return 0==e?t:n*Math.pow(2,10*(e/i-1))+t},easeOut:function(e,t,n,i){return e==i?t+n:n*(-Math.pow(2,-10*e/i)+1)+t},easeInOut:function(e,t,n,i){return 0==e?t:e==i?t+n:1>(e/=i/2)?n/2*Math.pow(2,10*(e-1))+t:n/2*(-Math.pow(2,-10*--e)+2)+t},CLASS_NAME:"OpenLayers.Easing.Expo"},OpenLayers.Easing.Quad={easeIn:function(e,t,n,i){return n*(e/=i)*e+t},easeOut:function(e,t,n,i){return-n*(e/=i)*(e-2)+t},easeInOut:function(e,t,n,i){return 1>(e/=i/2)?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t},CLASS_NAME:"OpenLayers.Easing.Quad"},OpenLayers.Projection=OpenLayers.Class({proj:null,projCode:null,titleRegEx:/\+title=[^\+]*/,initialize:function(e,t){OpenLayers.Util.extend(this,t),this.projCode=e,"object"==typeof Proj4js&&(this.proj=new Proj4js.Proj(e))},getCode:function(){return this.proj?this.proj.srsCode:this.projCode},getUnits:function(){return this.proj?this.proj.units:null},toString:function(){return this.getCode()},equals:function(e){var t=!1;return e&&(e instanceof OpenLayers.Projection||(e=new OpenLayers.Projection(e)),"object"==typeof Proj4js&&this.proj.defData&&e.proj.defData?t=this.proj.defData.replace(this.titleRegEx,"")==e.proj.defData.replace(this.titleRegEx,""):e.getCode&&(t=this.getCode(),e=e.getCode(),t=t==e||!!OpenLayers.Projection.transforms[t]&&OpenLayers.Projection.transforms[t][e]===OpenLayers.Projection.nullTransform)),t},destroy:function(){delete this.proj,delete this.projCode},CLASS_NAME:"OpenLayers.Projection"}),OpenLayers.Projection.transforms={},OpenLayers.Projection.defaults={"EPSG:4326":{units:"degrees",maxExtent:[-180,-90,180,90],worldExtent:[-180,-90,180,90],yx:!0},"CRS:84":{units:"degrees",maxExtent:[-180,-90,180,90],worldExtent:[-180,-90,180,90]},"EPSG:900913":{units:"m",maxExtent:[-20037508.34,-20037508.34,20037508.34,20037508.34],worldExtent:[-180,-89,180,89]}},OpenLayers.Projection.addTransform=function(e,t,n){if(n===OpenLayers.Projection.nullTransform){var i=OpenLayers.Projection.defaults[e];i&&!OpenLayers.Projection.defaults[t]&&(OpenLayers.Projection.defaults[t]=i)}OpenLayers.Projection.transforms[e]||(OpenLayers.Projection.transforms[e]={}),OpenLayers.Projection.transforms[e][t]=n},OpenLayers.Projection.transform=function(e,t,n){if(t&&n)if(t instanceof OpenLayers.Projection||(t=new OpenLayers.Projection(t)),n instanceof OpenLayers.Projection||(n=new OpenLayers.Projection(n)),t.proj&&n.proj)e=Proj4js.transform(t.proj,n.proj,e);else{t=t.getCode(),n=n.getCode();var i=OpenLayers.Projection.transforms;i[t]&&i[t][n]&&i[t][n](e)}return e},OpenLayers.Projection.nullTransform=function(e){return e},function(){function e(e){return e.x=180*e.x/20037508.34,e.y=180/Math.PI*(2*Math.atan(Math.exp(e.y/20037508.34*Math.PI))-Math.PI/2),e}function t(e){return e.x=20037508.34*e.x/180,e.y=Math.max(-20037508.34,Math.min(Math.log(Math.tan((90+e.y)*Math.PI/360))/Math.PI*20037508.34,20037508.34)),e}function n(n,i){var r,s,a,o,l,h=OpenLayers.Projection.addTransform,u=OpenLayers.Projection.nullTransform;for(r=0,s=i.length;r<s;++r)for(a=i[r],h(n,a,t),h(a,n,e),l=r+1;l<s;++l)o=i[l],h(a,o,u),h(o,a,u)}var i,r=["EPSG:900913","EPSG:3857","EPSG:102113","EPSG:102100","OSGEO:41001"],s=["CRS:84","urn:ogc:def:crs:EPSG:6.6:4326","EPSG:4326"];for(i=r.length-1;0<=i;--i)n(r[i],s);for(i=s.length-1;0<=i;--i)n(s[i],r)}(),OpenLayers.Map=OpenLayers.Class({Z_INDEX_BASE:{BaseLayer:100,Overlay:325,Feature:725,Popup:750,Control:1e3},id:null,fractionalZoom:!1,events:null,allOverlays:!1,div:null,dragging:!1,size:null,viewPortDiv:null,layerContainerOrigin:null,layerContainerDiv:null,layers:null,controls:null,popups:null,baseLayer:null,center:null,resolution:null,zoom:0,panRatio:1.5,options:null,tileSize:null,projection:"EPSG:4326",units:null,resolutions:null,maxResolution:null,minResolution:null,maxScale:null,minScale:null,maxExtent:null,minExtent:null,restrictedExtent:null,numZoomLevels:16,theme:null,displayProjection:null,fallThrough:!1,autoUpdateSize:!0,eventListeners:null,panTween:null,panMethod:OpenLayers.Easing.Expo.easeOut,panDuration:50,zoomTween:null,zoomMethod:OpenLayers.Easing.Quad.easeOut,zoomDuration:20,paddingForPopups:null,layerContainerOriginPx:null,minPx:null,maxPx:null,initialize:function(e,t){var n=OpenLayers.Util.isElement(e);if(1!==arguments.length||"object"!=typeof e||n||(e=(t=e)&&t.div),this.tileSize=new OpenLayers.Size(OpenLayers.Map.TILE_WIDTH,OpenLayers.Map.TILE_HEIGHT),this.paddingForPopups=new OpenLayers.Bounds(15,15,15,15),this.theme=OpenLayers._getScriptLocation()+"theme/default/style.css",this.options=OpenLayers.Util.extend({},t),OpenLayers.Util.extend(this,t),OpenLayers.Util.applyDefaults(this,OpenLayers.Projection.defaults[this.projection instanceof OpenLayers.Projection?this.projection.projCode:this.projection]),!this.maxExtent||this.maxExtent instanceof OpenLayers.Bounds||(this.maxExtent=new OpenLayers.Bounds(this.maxExtent)),!this.minExtent||this.minExtent instanceof OpenLayers.Bounds||(this.minExtent=new OpenLayers.Bounds(this.minExtent)),!this.restrictedExtent||this.restrictedExtent instanceof OpenLayers.Bounds||(this.restrictedExtent=new OpenLayers.Bounds(this.restrictedExtent)),!this.center||this.center instanceof OpenLayers.LonLat||(this.center=new OpenLayers.LonLat(this.center)),this.layers=[],this.id=OpenLayers.Util.createUniqueID("OpenLayers.Map_"),this.div=OpenLayers.Util.getElement(e),this.div||(this.div=document.createElement("div"),this.div.style.height="1px",this.div.style.width="1px"),OpenLayers.Element.addClass(this.div,"olMap"),n=this.id+"_OpenLayers_ViewPort",this.viewPortDiv=OpenLayers.Util.createDiv(n,null,null,null,"relative",null,"hidden"),this.viewPortDiv.style.width="100%",this.viewPortDiv.style.height="100%",this.viewPortDiv.className="olMapViewport",this.div.appendChild(this.viewPortDiv),this.events=new OpenLayers.Events(this,this.viewPortDiv,null,this.fallThrough,{includeXY:!0}),OpenLayers.TileManager&&null!==this.tileManager&&(this.tileManager instanceof OpenLayers.TileManager||(this.tileManager=new OpenLayers.TileManager(this.tileManager)),this.tileManager.addMap(this)),n=this.id+"_OpenLayers_Container",this.layerContainerDiv=OpenLayers.Util.createDiv(n),this.layerContainerDiv.style.zIndex=this.Z_INDEX_BASE.Popup-1,this.layerContainerOriginPx={x:0,y:0},this.applyTransform(),this.viewPortDiv.appendChild(this.layerContainerDiv),this.updateSize(),this.eventListeners instanceof Object&&this.events.on(this.eventListeners),!0===this.autoUpdateSize&&(this.updateSizeDestroy=OpenLayers.Function.bind(this.updateSize,this),OpenLayers.Event.observe(window,"resize",this.updateSizeDestroy)),this.theme){for(var n=!0,i=document.getElementsByTagName("link"),r=0,s=i.length;r<s;++r)if(OpenLayers.Util.isEquivalentUrl(i.item(r).href,this.theme)){n=!1;break}n&&(n=document.createElement("link"),n.setAttribute("rel","stylesheet"),n.setAttribute("type","text/css"),n.setAttribute("href",this.theme),document.getElementsByTagName("head")[0].appendChild(n))}for(null==this.controls&&(this.controls=[],null!=OpenLayers.Control&&(OpenLayers.Control.Navigation?this.controls.push(new OpenLayers.Control.Navigation):OpenLayers.Control.TouchNavigation&&this.controls.push(new OpenLayers.Control.TouchNavigation),OpenLayers.Control.Zoom?this.controls.push(new OpenLayers.Control.Zoom):OpenLayers.Control.PanZoom&&this.controls.push(new OpenLayers.Control.PanZoom),OpenLayers.Control.ArgParser&&this.controls.push(new OpenLayers.Control.ArgParser),OpenLayers.Control.Attribution&&this.controls.push(new OpenLayers.Control.Attribution))),r=0,s=this.controls.length;r<s;r++)this.addControlToMap(this.controls[r]);this.popups=[],this.unloadDestroy=OpenLayers.Function.bind(this.destroy,this),OpenLayers.Event.observe(window,"unload",this.unloadDestroy),t&&t.layers&&(delete this.center,delete this.zoom,this.addLayers(t.layers),t.center&&!this.getCenter()&&this.setCenter(t.center,t.zoom)),this.panMethod&&(this.panTween=new OpenLayers.Tween(this.panMethod)),this.zoomMethod&&this.applyTransform.transform&&(this.zoomTween=new OpenLayers.Tween(this.zoomMethod))},getViewport:function(){return this.viewPortDiv},render:function(e){this.div=OpenLayers.Util.getElement(e),OpenLayers.Element.addClass(this.div,"olMap"),this.viewPortDiv.parentNode.removeChild(this.viewPortDiv),this.div.appendChild(this.viewPortDiv),this.updateSize()},unloadDestroy:null,updateSizeDestroy:null,destroy:function(){if(!this.unloadDestroy)return!1;if(this.panTween&&(this.panTween.stop(),this.panTween=null),this.zoomTween&&(this.zoomTween.stop(),this.zoomTween=null),OpenLayers.Event.stopObserving(window,"unload",this.unloadDestroy),this.unloadDestroy=null,this.updateSizeDestroy&&OpenLayers.Event.stopObserving(window,"resize",this.updateSizeDestroy),this.paddingForPopups=null,null!=this.controls){for(var e=this.controls.length-1;0<=e;--e)this.controls[e].destroy();this.controls=null}if(null!=this.layers){for(e=this.layers.length-1;0<=e;--e)this.layers[e].destroy(!1);this.layers=null}this.viewPortDiv&&this.viewPortDiv.parentNode&&this.viewPortDiv.parentNode.removeChild(this.viewPortDiv),this.viewPortDiv=null,this.tileManager&&(this.tileManager.removeMap(this),this.tileManager=null),this.eventListeners&&(this.events.un(this.eventListeners),this.eventListeners=null),this.events.destroy(),this.options=this.events=null},setOptions:function(e){var t=this.minPx&&e.restrictedExtent!=this.restrictedExtent;OpenLayers.Util.extend(this,e),t&&this.moveTo(this.getCachedCenter(),this.zoom,{forceZoomChange:!0})},getTileSize:function(){return this.tileSize},getBy:function(e,t,n){var i="function"==typeof n.test;return OpenLayers.Array.filter(this[e],function(e){return e[t]==n||i&&n.test(e[t])})},getLayersBy:function(e,t){return this.getBy("layers",e,t)},getLayersByName:function(e){return this.getLayersBy("name",e)},getLayersByClass:function(e){return this.getLayersBy("CLASS_NAME",e)},getControlsBy:function(e,t){return this.getBy("controls",e,t)},getControlsByClass:function(e){return this.getControlsBy("CLASS_NAME",e)},getLayer:function(e){for(var t=null,n=0,i=this.layers.length;n<i;n++){var r=this.layers[n];if(r.id==e){t=r;break}}return t},setLayerZIndex:function(e,t){e.setZIndex(this.Z_INDEX_BASE[e.isBaseLayer?"BaseLayer":"Overlay"]+5*t)},resetLayersZIndex:function(){for(var e=0,t=this.layers.length;e<t;e++)this.setLayerZIndex(this.layers[e],e)},addLayer:function(e){for(var t=0,n=this.layers.length;t<n;t++)if(this.layers[t]==e)return!1;return!1!==this.events.triggerEvent("preaddlayer",{layer:e})&&(this.allOverlays&&(e.isBaseLayer=!1),e.div.className="olLayerDiv",e.div.style.overflow="",this.setLayerZIndex(e,this.layers.length),e.isFixed?this.viewPortDiv.appendChild(e.div):this.layerContainerDiv.appendChild(e.div),this.layers.push(e),e.setMap(this),e.isBaseLayer||this.allOverlays&&!this.baseLayer?null==this.baseLayer?this.setBaseLayer(e):e.setVisibility(!1):e.redraw(),this.events.triggerEvent("addlayer",{layer:e}),e.events.triggerEvent("added",{map:this,layer:e}),e.afterAdd(),!0)},addLayers:function(e){for(var t=0,n=e.length;t<n;t++)this.addLayer(e[t])},removeLayer:function(e,t){if(!1!==this.events.triggerEvent("preremovelayer",{layer:e})){if(null==t&&(t=!0),e.isFixed?this.viewPortDiv.removeChild(e.div):this.layerContainerDiv.removeChild(e.div),OpenLayers.Util.removeItem(this.layers,e),e.removeMap(this),e.map=null,this.baseLayer==e&&(this.baseLayer=null,t))for(var n=0,i=this.layers.length;n<i;n++){var r=this.layers[n];if(r.isBaseLayer||this.allOverlays){this.setBaseLayer(r);break}}this.resetLayersZIndex(),this.events.triggerEvent("removelayer",{layer:e}),e.events.triggerEvent("removed",{map:this,layer:e})}},getNumLayers:function(){return this.layers.length},getLayerIndex:function(e){return OpenLayers.Util.indexOf(this.layers,e)},setLayerIndex:function(e,t){var n=this.getLayerIndex(e);if(0>t?t=0:t>this.layers.length&&(t=this.layers.length),n!=t){this.layers.splice(n,1),this.layers.splice(t,0,e);for(var n=0,i=this.layers.length;n<i;n++)this.setLayerZIndex(this.layers[n],n);this.events.triggerEvent("changelayer",{layer:e,property:"order"}),this.allOverlays&&(0===t?this.setBaseLayer(e):this.baseLayer!==this.layers[0]&&this.setBaseLayer(this.layers[0]))}},raiseLayer:function(e,t){var n=this.getLayerIndex(e)+t;this.setLayerIndex(e,n)},setBaseLayer:function(e){if(e!=this.baseLayer&&-1!=OpenLayers.Util.indexOf(this.layers,e)){var t=this.getCachedCenter(),n=this.getResolution(),i=OpenLayers.Util.getResolutionFromScale(this.getScale(),e.units);null==this.baseLayer||this.allOverlays||this.baseLayer.setVisibility(!1),this.baseLayer=e,this.allOverlays&&!this.baseLayer.visibility||(this.baseLayer.setVisibility(!0),!1===this.baseLayer.inRange&&this.baseLayer.redraw()),null!=t&&(e=this.getZoomForResolution(i||this.resolution,!0),this.setCenter(t,e,!1,n!=i)),this.events.triggerEvent("changebaselayer",{layer:this.baseLayer})}},addControl:function(e,t){this.controls.push(e),this.addControlToMap(e,t)},addControls:function(e,t){for(var n=1===arguments.length?[]:t,i=0,r=e.length;i<r;i++)this.addControl(e[i],n[i]?n[i]:null)},addControlToMap:function(e,t){e.outsideViewport=null!=e.div,this.displayProjection&&!e.displayProjection&&(e.displayProjection=this.displayProjection),e.setMap(this);var n=e.draw(t);n&&!e.outsideViewport&&(n.style.zIndex=this.Z_INDEX_BASE.Control+this.controls.length,this.viewPortDiv.appendChild(n)),e.autoActivate&&e.activate()},getControl:function(e){for(var t=null,n=0,i=this.controls.length;n<i;n++){var r=this.controls[n];if(r.id==e){t=r;break}}return t},removeControl:function(e){e&&e==this.getControl(e.id)&&(e.div&&e.div.parentNode==this.viewPortDiv&&this.viewPortDiv.removeChild(e.div),OpenLayers.Util.removeItem(this.controls,e))},addPopup:function(e,t){if(t)for(var n=this.popups.length-1;0<=n;--n)this.removePopup(this.popups[n]);e.map=this,this.popups.push(e),(n=e.draw())&&(n.style.zIndex=this.Z_INDEX_BASE.Popup+this.popups.length,this.layerContainerDiv.appendChild(n))},removePopup:function(e){if(OpenLayers.Util.removeItem(this.popups,e),
e.div)try{this.layerContainerDiv.removeChild(e.div)}catch(e){}e.map=null},getSize:function(){var e=null;return null!=this.size&&(e=this.size.clone()),e},updateSize:function(){var e=this.getCurrentSize();if(e&&!isNaN(e.h)&&!isNaN(e.w)){this.events.clearMouseCache();var t=this.getSize();if(null==t&&(this.size=t=e),!e.equals(t)){for(this.size=e,e=0,t=this.layers.length;e<t;e++)this.layers[e].onMapResize();e=this.getCachedCenter(),null!=this.baseLayer&&null!=e&&(t=this.getZoom(),this.zoom=null,this.setCenter(e,t))}}this.events.triggerEvent("updatesize")},getCurrentSize:function(){var e=new OpenLayers.Size(this.div.clientWidth,this.div.clientHeight);return(0==e.w&&0==e.h||isNaN(e.w)&&isNaN(e.h))&&(e.w=this.div.offsetWidth,e.h=this.div.offsetHeight),(0==e.w&&0==e.h||isNaN(e.w)&&isNaN(e.h))&&(e.w=parseInt(this.div.style.width),e.h=parseInt(this.div.style.height)),e},calculateBounds:function(e,t){var n=null;if(null==e&&(e=this.getCachedCenter()),null==t&&(t=this.getResolution()),null!=e&&null!=t)var n=this.size.w*t/2,i=this.size.h*t/2,n=new OpenLayers.Bounds(e.lon-n,e.lat-i,e.lon+n,e.lat+i);return n},getCenter:function(){var e=null,t=this.getCachedCenter();return t&&(e=t.clone()),e},getCachedCenter:function(){return!this.center&&this.size&&(this.center=this.getLonLatFromViewPortPx({x:this.size.w/2,y:this.size.h/2})),this.center},getZoom:function(){return this.zoom},pan:function(e,t,n){if(n=OpenLayers.Util.applyDefaults(n,{animate:!0,dragging:!1}),n.dragging)0==e&&0==t||this.moveByPx(e,t);else{var i=this.getViewPortPxFromLonLat(this.getCachedCenter());e=i.add(e,t),!this.dragging&&e.equals(i)||(i=this.getLonLatFromViewPortPx(e),n.animate?this.panTo(i):(this.moveTo(i),this.dragging&&(this.dragging=!1,this.events.triggerEvent("moveend"))))}},panTo:function(e){if(this.panTween&&this.getExtent().scale(this.panRatio).containsLonLat(e)){var t=this.getCachedCenter();if(!e.equals(t)){var t=this.getPixelFromLonLat(t),n=this.getPixelFromLonLat(e),i=0,r=0;this.panTween.start({x:0,y:0},{x:n.x-t.x,y:n.y-t.y},this.panDuration,{callbacks:{eachStep:OpenLayers.Function.bind(function(e){this.moveByPx(e.x-i,e.y-r),i=Math.round(e.x),r=Math.round(e.y)},this),done:OpenLayers.Function.bind(function(t){this.moveTo(e),this.dragging=!1,this.events.triggerEvent("moveend")},this)}})}}else this.setCenter(e)},setCenter:function(e,t,n,i){this.panTween&&this.panTween.stop(),this.zoomTween&&this.zoomTween.stop(),this.moveTo(e,t,{dragging:n,forceZoomChange:i})},moveByPx:function(e,t){var n=this.size.w/2,i=this.size.h/2,r=n+e,s=i+t,a=this.baseLayer.wrapDateLine,o=0,l=0;if(this.restrictedExtent&&(o=n,l=i,a=!1),e=a||r<=this.maxPx.x-o&&r>=this.minPx.x+o?Math.round(e):0,t=s<=this.maxPx.y-l&&s>=this.minPx.y+l?Math.round(t):0,e||t){for(this.dragging||(this.dragging=!0,this.events.triggerEvent("movestart")),this.center=null,e&&(this.layerContainerOriginPx.x-=e,this.minPx.x-=e,this.maxPx.x-=e),t&&(this.layerContainerOriginPx.y-=t,this.minPx.y-=t,this.maxPx.y-=t),this.applyTransform(),i=0,r=this.layers.length;i<r;++i)n=this.layers[i],n.visibility&&(n===this.baseLayer||n.inRange)&&(n.moveByPx(e,t),n.events.triggerEvent("move"));this.events.triggerEvent("move")}},adjustZoom:function(e){if(this.baseLayer&&this.baseLayer.wrapDateLine){var t=this.baseLayer.resolutions,n=this.getMaxExtent().getWidth()/this.size.w;if(this.getResolutionForZoom(e)>n)if(this.fractionalZoom)e=this.getZoomForResolution(n);else for(var i=0|e,r=t.length;i<r;++i)if(t[i]<=n){e=i;break}}return e},getMinZoom:function(){return this.adjustZoom(0)},moveTo:function(e,t,n){null==e||e instanceof OpenLayers.LonLat||(e=new OpenLayers.LonLat(e)),n||(n={}),null!=t&&(t=parseFloat(t),this.fractionalZoom||(t=Math.round(t)));var i=t;t=this.adjustZoom(t),t!==i&&(e=this.getCenter());var i=n.dragging||this.dragging,r=n.forceZoomChange;if(this.getCachedCenter()||this.isValidLonLat(e)||(e=this.maxExtent.getCenterLonLat(),this.center=e.clone()),null!=this.restrictedExtent){null==e&&(e=this.center),null==t&&(t=this.getZoom());var s=this.getResolutionForZoom(t),s=this.calculateBounds(e,s);if(!this.restrictedExtent.containsBounds(s)){var a=this.restrictedExtent.getCenterLonLat();s.getWidth()>this.restrictedExtent.getWidth()?e=new OpenLayers.LonLat(a.lon,e.lat):s.left<this.restrictedExtent.left?e=e.add(this.restrictedExtent.left-s.left,0):s.right>this.restrictedExtent.right&&(e=e.add(this.restrictedExtent.right-s.right,0)),s.getHeight()>this.restrictedExtent.getHeight()?e=new OpenLayers.LonLat(e.lon,a.lat):s.bottom<this.restrictedExtent.bottom?e=e.add(0,this.restrictedExtent.bottom-s.bottom):s.top>this.restrictedExtent.top&&(e=e.add(0,this.restrictedExtent.top-s.top))}}if(r=r||this.isValidZoomLevel(t)&&t!=this.getZoom(),s=this.isValidLonLat(e)&&!e.equals(this.center),r||s||i){if(i||this.events.triggerEvent("movestart",{zoomChanged:r}),s&&(!r&&this.center&&this.centerLayerContainer(e),this.center=e.clone()),e=r?this.getResolutionForZoom(t):this.getResolution(),r||null==this.layerContainerOrigin){this.layerContainerOrigin=this.getCachedCenter(),this.layerContainerOriginPx.x=0,this.layerContainerOriginPx.y=0,this.applyTransform();var s=this.getMaxExtent({restricted:!0}),o=s.getCenterLonLat(),a=this.center.lon-o.lon,o=o.lat-this.center.lat,l=Math.round(s.getWidth()/e),h=Math.round(s.getHeight()/e);this.minPx={x:(this.size.w-l)/2-a/e,y:(this.size.h-h)/2-o/e},this.maxPx={x:this.minPx.x+Math.round(s.getWidth()/e),y:this.minPx.y+Math.round(s.getHeight()/e)}}for(r&&(this.zoom=t,this.resolution=e),e=this.getExtent(),this.baseLayer.visibility&&(this.baseLayer.moveTo(e,r,n.dragging),n.dragging||this.baseLayer.events.triggerEvent("moveend",{zoomChanged:r})),e=this.baseLayer.getExtent(),t=this.layers.length-1;0<=t;--t)s=this.layers[t],s===this.baseLayer||s.isBaseLayer||(a=s.calculateInRange(),s.inRange!=a&&((s.inRange=a)||s.display(!1),this.events.triggerEvent("changelayer",{layer:s,property:"visibility"})),a&&s.visibility&&(s.moveTo(e,r,n.dragging),n.dragging||s.events.triggerEvent("moveend",{zoomChanged:r})));if(this.events.triggerEvent("move"),i||this.events.triggerEvent("moveend"),r){for(t=0,n=this.popups.length;t<n;t++)this.popups[t].updatePosition();this.events.triggerEvent("zoomend")}}},centerLayerContainer:function(e){var t=this.getViewPortPxFromLonLat(this.layerContainerOrigin),n=this.getViewPortPxFromLonLat(e);if(null!=t&&null!=n){var i=this.layerContainerOriginPx.x;e=this.layerContainerOriginPx.y;var r=Math.round(t.x-n.x),t=Math.round(t.y-n.y);this.applyTransform(this.layerContainerOriginPx.x=r,this.layerContainerOriginPx.y=t),i-=r,e-=t,this.minPx.x-=i,this.maxPx.x-=i,this.minPx.y-=e,this.maxPx.y-=e}},isValidZoomLevel:function(e){return null!=e&&0<=e&&e<this.getNumZoomLevels()},isValidLonLat:function(e){var t=!1;return null!=e&&(t=this.getMaxExtent(),t=t.containsLonLat(e,{worldBounds:this.baseLayer.wrapDateLine&&t})),t},getProjection:function(){var e=this.getProjectionObject();return e?e.getCode():null},getProjectionObject:function(){var e=null;return null!=this.baseLayer&&(e=this.baseLayer.projection),e},getMaxResolution:function(){var e=null;return null!=this.baseLayer&&(e=this.baseLayer.maxResolution),e},getMaxExtent:function(e){var t=null;return e&&e.restricted&&this.restrictedExtent?t=this.restrictedExtent:null!=this.baseLayer&&(t=this.baseLayer.maxExtent),t},getNumZoomLevels:function(){var e=null;return null!=this.baseLayer&&(e=this.baseLayer.numZoomLevels),e},getExtent:function(){var e=null;return null!=this.baseLayer&&(e=this.baseLayer.getExtent()),e},getResolution:function(){var e=null;return null!=this.baseLayer?e=this.baseLayer.getResolution():!0===this.allOverlays&&0<this.layers.length&&(e=this.layers[0].getResolution()),e},getUnits:function(){var e=null;return null!=this.baseLayer&&(e=this.baseLayer.units),e},getScale:function(){var e=null;return null!=this.baseLayer&&(e=this.getResolution(),e=OpenLayers.Util.getScaleFromResolution(e,this.baseLayer.units)),e},getZoomForExtent:function(e,t){var n=null;return null!=this.baseLayer&&(n=this.baseLayer.getZoomForExtent(e,t)),n},getResolutionForZoom:function(e){var t=null;return this.baseLayer&&(t=this.baseLayer.getResolutionForZoom(e)),t},getZoomForResolution:function(e,t){var n=null;return null!=this.baseLayer&&(n=this.baseLayer.getZoomForResolution(e,t)),n},zoomTo:function(e,t){var n=this;if(n.isValidZoomLevel(e)){n.baseLayer.wrapDateLine&&(e=n.adjustZoom(e));var i=t?n.getZoomTargetCenter(t,n.getResolutionForZoom(e)):n.getCenter();if(i&&n.events.triggerEvent("zoomstart",{center:i,zoom:e}),n.zoomTween){n.zoomTween.stop();var r=n.getResolution(),s=n.getResolutionForZoom(e),r={scale:r/s};t||(s=n.getSize(),t={x:s.w/2,y:s.h/2}),n.zoomTween.start({scale:1},r,n.zoomDuration,{minFrameRate:50,callbacks:{eachStep:function(e){var i=n.layerContainerOriginPx;e=e.scale,n.applyTransform(i.x+((e-1)*(i.x-t.x)|0),i.y+((e-1)*(i.y-t.y)|0),e)},done:function(e){n.applyTransform();var r=n.getResolution()/e.scale,s=n.getZoomForResolution(r,!0);e=1===e.scale?i:n.getZoomTargetCenter(t,r),n.moveTo(e,s)}}})}else n.setCenter(i,e)}},zoomIn:function(){this.zoomTween&&this.zoomTween.stop(),this.zoomTo(this.getZoom()+1)},zoomOut:function(){this.zoomTween&&this.zoomTween.stop(),this.zoomTo(this.getZoom()-1)},zoomToExtent:function(e,t){e instanceof OpenLayers.Bounds||(e=new OpenLayers.Bounds(e));var n=e.getCenterLonLat();if(this.baseLayer.wrapDateLine){for(n=this.getMaxExtent(),e=e.clone();e.right<e.left;)e.right+=n.getWidth();n=e.getCenterLonLat().wrapDateLine(n)}this.setCenter(n,this.getZoomForExtent(e,t))},zoomToMaxExtent:function(e){e=this.getMaxExtent({restricted:!e||e.restricted}),this.zoomToExtent(e)},zoomToScale:function(e,t){var n=OpenLayers.Util.getResolutionFromScale(e,this.baseLayer.units),i=this.size.w*n/2,n=this.size.h*n/2,r=this.getCachedCenter(),i=new OpenLayers.Bounds(r.lon-i,r.lat-n,r.lon+i,r.lat+n);this.zoomToExtent(i,t)},getLonLatFromViewPortPx:function(e){var t=null;return null!=this.baseLayer&&(t=this.baseLayer.getLonLatFromViewPortPx(e)),t},getViewPortPxFromLonLat:function(e){var t=null;return null!=this.baseLayer&&(t=this.baseLayer.getViewPortPxFromLonLat(e)),t},getZoomTargetCenter:function(e,t){var n=null,i=this.getSize(),r=i.w/2-e.x,i=e.y-i.h/2,s=this.getLonLatFromPixel(e);return s&&(n=new OpenLayers.LonLat(s.lon+r*t,s.lat+i*t)),n},getLonLatFromPixel:function(e){return this.getLonLatFromViewPortPx(e)},getPixelFromLonLat:function(e){return e=this.getViewPortPxFromLonLat(e),e.x=Math.round(e.x),e.y=Math.round(e.y),e},getGeodesicPixelSize:function(e){var t=e?this.getLonLatFromPixel(e):this.getCachedCenter()||new OpenLayers.LonLat(0,0),n=this.getResolution();e=t.add(-n/2,0);var i=t.add(n/2,0),r=t.add(0,-n/2),t=t.add(0,n/2),n=new OpenLayers.Projection("EPSG:4326"),s=this.getProjectionObject()||n;return s.equals(n)||(e.transform(s,n),i.transform(s,n),r.transform(s,n),t.transform(s,n)),new OpenLayers.Size(OpenLayers.Util.distVincenty(e,i),OpenLayers.Util.distVincenty(r,t))},getViewPortPxFromLayerPx:function(e){var t=null;return null!=e&&(t=e.add(this.layerContainerOriginPx.x,this.layerContainerOriginPx.y)),t},getLayerPxFromViewPortPx:function(e){var t=null;return null!=e&&(t=e.add(-this.layerContainerOriginPx.x,-this.layerContainerOriginPx.y),isNaN(t.x)||isNaN(t.y))&&(t=null),t},getLonLatFromLayerPx:function(e){return e=this.getViewPortPxFromLayerPx(e),this.getLonLatFromViewPortPx(e)},getLayerPxFromLonLat:function(e){return e=this.getPixelFromLonLat(e),this.getLayerPxFromViewPortPx(e)},applyTransform:function(e,t,n){n=n||1;var i=this.layerContainerOriginPx,r=1!==n;e=e||i.x,t=t||i.y;var s=this.layerContainerDiv.style,a=this.applyTransform.transform,o=this.applyTransform.template;if(void 0===a&&(a=OpenLayers.Util.vendorPrefix.style("transform"),this.applyTransform.transform=a)){var l=OpenLayers.Element.getStyle(this.viewPortDiv,OpenLayers.Util.vendorPrefix.css("transform"));l&&"none"===l||(o=["translate3d(",",0) ","scale3d(",",1)"],s[a]=[o[0],"0,0",o[1]].join("")),o&&~s[a].indexOf(o[0])||(o=["translate(",") ","scale(",")"]),this.applyTransform.template=o}null===a||"translate3d("!==o[0]&&!0!==r?(s.left=e+"px",s.top=t+"px",null!==a&&(s[a]="")):(!0===r&&"translate("===o[0]&&(e-=i.x,t-=i.y,s.left=i.x+"px",s.top=i.y+"px"),s[a]=[o[0],e,"px,",t,"px",o[1],o[2],n,",",n,o[3]].join(""))},CLASS_NAME:"OpenLayers.Map"}),OpenLayers.Map.TILE_WIDTH=256,OpenLayers.Map.TILE_HEIGHT=256,OpenLayers.Layer=OpenLayers.Class({id:null,name:null,div:null,opacity:1,alwaysInRange:null,RESOLUTION_PROPERTIES:"scales resolutions maxScale minScale maxResolution minResolution numZoomLevels maxZoomLevel".split(" "),events:null,map:null,isBaseLayer:!1,alpha:!1,displayInLayerSwitcher:!0,visibility:!0,attribution:null,inRange:!1,imageSize:null,options:null,eventListeners:null,gutter:0,projection:null,units:null,scales:null,resolutions:null,maxExtent:null,minExtent:null,maxResolution:null,minResolution:null,numZoomLevels:null,minScale:null,maxScale:null,displayOutsideMaxExtent:!1,wrapDateLine:!1,metadata:null,initialize:function(e,t){this.metadata={},t=OpenLayers.Util.extend({},t),null!=this.alwaysInRange&&(t.alwaysInRange=this.alwaysInRange),this.addOptions(t),this.name=e,null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"),this.div=OpenLayers.Util.createDiv(this.id),this.div.style.width="100%",this.div.style.height="100%",this.div.dir="ltr",this.events=new OpenLayers.Events(this,this.div),this.eventListeners instanceof Object)&&this.events.on(this.eventListeners)},destroy:function(e){null==e&&(e=!0),null!=this.map&&this.map.removeLayer(this,e),this.options=this.div=this.name=this.map=this.projection=null,this.events&&(this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy()),this.events=this.eventListeners=null},clone:function(e){return null==e&&(e=new OpenLayers.Layer(this.name,this.getOptions())),OpenLayers.Util.applyDefaults(e,this),e.map=null,e},getOptions:function(){var e,t={};for(e in this.options)t[e]=this[e];return t},setName:function(e){e!=this.name&&(this.name=e,null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"name"}))},addOptions:function(e,t){if(null==this.options&&(this.options={}),e&&("string"==typeof e.projection&&(e.projection=new OpenLayers.Projection(e.projection)),e.projection&&OpenLayers.Util.applyDefaults(e,OpenLayers.Projection.defaults[e.projection.getCode()]),!e.maxExtent||e.maxExtent instanceof OpenLayers.Bounds||(e.maxExtent=new OpenLayers.Bounds(e.maxExtent)),!e.minExtent||e.minExtent instanceof OpenLayers.Bounds||(e.minExtent=new OpenLayers.Bounds(e.minExtent))),OpenLayers.Util.extend(this.options,e),OpenLayers.Util.extend(this,e),this.projection&&this.projection.getUnits()&&(this.units=this.projection.getUnits()),this.map){var n,i=this.map.getResolution(),r=this.RESOLUTION_PROPERTIES.concat(["projection","units","minExtent","maxExtent"]);for(n in e)if(e.hasOwnProperty(n)&&0<=OpenLayers.Util.indexOf(r,n)){this.initResolutions(),t&&this.map.baseLayer===this&&(this.map.setCenter(this.map.getCenter(),this.map.getZoomForResolution(i),!1,!0),this.map.events.triggerEvent("changebaselayer",{layer:this}));break}}},onMapResize:function(){},redraw:function(){var e=!1;if(this.map){this.inRange=this.calculateInRange();var t=this.getExtent();t&&this.inRange&&this.visibility&&(this.moveTo(t,!0,!1),this.events.triggerEvent("moveend",{zoomChanged:!0}),e=!0)}return e},moveTo:function(e,t,n){e=this.visibility,this.isBaseLayer||(e=e&&this.inRange),this.display(e)},moveByPx:function(e,t){},setMap:function(e){null==this.map&&(this.map=e,this.maxExtent=this.maxExtent||this.map.maxExtent,this.minExtent=this.minExtent||this.map.minExtent,this.projection=this.projection||this.map.projection,"string"==typeof this.projection&&(this.projection=new OpenLayers.Projection(this.projection)),this.projection&&this.projection.getUnits()?this.units=this.projection.getUnits():this.units=this.units||this.map.units,this.initResolutions(),this.isBaseLayer||(this.inRange=this.calculateInRange(),this.div.style.display=this.visibility&&this.inRange?"":"none"),this.setTileSize())},afterAdd:function(){},removeMap:function(e){},getImageSize:function(e){return this.imageSize||this.tileSize},setTileSize:function(e){this.tileSize=e=e?e:this.tileSize?this.tileSize:this.map.getTileSize(),this.gutter&&(this.imageSize=new OpenLayers.Size(e.w+2*this.gutter,e.h+2*this.gutter))},getVisibility:function(){return this.visibility},setVisibility:function(e){e!=this.visibility&&(this.visibility=e,this.display(e),this.redraw(),null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"visibility"}),this.events.triggerEvent("visibilitychanged"))},display:function(e){e!=("none"!=this.div.style.display)&&(this.div.style.display=e&&this.calculateInRange()?"block":"none")},calculateInRange:function(){var e=!1;return this.alwaysInRange?e=!0:this.map&&(e=this.map.getResolution(),e=e>=this.minResolution&&e<=this.maxResolution),e},setIsBaseLayer:function(e){e!=this.isBaseLayer&&(this.isBaseLayer=e,null!=this.map&&this.map.events.triggerEvent("changebaselayer",{layer:this}))},initResolutions:function(){var e,t,n,i={},r=!0;for(e=0,t=this.RESOLUTION_PROPERTIES.length;e<t;e++)n=this.RESOLUTION_PROPERTIES[e],i[n]=this.options[n],r&&this.options[n]&&(r=!1);if(null==this.options.alwaysInRange&&(this.alwaysInRange=r),null==i.resolutions&&(i.resolutions=this.resolutionsFromScales(i.scales)),null==i.resolutions&&(i.resolutions=this.calculateResolutions(i)),null==i.resolutions){for(e=0,t=this.RESOLUTION_PROPERTIES.length;e<t;e++)n=this.RESOLUTION_PROPERTIES[e],i[n]=null!=this.options[n]?this.options[n]:this.map[n];null==i.resolutions&&(i.resolutions=this.resolutionsFromScales(i.scales)),null==i.resolutions&&(i.resolutions=this.calculateResolutions(i))}var s;this.options.maxResolution&&"auto"!==this.options.maxResolution&&(s=this.options.maxResolution),this.options.minScale&&(s=OpenLayers.Util.getResolutionFromScale(this.options.minScale,this.units));var a;if(this.options.minResolution&&"auto"!==this.options.minResolution&&(a=this.options.minResolution),this.options.maxScale&&(a=OpenLayers.Util.getResolutionFromScale(this.options.maxScale,this.units)),i.resolutions&&(i.resolutions.sort(function(e,t){return t-e}),s||(s=i.resolutions[0]),a||(a=i.resolutions[i.resolutions.length-1])),this.resolutions=i.resolutions){for(t=this.resolutions.length,this.scales=Array(t),e=0;e<t;e++)this.scales[e]=OpenLayers.Util.getScaleFromResolution(this.resolutions[e],this.units);this.numZoomLevels=t}(this.minResolution=a)&&(this.maxScale=OpenLayers.Util.getScaleFromResolution(a,this.units)),(this.maxResolution=s)&&(this.minScale=OpenLayers.Util.getScaleFromResolution(s,this.units))},resolutionsFromScales:function(e){if(null!=e){var t,n,i;for(i=e.length,t=Array(i),n=0;n<i;n++)t[n]=OpenLayers.Util.getResolutionFromScale(e[n],this.units);return t}},calculateResolutions:function(e){var t,n,i=e.maxResolution;if(null!=e.minScale?i=OpenLayers.Util.getResolutionFromScale(e.minScale,this.units):"auto"==i&&null!=this.maxExtent&&(t=this.map.getSize(),n=this.maxExtent.getWidth()/t.w,t=this.maxExtent.getHeight()/t.h,i=Math.max(n,t)),n=e.minResolution,null!=e.maxScale?n=OpenLayers.Util.getResolutionFromScale(e.maxScale,this.units):"auto"==e.minResolution&&null!=this.minExtent&&(t=this.map.getSize(),n=this.minExtent.getWidth()/t.w,t=this.minExtent.getHeight()/t.h,n=Math.max(n,t)),"number"!=typeof i&&"number"!=typeof n&&null!=this.maxExtent&&(i=this.map.getTileSize(),i=Math.max(this.maxExtent.getWidth()/i.w,this.maxExtent.getHeight()/i.h)),t=e.maxZoomLevel,e=e.numZoomLevels,"number"==typeof n&&"number"==typeof i&&void 0===e?e=Math.floor(Math.log(i/n)/Math.log(2))+1:void 0===e&&null!=t&&(e=t+1),!("number"!=typeof e||0>=e||"number"!=typeof i&&"number"!=typeof n)){t=Array(e);var r=2;"number"==typeof n&&"number"==typeof i&&(r=Math.pow(i/n,1/(e-1)));var s;if("number"==typeof i)for(s=0;s<e;s++)t[s]=i/Math.pow(r,s);else for(s=0;s<e;s++)t[e-1-s]=n*Math.pow(r,s);return t}},getResolution:function(){var e=this.map.getZoom();return this.getResolutionForZoom(e)},getExtent:function(){return this.map.calculateBounds()},getZoomForExtent:function(e,t){var n=this.map.getSize(),n=Math.max(e.getWidth()/n.w,e.getHeight()/n.h);return this.getZoomForResolution(n,t)},getDataExtent:function(){},getResolutionForZoom:function(e){if(e=Math.max(0,Math.min(e,this.resolutions.length-1)),this.map.fractionalZoom){var t=Math.floor(e);e=this.resolutions[t]-(e-t)*(this.resolutions[t]-this.resolutions[Math.ceil(e)])}else e=this.resolutions[Math.round(e)];return e},getZoomForResolution:function(e,t){var n,i;if(this.map.fractionalZoom){var r,s=0,a=this.resolutions[s],o=this.resolutions[this.resolutions.length-1];for(n=0,i=this.resolutions.length;n<i;++n)if(r=this.resolutions[n],r>=e&&(a=r,s=n),r<=e){o=r;break}n=a-o,n=0<n?s+(a-e)/n:s}else{for(a=Number.POSITIVE_INFINITY,n=0,i=this.resolutions.length;n<i;n++)if(t){if(s=Math.abs(this.resolutions[n]-e),s>a)break;a=s}else if(this.resolutions[n]<e)break;n=Math.max(0,n-1)}return n},getLonLatFromViewPortPx:function(e){var t=null,n=this.map;if(null!=e&&n.minPx){var t=n.getResolution(),i=n.getMaxExtent({restricted:!0}),t=new OpenLayers.LonLat((e.x-n.minPx.x)*t+i.left,(n.minPx.y-e.y)*t+i.top);this.wrapDateLine&&(t=t.wrapDateLine(this.maxExtent))}return t},getViewPortPxFromLonLat:function(e,t){var n=null;return null!=e&&(t=t||this.map.getResolution(),n=this.map.calculateBounds(null,t),n=new OpenLayers.Pixel(1/t*(e.lon-n.left),1/t*(n.top-e.lat))),n},setOpacity:function(e){if(e!=this.opacity){this.opacity=e;for(var t=this.div.childNodes,n=0,i=t.length;n<i;++n){var r=t[n].firstChild||t[n],s=t[n].lastChild;s&&"iframe"===s.nodeName.toLowerCase()&&(r=s.parentNode),OpenLayers.Util.modifyDOMElement(r,null,null,null,null,null,null,e)}null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"})}},getZIndex:function(){return this.div.style.zIndex},setZIndex:function(e){this.div.style.zIndex=e},adjustBounds:function(e){if(this.gutter){var t=this.gutter*this.map.getResolution();e=new OpenLayers.Bounds(e.left-t,e.bottom-t,e.right+t,e.top+t)}return this.wrapDateLine&&(t={rightTolerance:this.getResolution(),leftTolerance:this.getResolution()},e=e.wrapDateLine(this.maxExtent,t)),e},CLASS_NAME:"OpenLayers.Layer"}),OpenLayers.Layer.HTTPRequest=OpenLayers.Class(OpenLayers.Layer,{URL_HASH_FACTOR:(Math.sqrt(5)-1)/2,url:null,params:null,reproject:!1,initialize:function(e,t,n,i){OpenLayers.Layer.prototype.initialize.apply(this,[e,i]),this.url=t,this.params||(this.params=OpenLayers.Util.extend({},n))},destroy:function(){this.params=this.url=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.HTTPRequest(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.prototype.clone.apply(this,[e])},setUrl:function(e){this.url=e},mergeNewParams:function(e){return this.params=OpenLayers.Util.extend(this.params,e),e=this.redraw(),null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"params"}),e},redraw:function(e){return e?(this.events.triggerEvent("refresh"),this.mergeNewParams({_olSalt:Math.random()})):OpenLayers.Layer.prototype.redraw.apply(this,[])},selectUrl:function(e,t){for(var n=1,i=0,r=e.length;i<r;i++)n*=e.charCodeAt(i)*this.URL_HASH_FACTOR,n-=Math.floor(n);return t[Math.floor(n*t.length)]},getFullRequestString:function(e,t){var n=t||this.url,i=OpenLayers.Util.extend({},this.params),i=OpenLayers.Util.extend(i,e),r=OpenLayers.Util.getParameterString(i);OpenLayers.Util.isArray(n)&&(n=this.selectUrl(r,n));var s,r=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(n));for(s in i)s.toUpperCase()in r&&delete i[s];return r=OpenLayers.Util.getParameterString(i),OpenLayers.Util.urlAppend(n,r)},CLASS_NAME:"OpenLayers.Layer.HTTPRequest"}),OpenLayers.Tile=OpenLayers.Class({events:null,eventListeners:null,id:null,layer:null,url:null,bounds:null,size:null,position:null,isLoading:!1,initialize:function(e,t,n,i,r,s){this.layer=e,this.position=t.clone(),this.setBounds(n),this.url=i,r&&(this.size=r.clone()),this.id=OpenLayers.Util.createUniqueID("Tile_"),OpenLayers.Util.extend(this,s),this.events=new OpenLayers.Events(this),this.eventListeners instanceof Object&&this.events.on(this.eventListeners)},unload:function(){this.isLoading&&(this.isLoading=!1,this.events.triggerEvent("unload"))},destroy:function(){this.position=this.size=this.bounds=this.layer=null,this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy(),this.events=this.eventListeners=null},draw:function(e){e||this.clear();var t=this.shouldDraw();return t&&!e&&!1===this.events.triggerEvent("beforedraw")&&(t=null),t},shouldDraw:function(){var e=!1,t=this.layer.maxExtent;if(t){var n=this.layer.map,n=n.baseLayer.wrapDateLine&&n.getMaxExtent();this.bounds.intersectsBounds(t,{inclusive:!1,worldBounds:n})&&(e=!0)}return e||this.layer.displayOutsideMaxExtent},setBounds:function(e){if(e=e.clone(),this.layer.map.baseLayer.wrapDateLine){var t=this.layer.map.getMaxExtent(),n=this.layer.map.getResolution();e=e.wrapDateLine(t,{leftTolerance:n,rightTolerance:n})}this.bounds=e},moveTo:function(e,t,n){null==n&&(n=!0),this.setBounds(e),this.position=t.clone(),n&&this.draw()},clear:function(e){},CLASS_NAME:"OpenLayers.Tile"}),OpenLayers.Tile.Image=OpenLayers.Class(OpenLayers.Tile,{url:null,imgDiv:null,frame:null,imageReloadAttempts:null,layerAlphaHack:null,asyncRequestId:null,maxGetUrlLength:null,canvasContext:null,crossOriginKeyword:null,initialize:function(e,t,n,i,r,s){OpenLayers.Tile.prototype.initialize.apply(this,arguments),this.url=i,this.layerAlphaHack=this.layer.alpha&&OpenLayers.Util.alphaHack(),(null!=this.maxGetUrlLength||this.layer.gutter||this.layerAlphaHack)&&(this.frame=document.createElement("div"),this.frame.style.position="absolute",this.frame.style.overflow="hidden"),null!=this.maxGetUrlLength&&OpenLayers.Util.extend(this,OpenLayers.Tile.Image.IFrame)},destroy:function(){this.imgDiv&&(this.clear(),this.frame=this.imgDiv=null),this.asyncRequestId=null,OpenLayers.Tile.prototype.destroy.apply(this,arguments)},draw:function(){var e=OpenLayers.Tile.prototype.draw.apply(this,arguments);return e?(this.layer!=this.layer.map.baseLayer&&this.layer.reproject&&(this.bounds=this.getBoundsFromBaseLayer(this.position)),this.isLoading?this._loadEvent="reload":(this.isLoading=!0,this._loadEvent="loadstart"),this.renderTile(),this.positionTile()):!1===e&&this.unload(),e},renderTile:function(){if(this.layer.async){var e=this.asyncRequestId=(this.asyncRequestId||0)+1;this.layer.getURLasync(this.bounds,function(t){e==this.asyncRequestId&&(this.url=t,this.initImage())},this)}else this.url=this.layer.getURL(this.bounds),this.initImage()},positionTile:function(){var e=this.getTile().style,t=this.frame?this.size:this.layer.getImageSize(this.bounds),n=1;this.layer instanceof OpenLayers.Layer.Grid&&(n=this.layer.getServerResolution()/this.layer.map.getResolution()),e.left=this.position.x+"px",e.top=this.position.y+"px",e.width=Math.round(n*t.w)+"px",e.height=Math.round(n*t.h)+"px"},clear:function(){OpenLayers.Tile.prototype.clear.apply(this,arguments);var e=this.imgDiv;if(e){var t=this.getTile();t.parentNode===this.layer.div&&this.layer.div.removeChild(t),this.setImgSrc(),!0===this.layerAlphaHack&&(e.style.filter=""),OpenLayers.Element.removeClass(e,"olImageLoadError")}this.canvasContext=null},getImage:function(){if(!this.imgDiv){this.imgDiv=OpenLayers.Tile.Image.IMAGE.cloneNode(!1);var e=this.imgDiv.style;if(this.frame){var t=0,n=0;this.layer.gutter&&(t=this.layer.gutter/this.layer.tileSize.w*100,n=this.layer.gutter/this.layer.tileSize.h*100),e.left=-t+"%",e.top=-n+"%",e.width=2*t+100+"%",e.height=2*n+100+"%"}e.visibility="hidden",e.opacity=0,1>this.layer.opacity&&(e.filter="alpha(opacity="+100*this.layer.opacity+")"),e.position="absolute",this.layerAlphaHack&&(e.paddingTop=e.height,e.height="0",e.width="100%"),this.frame&&this.frame.appendChild(this.imgDiv)}return this.imgDiv},setImage:function(e){this.imgDiv=e},initImage:function(){if(this.url||this.imgDiv){this.events.triggerEvent("beforeload"),this.layer.div.appendChild(this.getTile()),this.events.triggerEvent(this._loadEvent);var e=this.getImage(),t=e.getAttribute("src")||"";this.url&&OpenLayers.Util.isEquivalentUrl(t,this.url)?this._loadTimeout=window.setTimeout(OpenLayers.Function.bind(this.onImageLoad,this),0):(this.stopLoading(),this.crossOriginKeyword&&e.removeAttribute("crossorigin"),OpenLayers.Event.observe(e,"load",OpenLayers.Function.bind(this.onImageLoad,this)),OpenLayers.Event.observe(e,"error",OpenLayers.Function.bind(this.onImageError,this)),this.imageReloadAttempts=0,this.setImgSrc(this.url))}else this.isLoading=!1},setImgSrc:function(e){var t=this.imgDiv;e?(t.style.visibility="hidden",t.style.opacity=0,this.crossOriginKeyword&&("data:"!==e.substr(0,5)?t.setAttribute("crossorigin",this.crossOriginKeyword):t.removeAttribute("crossorigin")),t.src=e):(this.stopLoading(),this.imgDiv=null,t.parentNode&&t.parentNode.removeChild(t))},getTile:function(){return this.frame?this.frame:this.getImage()},createBackBuffer:function(){if(this.imgDiv&&!this.isLoading){var e;return this.frame?(e=this.frame.cloneNode(!1),e.appendChild(this.imgDiv)):e=this.imgDiv,this.imgDiv=null,e}},onImageLoad:function(){var e=this.imgDiv;this.stopLoading(),e.style.visibility="inherit",e.style.opacity=this.layer.opacity,this.isLoading=!1,this.canvasContext=null,this.events.triggerEvent("loadend"),!0===this.layerAlphaHack&&(e.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+e.src+"', sizingMethod='scale')")},onImageError:function(){var e=this.imgDiv;null!=e.src&&(this.imageReloadAttempts++,this.imageReloadAttempts<=OpenLayers.IMAGE_RELOAD_ATTEMPTS?this.setImgSrc(this.layer.getURL(this.bounds)):(OpenLayers.Element.addClass(e,"olImageLoadError"),this.events.triggerEvent("loaderror"),this.onImageLoad()))},stopLoading:function(){OpenLayers.Event.stopObservingElement(this.imgDiv),window.clearTimeout(this._loadTimeout),delete this._loadTimeout},getCanvasContext:function(){if(OpenLayers.CANVAS_SUPPORTED&&this.imgDiv&&!this.isLoading){if(!this.canvasContext){var e=document.createElement("canvas");e.width=this.size.w,e.height=this.size.h,this.canvasContext=e.getContext("2d"),this.canvasContext.drawImage(this.imgDiv,0,0)}return this.canvasContext}},CLASS_NAME:"OpenLayers.Tile.Image"}),OpenLayers.Tile.Image.IMAGE=function(){var e=new Image;return e.className="olTileImage",e.galleryImg="no",e}(),OpenLayers.Layer.Grid=OpenLayers.Class(OpenLayers.Layer.HTTPRequest,{tileSize:null,tileOriginCorner:"bl",tileOrigin:null,tileOptions:null,tileClass:OpenLayers.Tile.Image,grid:null,singleTile:!1,ratio:1.5,buffer:0,transitionEffect:"resize",numLoadingTiles:0,serverResolutions:null,loading:!1,backBuffer:null,gridResolution:null,backBufferResolution:null,backBufferLonLat:null,backBufferTimerId:null,removeBackBufferDelay:null,className:null,gridLayout:null,rowSign:null,transitionendEvents:["transitionend","webkitTransitionEnd","otransitionend","oTransitionEnd"],initialize:function(e,t,n,i){OpenLayers.Layer.HTTPRequest.prototype.initialize.apply(this,arguments),this.grid=[],this._removeBackBuffer=OpenLayers.Function.bind(this.removeBackBuffer,this),this.initProperties(),this.rowSign="t"===this.tileOriginCorner.substr(0,1)?1:-1},initProperties:function(){void 0===this.options.removeBackBufferDelay&&(this.removeBackBufferDelay=this.singleTile?0:2500),void 0===this.options.className&&(this.className=this.singleTile?"olLayerGridSingleTile":"olLayerGrid")},setMap:function(e){OpenLayers.Layer.HTTPRequest.prototype.setMap.call(this,e),OpenLayers.Element.addClass(this.div,this.className)},removeMap:function(e){this.removeBackBuffer()},destroy:function(){this.removeBackBuffer(),this.clearGrid(),this.tileSize=this.grid=null,OpenLayers.Layer.HTTPRequest.prototype.destroy.apply(this,arguments)},clearGrid:function(){if(this.grid){for(var e=0,t=this.grid.length;e<t;e++)for(var n=this.grid[e],i=0,r=n.length;i<r;i++)this.destroyTile(n[i]);
this.grid=[],this.gridLayout=this.gridResolution=null}},addOptions:function(e,t){var n=void 0!==e.singleTile&&e.singleTile!==this.singleTile;OpenLayers.Layer.HTTPRequest.prototype.addOptions.apply(this,arguments),this.map&&n&&(this.initProperties(),this.clearGrid(),this.tileSize=this.options.tileSize,this.setTileSize(),this.visibility&&this.moveTo(null,!0))},clone:function(e){return null==e&&(e=new OpenLayers.Layer.Grid(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.HTTPRequest.prototype.clone.apply(this,[e]),null!=this.tileSize&&(e.tileSize=this.tileSize.clone()),e.grid=[],e.gridResolution=null,e.backBuffer=null,e.backBufferTimerId=null,e.loading=!1,e.numLoadingTiles=0,e},moveTo:function(e,t,n){if(OpenLayers.Layer.HTTPRequest.prototype.moveTo.apply(this,arguments),e=e||this.map.getExtent(),null!=e){var i=!this.grid.length||t,r=this.getTilesBounds(),s=this.map.getResolution();this.getServerResolution(s),this.singleTile?(i||!n&&!r.containsBounds(e))&&(t&&"resize"!==this.transitionEffect&&this.removeBackBuffer(),t&&"resize"!==this.transitionEffect||this.applyBackBuffer(s),this.initSingleTile(e)):(i=i||!r.intersectsBounds(e,{worldBounds:this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent()}))?(!t||"resize"!==this.transitionEffect&&this.gridResolution!==s||this.applyBackBuffer(s),this.initGriddedTiles(e)):this.moveGriddedTiles()}},getTileData:function(e){var t=null,n=e.lon,i=e.lat,r=this.grid.length;if(this.map&&r){var s=this.map.getResolution();e=this.tileSize.w;var a=this.tileSize.h,o=this.grid[0][0].bounds,l=o.left,o=o.top;if(n<l&&this.map.baseLayer.wrapDateLine)var h=this.map.getMaxExtent().getWidth(),n=n+h*Math.ceil((l-n)/h);n=(n-l)/(s*e),i=(o-i)/(s*a),s=Math.floor(n),l=Math.floor(i),0<=l&&l<r&&(r=this.grid[l][s])&&(t={tile:r,i:Math.floor((n-s)*e),j:Math.floor((i-l)*a)})}return t},destroyTile:function(e){this.removeTileMonitoringHooks(e),e.destroy()},getServerResolution:function(e){var t=Number.POSITIVE_INFINITY;if(e=e||this.map.getResolution(),this.serverResolutions&&-1===OpenLayers.Util.indexOf(this.serverResolutions,e)){var n,i,r,s;for(n=this.serverResolutions.length-1;0<=n&&(r=this.serverResolutions[n],i=Math.abs(r-e),!(i>t));n--)t=i,s=r;e=s}return e},getServerZoom:function(){var e=this.getServerResolution();return this.serverResolutions?OpenLayers.Util.indexOf(this.serverResolutions,e):this.map.getZoomForResolution(e)+(this.zoomOffset||0)},applyBackBuffer:function(e){null!==this.backBufferTimerId&&this.removeBackBuffer();var t=this.backBuffer;if(!t){if(t=this.createBackBuffer(),!t)return;e===this.gridResolution?this.div.insertBefore(t,this.div.firstChild):this.map.baseLayer.div.parentNode.insertBefore(t,this.map.baseLayer.div),this.backBuffer=t;var n=this.grid[0][0].bounds;this.backBufferLonLat={lon:n.left,lat:n.top},this.backBufferResolution=this.gridResolution}for(var i,n=this.backBufferResolution/e,r=t.childNodes,s=r.length-1;0<=s;--s)i=r[s],i.style.top=(n*i._i*t._th|0)+"px",i.style.left=(n*i._j*t._tw|0)+"px",i.style.width=Math.round(n*i._w)+"px",i.style.height=Math.round(n*i._h)+"px";e=this.getViewPortPxFromLonLat(this.backBufferLonLat,e),n=this.map.layerContainerOriginPx.y,t.style.left=Math.round(e.x-this.map.layerContainerOriginPx.x)+"px",t.style.top=Math.round(e.y-n)+"px"},createBackBuffer:function(){var e;if(0<this.grid.length){e=document.createElement("div"),e.id=this.div.id+"_bb",e.className="olBackBuffer",e.style.position="absolute";var t=this.map;e.style.zIndex="resize"===this.transitionEffect?this.getZIndex()-1:t.Z_INDEX_BASE.BaseLayer-(t.getNumLayers()-t.getLayerIndex(this));for(var t=0,n=this.grid.length;t<n;t++)for(var i=0,r=this.grid[t].length;i<r;i++){var s=this.grid[t][i],a=this.grid[t][i].createBackBuffer();a&&(a._i=t,a._j=i,a._w=this.singleTile?this.getImageSize(s.bounds).w:s.size.w,a._h=s.size.h,a.id=s.id+"_bb",e.appendChild(a))}e._tw=this.tileSize.w,e._th=this.tileSize.h}return e},removeBackBuffer:function(){if(this._transitionElement){for(var e=this.transitionendEvents.length-1;0<=e;--e)OpenLayers.Event.stopObserving(this._transitionElement,this.transitionendEvents[e],this._removeBackBuffer);delete this._transitionElement}this.backBuffer&&(this.backBuffer.parentNode&&this.backBuffer.parentNode.removeChild(this.backBuffer),this.backBufferResolution=this.backBuffer=null,null!==this.backBufferTimerId&&(window.clearTimeout(this.backBufferTimerId),this.backBufferTimerId=null))},moveByPx:function(e,t){this.singleTile||this.moveGriddedTiles()},setTileSize:function(e){this.singleTile&&(e=this.map.getSize(),e.h=parseInt(e.h*this.ratio,10),e.w=parseInt(e.w*this.ratio,10)),OpenLayers.Layer.HTTPRequest.prototype.setTileSize.apply(this,[e])},getTilesBounds:function(){var e=null,t=this.grid.length;if(t)var e=this.grid[t-1][0].bounds,t=this.grid[0].length*e.getWidth(),n=this.grid.length*e.getHeight(),e=new OpenLayers.Bounds(e.left,e.bottom,e.left+t,e.bottom+n);return e},initSingleTile:function(e){this.events.triggerEvent("retile");var t=e.getCenterLonLat(),n=e.getWidth()*this.ratio;e=e.getHeight()*this.ratio,t=new OpenLayers.Bounds(t.lon-n/2,t.lat-e/2,t.lon+n/2,t.lat+e/2),this.gridResolution=this.getServerResolution(),(n=this.maxExtent)&&(!this.displayOutsideMaxExtent||this.map.baseLayer.wrapDateLine&&this.maxExtent.equals(this.map.getMaxExtent()))&&(t.left=Math.max(t.left,n.left),t.right=Math.min(t.right,n.right)),n=this.map.getLayerPxFromLonLat({lon:t.left,lat:t.top}),this.grid.length||(this.grid[0]=[]),(e=this.grid[0][0])?e.moveTo(t,n):(e=this.addTile(t,n),this.addTileMonitoringHooks(e),e.draw(),this.grid[0][0]=e),this.removeExcessTiles(1,1)},calculateGridLayout:function(e,t,n){var i=n*this.tileSize.w;n*=this.tileSize.h;var r=Math.floor((e.left-t.lon)/i)-this.buffer,s=this.rowSign;return e=Math[~s?"floor":"ceil"](s*(t.lat-e.top+n)/n)-this.buffer*s,{tilelon:i,tilelat:n,startcol:r,startrow:e}},getImageSize:function(e){var t=OpenLayers.Layer.HTTPRequest.prototype.getImageSize.apply(this,arguments);return this.singleTile&&(t=new OpenLayers.Size(Math.round(e.getWidth()/this.gridResolution),t.h)),t},getTileOrigin:function(){var e=this.tileOrigin;if(!e)var e=this.getMaxExtent(),t={tl:["left","top"],tr:["right","top"],bl:["left","bottom"],br:["right","bottom"]}[this.tileOriginCorner],e=new OpenLayers.LonLat(e[t[0]],e[t[1]]);return e},getTileBoundsForGridIndex:function(e,t){var n=this.getTileOrigin(),i=this.gridLayout,r=i.tilelon,s=i.tilelat,a=i.startcol,i=i.startrow,o=this.rowSign;return new OpenLayers.Bounds(n.lon+(a+t)*r,n.lat-(i+e*o)*s*o,n.lon+(a+t+1)*r,n.lat-(i+(e-1)*o)*s*o)},initGriddedTiles:function(e){this.events.triggerEvent("retile");var t=this.map.getSize(),n=this.getTileOrigin(),i=this.map.getResolution(),r=this.getServerResolution(),s=i/r,i=this.tileSize.w/s,s=this.tileSize.h/s,a=Math.ceil(t.h/s)+2*this.buffer+1,t=Math.ceil(t.w/i)+2*this.buffer+1;this.gridLayout=r=this.calculateGridLayout(e,n,r);var n=r.tilelon,o=r.tilelat,r=this.map.layerContainerOriginPx.x,l=this.map.layerContainerOriginPx.y,h=this.getTileBoundsForGridIndex(0,0),u=this.map.getViewPortPxFromLonLat(new OpenLayers.LonLat(h.left,h.top));u.x=Math.round(u.x)-r,u.y=Math.round(u.y)-l;var r=[],l=this.map.getCenter(),p=0;do{var c=this.grid[p];c||(c=[],this.grid.push(c));var d=0;do{var h=this.getTileBoundsForGridIndex(p,d),y=u.clone();y.x+=d*Math.round(i),y.y+=p*Math.round(s);var f=c[d];f?f.moveTo(h,y,!1):(f=this.addTile(h,y),this.addTileMonitoringHooks(f),c.push(f)),y=h.getCenterLonLat(),r.push({tile:f,distance:Math.pow(y.lon-l.lon,2)+Math.pow(y.lat-l.lat,2)}),d+=1}while(h.right<=e.right+n*this.buffer||d<t);p+=1}while(h.bottom>=e.bottom-o*this.buffer||p<a);for(this.removeExcessTiles(p,d),this.gridResolution=i=this.getServerResolution(),r.sort(function(e,t){return e.distance-t.distance}),e=0,i=r.length;e<i;++e)r[e].tile.draw()},getMaxExtent:function(){return this.maxExtent},addTile:function(e,t){var n=new this.tileClass(this,t,e,null,this.tileSize,this.tileOptions);return this.events.triggerEvent("addtile",{tile:n}),n},addTileMonitoringHooks:function(e){e.onLoadStart=function(){!1===this.loading&&(this.loading=!0,this.events.triggerEvent("loadstart")),this.events.triggerEvent("tileloadstart",{tile:e}),this.numLoadingTiles++,!this.singleTile&&this.backBuffer&&this.gridResolution===this.backBufferResolution&&OpenLayers.Element.addClass(e.getTile(),"olTileReplacing")},e.onLoadEnd=function(t){if(this.numLoadingTiles--,t="unload"===t.type,this.events.triggerEvent("tileloaded",{tile:e,aborted:t}),!this.singleTile&&!t&&this.backBuffer&&this.gridResolution===this.backBufferResolution){var n=e.getTile();if("none"===OpenLayers.Element.getStyle(n,"display")){var i=document.getElementById(e.id+"_bb");i&&i.parentNode.removeChild(i)}OpenLayers.Element.removeClass(n,"olTileReplacing")}if(0===this.numLoadingTiles){if(this.backBuffer)if(0===this.backBuffer.childNodes.length)this.removeBackBuffer();else{if(this._transitionElement=t?this.div.lastChild:e.imgDiv,t=this.transitionendEvents,this._transitionElement)for(n=t.length-1;0<=n;--n)OpenLayers.Event.observe(this._transitionElement,t[n],this._removeBackBuffer);this.backBufferTimerId=window.setTimeout(this._removeBackBuffer,this.removeBackBufferDelay)}this.loading=!1,this.events.triggerEvent("loadend")}},e.onLoadError=function(){this.events.triggerEvent("tileerror",{tile:e})},e.events.on({loadstart:e.onLoadStart,loadend:e.onLoadEnd,unload:e.onLoadEnd,loaderror:e.onLoadError,scope:this})},removeTileMonitoringHooks:function(e){e.unload(),e.events.un({loadstart:e.onLoadStart,loadend:e.onLoadEnd,unload:e.onLoadEnd,loaderror:e.onLoadError,scope:this})},moveGriddedTiles:function(){for(var e=this.buffer+1;;){var t=this.grid[0][0],n=t.position.x+this.map.layerContainerOriginPx.x,t=t.position.y+this.map.layerContainerOriginPx.y,i=this.getServerResolution()/this.map.getResolution(),i={w:Math.round(this.tileSize.w*i),h:Math.round(this.tileSize.h*i)};if(n>-i.w*(e-1))this.shiftColumn(!0,i);else if(n<-i.w*e)this.shiftColumn(!1,i);else if(t>-i.h*(e-1))this.shiftRow(!0,i);else{if(!(t<-i.h*e))break;this.shiftRow(!1,i)}}},shiftRow:function(e,t){var n=this.grid,i=e?0:n.length-1,r=e?-1:1;this.gridLayout.startrow+=r*this.rowSign;for(var s=n[i],a=n[e?"pop":"shift"](),o=0,l=a.length;o<l;o++){var h=a[o],u=s[o].position.clone();u.y+=t.h*r,h.moveTo(this.getTileBoundsForGridIndex(i,o),u)}n[e?"unshift":"push"](a)},shiftColumn:function(e,t){var n=this.grid,i=e?0:n[0].length-1,r=e?-1:1;this.gridLayout.startcol+=r;for(var s=0,a=n.length;s<a;s++){var o=n[s],l=o[i].position.clone(),h=o[e?"pop":"shift"]();l.x+=t.w*r,h.moveTo(this.getTileBoundsForGridIndex(s,i),l),o[e?"unshift":"push"](h)}},removeExcessTiles:function(e,t){for(var n,i;this.grid.length>e;){var r=this.grid.pop();for(n=0,i=r.length;n<i;n++){var s=r[n];this.destroyTile(s)}}for(n=0,i=this.grid.length;n<i;n++)for(;this.grid[n].length>t;)r=this.grid[n],s=r.pop(),this.destroyTile(s)},onMapResize:function(){this.singleTile&&(this.clearGrid(),this.setTileSize())},getTileBounds:function(e){var t=this.maxExtent,n=this.getResolution(),i=n*this.tileSize.w,n=n*this.tileSize.h,r=this.getLonLatFromViewPortPx(e);return e=t.left+i*Math.floor((r.lon-t.left)/i),t=t.bottom+n*Math.floor((r.lat-t.bottom)/n),new OpenLayers.Bounds(e,t,e+i,t+n)},CLASS_NAME:"OpenLayers.Layer.Grid"}),OpenLayers.TileManager=OpenLayers.Class({cacheSize:256,tilesPerFrame:2,frameDelay:16,moveDelay:100,zoomDelay:200,maps:null,tileQueueId:null,tileQueue:null,tileCache:null,tileCacheIndex:null,initialize:function(e){OpenLayers.Util.extend(this,e),this.maps=[],this.tileQueueId={},this.tileQueue={},this.tileCache={},this.tileCacheIndex=[]},addMap:function(e){if(!this._destroyed&&OpenLayers.Layer.Grid){this.maps.push(e),this.tileQueue[e.id]=[];for(var t=0,n=e.layers.length;t<n;++t)this.addLayer({layer:e.layers[t]});e.events.on({move:this.move,zoomend:this.zoomEnd,changelayer:this.changeLayer,addlayer:this.addLayer,preremovelayer:this.removeLayer,scope:this})}},removeMap:function(e){if(!this._destroyed&&OpenLayers.Layer.Grid){if(window.clearTimeout(this.tileQueueId[e.id]),e.layers)for(var t=0,n=e.layers.length;t<n;++t)this.removeLayer({layer:e.layers[t]});e.events&&e.events.un({move:this.move,zoomend:this.zoomEnd,changelayer:this.changeLayer,addlayer:this.addLayer,preremovelayer:this.removeLayer,scope:this}),delete this.tileQueue[e.id],delete this.tileQueueId[e.id],OpenLayers.Util.removeItem(this.maps,e)}},move:function(e){this.updateTimeout(e.object,this.moveDelay,!0)},zoomEnd:function(e){this.updateTimeout(e.object,this.zoomDelay)},changeLayer:function(e){"visibility"!==e.property&&"params"!==e.property||this.updateTimeout(e.object,0)},addLayer:function(e){if(e=e.layer,e instanceof OpenLayers.Layer.Grid){e.events.on({addtile:this.addTile,refresh:this.handleLayerRefresh,retile:this.clearTileQueue,scope:this});var t,n,i;for(t=e.grid.length-1;0<=t;--t)for(n=e.grid[t].length-1;0<=n;--n)i=e.grid[t][n],this.addTile({tile:i}),i.url&&!i.imgDiv&&this.manageTileCache({object:i})}},removeLayer:function(e){if(e=e.layer,e instanceof OpenLayers.Layer.Grid&&(this.clearTileQueue({object:e}),e.events&&e.events.un({addtile:this.addTile,refresh:this.handleLayerRefresh,retile:this.clearTileQueue,scope:this}),e.grid)){var t,n,i;for(t=e.grid.length-1;0<=t;--t)for(n=e.grid[t].length-1;0<=n;--n)i=e.grid[t][n],this.unloadTile({object:i})}},handleLayerRefresh:function(e){if(e=e.object,e.grid){var t,n,i;for(t=e.grid.length-1;0<=t;--t)for(n=e.grid[t].length-1;0<=n;--n)i=e.grid[t][n],OpenLayers.Util.removeItem(this.tileCacheIndex,i.url),delete this.tileCache[i.url]}},updateTimeout:function(e,t,n){window.clearTimeout(this.tileQueueId[e.id]);var i=this.tileQueue[e.id];n&&!i.length||(this.tileQueueId[e.id]=window.setTimeout(OpenLayers.Function.bind(function(){this.drawTilesFromQueue(e),i.length&&this.updateTimeout(e,this.frameDelay)},this),t))},addTile:function(e){e.tile instanceof OpenLayers.Tile.Image?e.tile.layer.singleTile||e.tile.events.on({beforedraw:this.queueTileDraw,beforeload:this.manageTileCache,loadend:this.addToCache,unload:this.unloadTile,scope:this}):this.removeLayer({layer:e.tile.layer})},unloadTile:function(e){e=e.object,e.events.un({beforedraw:this.queueTileDraw,beforeload:this.manageTileCache,loadend:this.addToCache,unload:this.unloadTile,scope:this}),OpenLayers.Util.removeItem(this.tileQueue[e.layer.map.id],e)},queueTileDraw:function(e){e=e.object;var t=!1,n=e.layer,i=n.getURL(e.bounds),r=this.tileCache[i];return r&&"olTileImage"!==r.className&&(delete this.tileCache[i],OpenLayers.Util.removeItem(this.tileCacheIndex,i),r=null),!n.url||!n.async&&r||(t=this.tileQueue[n.map.id],~OpenLayers.Util.indexOf(t,e)||t.push(e),t=!0),!t},drawTilesFromQueue:function(e){var t=this.tileQueue[e.id],n=this.tilesPerFrame;for(e=e.zoomTween&&e.zoomTween.playing;!e&&t.length&&n;)t.shift().draw(!0),--n},manageTileCache:function(e){e=e.object;var t=this.tileCache[e.url];t&&(t.parentNode&&OpenLayers.Element.hasClass(t.parentNode,"olBackBuffer")&&(t.parentNode.removeChild(t),t.id=null),t.parentNode||(t.style.visibility="hidden",t.style.opacity=0,e.setImage(t),OpenLayers.Util.removeItem(this.tileCacheIndex,e.url),this.tileCacheIndex.push(e.url)))},addToCache:function(e){e=e.object,this.tileCache[e.url]||OpenLayers.Element.hasClass(e.imgDiv,"olImageLoadError")||(this.tileCacheIndex.length>=this.cacheSize&&(delete this.tileCache[this.tileCacheIndex[0]],this.tileCacheIndex.shift()),this.tileCache[e.url]=e.imgDiv,this.tileCacheIndex.push(e.url))},clearTileQueue:function(e){e=e.object;for(var t=this.tileQueue[e.map.id],n=t.length-1;0<=n;--n)t[n].layer===e&&t.splice(n,1)},destroy:function(){for(var e=this.maps.length-1;0<=e;--e)this.removeMap(this.maps[e]);this.tileCacheIndex=this.tileCache=this.tileQueueId=this.tileQueue=this.maps=null,this._destroyed=!0}}),OpenLayers.Renderer=OpenLayers.Class({container:null,root:null,extent:null,locked:!1,size:null,resolution:null,map:null,featureDx:0,initialize:function(e,t){this.container=OpenLayers.Util.getElement(e),OpenLayers.Util.extend(this,t)},destroy:function(){this.map=this.resolution=this.size=this.extent=this.container=null},supported:function(){return!1},setExtent:function(e,t){if(this.extent=e.clone(),this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var n=e.getWidth()/this.map.getExtent().getWidth();e=e.scale(1/n),this.extent=e.wrapDateLine(this.map.getMaxExtent()).scale(n)}return t&&(this.resolution=null),!0},setSize:function(e){this.size=e.clone(),this.resolution=null},getResolution:function(){return this.resolution=this.resolution||this.map.getResolution()},drawFeature:function(e,t){if(null==t&&(t=e.style),e.geometry){var n=e.geometry.getBounds();if(n){var i;if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(i=this.map.getMaxExtent()),n.intersectsBounds(this.extent,{worldBounds:i})?this.calculateFeatureDx(n,i):t={display:"none"},n=this.drawGeometry(e.geometry,t,e.id),"none"!=t.display&&t.label&&!1!==n){if(i=e.geometry.getCentroid(),t.labelXOffset||t.labelYOffset){var r=isNaN(t.labelXOffset)?0:t.labelXOffset,s=isNaN(t.labelYOffset)?0:t.labelYOffset,a=this.getResolution();i.move(r*a,s*a)}this.drawText(e.id,t,i)}else this.removeText(e.id);return n}}},calculateFeatureDx:function(e,t){if(this.featureDx=0,t){var n=t.getWidth();this.featureDx=Math.round(((e.left+e.right)/2-(this.extent.left+this.extent.right)/2)/n)*n}},drawGeometry:function(e,t,n){},drawText:function(e,t,n){},removeText:function(e){},clear:function(){},getFeatureIdFromEvent:function(e){},eraseFeatures:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=0,n=e.length;t<n;++t){var i=e[t];this.eraseGeometry(i.geometry,i.id),this.removeText(i.id)}},eraseGeometry:function(e,t){},moveRoot:function(e){},getRenderLayerId:function(){return this.container.id},applyDefaultSymbolizer:function(e){var t=OpenLayers.Util.extend({},OpenLayers.Renderer.defaultSymbolizer);return!1===e.stroke&&(delete t.strokeWidth,delete t.strokeColor),!1===e.fill&&delete t.fillColor,OpenLayers.Util.extend(t,e),t},CLASS_NAME:"OpenLayers.Renderer"}),OpenLayers.Renderer.defaultSymbolizer={fillColor:"#000000",strokeColor:"#000000",strokeWidth:2,fillOpacity:1,strokeOpacity:1,pointRadius:0,labelAlign:"cm"},OpenLayers.Renderer.symbol={star:[350,75,379,161,469,161,397,215,423,301,350,250,277,301,303,215,231,161,321,161,350,75],cross:[4,0,6,0,6,4,10,4,10,6,6,6,6,10,4,10,4,6,0,6,0,4,4,4,4,0],x:[0,0,25,0,50,35,75,0,100,0,65,50,100,100,75,100,50,65,25,100,0,100,35,50,0,0],square:[0,0,0,1,1,1,1,0,0,0],triangle:[0,10,10,10,5,0,0,10]},OpenLayers.Renderer.Canvas=OpenLayers.Class(OpenLayers.Renderer,{hitDetection:!0,hitOverflow:0,canvas:null,features:null,pendingRedraw:!1,cachedSymbolBounds:{},initialize:function(e,t){OpenLayers.Renderer.prototype.initialize.apply(this,arguments),this.root=document.createElement("canvas"),this.container.appendChild(this.root),this.canvas=this.root.getContext("2d"),this._clearRectId=OpenLayers.Util.createUniqueID(),this.features={},this.hitDetection&&(this.hitCanvas=document.createElement("canvas"),this.hitContext=this.hitCanvas.getContext("2d"))},setExtent:function(){return OpenLayers.Renderer.prototype.setExtent.apply(this,arguments),!1},eraseGeometry:function(e,t){this.eraseFeatures(this.features[t][0])},supported:function(){return OpenLayers.CANVAS_SUPPORTED},setSize:function(e){this.size=e.clone();var t=this.root;t.style.width=e.w+"px",t.style.height=e.h+"px",t.width=e.w,t.height=e.h,this.resolution=null,this.hitDetection&&(t=this.hitCanvas,t.style.width=e.w+"px",t.style.height=e.h+"px",t.width=e.w,t.height=e.h)},drawFeature:function(e,t){var n;if(e.geometry){t=this.applyDefaultSymbolizer(t||e.style),n=e.geometry.getBounds();var i;this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(i=this.map.getMaxExtent()),i=n&&n.intersectsBounds(this.extent,{worldBounds:i}),(n="none"!==t.display&&!!n&&i)?this.features[e.id]=[e,t]:delete this.features[e.id],this.pendingRedraw=!0}return this.pendingRedraw&&!this.locked&&(this.redraw(),this.pendingRedraw=!1),n},drawGeometry:function(e,t,n){var i=e.CLASS_NAME;if("OpenLayers.Geometry.Collection"==i||"OpenLayers.Geometry.MultiPoint"==i||"OpenLayers.Geometry.MultiLineString"==i||"OpenLayers.Geometry.MultiPolygon"==i)for(var i=this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent(),r=0;r<e.components.length;r++)this.calculateFeatureDx(e.components[r].getBounds(),i),this.drawGeometry(e.components[r],t,n);else switch(e.CLASS_NAME){case"OpenLayers.Geometry.Point":this.drawPoint(e,t,n);break;case"OpenLayers.Geometry.LineString":this.drawLineString(e,t,n);break;case"OpenLayers.Geometry.LinearRing":this.drawLinearRing(e,t,n);break;case"OpenLayers.Geometry.Polygon":this.drawPolygon(e,t,n)}},drawExternalGraphic:function(e,t,n){var i=new Image,r=t.title||t.graphicTitle;r&&(i.title=r);var s=t.graphicWidth||t.graphicHeight,a=t.graphicHeight||t.graphicWidth,s=s?s:2*t.pointRadius,a=a?a:2*t.pointRadius,o=void 0!=t.graphicXOffset?t.graphicXOffset:-(.5*s),l=void 0!=t.graphicYOffset?t.graphicYOffset:-(.5*a),h=this._clearRectId,u=t.graphicOpacity||t.fillOpacity;i.onload=OpenLayers.Function.bind(function(){if(this.features[n]&&h===this._clearRectId){var t=this.getLocalXY(e),r=t[0],t=t[1];if(!isNaN(r)&&!isNaN(t)){var r=r+o|0,t=t+l|0,p=this.canvas;p.globalAlpha=u;var c=OpenLayers.Renderer.Canvas.drawImageScaleFactor||(OpenLayers.Renderer.Canvas.drawImageScaleFactor=/android 2.1/.test(navigator.userAgent.toLowerCase())?320/window.screen.width:1);p.drawImage(i,r*c,t*c,s*c,a*c),this.hitDetection&&(this.setHitContextStyle("fill",n),this.hitContext.fillRect(r,t,s,a))}}},this),i.src=t.externalGraphic,i.complete&&(i.onload(),i.onload=null)},drawNamedSymbol:function(e,t,n){var i,r,s,a;s=Math.PI/180;var o=OpenLayers.Renderer.symbol[t.graphicName];if(!o)throw Error(t.graphicName+" is not a valid symbol name");if(!(!o.length||2>o.length||(e=this.getLocalXY(e),r=e[0],a=e[1],isNaN(r)||isNaN(a)))){if(this.canvas.lineCap="round",this.canvas.lineJoin="round",this.hitDetection&&(this.hitContext.lineCap="round",this.hitContext.lineJoin="round"),t.graphicName in this.cachedSymbolBounds)i=this.cachedSymbolBounds[t.graphicName];else{for(i=new OpenLayers.Bounds,e=0;e<o.length;e+=2)i.extend(new OpenLayers.LonLat(o[e],o[e+1]));this.cachedSymbolBounds[t.graphicName]=i}if(this.canvas.save(),this.hitDetection&&this.hitContext.save(),this.canvas.translate(r,a),this.hitDetection&&this.hitContext.translate(r,a),e=s*t.rotation,isNaN(e)||(this.canvas.rotate(e),this.hitDetection&&this.hitContext.rotate(e)),s=2*t.pointRadius/Math.max(i.getWidth(),i.getHeight()),this.canvas.scale(s,s),this.hitDetection&&this.hitContext.scale(s,s),e=i.getCenterLonLat().lon,i=i.getCenterLonLat().lat,this.canvas.translate(-e,-i),this.hitDetection&&this.hitContext.translate(-e,-i),a=t.strokeWidth,t.strokeWidth=a/s,!1!==t.fill){for(this.setCanvasStyle("fill",t),this.canvas.beginPath(),e=0;e<o.length;e+=2)i=o[e],r=o[e+1],0==e&&this.canvas.moveTo(i,r),this.canvas.lineTo(i,r);if(this.canvas.closePath(),this.canvas.fill(),this.hitDetection){for(this.setHitContextStyle("fill",n,t),this.hitContext.beginPath(),e=0;e<o.length;e+=2)i=o[e],r=o[e+1],0==e&&this.canvas.moveTo(i,r),this.hitContext.lineTo(i,r);this.hitContext.closePath(),this.hitContext.fill()}}if(!1!==t.stroke){for(this.setCanvasStyle("stroke",t),this.canvas.beginPath(),e=0;e<o.length;e+=2)i=o[e],r=o[e+1],0==e&&this.canvas.moveTo(i,r),this.canvas.lineTo(i,r);if(this.canvas.closePath(),this.canvas.stroke(),this.hitDetection){for(this.setHitContextStyle("stroke",n,t,s),this.hitContext.beginPath(),e=0;e<o.length;e+=2)i=o[e],r=o[e+1],0==e&&this.hitContext.moveTo(i,r),this.hitContext.lineTo(i,r);this.hitContext.closePath(),this.hitContext.stroke()}}t.strokeWidth=a,this.canvas.restore(),this.hitDetection&&this.hitContext.restore(),this.setCanvasStyle("reset")}},setCanvasStyle:function(e,t){"fill"===e?(this.canvas.globalAlpha=t.fillOpacity,this.canvas.fillStyle=t.fillColor):"stroke"===e?(this.canvas.globalAlpha=t.strokeOpacity,this.canvas.strokeStyle=t.strokeColor,this.canvas.lineWidth=t.strokeWidth):(this.canvas.globalAlpha=0,this.canvas.lineWidth=1)},featureIdToHex:function(e){e=Number(e.split("_").pop())+1,16777216<=e&&(this.hitOverflow=e-16777215,e=e%16777216+1),e="000000"+e.toString(16);var t=e.length;return e="#"+e.substring(t-6,t)},setHitContextStyle:function(e,t,n,i){t=this.featureIdToHex(t),"fill"==e?(this.hitContext.globalAlpha=1,this.hitContext.fillStyle=t):"stroke"==e?(this.hitContext.globalAlpha=1,this.hitContext.strokeStyle=t,"undefined"==typeof i?this.hitContext.lineWidth=n.strokeWidth+2:isNaN(i)||(this.hitContext.lineWidth=n.strokeWidth+2/i)):(this.hitContext.globalAlpha=0,this.hitContext.lineWidth=1)},drawPoint:function(e,t,n){if(!1!==t.graphic)if(t.externalGraphic)this.drawExternalGraphic(e,t,n);else if(t.graphicName&&"circle"!=t.graphicName)this.drawNamedSymbol(e,t,n);else{var i=this.getLocalXY(e);if(e=i[0],i=i[1],!isNaN(e)&&!isNaN(i)){var r=2*Math.PI,s=t.pointRadius;!1!==t.fill&&(this.setCanvasStyle("fill",t),this.canvas.beginPath(),this.canvas.arc(e,i,s,0,r,!0),this.canvas.fill(),this.hitDetection&&(this.setHitContextStyle("fill",n,t),this.hitContext.beginPath(),this.hitContext.arc(e,i,s,0,r,!0),this.hitContext.fill())),!1!==t.stroke&&(this.setCanvasStyle("stroke",t),this.canvas.beginPath(),this.canvas.arc(e,i,s,0,r,!0),this.canvas.stroke(),this.hitDetection&&(this.setHitContextStyle("stroke",n,t),this.hitContext.beginPath(),this.hitContext.arc(e,i,s,0,r,!0),this.hitContext.stroke()),this.setCanvasStyle("reset"))}}},drawLineString:function(e,t,n){t=OpenLayers.Util.applyDefaults({fill:!1},t),this.drawLinearRing(e,t,n)},drawLinearRing:function(e,t,n){!1!==t.fill&&(this.setCanvasStyle("fill",t),this.renderPath(this.canvas,e,t,n,"fill"),this.hitDetection&&(this.setHitContextStyle("fill",n,t),this.renderPath(this.hitContext,e,t,n,"fill"))),!1!==t.stroke&&(this.setCanvasStyle("stroke",t),this.renderPath(this.canvas,e,t,n,"stroke"),this.hitDetection&&(this.setHitContextStyle("stroke",n,t),this.renderPath(this.hitContext,e,t,n,"stroke"))),this.setCanvasStyle("reset")},renderPath:function(e,t,n,i,r){t=t.components,n=t.length,e.beginPath(),i=this.getLocalXY(t[0]);var s=i[1];if(!isNaN(i[0])&&!isNaN(s)){for(e.moveTo(i[0],i[1]),i=1;i<n;++i)s=this.getLocalXY(t[i]),e.lineTo(s[0],s[1]);"fill"===r?e.fill():e.stroke()}},drawPolygon:function(e,t,n){e=e.components;var i=e.length;this.drawLinearRing(e[0],t,n);for(var r=1;r<i;++r)this.canvas.globalCompositeOperation="destination-out",this.hitDetection&&(this.hitContext.globalCompositeOperation="destination-out"),this.drawLinearRing(e[r],OpenLayers.Util.applyDefaults({stroke:!1,fillOpacity:1},t),n),this.canvas.globalCompositeOperation="source-over",this.hitDetection&&(this.hitContext.globalCompositeOperation="source-over"),this.drawLinearRing(e[r],OpenLayers.Util.applyDefaults({fill:!1},t),n)},drawText:function(e,t){var n=this.getLocalXY(e);this.setCanvasStyle("reset"),this.canvas.fillStyle=t.fontColor,this.canvas.globalAlpha=t.fontOpacity||1;var i=[t.fontStyle?t.fontStyle:"normal","normal",t.fontWeight?t.fontWeight:"normal",t.fontSize?t.fontSize:"1em",t.fontFamily?t.fontFamily:"sans-serif"].join(" "),r=t.label.split("\n"),s=r.length;if(this.canvas.fillText){this.canvas.font=i,this.canvas.textAlign=OpenLayers.Renderer.Canvas.LABEL_ALIGN[t.labelAlign[0]]||"center",this.canvas.textBaseline=OpenLayers.Renderer.Canvas.LABEL_ALIGN[t.labelAlign[1]]||"middle";var a=OpenLayers.Renderer.Canvas.LABEL_FACTOR[t.labelAlign[1]];for(null==a&&(a=-.5),i=this.canvas.measureText("Mg").height||this.canvas.measureText("xx").width,n[1]+=i*a*(s-1),a=0;a<s;a++)t.labelOutlineWidth&&(this.canvas.save(),this.canvas.globalAlpha=t.labelOutlineOpacity||t.fontOpacity||1,this.canvas.strokeStyle=t.labelOutlineColor,this.canvas.lineWidth=t.labelOutlineWidth,this.canvas.strokeText(r[a],n[0],n[1]+i*a+1),this.canvas.restore()),this.canvas.fillText(r[a],n[0],n[1]+i*a)}else if(this.canvas.mozDrawText){this.canvas.mozTextStyle=i;var o=OpenLayers.Renderer.Canvas.LABEL_FACTOR[t.labelAlign[0]];for(null==o&&(o=-.5),a=OpenLayers.Renderer.Canvas.LABEL_FACTOR[t.labelAlign[1]],null==a&&(a=-.5),i=this.canvas.mozMeasureText("xx"),n[1]+=i*(1+a*s),a=0;a<s;a++){var l=n[0]+o*this.canvas.mozMeasureText(r[a]),h=n[1]+a*i;this.canvas.translate(l,h),this.canvas.mozDrawText(r[a]),this.canvas.translate(-l,-h)}}this.setCanvasStyle("reset")},getLocalXY:function(e){var t=this.getResolution(),n=this.extent;return[(e.x-this.featureDx)/t+-n.left/t,n.top/t-e.y/t]},clear:function(){this.clearCanvas(),this.features={}},clearCanvas:function(){var e=this.root.height,t=this.root.width;this.canvas.clearRect(0,0,t,e),this._clearRectId=OpenLayers.Util.createUniqueID(),this.hitDetection&&this.hitContext.clearRect(0,0,t,e)},getFeatureIdFromEvent:function(e){var t;if(this.hitDetection&&"none"!==this.root.style.display&&!this.map.dragging&&(e=e.xy,e=this.hitContext.getImageData(0|e.x,0|e.y,1,1).data,255===e[3]&&(e=e[2]+256*(e[1]+256*e[0])))){e="OpenLayers_Feature_Vector_"+(e-1+this.hitOverflow);try{t=this.features[e][0]}catch(e){}}return t},eraseFeatures:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=0;t<e.length;++t)delete this.features[e[t].id];this.redraw()},redraw:function(){if(!this.locked){this.clearCanvas();var e,t,n,i,r=[],s=this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent();for(i in this.features)this.features.hasOwnProperty(i)&&(e=this.features[i][0],t=e.geometry,this.calculateFeatureDx(t.getBounds(),s),n=this.features[i][1],this.drawGeometry(t,n,e.id),n.label&&r.push([e,n]));for(t=0,n=r.length;t<n;++t)e=r[t],this.drawText(e[0].geometry.getCentroid(),e[1])}},CLASS_NAME:"OpenLayers.Renderer.Canvas"}),OpenLayers.Renderer.Canvas.LABEL_ALIGN={l:"left",r:"right",t:"top",b:"bottom"},OpenLayers.Renderer.Canvas.LABEL_FACTOR={l:0,r:-1,t:0,b:-1},OpenLayers.Renderer.Canvas.drawImageScaleFactor=null,OpenLayers.ElementsIndexer=OpenLayers.Class({maxZIndex:null,order:null,indices:null,compare:null,initialize:function(e){this.compare=e?OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_Y_ORDER:OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_DRAWING_ORDER,this.clear()},insert:function(e){this.exists(e)&&this.remove(e);var t=e.id;this.determineZIndex(e);for(var n,i=-1,r=this.order.length;1<r-i;)n=parseInt((i+r)/2),0<this.compare(this,e,OpenLayers.Util.getElement(this.order[n]))?i=n:r=n;return this.order.splice(r,0,t),this.indices[t]=this.getZIndex(e),this.getNextElement(r)},remove:function(e){e=e.id;var t=OpenLayers.Util.indexOf(this.order,e);0<=t&&(this.order.splice(t,1),delete this.indices[e],this.maxZIndex=0<this.order.length?this.indices[this.order[this.order.length-1]]:0)},clear:function(){this.order=[],this.indices={},this.maxZIndex=0},exists:function(e){return null!=this.indices[e.id]},getZIndex:function(e){return e._style.graphicZIndex},determineZIndex:function(e){var t=e._style.graphicZIndex;null==t?(t=this.maxZIndex,e._style.graphicZIndex=t):t>this.maxZIndex&&(this.maxZIndex=t)},getNextElement:function(e){e+=1;for(var t=void 0;e<this.order.length&&void 0==t;e++)t=OpenLayers.Util.getElement(this.order[e]);return t||null},CLASS_NAME:"OpenLayers.ElementsIndexer"}),OpenLayers.ElementsIndexer.IndexingMethods={Z_ORDER:function(e,t,n){t=e.getZIndex(t);var i=0;return n&&(e=e.getZIndex(n),i=t-e),i},Z_ORDER_DRAWING_ORDER:function(e,t,n){return e=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(e,t,n),n&&0==e&&(e=1),e},Z_ORDER_Y_ORDER:function(e,t,n){return e=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(e,t,n),n&&0===e&&(t=n._boundsBottom-t._boundsBottom,e=0===t?1:t),e}},OpenLayers.Renderer.Elements=OpenLayers.Class(OpenLayers.Renderer,{rendererRoot:null,root:null,vectorRoot:null,textRoot:null,xmlns:null,xOffset:0,indexer:null,BACKGROUND_ID_SUFFIX:"_background",LABEL_ID_SUFFIX:"_label",LABEL_OUTLINE_SUFFIX:"_outline",initialize:function(e,t){OpenLayers.Renderer.prototype.initialize.apply(this,arguments),this.rendererRoot=this.createRenderRoot(),this.root=this.createRoot("_root"),this.vectorRoot=this.createRoot("_vroot"),this.textRoot=this.createRoot("_troot"),this.root.appendChild(this.vectorRoot),
this.root.appendChild(this.textRoot),this.rendererRoot.appendChild(this.root),this.container.appendChild(this.rendererRoot),t&&(t.zIndexing||t.yOrdering)&&(this.indexer=new OpenLayers.ElementsIndexer(t.yOrdering))},destroy:function(){this.clear(),this.xmlns=this.root=this.rendererRoot=null,OpenLayers.Renderer.prototype.destroy.apply(this,arguments)},clear:function(){var e,t=this.vectorRoot;if(t)for(;e=t.firstChild;)t.removeChild(e);if(t=this.textRoot)for(;e=t.firstChild;)t.removeChild(e);this.indexer&&this.indexer.clear()},setExtent:function(e,t){var n=OpenLayers.Renderer.prototype.setExtent.apply(this,arguments),i=this.getResolution();if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var r,s=e.getWidth()/this.map.getExtent().getWidth();e=e.scale(1/s),s=this.map.getMaxExtent(),s.right>e.left&&s.right<e.right?r=!0:s.left>e.left&&s.left<e.right&&(r=!1),(r!==this.rightOfDateLine||t)&&(n=!1,this.xOffset=!0===r?s.getWidth()/i:0),this.rightOfDateLine=r}return n},getNodeType:function(e,t){},drawGeometry:function(e,t,n){var i=e.CLASS_NAME,r=!0;if("OpenLayers.Geometry.Collection"==i||"OpenLayers.Geometry.MultiPoint"==i||"OpenLayers.Geometry.MultiLineString"==i||"OpenLayers.Geometry.MultiPolygon"==i){for(var i=0,s=e.components.length;i<s;i++)r=this.drawGeometry(e.components[i],t,n)&&r;return r}return i=r=!1,"none"!=t.display&&(t.backgroundGraphic?this.redrawBackgroundNode(e.id,e,t,n):i=!0,r=this.redrawNode(e.id,e,t,n)),0==r&&(t=document.getElementById(e.id))&&(t._style.backgroundGraphic&&(i=!0),t.parentNode.removeChild(t)),i&&(t=document.getElementById(e.id+this.BACKGROUND_ID_SUFFIX))&&t.parentNode.removeChild(t),r},redrawNode:function(e,t,n,i){return n=this.applyDefaultSymbolizer(n),e=this.nodeFactory(e,this.getNodeType(t,n)),e._featureId=i,e._boundsBottom=t.getBounds().bottom,e._geometryClass=t.CLASS_NAME,e._style=n,t=this.drawGeometryNode(e,t,n),!1!==t&&(e=t.node,this.indexer?(n=this.indexer.insert(e))?this.vectorRoot.insertBefore(e,n):this.vectorRoot.appendChild(e):e.parentNode!==this.vectorRoot&&this.vectorRoot.appendChild(e),this.postDraw(e),t.complete)},redrawBackgroundNode:function(e,t,n,i){return n=OpenLayers.Util.extend({},n),n.externalGraphic=n.backgroundGraphic,n.graphicXOffset=n.backgroundXOffset,n.graphicYOffset=n.backgroundYOffset,n.graphicZIndex=n.backgroundGraphicZIndex,n.graphicWidth=n.backgroundWidth||n.graphicWidth,n.graphicHeight=n.backgroundHeight||n.graphicHeight,n.backgroundGraphic=null,n.backgroundXOffset=null,n.backgroundYOffset=null,n.backgroundGraphicZIndex=null,this.redrawNode(e+this.BACKGROUND_ID_SUFFIX,t,n,null)},drawGeometryNode:function(e,t,n){n=n||e._style;var i,r={isFilled:void 0===n.fill||n.fill,isStroked:void 0===n.stroke?!!n.strokeWidth:n.stroke};switch(t.CLASS_NAME){case"OpenLayers.Geometry.Point":!1===n.graphic&&(r.isFilled=!1,r.isStroked=!1),i=this.drawPoint(e,t);break;case"OpenLayers.Geometry.LineString":r.isFilled=!1,i=this.drawLineString(e,t);break;case"OpenLayers.Geometry.LinearRing":i=this.drawLinearRing(e,t);break;case"OpenLayers.Geometry.Polygon":i=this.drawPolygon(e,t);break;case"OpenLayers.Geometry.Rectangle":i=this.drawRectangle(e,t)}return e._options=r,0!=i&&{node:this.setStyle(e,n,r,t),complete:i}},postDraw:function(e){},drawPoint:function(e,t){},drawLineString:function(e,t){},drawLinearRing:function(e,t){},drawPolygon:function(e,t){},drawRectangle:function(e,t){},drawCircle:function(e,t){},removeText:function(e){var t=document.getElementById(e+this.LABEL_ID_SUFFIX);t&&this.textRoot.removeChild(t),(e=document.getElementById(e+this.LABEL_OUTLINE_SUFFIX))&&this.textRoot.removeChild(e)},getFeatureIdFromEvent:function(e){var t=e.target,n=t&&t.correspondingUseElement;return(n?n:t||e.srcElement)._featureId},eraseGeometry:function(e,t){if("OpenLayers.Geometry.MultiPoint"==e.CLASS_NAME||"OpenLayers.Geometry.MultiLineString"==e.CLASS_NAME||"OpenLayers.Geometry.MultiPolygon"==e.CLASS_NAME||"OpenLayers.Geometry.Collection"==e.CLASS_NAME)for(var n=0,i=e.components.length;n<i;n++)this.eraseGeometry(e.components[n],t);else(n=OpenLayers.Util.getElement(e.id))&&n.parentNode&&(n.geometry&&(n.geometry.destroy(),n.geometry=null),n.parentNode.removeChild(n),this.indexer&&this.indexer.remove(n),n._style.backgroundGraphic&&(n=OpenLayers.Util.getElement(e.id+this.BACKGROUND_ID_SUFFIX))&&n.parentNode&&n.parentNode.removeChild(n))},nodeFactory:function(e,t){var n=OpenLayers.Util.getElement(e);return n?this.nodeTypeCompare(n,t)||(n.parentNode.removeChild(n),n=this.nodeFactory(e,t)):n=this.createNode(t,e),n},nodeTypeCompare:function(e,t){},createNode:function(e,t){},moveRoot:function(e){var t=this.root;e.root.parentNode==this.rendererRoot&&(t=e.root),t.parentNode.removeChild(t),e.rendererRoot.appendChild(t)},getRenderLayerId:function(){return this.root.parentNode.parentNode.id},isComplexSymbol:function(e){return"circle"!=e&&!!e},CLASS_NAME:"OpenLayers.Renderer.Elements"}),OpenLayers.Renderer.SVG=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",MAX_PIXEL:15e3,translationParameters:null,symbolMetrics:null,initialize:function(e){this.supported()&&(OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments),this.translationParameters={x:0,y:0},this.symbolMetrics={})},supported:function(){return document.implementation&&(document.implementation.hasFeature("org.w3c.svg","1.0")||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#SVG","1.1")||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"))},inValidRange:function(e,t,n){return e+=n?0:this.translationParameters.x,t+=n?0:this.translationParameters.y,e>=-this.MAX_PIXEL&&e<=this.MAX_PIXEL&&t>=-this.MAX_PIXEL&&t<=this.MAX_PIXEL},setExtent:function(e,t){var n=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments),i=this.getResolution(),r=-e.left/i,i=e.top/i;return t?(this.left=r,this.top=i,this.rendererRoot.setAttributeNS(null,"viewBox","0 0 "+this.size.w+" "+this.size.h),this.translate(this.xOffset,0),!0):((r=this.translate(r-this.left+this.xOffset,i-this.top))||this.setExtent(e,!0),n&&r)},translate:function(e,t){if(this.inValidRange(e,t,!0)){var n="";return(e||t)&&(n="translate("+e+","+t+")"),this.root.setAttributeNS(null,"transform",n),this.translationParameters={x:e,y:t},!0}return!1},setSize:function(e){OpenLayers.Renderer.prototype.setSize.apply(this,arguments),this.rendererRoot.setAttributeNS(null,"width",this.size.w),this.rendererRoot.setAttributeNS(null,"height",this.size.h)},getNodeType:function(e,t){var n=null;switch(e.CLASS_NAME){case"OpenLayers.Geometry.Point":n=t.externalGraphic?"image":this.isComplexSymbol(t.graphicName)?"svg":"circle";break;case"OpenLayers.Geometry.Rectangle":n="rect";break;case"OpenLayers.Geometry.LineString":n="polyline";break;case"OpenLayers.Geometry.LinearRing":n="polygon";break;case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":n="path"}return n},setStyle:function(e,t,n){t=t||e._style,n=n||e._options;var i=t.title||t.graphicTitle;if(i){e.setAttributeNS(null,"title",i);var r=e.getElementsByTagName("title");0<r.length?r[0].firstChild.textContent=i:(r=this.nodeFactory(null,"title"),r.textContent=i,e.appendChild(r))}var s,r=parseFloat(e.getAttributeNS(null,"r")),i=1;if("OpenLayers.Geometry.Point"==e._geometryClass&&r){if(e.style.visibility="",!1===t.graphic)e.style.visibility="hidden";else if(t.externalGraphic){s=this.getPosition(e),t.graphicWidth&&t.graphicHeight&&e.setAttributeNS(null,"preserveAspectRatio","none");var r=t.graphicWidth||t.graphicHeight,a=t.graphicHeight||t.graphicWidth,r=r?r:2*t.pointRadius,a=a?a:2*t.pointRadius,o=void 0!=t.graphicYOffset?t.graphicYOffset:-(.5*a),l=t.graphicOpacity||t.fillOpacity;e.setAttributeNS(null,"x",(s.x+(void 0!=t.graphicXOffset?t.graphicXOffset:-(.5*r))).toFixed()),e.setAttributeNS(null,"y",(s.y+o).toFixed()),e.setAttributeNS(null,"width",r),e.setAttributeNS(null,"height",a),e.setAttributeNS(this.xlinkns,"xlink:href",t.externalGraphic),e.setAttributeNS(null,"style","opacity: "+l),e.onclick=OpenLayers.Event.preventDefault}else if(this.isComplexSymbol(t.graphicName)){var r=3*t.pointRadius,a=2*r,h=this.importSymbol(t.graphicName);s=this.getPosition(e),i=3*this.symbolMetrics[h.id][0]/a,o=e.parentNode,l=e.nextSibling,o&&o.removeChild(e),e.firstChild&&e.removeChild(e.firstChild),e.appendChild(h.firstChild.cloneNode(!0)),e.setAttributeNS(null,"viewBox",h.getAttributeNS(null,"viewBox")),e.setAttributeNS(null,"width",a),e.setAttributeNS(null,"height",a),e.setAttributeNS(null,"x",s.x-r),e.setAttributeNS(null,"y",s.y-r),l?o.insertBefore(e,l):o&&o.appendChild(e)}else e.setAttributeNS(null,"r",t.pointRadius);r=t.rotation,void 0===r&&void 0===e._rotation||!s||(e._rotation=r,r|=0,"svg"!==e.nodeName?e.setAttributeNS(null,"transform","rotate("+r+" "+s.x+" "+s.y+")"):(s=this.symbolMetrics[h.id],e.firstChild.setAttributeNS(null,"transform","rotate("+r+" "+s[1]+" "+s[2]+")")))}return n.isFilled?(e.setAttributeNS(null,"fill",t.fillColor),e.setAttributeNS(null,"fill-opacity",t.fillOpacity)):e.setAttributeNS(null,"fill","none"),n.isStroked?(e.setAttributeNS(null,"stroke",t.strokeColor),e.setAttributeNS(null,"stroke-opacity",t.strokeOpacity),e.setAttributeNS(null,"stroke-width",t.strokeWidth*i),e.setAttributeNS(null,"stroke-linecap",t.strokeLinecap||"round"),e.setAttributeNS(null,"stroke-linejoin","round"),t.strokeDashstyle&&e.setAttributeNS(null,"stroke-dasharray",this.dashStyle(t,i))):e.setAttributeNS(null,"stroke","none"),t.pointerEvents&&e.setAttributeNS(null,"pointer-events",t.pointerEvents),null!=t.cursor&&e.setAttributeNS(null,"cursor",t.cursor),e},dashStyle:function(e,t){var n=e.strokeWidth*t,i=e.strokeDashstyle;switch(i){case"solid":return"none";case"dot":return[1,4*n].join();case"dash":return[4*n,4*n].join();case"dashdot":return[4*n,4*n,1,4*n].join();case"longdash":return[8*n,4*n].join();case"longdashdot":return[8*n,4*n,1,4*n].join();default:return OpenLayers.String.trim(i).replace(/\s+/g,",")}},createNode:function(e,t){var n=document.createElementNS(this.xmlns,e);return t&&n.setAttributeNS(null,"id",t),n.setAttribute("class"," "),n},nodeTypeCompare:function(e,t){return t==e.nodeName},createRenderRoot:function(){var e=this.nodeFactory(this.container.id+"_svgRoot","svg");return e.style.display="block",e},createRoot:function(e){return this.nodeFactory(this.container.id+e,"g")},createDefs:function(){var e=this.nodeFactory(this.container.id+"_defs","defs");return this.rendererRoot.appendChild(e),e},drawPoint:function(e,t){return this.drawCircle(e,t,1)},drawCircle:function(e,t,n){var i=this.getResolution(),r=(t.x-this.featureDx)/i+this.left;return t=this.top-t.y/i,!!this.inValidRange(r,t)&&(e.setAttributeNS(null,"cx",r),e.setAttributeNS(null,"cy",t),e.setAttributeNS(null,"r",n),e)},drawLineString:function(e,t){var n=this.getComponentsString(t.components);return!!n.path&&(e.setAttributeNS(null,"points",n.path),n.complete?e:null)},drawLinearRing:function(e,t){var n=this.getComponentsString(t.components);return!!n.path&&(e.setAttributeNS(null,"points",n.path),n.complete?e:null)},drawPolygon:function(e,t){for(var n,i,r="",s=!0,a=!0,o=0,l=t.components.length;o<l;o++)r+=" M",n=this.getComponentsString(t.components[o].components," "),(i=n.path)?(r+=" "+i,a=n.complete&&a):s=!1;return!!s&&(e.setAttributeNS(null,"d",r+" z"),e.setAttributeNS(null,"fill-rule","evenodd"),a?e:null)},drawRectangle:function(e,t){var n=this.getResolution(),i=(t.x-this.featureDx)/n+this.left,r=this.top-t.y/n;return!!this.inValidRange(i,r)&&(e.setAttributeNS(null,"x",i),e.setAttributeNS(null,"y",r),e.setAttributeNS(null,"width",t.width/n),e.setAttributeNS(null,"height",t.height/n),e)},drawText:function(e,t,n){var i=!!t.labelOutlineWidth;if(i){var r=OpenLayers.Util.extend({},t);r.fontColor=r.labelOutlineColor,r.fontStrokeColor=r.labelOutlineColor,r.fontStrokeWidth=t.labelOutlineWidth,t.labelOutlineOpacity&&(r.fontOpacity=t.labelOutlineOpacity),delete r.labelOutlineWidth,this.drawText(e,r,n)}var s=this.getResolution(),r=(n.x-this.featureDx)/s+this.left,a=n.y/s-this.top,i=i?this.LABEL_OUTLINE_SUFFIX:this.LABEL_ID_SUFFIX,s=this.nodeFactory(e+i,"text");s.setAttributeNS(null,"x",r),s.setAttributeNS(null,"y",-a),t.fontColor&&s.setAttributeNS(null,"fill",t.fontColor),t.fontStrokeColor&&s.setAttributeNS(null,"stroke",t.fontStrokeColor),t.fontStrokeWidth&&s.setAttributeNS(null,"stroke-width",t.fontStrokeWidth),t.fontOpacity&&s.setAttributeNS(null,"opacity",t.fontOpacity),t.fontFamily&&s.setAttributeNS(null,"font-family",t.fontFamily),t.fontSize&&s.setAttributeNS(null,"font-size",t.fontSize),t.fontWeight&&s.setAttributeNS(null,"font-weight",t.fontWeight),t.fontStyle&&s.setAttributeNS(null,"font-style",t.fontStyle),!0===t.labelSelect?(s.setAttributeNS(null,"pointer-events","visible"),s._featureId=e):s.setAttributeNS(null,"pointer-events","none"),a=t.labelAlign||OpenLayers.Renderer.defaultSymbolizer.labelAlign,s.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG.LABEL_ALIGN[a[0]]||"middle"),!0===OpenLayers.IS_GECKO&&s.setAttributeNS(null,"dominant-baseline",OpenLayers.Renderer.SVG.LABEL_ALIGN[a[1]]||"central");for(var o=t.label.split("\n"),l=o.length;s.childNodes.length>l;)s.removeChild(s.lastChild);for(var h=0;h<l;h++){var u=this.nodeFactory(e+i+"_tspan_"+h,"tspan");if(!0===t.labelSelect&&(u._featureId=e,u._geometry=n,u._geometryClass=n.CLASS_NAME),!1===OpenLayers.IS_GECKO&&u.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG.LABEL_VSHIFT[a[1]]||"-35%"),u.setAttribute("x",r),0==h){var p=OpenLayers.Renderer.SVG.LABEL_VFACTOR[a[1]];null==p&&(p=-.5),u.setAttribute("dy",p*(l-1)+"em")}else u.setAttribute("dy","1em");u.textContent=""===o[h]?" ":o[h],u.parentNode||s.appendChild(u)}s.parentNode||this.textRoot.appendChild(s)},getComponentsString:function(e,t){for(var n,i=[],r=!0,s=e.length,a=[],o=0;o<s;o++)n=e[o],i.push(n),(n=this.getShortString(n))?a.push(n):(0<o&&this.getShortString(e[o-1])&&a.push(this.clipLine(e[o],e[o-1])),o<s-1&&this.getShortString(e[o+1])&&a.push(this.clipLine(e[o],e[o+1])),r=!1);return{path:a.join(t||","),complete:r}},clipLine:function(e,t){if(t.equals(e))return"";var n,i=this.getResolution(),r=this.MAX_PIXEL-this.translationParameters.x,s=this.MAX_PIXEL-this.translationParameters.y,a=(t.x-this.featureDx)/i+this.left,o=this.top-t.y/i,l=(e.x-this.featureDx)/i+this.left,i=this.top-e.y/i;return(l<-r||l>r)&&(n=(i-o)/(l-a),l=0>l?-r:r,i=o+(l-a)*n),(i<-s||i>s)&&(n=(l-a)/(i-o),i=0>i?-s:s,l=a+(i-o)*n),l+","+i},getShortString:function(e){var t=this.getResolution(),n=(e.x-this.featureDx)/t+this.left;return e=this.top-e.y/t,!!this.inValidRange(n,e)&&n+","+e},getPosition:function(e){return{x:parseFloat(e.getAttributeNS(null,"cx")),y:parseFloat(e.getAttributeNS(null,"cy"))}},importSymbol:function(e){this.defs||(this.defs=this.createDefs());var t=this.container.id+"-"+e,n=document.getElementById(t);if(null!=n)return n;var i=OpenLayers.Renderer.symbol[e];if(!i)throw Error(e+" is not a valid symbol name");e=this.nodeFactory(t,"symbol");var r=this.nodeFactory(null,"polygon");e.appendChild(r);for(var s,a,n=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),o=[],l=0;l<i.length;l+=2)s=i[l],a=i[l+1],n.left=Math.min(n.left,s),n.bottom=Math.min(n.bottom,a),n.right=Math.max(n.right,s),n.top=Math.max(n.top,a),o.push(s,",",a);return r.setAttributeNS(null,"points",o.join(" ")),i=n.getWidth(),r=n.getHeight(),e.setAttributeNS(null,"viewBox",[n.left-i,n.bottom-r,3*i,3*r].join(" ")),this.symbolMetrics[t]=[Math.max(i,r),n.getCenterLonLat().lon,n.getCenterLonLat().lat],this.defs.appendChild(e),e},getFeatureIdFromEvent:function(e){var t=OpenLayers.Renderer.Elements.prototype.getFeatureIdFromEvent.apply(this,arguments);return t||(t=e.target,t=t.parentNode&&t!=this.rendererRoot?t.parentNode._featureId:void 0),t},CLASS_NAME:"OpenLayers.Renderer.SVG"}),OpenLayers.Renderer.SVG.LABEL_ALIGN={l:"start",r:"end",b:"bottom",t:"hanging"},OpenLayers.Renderer.SVG.LABEL_VSHIFT={t:"-70%",b:"0"},OpenLayers.Renderer.SVG.LABEL_VFACTOR={t:0,b:-1},OpenLayers.Renderer.SVG.preventDefault=function(e){OpenLayers.Event.preventDefault(e)},OpenLayers.Popup=OpenLayers.Class({events:null,id:"",lonlat:null,div:null,contentSize:null,size:null,contentHTML:null,backgroundColor:"",opacity:"",border:"",contentDiv:null,groupDiv:null,closeDiv:null,autoSize:!1,minSize:null,maxSize:null,displayClass:"olPopup",contentDisplayClass:"olPopupContent",padding:0,disableFirefoxOverflowHack:!1,fixPadding:function(){"number"==typeof this.padding&&(this.padding=new OpenLayers.Bounds(this.padding,this.padding,this.padding,this.padding))},panMapIfOutOfView:!1,keepInMap:!1,closeOnMove:!1,map:null,initialize:function(e,t,n,i,r,s){null==e&&(e=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")),this.id=e,this.lonlat=t,this.contentSize=null!=n?n:new OpenLayers.Size(OpenLayers.Popup.WIDTH,OpenLayers.Popup.HEIGHT),null!=i&&(this.contentHTML=i),this.backgroundColor=OpenLayers.Popup.COLOR,this.opacity=OpenLayers.Popup.OPACITY,this.border=OpenLayers.Popup.BORDER,this.div=OpenLayers.Util.createDiv(this.id,null,null,null,null,null,"hidden"),this.div.className=this.displayClass,this.groupDiv=OpenLayers.Util.createDiv(this.id+"_GroupDiv",null,null,null,"relative",null,"hidden"),e=this.div.id+"_contentDiv",this.contentDiv=OpenLayers.Util.createDiv(e,null,this.contentSize.clone(),null,"relative"),this.contentDiv.className=this.contentDisplayClass,this.groupDiv.appendChild(this.contentDiv),this.div.appendChild(this.groupDiv),r&&this.addCloseBox(s),this.registerEvents()},destroy:function(){this.border=this.opacity=this.backgroundColor=this.contentHTML=this.size=this.lonlat=this.id=null,this.closeOnMove&&this.map&&this.map.events.unregister("movestart",this,this.hide),this.events.destroy(),this.events=null,this.closeDiv&&(OpenLayers.Event.stopObservingElement(this.closeDiv),this.groupDiv.removeChild(this.closeDiv)),this.closeDiv=null,this.div.removeChild(this.groupDiv),this.groupDiv=null,null!=this.map&&this.map.removePopup(this),this.panMapIfOutOfView=this.padding=this.maxSize=this.minSize=this.autoSize=this.div=this.map=null},draw:function(e){return null==e&&null!=this.lonlat&&null!=this.map&&(e=this.map.getLayerPxFromLonLat(this.lonlat)),this.closeOnMove&&this.map.events.register("movestart",this,this.hide),this.disableFirefoxOverflowHack||"firefox"!=OpenLayers.BROWSER_NAME||(this.map.events.register("movestart",this,function(){var e=document.defaultView.getComputedStyle(this.contentDiv,null).getPropertyValue("overflow");"hidden"!=e&&(this.contentDiv._oldOverflow=e,this.contentDiv.style.overflow="hidden")}),this.map.events.register("moveend",this,function(){var e=this.contentDiv._oldOverflow;e&&(this.contentDiv.style.overflow=e,this.contentDiv._oldOverflow=null)})),this.moveTo(e),this.autoSize||this.size||this.setSize(this.contentSize),this.setBackgroundColor(),this.setOpacity(),this.setBorder(),this.setContentHTML(),this.panMapIfOutOfView&&this.panIntoView(),this.div},updatePosition:function(){if(this.lonlat&&this.map){var e=this.map.getLayerPxFromLonLat(this.lonlat);e&&this.moveTo(e)}},moveTo:function(e){null!=e&&null!=this.div&&(this.div.style.left=e.x+"px",this.div.style.top=e.y+"px")},visible:function(){return OpenLayers.Element.visible(this.div)},toggle:function(){this.visible()?this.hide():this.show()},show:function(){this.div.style.display="",this.panMapIfOutOfView&&this.panIntoView()},hide:function(){this.div.style.display="none"},setSize:function(e){this.size=e.clone();var t=this.getContentDivPadding(),n=t.left+t.right,i=t.top+t.bottom;if(this.fixPadding(),n+=this.padding.left+this.padding.right,i+=this.padding.top+this.padding.bottom,this.closeDiv)var r=parseInt(this.closeDiv.style.width),n=n+(r+t.right);this.size.w+=n,this.size.h+=i,"msie"==OpenLayers.BROWSER_NAME&&(this.contentSize.w+=t.left+t.right,this.contentSize.h+=t.bottom+t.top),null!=this.div&&(this.div.style.width=this.size.w+"px",this.div.style.height=this.size.h+"px"),null!=this.contentDiv&&(this.contentDiv.style.width=e.w+"px",this.contentDiv.style.height=e.h+"px")},updateSize:function(){var e="<div class='"+this.contentDisplayClass+"'>"+this.contentDiv.innerHTML+"</div>",t=this.map?this.map.div:document.body,n=OpenLayers.Util.getRenderedDimensions(e,null,{displayClass:this.displayClass,containerElement:t}),i=this.getSafeContentSize(n);i.equals(n)?i=n:(n={w:i.w<n.w?i.w:null,h:i.h<n.h?i.h:null},n.w&&n.h||(e=OpenLayers.Util.getRenderedDimensions(e,n,{displayClass:this.contentDisplayClass,containerElement:t}),"hidden"!=OpenLayers.Element.getStyle(this.contentDiv,"overflow")&&e.equals(i)&&(i=OpenLayers.Util.getScrollbarWidth(),n.w?e.h+=i:e.w+=i),i=this.getSafeContentSize(e))),this.setSize(i)},setBackgroundColor:function(e){void 0!=e&&(this.backgroundColor=e),null!=this.div&&(this.div.style.backgroundColor=this.backgroundColor)},setOpacity:function(e){void 0!=e&&(this.opacity=e),null!=this.div&&(this.div.style.opacity=this.opacity,this.div.style.filter="alpha(opacity="+100*this.opacity+")")},setBorder:function(e){void 0!=e&&(this.border=e),null!=this.div&&(this.div.style.border=this.border)},setContentHTML:function(e){null!=e&&(this.contentHTML=e),null!=this.contentDiv&&null!=this.contentHTML&&this.contentHTML!=this.contentDiv.innerHTML&&(this.contentDiv.innerHTML=this.contentHTML,this.autoSize&&(this.registerImageListeners(),this.updateSize()))},registerImageListeners:function(){for(var e=function(){null!==this.popup.id&&(this.popup.updateSize(),this.popup.visible()&&this.popup.panMapIfOutOfView&&this.popup.panIntoView(),OpenLayers.Event.stopObserving(this.img,"load",this.img._onImgLoad))},t=this.contentDiv.getElementsByTagName("img"),n=0,i=t.length;n<i;n++){var r=t[n];0!=r.width&&0!=r.height||(r._onImgLoad=OpenLayers.Function.bind(e,{popup:this,img:r}),OpenLayers.Event.observe(r,"load",r._onImgLoad))}},getSafeContentSize:function(e){e=e.clone();var t=this.getContentDivPadding(),n=t.left+t.right,i=t.top+t.bottom;if(this.fixPadding(),n+=this.padding.left+this.padding.right,i+=this.padding.top+this.padding.bottom,this.closeDiv)var r=parseInt(this.closeDiv.style.width),n=n+(r+t.right);if(this.minSize&&(e.w=Math.max(e.w,this.minSize.w-n),e.h=Math.max(e.h,this.minSize.h-i)),this.maxSize&&(e.w=Math.min(e.w,this.maxSize.w-n),e.h=Math.min(e.h,this.maxSize.h-i)),this.map&&this.map.size){if(r=t=0,this.keepInMap&&!this.panMapIfOutOfView)switch(r=this.map.getPixelFromLonLat(this.lonlat),this.relativePosition){case"tr":t=r.x,r=this.map.size.h-r.y;break;case"tl":t=this.map.size.w-r.x,r=this.map.size.h-r.y;break;case"bl":t=this.map.size.w-r.x,r=r.y;break;case"br":t=r.x,r=r.y;break;default:t=r.x,r=this.map.size.h-r.y}i=this.map.size.h-this.map.paddingForPopups.top-this.map.paddingForPopups.bottom-i-r,e.w=Math.min(e.w,this.map.size.w-this.map.paddingForPopups.left-this.map.paddingForPopups.right-n-t),e.h=Math.min(e.h,i)}return e},getContentDivPadding:function(){var e=this._contentDivPadding;return e||(null==this.div.parentNode&&(this.div.style.display="none",document.body.appendChild(this.div)),this._contentDivPadding=e=new OpenLayers.Bounds(OpenLayers.Element.getStyle(this.contentDiv,"padding-left"),OpenLayers.Element.getStyle(this.contentDiv,"padding-bottom"),OpenLayers.Element.getStyle(this.contentDiv,"padding-right"),OpenLayers.Element.getStyle(this.contentDiv,"padding-top")),this.div.parentNode==document.body&&(document.body.removeChild(this.div),this.div.style.display="")),e},addCloseBox:function(e){this.closeDiv=OpenLayers.Util.createDiv(this.id+"_close",null,{w:17,h:17}),this.closeDiv.className="olPopupCloseBox";var t=this.getContentDivPadding();this.closeDiv.style.right=t.right+"px",this.closeDiv.style.top=t.top+"px",this.groupDiv.appendChild(this.closeDiv),e=e||function(e){this.hide(),OpenLayers.Event.stop(e)},OpenLayers.Event.observe(this.closeDiv,"touchend",OpenLayers.Function.bindAsEventListener(e,this)),OpenLayers.Event.observe(this.closeDiv,"click",OpenLayers.Function.bindAsEventListener(e,this))},panIntoView:function(){var e=this.map.getSize(),t=this.map.getViewPortPxFromLayerPx(new OpenLayers.Pixel(parseInt(this.div.style.left),parseInt(this.div.style.top))),n=t.clone();t.x<this.map.paddingForPopups.left?n.x=this.map.paddingForPopups.left:t.x+this.size.w>e.w-this.map.paddingForPopups.right&&(n.x=e.w-this.map.paddingForPopups.right-this.size.w),t.y<this.map.paddingForPopups.top?n.y=this.map.paddingForPopups.top:t.y+this.size.h>e.h-this.map.paddingForPopups.bottom&&(n.y=e.h-this.map.paddingForPopups.bottom-this.size.h),this.map.pan(t.x-n.x,t.y-n.y)},registerEvents:function(){this.events=new OpenLayers.Events(this,this.div,null,!0),this.events.on({mousedown:this.onmousedown,mousemove:this.onmousemove,mouseup:this.onmouseup,click:this.onclick,mouseout:this.onmouseout,dblclick:this.ondblclick,touchstart:function(e){OpenLayers.Event.stop(e,!0)},scope:this})},onmousedown:function(e){this.mousedown=!0,OpenLayers.Event.stop(e,!0)},onmousemove:function(e){this.mousedown&&OpenLayers.Event.stop(e,!0)},onmouseup:function(e){this.mousedown&&(this.mousedown=!1,OpenLayers.Event.stop(e,!0))},onclick:function(e){OpenLayers.Event.stop(e,!0)},onmouseout:function(e){this.mousedown=!1},ondblclick:function(e){OpenLayers.Event.stop(e,!0)},CLASS_NAME:"OpenLayers.Popup"}),OpenLayers.Popup.WIDTH=200,OpenLayers.Popup.HEIGHT=200,OpenLayers.Popup.COLOR="white",OpenLayers.Popup.OPACITY=1,OpenLayers.Popup.BORDER="0px",OpenLayers.Popup.Anchored=OpenLayers.Class(OpenLayers.Popup,{relativePosition:null,keepInMap:!0,anchor:null,initialize:function(e,t,n,i,r,s,a){OpenLayers.Popup.prototype.initialize.apply(this,[e,t,n,i,s,a]),this.anchor=null!=r?r:{size:new OpenLayers.Size(0,0),offset:new OpenLayers.Pixel(0,0)}},destroy:function(){this.relativePosition=this.anchor=null,OpenLayers.Popup.prototype.destroy.apply(this,arguments)},show:function(){this.updatePosition(),OpenLayers.Popup.prototype.show.apply(this,arguments)},moveTo:function(e){var t=this.relativePosition;this.relativePosition=this.calculateRelativePosition(e),OpenLayers.Popup.prototype.moveTo.call(this,this.calculateNewPx(e)),this.relativePosition!=t&&this.updateRelativePosition()},setSize:function(e){if(OpenLayers.Popup.prototype.setSize.apply(this,arguments),this.lonlat&&this.map){var t=this.map.getLayerPxFromLonLat(this.lonlat);this.moveTo(t)}},calculateRelativePosition:function(e){return e=this.map.getLonLatFromLayerPx(e),e=this.map.getExtent().determineQuadrant(e),OpenLayers.Bounds.oppositeQuadrant(e)},updateRelativePosition:function(){},calculateNewPx:function(e){e=e.offset(this.anchor.offset);var t=this.size||this.contentSize,n="t"==this.relativePosition.charAt(0);return e.y+=n?-t.h:this.anchor.size.h,n="l"==this.relativePosition.charAt(1),e.x+=n?-t.w:this.anchor.size.w,e},CLASS_NAME:"OpenLayers.Popup.Anchored"}),OpenLayers.Popup.Framed=OpenLayers.Class(OpenLayers.Popup.Anchored,{imageSrc:null,imageSize:null,isAlphaImage:!1,positionBlocks:null,blocks:null,fixedRelativePosition:!1,initialize:function(e,t,n,i,r,s,a){OpenLayers.Popup.Anchored.prototype.initialize.apply(this,arguments),this.fixedRelativePosition&&(this.updateRelativePosition(),this.calculateRelativePosition=function(e){return this.relativePosition}),this.contentDiv.style.position="absolute",this.contentDiv.style.zIndex=1,s&&(this.closeDiv.style.zIndex=1),this.groupDiv.style.position="absolute",this.groupDiv.style.top="0px",this.groupDiv.style.left="0px",this.groupDiv.style.height="100%",this.groupDiv.style.width="100%"},destroy:function(){this.isAlphaImage=this.imageSize=this.imageSrc=null,this.fixedRelativePosition=!1,this.positionBlocks=null;for(var e=0;e<this.blocks.length;e++){var t=this.blocks[e];t.image&&t.div.removeChild(t.image),t.image=null,t.div&&this.groupDiv.removeChild(t.div),t.div=null}this.blocks=null,OpenLayers.Popup.Anchored.prototype.destroy.apply(this,arguments)},setBackgroundColor:function(e){},setBorder:function(){},setOpacity:function(e){},setSize:function(e){OpenLayers.Popup.Anchored.prototype.setSize.apply(this,arguments),this.updateBlocks()},updateRelativePosition:function(){if(this.padding=this.positionBlocks[this.relativePosition].padding,this.closeDiv){var e=this.getContentDivPadding();this.closeDiv.style.right=e.right+this.padding.right+"px",this.closeDiv.style.top=e.top+this.padding.top+"px"}this.updateBlocks()},calculateNewPx:function(e){var t=OpenLayers.Popup.Anchored.prototype.calculateNewPx.apply(this,arguments);return t=t.offset(this.positionBlocks[this.relativePosition].offset)},createBlocks:function(){this.blocks=[];var e,t=null;for(e in this.positionBlocks){t=e;break}for(t=this.positionBlocks[t],e=0;e<t.blocks.length;e++){var n={};this.blocks.push(n),n.div=OpenLayers.Util.createDiv(this.id+"_FrameDecorationDiv_"+e,null,null,null,"absolute",null,"hidden",null),n.image=(this.isAlphaImage?OpenLayers.Util.createAlphaImageDiv:OpenLayers.Util.createImage)(this.id+"_FrameDecorationImg_"+e,null,this.imageSize,this.imageSrc,"absolute",null,null,null),n.div.appendChild(n.image),this.groupDiv.appendChild(n.div)}},updateBlocks:function(){if(this.blocks||this.createBlocks(),this.size&&this.relativePosition){for(var e=this.positionBlocks[this.relativePosition],t=0;t<e.blocks.length;t++){var n=e.blocks[t],i=this.blocks[t],r=n.anchor.left,s=n.anchor.bottom,a=n.anchor.right,o=n.anchor.top,l=isNaN(n.size.w)?this.size.w-(a+r):n.size.w,h=isNaN(n.size.h)?this.size.h-(s+o):n.size.h;i.div.style.width=(0>l?0:l)+"px",i.div.style.height=(0>h?0:h)+"px",i.div.style.left=null!=r?r+"px":"",i.div.style.bottom=null!=s?s+"px":"",i.div.style.right=null!=a?a+"px":"",i.div.style.top=null!=o?o+"px":"",i.image.style.left=n.position.x+"px",i.image.style.top=n.position.y+"px"}this.contentDiv.style.left=this.padding.left+"px",this.contentDiv.style.top=this.padding.top+"px"}},CLASS_NAME:"OpenLayers.Popup.Framed"}),OpenLayers.Popup.FramedCloud=OpenLayers.Class(OpenLayers.Popup.Framed,{contentDisplayClass:"olFramedCloudPopupContent",autoSize:!0,panMapIfOutOfView:!0,imageSize:new OpenLayers.Size(1276,736),isAlphaImage:!1,fixedRelativePosition:!1,positionBlocks:{tl:{offset:new OpenLayers.Pixel(44,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,18),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-632)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(0,-688)}]},tr:{offset:new OpenLayers.Pixel(-45,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,19),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-631)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(0,0,null,null),position:new OpenLayers.Pixel(-215,-687)}]},bl:{offset:new OpenLayers.Pixel(45,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(null,null,0,0),position:new OpenLayers.Pixel(-101,-674)
}]},br:{offset:new OpenLayers.Pixel(-44,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(0,null,null,0),position:new OpenLayers.Pixel(-311,-674)}]}},minSize:new OpenLayers.Size(105,10),maxSize:new OpenLayers.Size(1200,660),initialize:function(e,t,n,i,r,s,a){this.imageSrc=OpenLayers.Util.getImageLocation("cloud-popup-relative.png"),OpenLayers.Popup.Framed.prototype.initialize.apply(this,arguments),this.contentDiv.className=this.contentDisplayClass},CLASS_NAME:"OpenLayers.Popup.FramedCloud"}),OpenLayers.Protocol=OpenLayers.Class({format:null,options:null,autoDestroy:!0,defaultFilter:null,initialize:function(e){e=e||{},OpenLayers.Util.extend(this,e),this.options=e},mergeWithDefaultFilter:function(e){return e&&this.defaultFilter?new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.defaultFilter,e]}):e||this.defaultFilter||void 0},destroy:function(){this.format=this.options=null},read:function(e){e=e||{},e.filter=this.mergeWithDefaultFilter(e.filter)},create:function(){},update:function(){},delete:function(){},commit:function(){},abort:function(e){},createCallback:function(e,t,n){return OpenLayers.Function.bind(function(){e.apply(this,[t,n])},this)},CLASS_NAME:"OpenLayers.Protocol"}),OpenLayers.Protocol.Response=OpenLayers.Class({code:null,requestType:null,last:!0,features:null,data:null,reqFeatures:null,priv:null,error:null,initialize:function(e){OpenLayers.Util.extend(this,e)},success:function(){return 0<this.code},CLASS_NAME:"OpenLayers.Protocol.Response"}),OpenLayers.Protocol.Response.SUCCESS=1,OpenLayers.Protocol.Response.FAILURE=0,OpenLayers.ProxyHost="",OpenLayers.Request||(OpenLayers.Request={}),OpenLayers.Util.extend(OpenLayers.Request,{DEFAULT_CONFIG:{method:"GET",url:window.location.href,async:!0,user:void 0,password:void 0,params:null,proxy:OpenLayers.ProxyHost,headers:{},data:null,callback:function(){},success:null,failure:null,scope:null},URL_SPLIT_REGEX:/([^:]*:)\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/,events:new OpenLayers.Events(this),makeSameOrigin:function(e,t){var n=0!==e.indexOf("http"),i=!n&&e.match(this.URL_SPLIT_REGEX);if(i){var r=window.location,n=i[1]==r.protocol&&i[3]==r.hostname,i=i[4],r=r.port;(80!=i&&""!=i||"80"!=r&&""!=r)&&(n=n&&i==r)}return n||t&&(e="function"==typeof t?t(e):t+encodeURIComponent(e)),e},issue:function(e){var t=OpenLayers.Util.extend(this.DEFAULT_CONFIG,{proxy:OpenLayers.ProxyHost});e=e||{},e.headers=e.headers||{},e=OpenLayers.Util.applyDefaults(e,t),e.headers=OpenLayers.Util.applyDefaults(e.headers,t.headers);var n,t=!1;for(n in e.headers)e.headers.hasOwnProperty(n)&&"x-requested-with"===n.toLowerCase()&&(t=!0);!1===t&&(e.headers["X-Requested-With"]="XMLHttpRequest");var i=new OpenLayers.Request.XMLHttpRequest,r=OpenLayers.Util.urlAppend(e.url,OpenLayers.Util.getParameterString(e.params||{})),r=OpenLayers.Request.makeSameOrigin(r,e.proxy);i.open(e.method,r,e.async,e.user,e.password);for(var s in e.headers)i.setRequestHeader(s,e.headers[s]);var a=this.events,o=this;return i.onreadystatechange=function(){i.readyState==OpenLayers.Request.XMLHttpRequest.DONE&&!1!==a.triggerEvent("complete",{request:i,config:e,requestUrl:r})&&o.runCallbacks({request:i,config:e,requestUrl:r})},!1===e.async?i.send(e.data):window.setTimeout(function(){0!==i.readyState&&i.send(e.data)},0),i},runCallbacks:function(e){var t,n=e.request,i=e.config,r=i.scope?OpenLayers.Function.bind(i.callback,i.scope):i.callback;i.success&&(t=i.scope?OpenLayers.Function.bind(i.success,i.scope):i.success);var s;i.failure&&(s=i.scope?OpenLayers.Function.bind(i.failure,i.scope):i.failure),"file:"==OpenLayers.Util.createUrlObject(i.url).protocol&&n.responseText&&(n.status=200),r(n),(!n.status||200<=n.status&&300>n.status)&&(this.events.triggerEvent("success",e),t&&t(n)),n.status&&(200>n.status||300<=n.status)&&(this.events.triggerEvent("failure",e),s&&s(n))},GET:function(e){return e=OpenLayers.Util.extend(e,{method:"GET"}),OpenLayers.Request.issue(e)},POST:function(e){return e=OpenLayers.Util.extend(e,{method:"POST"}),e.headers=e.headers?e.headers:{},"CONTENT-TYPE"in OpenLayers.Util.upperCaseObject(e.headers)||(e.headers["Content-Type"]="application/xml"),OpenLayers.Request.issue(e)},PUT:function(e){return e=OpenLayers.Util.extend(e,{method:"PUT"}),e.headers=e.headers?e.headers:{},"CONTENT-TYPE"in OpenLayers.Util.upperCaseObject(e.headers)||(e.headers["Content-Type"]="application/xml"),OpenLayers.Request.issue(e)},DELETE:function(e){return e=OpenLayers.Util.extend(e,{method:"DELETE"}),OpenLayers.Request.issue(e)},HEAD:function(e){return e=OpenLayers.Util.extend(e,{method:"HEAD"}),OpenLayers.Request.issue(e)},OPTIONS:function(e){return e=OpenLayers.Util.extend(e,{method:"OPTIONS"}),OpenLayers.Request.issue(e)}}),function(){function e(){this._object=s&&!l?new s:new window.ActiveXObject("Microsoft.XMLHTTP"),this._listeners=[]}function t(){return new e}function n(e){t.onreadystatechange&&t.onreadystatechange.apply(e),e.dispatchEvent({type:"readystatechange",bubbles:!1,cancelable:!1,timeStamp:new Date+0})}function i(e){try{e.responseText=e._object.responseText}catch(e){}try{var t,n=e._object,i=n.responseXML,r=n.responseText;o&&r&&i&&!i.documentElement&&n.getResponseHeader("Content-Type").match(/[^\/]+\/[^\+]+\+xml/)&&(i=new window.ActiveXObject("Microsoft.XMLDOM"),i.async=!1,i.validateOnParse=!1,i.loadXML(r)),t=i&&(o&&0!=i.parseError||!i.documentElement||i.documentElement&&"parsererror"==i.documentElement.tagName)?null:i,e.responseXML=t}catch(e){}try{e.status=e._object.status}catch(e){}try{e.statusText=e._object.statusText}catch(e){}}function r(e){e._object.onreadystatechange=new window.Function}var s=window.XMLHttpRequest,a=!!window.controllers,o=window.document.all&&!window.opera,l=o&&window.navigator.userAgent.match(/MSIE 7.0/);t.prototype=e.prototype,a&&s.wrapped&&(t.wrapped=s.wrapped),t.UNSENT=0,t.OPENED=1,t.HEADERS_RECEIVED=2,t.LOADING=3,t.DONE=4,t.prototype.readyState=t.UNSENT,t.prototype.responseText="",t.prototype.responseXML=null,t.prototype.status=0,t.prototype.statusText="",t.prototype.priority="NORMAL",t.prototype.onreadystatechange=null,t.onreadystatechange=null,t.onopen=null,t.onsend=null,t.onabort=null,t.prototype.open=function(e,s,l,h,u){delete this._headers,3>arguments.length&&(l=!0),this._async=l;var p,c=this,d=this.readyState;o&&l&&(p=function(){d!=t.DONE&&(r(c),c.abort())},window.attachEvent("onunload",p)),t.onopen&&t.onopen.apply(this,arguments),4<arguments.length?this._object.open(e,s,l,h,u):3<arguments.length?this._object.open(e,s,l,h):this._object.open(e,s,l),this.readyState=t.OPENED,n(this),this._object.onreadystatechange=function(){a&&!l||(c.readyState=c._object.readyState,i(c),c._aborted?c.readyState=t.UNSENT:(c.readyState==t.DONE&&(delete c._data,r(c),o&&l&&window.detachEvent("onunload",p)),d!=c.readyState&&n(c),d=c.readyState))}},t.prototype.send=function(e){t.onsend&&t.onsend.apply(this,arguments),arguments.length||(e=null),e&&e.nodeType&&(e=window.XMLSerializer?(new window.XMLSerializer).serializeToString(e):e.xml,this._headers["Content-Type"]||this._object.setRequestHeader("Content-Type","application/xml")),this._data=e;e:if(this._object.send(this._data),a&&!this._async)for(this.readyState=t.OPENED,i(this);this.readyState<t.DONE;)if(this.readyState++,n(this),this._aborted)break e},t.prototype.abort=function(){t.onabort&&t.onabort.apply(this,arguments),this.readyState>t.UNSENT&&(this._aborted=!0),this._object.abort(),r(this),this.readyState=t.UNSENT,delete this._data},t.prototype.getAllResponseHeaders=function(){return this._object.getAllResponseHeaders()},t.prototype.getResponseHeader=function(e){return this._object.getResponseHeader(e)},t.prototype.setRequestHeader=function(e,t){return this._headers||(this._headers={}),this._headers[e]=t,this._object.setRequestHeader(e,t)},t.prototype.addEventListener=function(e,t,n){for(var i,r=0;i=this._listeners[r];r++)if(i[0]==e&&i[1]==t&&i[2]==n)return;this._listeners.push([e,t,n])},t.prototype.removeEventListener=function(e,t,n){for(var i,r=0;(i=this._listeners[r])&&(i[0]!=e||i[1]!=t||i[2]!=n);r++);i&&this._listeners.splice(r,1)},t.prototype.dispatchEvent=function(e){e={type:e.type,target:this,currentTarget:this,eventPhase:2,bubbles:e.bubbles,cancelable:e.cancelable,timeStamp:e.timeStamp,stopPropagation:function(){},preventDefault:function(){},initEvent:function(){}},"readystatechange"==e.type&&this.onreadystatechange&&(this.onreadystatechange.handleEvent||this.onreadystatechange).apply(this,[e]);for(var t,n=0;t=this._listeners[n];n++)t[0]!=e.type||t[2]||(t[1].handleEvent||t[1]).apply(this,[e])},t.prototype.toString=function(){return"[object XMLHttpRequest]"},t.toString=function(){return"[XMLHttpRequest]"},window.Function.prototype.apply||(window.Function.prototype.apply=function(e,t){t||(t=[]),e.__func=this,e.__func(t[0],t[1],t[2],t[3],t[4]),delete e.__func}),OpenLayers.Request||(OpenLayers.Request={}),OpenLayers.Request.XMLHttpRequest=t}(),OpenLayers.Protocol.HTTP=OpenLayers.Class(OpenLayers.Protocol,{url:null,headers:null,params:null,callback:null,scope:null,readWithPOST:!1,updateWithPOST:!1,deleteWithPOST:!1,wildcarded:!1,srsInBBOX:!1,initialize:function(e){if(e=e||{},this.params={},this.headers={},OpenLayers.Protocol.prototype.initialize.apply(this,arguments),!this.filterToParams&&OpenLayers.Format.QueryStringFilter){var t=new OpenLayers.Format.QueryStringFilter({wildcarded:this.wildcarded,srsInBBOX:this.srsInBBOX});this.filterToParams=function(e,n){return t.write(e,n)}}},destroy:function(){this.headers=this.params=null,OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(e){OpenLayers.Protocol.prototype.read.apply(this,arguments),e=e||{},e.params=OpenLayers.Util.applyDefaults(e.params,this.options.params),e=OpenLayers.Util.applyDefaults(e,this.options),e.filter&&this.filterToParams&&(e.params=this.filterToParams(e.filter,e.params));var t=void 0!==e.readWithPOST?e.readWithPOST:this.readWithPOST,n=new OpenLayers.Protocol.Response({requestType:"read"});return t?(t=e.headers||{},t["Content-Type"]="application/x-www-form-urlencoded",n.priv=OpenLayers.Request.POST({url:e.url,callback:this.createCallback(this.handleRead,n,e),data:OpenLayers.Util.getParameterString(e.params),headers:t})):n.priv=OpenLayers.Request.GET({url:e.url,callback:this.createCallback(this.handleRead,n,e),params:e.params,headers:e.headers}),n},handleRead:function(e,t){this.handleResponse(e,t)},create:function(e,t){t=OpenLayers.Util.applyDefaults(t,this.options);var n=new OpenLayers.Protocol.Response({reqFeatures:e,requestType:"create"});return n.priv=OpenLayers.Request.POST({url:t.url,callback:this.createCallback(this.handleCreate,n,t),headers:t.headers,data:this.format.write(e)}),n},handleCreate:function(e,t){this.handleResponse(e,t)},update:function(e,t){t=t||{};var n=t.url||e.url||this.options.url+"/"+e.fid;t=OpenLayers.Util.applyDefaults(t,this.options);var i=new OpenLayers.Protocol.Response({reqFeatures:e,requestType:"update"});return i.priv=OpenLayers.Request[this.updateWithPOST?"POST":"PUT"]({url:n,callback:this.createCallback(this.handleUpdate,i,t),headers:t.headers,data:this.format.write(e)}),i},handleUpdate:function(e,t){this.handleResponse(e,t)},delete:function(e,t){t=t||{};var n=t.url||e.url||this.options.url+"/"+e.fid;t=OpenLayers.Util.applyDefaults(t,this.options);var i=new OpenLayers.Protocol.Response({reqFeatures:e,requestType:"delete"}),r=this.deleteWithPOST?"POST":"DELETE",n={url:n,callback:this.createCallback(this.handleDelete,i,t),headers:t.headers};return this.deleteWithPOST&&(n.data=this.format.write(e)),i.priv=OpenLayers.Request[r](n),i},handleDelete:function(e,t){this.handleResponse(e,t)},handleResponse:function(e,t){var n=e.priv;t.callback&&(200<=n.status&&300>n.status?("delete"!=e.requestType&&(e.features=this.parseFeatures(n)),e.code=OpenLayers.Protocol.Response.SUCCESS):e.code=OpenLayers.Protocol.Response.FAILURE,t.callback.call(t.scope,e))},parseFeatures:function(e){var t=e.responseXML;return t&&t.documentElement||(t=e.responseText),!t||0>=t.length?null:this.format.read(t)},commit:function(e,t){function n(e){for(var t=e.features?e.features.length:0,n=Array(t),r=0;r<t;++r)n[r]=e.features[r].fid;y.insertIds=n,i.apply(this,[e])}function i(e){this.callUserCallback(e,t),d=d&&e.success(),s++,s>=c&&t.callback&&(y.code=d?OpenLayers.Protocol.Response.SUCCESS:OpenLayers.Protocol.Response.FAILURE,t.callback.apply(t.scope,[y]))}t=OpenLayers.Util.applyDefaults(t,this.options);var r=[],s=0,a={};a[OpenLayers.State.INSERT]=[],a[OpenLayers.State.UPDATE]=[],a[OpenLayers.State.DELETE]=[];for(var o,l,h=[],u=0,p=e.length;u<p;++u)o=e[u],(l=a[o.state])&&(l.push(o),h.push(o));var c=(0<a[OpenLayers.State.INSERT].length?1:0)+a[OpenLayers.State.UPDATE].length+a[OpenLayers.State.DELETE].length,d=!0,y=new OpenLayers.Protocol.Response({reqFeatures:h});for(o=a[OpenLayers.State.INSERT],0<o.length&&r.push(this.create(o,OpenLayers.Util.applyDefaults({callback:n,scope:this},t.create))),o=a[OpenLayers.State.UPDATE],u=o.length-1;0<=u;--u)r.push(this.update(o[u],OpenLayers.Util.applyDefaults({callback:i,scope:this},t.update)));for(o=a[OpenLayers.State.DELETE],u=o.length-1;0<=u;--u)r.push(this.delete(o[u],OpenLayers.Util.applyDefaults({callback:i,scope:this},t.delete)));return r},abort:function(e){e&&e.priv.abort()},callUserCallback:function(e,t){var n=t[e.requestType];n&&n.callback&&n.callback.call(n.scope,e)},CLASS_NAME:"OpenLayers.Protocol.HTTP"}),OpenLayers.Geometry=OpenLayers.Class({id:null,parent:null,bounds:null,initialize:function(){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){this.bounds=this.id=null},clone:function(){return new OpenLayers.Geometry},setBounds:function(e){e&&(this.bounds=e.clone())},clearBounds:function(){this.bounds=null,this.parent&&this.parent.clearBounds()},extendBounds:function(e){this.getBounds()?this.bounds.extend(e):this.setBounds(e)},getBounds:function(){return null==this.bounds&&this.calculateBounds(),this.bounds},calculateBounds:function(){},distanceTo:function(e,t){},getVertices:function(e){},atPoint:function(e,t,n){var i=!1;return null!=this.getBounds()&&null!=e&&(t=null!=t?t:0,n=null!=n?n:0,i=new OpenLayers.Bounds(this.bounds.left-t,this.bounds.bottom-n,this.bounds.right+t,this.bounds.top+n).containsLonLat(e)),i},getLength:function(){return 0},getArea:function(){return 0},getCentroid:function(){return null},toString:function(){return OpenLayers.Format&&OpenLayers.Format.WKT?OpenLayers.Format.WKT.prototype.write(new OpenLayers.Feature.Vector(this)):Object.prototype.toString.call(this)},CLASS_NAME:"OpenLayers.Geometry"}),OpenLayers.Geometry.fromWKT=function(e){var t;if(OpenLayers.Format&&OpenLayers.Format.WKT){var n=OpenLayers.Geometry.fromWKT.format;if(n||(n=new OpenLayers.Format.WKT,OpenLayers.Geometry.fromWKT.format=n),e=n.read(e),e instanceof OpenLayers.Feature.Vector)t=e.geometry;else if(OpenLayers.Util.isArray(e)){t=e.length;for(var n=Array(t),i=0;i<t;++i)n[i]=e[i].geometry;t=new OpenLayers.Geometry.Collection(n)}}return t},OpenLayers.Geometry.segmentsIntersect=function(e,t,n){var i=n&&n.point;n=n&&n.tolerance;var r=!1,s=e.x1-t.x1,a=e.y1-t.y1,o=e.x2-e.x1,l=e.y2-e.y1,h=t.y2-t.y1,u=t.x2-t.x1,p=h*o-u*l,h=u*a-h*s,a=o*a-l*s;if(0==p?0==h&&0==a&&(r=!0):(s=h/p,p=a/p,0<=s&&1>=s&&0<=p&&1>=p&&(i?(o=e.x1+s*o,p=e.y1+s*l,r=new OpenLayers.Geometry.Point(o,p)):r=!0)),n)if(r){if(i)e:for(e=[e,t],t=0;2>t;++t)for(s=e[t],l=1;3>l;++l)if(o=s["x"+l],p=s["y"+l],i=Math.sqrt(Math.pow(o-r.x,2)+Math.pow(p-r.y,2)),i<n){r.x=o,r.y=p;break e}}else e:for(e=[e,t],t=0;2>t;++t)for(o=e[t],p=e[(t+1)%2],l=1;3>l;++l)if(s={x:o["x"+l],y:o["y"+l]},a=OpenLayers.Geometry.distanceToSegment(s,p),a.distance<n){r=!i||new OpenLayers.Geometry.Point(s.x,s.y);break e}return r},OpenLayers.Geometry.distanceToSegment=function(e,t){var n=OpenLayers.Geometry.distanceSquaredToSegment(e,t);return n.distance=Math.sqrt(n.distance),n},OpenLayers.Geometry.distanceSquaredToSegment=function(e,t){var n=e.x,i=e.y,r=t.x1,s=t.y1,a=t.x2,o=t.y2,l=a-r,h=o-s,u=0==l&&0==h?0:(l*(n-r)+h*(i-s))/(Math.pow(l,2)+Math.pow(h,2));return 0>=u||(1<=u?(r=a,s=o):(r+=u*l,s+=u*h)),{distance:Math.pow(r-n,2)+Math.pow(s-i,2),x:r,y:s,along:u}},OpenLayers.Geometry.Collection=OpenLayers.Class(OpenLayers.Geometry,{components:null,componentTypes:null,initialize:function(e){OpenLayers.Geometry.prototype.initialize.apply(this,arguments),this.components=[],null!=e&&this.addComponents(e)},destroy:function(){this.components.length=0,this.components=null,OpenLayers.Geometry.prototype.destroy.apply(this,arguments)},clone:function(){for(var e=new(OpenLayers.Util.getConstructor(this.CLASS_NAME)),t=0,n=this.components.length;t<n;t++)e.addComponent(this.components[t].clone());return OpenLayers.Util.applyDefaults(e,this),e},getComponentsString:function(){for(var e=[],t=0,n=this.components.length;t<n;t++)e.push(this.components[t].toShortString());return e.join(",")},calculateBounds:function(){this.bounds=null;var e=new OpenLayers.Bounds,t=this.components;if(t)for(var n=0,i=t.length;n<i;n++)e.extend(t[n].getBounds());null!=e.left&&null!=e.bottom&&null!=e.right&&null!=e.top&&this.setBounds(e)},addComponents:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=0,n=e.length;t<n;t++)this.addComponent(e[t])},addComponent:function(e,t){var n=!1;if(e&&(null==this.componentTypes||-1<OpenLayers.Util.indexOf(this.componentTypes,e.CLASS_NAME))){if(null!=t&&t<this.components.length){var n=this.components.slice(0,t),i=this.components.slice(t,this.components.length);n.push(e),this.components=n.concat(i)}else this.components.push(e);e.parent=this,this.clearBounds(),n=!0}return n},removeComponents:function(e){var t=!1;OpenLayers.Util.isArray(e)||(e=[e]);for(var n=e.length-1;0<=n;--n)t=this.removeComponent(e[n])||t;return t},removeComponent:function(e){return OpenLayers.Util.removeItem(this.components,e),this.clearBounds(),!0},getLength:function(){for(var e=0,t=0,n=this.components.length;t<n;t++)e+=this.components[t].getLength();return e},getArea:function(){for(var e=0,t=0,n=this.components.length;t<n;t++)e+=this.components[t].getArea();return e},getGeodesicArea:function(e){for(var t=0,n=0,i=this.components.length;n<i;n++)t+=this.components[n].getGeodesicArea(e);return t},getCentroid:function(e){if(!e)return this.components.length&&this.components[0].getCentroid();if(e=this.components.length,!e)return!1;for(var t,n=[],i=[],r=0,s=Number.MAX_VALUE,a=0;a<e;++a){t=this.components[a];var o=t.getArea();t=t.getCentroid(!0),isNaN(o)||isNaN(t.x)||isNaN(t.y)||(n.push(o),r+=o,s=o<s&&0<o?o:s,i.push(t))}if(e=n.length,0===r){for(a=0;a<e;++a)n[a]=1;r=n.length}else{for(a=0;a<e;++a)n[a]/=s;r/=s}for(var l=s=0,a=0;a<e;++a)t=i[a],o=n[a],s+=t.x*o,l+=t.y*o;return new OpenLayers.Geometry.Point(s/r,l/r)},getGeodesicLength:function(e){for(var t=0,n=0,i=this.components.length;n<i;n++)t+=this.components[n].getGeodesicLength(e);return t},move:function(e,t){for(var n=0,i=this.components.length;n<i;n++)this.components[n].move(e,t)},rotate:function(e,t){for(var n=0,i=this.components.length;n<i;++n)this.components[n].rotate(e,t)},resize:function(e,t,n){for(var i=0;i<this.components.length;++i)this.components[i].resize(e,t,n);return this},distanceTo:function(e,t){for(var n,i,r,s=!(t&&!1===t.edge)&&t&&t.details,a=Number.POSITIVE_INFINITY,o=0,l=this.components.length;o<l&&(n=this.components[o].distanceTo(e,t),r=s?n.distance:n,!(r<a&&(a=r,i=n,0==a)));++o);return i},equals:function(e){var t=!0;if(e&&e.CLASS_NAME&&this.CLASS_NAME==e.CLASS_NAME)if(OpenLayers.Util.isArray(e.components)&&e.components.length==this.components.length){for(var n=0,i=this.components.length;n<i;++n)if(!this.components[n].equals(e.components[n])){t=!1;break}}else t=!1;else t=!1;return t},transform:function(e,t){if(e&&t){for(var n=0,i=this.components.length;n<i;n++)this.components[n].transform(e,t);this.bounds=null}return this},intersects:function(e){for(var t=!1,n=0,i=this.components.length;n<i&&!(t=e.intersects(this.components[n]));++n);return t},getVertices:function(e){for(var t=[],n=0,i=this.components.length;n<i;++n)Array.prototype.push.apply(t,this.components[n].getVertices(e));return t},CLASS_NAME:"OpenLayers.Geometry.Collection"}),OpenLayers.Geometry.Point=OpenLayers.Class(OpenLayers.Geometry,{x:null,y:null,initialize:function(e,t){OpenLayers.Geometry.prototype.initialize.apply(this,arguments),this.x=parseFloat(e),this.y=parseFloat(t)},clone:function(e){return null==e&&(e=new OpenLayers.Geometry.Point(this.x,this.y)),OpenLayers.Util.applyDefaults(e,this),e},calculateBounds:function(){this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x,this.y)},distanceTo:function(e,t){var n,i,r,s,a,o=!(t&&!1===t.edge)&&t&&t.details;return e instanceof OpenLayers.Geometry.Point?(i=this.x,r=this.y,s=e.x,a=e.y,n=Math.sqrt(Math.pow(i-s,2)+Math.pow(r-a,2)),n=o?{x0:i,y0:r,x1:s,y1:a,distance:n}:n):(n=e.distanceTo(this,t),o&&(n={x0:n.x1,y0:n.y1,x1:n.x0,y1:n.y0,distance:n.distance})),n},equals:function(e){var t=!1;return null!=e&&(t=this.x==e.x&&this.y==e.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(e.x)&&isNaN(e.y)),t},toShortString:function(){return this.x+", "+this.y},move:function(e,t){this.x+=e,this.y+=t,this.clearBounds()},rotate:function(e,t){e*=Math.PI/180;var n=this.distanceTo(t),i=e+Math.atan2(this.y-t.y,this.x-t.x);this.x=t.x+n*Math.cos(i),this.y=t.y+n*Math.sin(i),this.clearBounds()},getCentroid:function(){return new OpenLayers.Geometry.Point(this.x,this.y)},resize:function(e,t,n){return this.x=t.x+e*(void 0==n?1:n)*(this.x-t.x),this.y=t.y+e*(this.y-t.y),this.clearBounds(),this},intersects:function(e){return"OpenLayers.Geometry.Point"==e.CLASS_NAME?this.equals(e):e.intersects(this)},transform:function(e,t){return e&&t&&(OpenLayers.Projection.transform(this,e,t),this.bounds=null),this},getVertices:function(e){return[this]},CLASS_NAME:"OpenLayers.Geometry.Point"}),OpenLayers.Geometry.MultiPoint=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Point"],addPoint:function(e,t){this.addComponent(e,t)},removePoint:function(e){this.removeComponent(e)},CLASS_NAME:"OpenLayers.Geometry.MultiPoint"}),OpenLayers.Geometry.Curve=OpenLayers.Class(OpenLayers.Geometry.MultiPoint,{componentTypes:["OpenLayers.Geometry.Point"],getLength:function(){var e=0;if(this.components&&1<this.components.length)for(var t=1,n=this.components.length;t<n;t++)e+=this.components[t-1].distanceTo(this.components[t]);return e},getGeodesicLength:function(e){var t=this;if(e){var n=new OpenLayers.Projection("EPSG:4326");n.equals(e)||(t=this.clone().transform(e,n))}if(e=0,t.components&&1<t.components.length)for(var i,r=1,s=t.components.length;r<s;r++)n=t.components[r-1],i=t.components[r],e+=OpenLayers.Util.distVincenty({lon:n.x,lat:n.y},{lon:i.x,lat:i.y});return 1e3*e},CLASS_NAME:"OpenLayers.Geometry.Curve"}),OpenLayers.Geometry.LineString=OpenLayers.Class(OpenLayers.Geometry.Curve,{removeComponent:function(e){var t=this.components&&2<this.components.length;return t&&OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments),t},intersects:function(e){var t=!1,n=e.CLASS_NAME;if("OpenLayers.Geometry.LineString"==n||"OpenLayers.Geometry.LinearRing"==n||"OpenLayers.Geometry.Point"==n){var i=this.getSortedSegments();e="OpenLayers.Geometry.Point"==n?[{x1:e.x,y1:e.y,x2:e.x,y2:e.y}]:e.getSortedSegments();var r,s,a,o,l,h,u,p=0,c=i.length;e:for(;p<c;++p){n=i[p],r=n.x1,s=n.x2,a=n.y1,o=n.y2;for(var d=0,y=e.length;d<y&&(l=e[d],!(l.x1>s));++d)if(!(l.x2<r||(h=l.y1,u=l.y2,Math.min(h,u)>Math.max(a,o)||Math.max(h,u)<Math.min(a,o)||!OpenLayers.Geometry.segmentsIntersect(n,l)))){t=!0;break e}}}else t=e.intersects(this);return t},getSortedSegments:function(){for(var e,t,n=this.components.length-1,i=Array(n),r=0;r<n;++r)e=this.components[r],t=this.components[r+1],i[r]=e.x<t.x?{x1:e.x,y1:e.y,x2:t.x,y2:t.y}:{x1:t.x,y1:t.y,x2:e.x,y2:e.y};return i.sort(function(e,t){return e.x1-t.x1})},splitWithSegment:function(e,t){for(var n,i,r,s=!(t&&!1===t.edge),a=t&&t.tolerance,o=[],l=this.getVertices(),h=[],u=[],p=!1,c={point:!0,tolerance:a},d=null,y=0,f=l.length-2;y<=f;++y)a=l[y],h.push(a.clone()),n=l[y+1],i={x1:a.x,y1:a.y,x2:n.x,y2:n.y},i=OpenLayers.Geometry.segmentsIntersect(e,i,c),i instanceof OpenLayers.Geometry.Point&&((r=!!(i.x===e.x1&&i.y===e.y1||i.x===e.x2&&i.y===e.y2||i.equals(a)||i.equals(n)))||s)&&(i.equals(u[u.length-1])||u.push(i.clone()),0===y&&i.equals(a)||i.equals(n)||(p=!0,i.equals(a)||h.push(i),o.push(new OpenLayers.Geometry.LineString(h)),h=[i.clone()]));if(p&&(h.push(n.clone()),o.push(new OpenLayers.Geometry.LineString(h))),0<u.length)var m=e.x1<e.x2?1:-1,g=e.y1<e.y2?1:-1,d={lines:o,points:u.sort(function(e,t){return m*e.x-m*t.x||g*e.y-g*t.y})};return d},split:function(e,t){var n,i,r,s,a=null,o=t&&t.mutual;if(e instanceof OpenLayers.Geometry.LineString){var l,h,u,p,c,d=this.getVertices(),y=[];r=[];for(var f=0,m=d.length-2;f<=m;++f){l=d[f],h=d[f+1],u={x1:l.x,y1:l.y,x2:h.x,y2:h.y},s=s||[e],o&&y.push(l.clone());for(var g=0;g<s.length;++g)if((p=s[g].splitWithSegment(u,t))&&(c=p.lines,0<c.length&&(c.unshift(g,1),Array.prototype.splice.apply(s,c),g+=c.length-2),o))for(var v=0,L=p.points.length;v<L;++v)c=p.points[v],c.equals(l)||(y.push(c),r.push(new OpenLayers.Geometry.LineString(y)),y=c.equals(h)?[]:[c.clone()])}o&&0<r.length&&0<y.length&&(y.push(h.clone()),r.push(new OpenLayers.Geometry.LineString(y)))}else a=e.splitWith(this,t);return s&&1<s.length?i=!0:s=[],r&&1<r.length?n=!0:r=[],(i||n)&&(a=o?[r,s]:s),a},splitWith:function(e,t){return e.split(this,t)},getVertices:function(e){return!0===e?[this.components[0],this.components[this.components.length-1]]:!1===e?this.components.slice(1,this.components.length-1):this.components.slice()},distanceTo:function(e,t){var n,i=!(t&&!1===t.edge)&&t&&t.details,r={},s=Number.POSITIVE_INFINITY;if(e instanceof OpenLayers.Geometry.Point)for(var a,o=this.getSortedSegments(),l=e.x,h=e.y,u=0,p=o.length;u<p&&(a=o[u],n=OpenLayers.Geometry.distanceToSegment(e,a),!(n.distance<s&&(s=n.distance,r=i?{distance:s,x0:n.x,y0:n.y,x1:l,y1:h,index:u,indexDistance:new OpenLayers.Geometry.Point(a.x1,a.y1).distanceTo(e)}:s,0===s)));++u);else if(e instanceof OpenLayers.Geometry.LineString){var c,d,o=this.getSortedSegments(),l=e.getSortedSegments(),y=l.length,f={point:!0},u=0,p=o.length;e:for(;u<p;++u){h=o[u],a=h.x1,d=h.y1;for(var m=0;m<y;++m){if(n=l[m],c=OpenLayers.Geometry.segmentsIntersect(h,n,f)){s=0,r={distance:0,x0:c.x,y0:c.y,x1:c.x,y1:c.y};break e}n=OpenLayers.Geometry.distanceToSegment({x:a,y:d},n),n.distance<s&&(s=n.distance,r={distance:s,x0:a,y0:d,x1:n.x,y1:n.y})}}i||(r=r.distance),0!==s&&h&&(n=e.distanceTo(new OpenLayers.Geometry.Point(h.x2,h.y2),t),u=i?n.distance:n,u<s&&(r=i?{distance:s,x0:n.x1,y0:n.y1,x1:n.x0,y1:n.y0}:u))}else r=e.distanceTo(this,t),i&&(r={distance:r.distance,x0:r.x1,y0:r.y1,x1:r.x0,y1:r.y0});return r},simplify:function(e){if(this&&null!==this){var t=this.getVertices();if(3>t.length)return this;var n=function(e,t,i,s){for(var a,o=0,l=0,h=t;h<i;h++){a=e[t];var u=e[i],p=e[h];a=Math.abs(.5*(a.x*u.y+u.x*p.y+p.x*a.y-u.x*a.y-p.x*u.y-a.x*p.y))/Math.sqrt(Math.pow(a.x-u.x,2)+Math.pow(a.y-u.y,2))*2,a>o&&(o=a,l=h)}o>s&&l!=t&&(r.push(l),n(e,t,l,s),n(e,l,i,s))},i=t.length-1,r=[];for(r.push(0),r.push(i);t[0].equals(t[i]);)i--,r.push(i);for(n(t,0,i,e),e=[],r.sort(function(e,t){return e-t}),i=0;i<r.length;i++)e.push(t[r[i]]);return new OpenLayers.Geometry.LineString(e)}return this},CLASS_NAME:"OpenLayers.Geometry.LineString"}),OpenLayers.Geometry.LineString.geodesic=function(e,t,n){for(var i,r,s,a,o,l=[],h=e(0),u=e(1),p=t(h),c=t(u),d=[u,h],y=[c,p],f=[1,0],m={},g=1e5;0<--g&&0<f.length;)s=f.pop(),h=d.pop(),p=y.pop(),u=s.toString(),u in m||(l.push(p),m[u]=!0),a=f.pop(),u=d.pop(),c=y.pop(),o=(s+a)/2,i=e(o),r=t(i),OpenLayers.Geometry.distanceSquaredToSegment(r,{x1:p.x,y1:p.y,x2:c.x,y2:c.y}).distance<n?(l.push(c),u=a.toString(),m[u]=!0):(f.push(a,o,o,s),y.push(c,r,r,p),d.push(u,i,i,h));return new OpenLayers.Geometry.LineString(l)},OpenLayers.Geometry.LineString.geodesicMeridian=function(e,t,n,i,r){var s=new OpenLayers.Projection("EPSG:4326");return OpenLayers.Geometry.LineString.geodesic(function(i){return new OpenLayers.Geometry.Point(e,t+(n-t)*i)},function(e){return e.transform(s,i)},r)},OpenLayers.Geometry.LineString.geodesicParallel=function(e,t,n,i,r){var s=new OpenLayers.Projection("EPSG:4326");return OpenLayers.Geometry.LineString.geodesic(function(i){return new OpenLayers.Geometry.Point(t+(n-t)*i,e)},function(e){return e.transform(s,i)},r)},OpenLayers.Geometry.LinearRing=OpenLayers.Class(OpenLayers.Geometry.LineString,{componentTypes:["OpenLayers.Geometry.Point"],addComponent:function(e,t){var n=!1,i=this.components.pop();return null==t&&e.equals(i)||(n=OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,arguments)),OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[this.components[0]]),n},removeComponent:function(e){var t=this.components&&3<this.components.length;return t&&(this.components.pop(),OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments),OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[this.components[0]])),t},move:function(e,t){for(var n=0,i=this.components.length;n<i-1;n++)this.components[n].move(e,t)},rotate:function(e,t){for(var n=0,i=this.components.length;n<i-1;++n)this.components[n].rotate(e,t)},resize:function(e,t,n){for(var i=0,r=this.components.length;i<r-1;++i)this.components[i].resize(e,t,n);return this},transform:function(e,t){if(e&&t){for(var n=0,i=this.components.length;n<i-1;n++)this.components[n].transform(e,t);this.bounds=null}return this},getCentroid:function(){if(this.components){var e=this.components.length;if(0<e&&2>=e)return this.components[0].clone();if(2<e){var t=0,n=0,i=this.components[0].x,r=this.components[0].y,s=-1*this.getArea();if(0!=s){for(var a=0;a<e-1;a++)var o=this.components[a],l=this.components[a+1],t=t+(o.x+l.x-2*i)*((o.x-i)*(l.y-r)-(l.x-i)*(o.y-r)),n=n+(o.y+l.y-2*r)*((o.x-i)*(l.y-r)-(l.x-i)*(o.y-r));t=i+t/(6*s),e=r+n/(6*s)}else{for(a=0;a<e-1;a++)t+=this.components[a].x,n+=this.components[a].y;t/=e-1,e=n/(e-1)}return new OpenLayers.Geometry.Point(t,e)}return null}},getArea:function(){var e=0;if(this.components&&2<this.components.length){for(var t=e=0,n=this.components.length;t<n-1;t++)var i=this.components[t],r=this.components[t+1],e=e+(i.x+r.x)*(r.y-i.y);e=-e/2}return e},getGeodesicArea:function(e){var t=this;if(e){var n=new OpenLayers.Projection("EPSG:4326");n.equals(e)||(t=this.clone().transform(e,n))}if(e=0,n=t.components&&t.components.length,2<n){for(var i,r,s=0;s<n-1;s++)i=t.components[s],r=t.components[s+1],e+=OpenLayers.Util.rad(r.x-i.x)*(2+Math.sin(OpenLayers.Util.rad(i.y))+Math.sin(OpenLayers.Util.rad(r.y)));e=e*OpenLayers.Util.VincentyConstants.a*OpenLayers.Util.VincentyConstants.a/2}return e},containsPoint:function(e){var t=OpenLayers.Number.limitSigDigs,n=t(e.x,14);e=t(e.y,14);for(var i,r,s,a,o,l=this.components.length-1,h=0,u=0;u<l;++u)if(i=this.components[u],s=t(i.x,14),i=t(i.y,14),r=this.components[u+1],a=t(r.x,14),r=t(r.y,14),i==r){if(e==i&&(s<=a&&n>=s&&n<=a||s>=a&&n<=s&&n>=a)){h=-1;break}}else{if(o=t((a-s)/(r-i)*(e-r)+a,14),o==n&&(i<r&&e>=i&&e<=r||i>r&&e<=i&&e>=r)){h=-1;break}o<=n||s!=a&&(o<Math.min(s,a)||o>Math.max(s,a))||(i<r&&e>=i&&e<r||i>r&&e<i&&e>=r)&&++h}return-1==h?1:!!(1&h)},intersects:function(e){var t=!1;if("OpenLayers.Geometry.Point"==e.CLASS_NAME)t=this.containsPoint(e);else if("OpenLayers.Geometry.LineString"==e.CLASS_NAME)t=e.intersects(this);else if("OpenLayers.Geometry.LinearRing"==e.CLASS_NAME)t=OpenLayers.Geometry.LineString.prototype.intersects.apply(this,[e]);else for(var n=0,i=e.components.length;n<i&&!(t=e.components[n].intersects(this));++n);
return t},getVertices:function(e){return!0===e?[]:this.components.slice(0,this.components.length-1)},CLASS_NAME:"OpenLayers.Geometry.LinearRing"}),OpenLayers.Geometry.Polygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LinearRing"],getArea:function(){var e=0;if(this.components&&0<this.components.length)for(var e=e+Math.abs(this.components[0].getArea()),t=1,n=this.components.length;t<n;t++)e-=Math.abs(this.components[t].getArea());return e},getGeodesicArea:function(e){var t=0;if(this.components&&0<this.components.length)for(var t=t+Math.abs(this.components[0].getGeodesicArea(e)),n=1,i=this.components.length;n<i;n++)t-=Math.abs(this.components[n].getGeodesicArea(e));return t},containsPoint:function(e){var t=this.components.length,n=!1;if(0<t&&(n=this.components[0].containsPoint(e),1!==n&&n&&1<t))for(var i,r=1;r<t;++r)if(i=this.components[r].containsPoint(e)){n=1===i&&1;break}return n},intersects:function(e){var t,n,i=!1;if("OpenLayers.Geometry.Point"==e.CLASS_NAME)i=this.containsPoint(e);else if("OpenLayers.Geometry.LineString"==e.CLASS_NAME||"OpenLayers.Geometry.LinearRing"==e.CLASS_NAME){for(t=0,n=this.components.length;t<n&&!(i=e.intersects(this.components[t]));++t);if(!i)for(t=0,n=e.components.length;t<n&&!(i=this.containsPoint(e.components[t]));++t);}else for(t=0,n=e.components.length;t<n&&!(i=this.intersects(e.components[t]));++t);if(!i&&"OpenLayers.Geometry.Polygon"==e.CLASS_NAME){var r=this.components[0];for(t=0,n=r.components.length;t<n&&!(i=e.containsPoint(r.components[t]));++t);}return i},distanceTo:function(e,t){return t&&!1===t.edge&&this.intersects(e)?0:OpenLayers.Geometry.Collection.prototype.distanceTo.apply(this,[e,t])},CLASS_NAME:"OpenLayers.Geometry.Polygon"}),OpenLayers.Geometry.Polygon.createRegularPolygon=function(e,t,n,i){var r=Math.PI*(1/n-.5);i&&(r+=i/180*Math.PI);for(var s,a=[],o=0;o<n;++o)s=r+2*o*Math.PI/n,i=e.x+t*Math.cos(s),s=e.y+t*Math.sin(s),a.push(new OpenLayers.Geometry.Point(i,s));return e=new OpenLayers.Geometry.LinearRing(a),new OpenLayers.Geometry.Polygon([e])},OpenLayers.Geometry.MultiPolygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Polygon"],CLASS_NAME:"OpenLayers.Geometry.MultiPolygon"}),OpenLayers.Feature=OpenLayers.Class({layer:null,id:null,lonlat:null,data:null,marker:null,popupClass:null,popup:null,initialize:function(e,t,n){this.layer=e,this.lonlat=t,this.data=null!=n?n:{},this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){null!=this.layer&&null!=this.layer.map&&null!=this.popup&&this.layer.map.removePopup(this.popup),null!=this.layer&&null!=this.marker&&this.layer.removeMarker(this.marker),this.data=this.lonlat=this.id=this.layer=null,null!=this.marker&&(this.destroyMarker(this.marker),this.marker=null),null!=this.popup&&(this.destroyPopup(this.popup),this.popup=null)},onScreen:function(){var e=!1;return null!=this.layer&&null!=this.layer.map&&(e=this.layer.map.getExtent().containsLonLat(this.lonlat)),e},createMarker:function(){return null!=this.lonlat&&(this.marker=new OpenLayers.Marker(this.lonlat,this.data.icon)),this.marker},destroyMarker:function(){this.marker.destroy()},createPopup:function(e){return null!=this.lonlat&&(this.popup||(this.popup=new(this.popupClass?this.popupClass:OpenLayers.Popup.Anchored)(this.id+"_popup",this.lonlat,this.data.popupSize,this.data.popupContentHTML,this.marker?this.marker.icon:null,e)),null!=this.data.overflow&&(this.popup.contentDiv.style.overflow=this.data.overflow),this.popup.feature=this),this.popup},destroyPopup:function(){this.popup&&(this.popup.feature=null,this.popup.destroy(),this.popup=null)},CLASS_NAME:"OpenLayers.Feature"}),OpenLayers.State={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"},OpenLayers.Feature.Vector=OpenLayers.Class(OpenLayers.Feature,{fid:null,geometry:null,attributes:null,bounds:null,state:null,style:null,url:null,renderIntent:"default",modified:null,initialize:function(e,t,n){OpenLayers.Feature.prototype.initialize.apply(this,[null,null,t]),this.lonlat=null,this.geometry=e?e:null,this.state=null,this.attributes={},t&&(this.attributes=OpenLayers.Util.extend(this.attributes,t)),this.style=n?n:null},destroy:function(){this.layer&&(this.layer.removeFeatures(this),this.layer=null),this.modified=this.geometry=null,OpenLayers.Feature.prototype.destroy.apply(this,arguments)},clone:function(){return new OpenLayers.Feature.Vector(this.geometry?this.geometry.clone():null,this.attributes,this.style)},onScreen:function(e){var t=!1;return this.layer&&this.layer.map&&(t=this.layer.map.getExtent(),e?(e=this.geometry.getBounds(),t=t.intersectsBounds(e)):t=t.toGeometry().intersects(this.geometry)),t},getVisibility:function(){return!(this.style&&"none"==this.style.display||!this.layer||this.layer&&this.layer.styleMap&&"none"==this.layer.styleMap.createSymbolizer(this,this.renderIntent).display||this.layer&&!this.layer.getVisibility())},createMarker:function(){return null},destroyMarker:function(){},createPopup:function(){return null},atPoint:function(e,t,n){var i=!1;return this.geometry&&(i=this.geometry.atPoint(e,t,n)),i},destroyPopup:function(){},move:function(e){if(this.layer&&this.geometry.move){e="OpenLayers.LonLat"==e.CLASS_NAME?this.layer.getViewPortPxFromLonLat(e):e;var t=this.layer.getViewPortPxFromLonLat(this.geometry.getBounds().getCenterLonLat()),n=this.layer.map.getResolution();return this.geometry.move(n*(e.x-t.x),n*(t.y-e.y)),this.layer.drawFeature(this),t}},toState:function(e){if(e==OpenLayers.State.UPDATE)switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.DELETE:this.state=e}else if(e==OpenLayers.State.INSERT)switch(this.state){case OpenLayers.State.UNKNOWN:break;default:this.state=e}else if(e==OpenLayers.State.DELETE)switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.UPDATE:this.state=e}else e==OpenLayers.State.UNKNOWN&&(this.state=e)},CLASS_NAME:"OpenLayers.Feature.Vector"}),OpenLayers.Feature.Vector.style={default:{fillColor:"#ee9900",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},select:{fillColor:"blue",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},temporary:{fillColor:"#66cccc",fillOpacity:.2,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#66cccc",strokeOpacity:1,strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},delete:{display:"none"}},OpenLayers.Style=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:!1,rules:null,context:null,defaultStyle:null,defaultsPerSymbolizer:!1,propertyStyles:null,initialize:function(e,t){OpenLayers.Util.extend(this,t),this.rules=[],t&&t.rules&&this.addRules(t.rules),this.setDefaultStyle(e||OpenLayers.Feature.Vector.style.default),this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var e=0,t=this.rules.length;e<t;e++)this.rules[e].destroy(),this.rules[e]=null;this.defaultStyle=this.rules=null},createSymbolizer:function(e){for(var t,n=this.defaultsPerSymbolizer?{}:this.createLiterals(OpenLayers.Util.extend({},this.defaultStyle),e),i=this.rules,r=[],s=!1,a=0,o=i.length;a<o;a++)t=i[a],t.evaluate(e)&&(t instanceof OpenLayers.Rule&&t.elseFilter?r.push(t):(s=!0,this.applySymbolizer(t,n,e)));if(0==s&&0<r.length)for(s=!0,a=0,o=r.length;a<o;a++)this.applySymbolizer(r[a],n,e);return 0<i.length&&0==s&&(n.display="none"),null!=n.label&&"string"!=typeof n.label&&(n.label=String(n.label)),n},applySymbolizer:function(e,t,n){var i=n.geometry?this.getSymbolizerPrefix(n.geometry):OpenLayers.Style.SYMBOLIZER_PREFIXES[0];return e=e.symbolizer[i]||e.symbolizer,!0===this.defaultsPerSymbolizer&&(i=this.defaultStyle,OpenLayers.Util.applyDefaults(e,{pointRadius:i.pointRadius}),!0!==e.stroke&&!0!==e.graphic||OpenLayers.Util.applyDefaults(e,{strokeWidth:i.strokeWidth,strokeColor:i.strokeColor,strokeOpacity:i.strokeOpacity,strokeDashstyle:i.strokeDashstyle,strokeLinecap:i.strokeLinecap}),!0!==e.fill&&!0!==e.graphic||OpenLayers.Util.applyDefaults(e,{fillColor:i.fillColor,fillOpacity:i.fillOpacity}),!0===e.graphic&&OpenLayers.Util.applyDefaults(e,{pointRadius:this.defaultStyle.pointRadius,externalGraphic:this.defaultStyle.externalGraphic,graphicName:this.defaultStyle.graphicName,graphicOpacity:this.defaultStyle.graphicOpacity,graphicWidth:this.defaultStyle.graphicWidth,graphicHeight:this.defaultStyle.graphicHeight,graphicXOffset:this.defaultStyle.graphicXOffset,graphicYOffset:this.defaultStyle.graphicYOffset})),this.createLiterals(OpenLayers.Util.extend(t,e),n)},createLiterals:function(e,t){var n=OpenLayers.Util.extend({},t.attributes||t.data);OpenLayers.Util.extend(n,this.context);for(var i in this.propertyStyles)e[i]=OpenLayers.Style.createLiteral(e[i],n,t,i);return e},findPropertyStyles:function(){var e={};this.addPropertyStyles(e,this.defaultStyle);for(var t,n,i=this.rules,r=0,s=i.length;r<s;r++){t=i[r].symbolizer;for(var a in t){if(n=t[a],"object"!=typeof n){this.addPropertyStyles(e,t);break}this.addPropertyStyles(e,n)}}return e},addPropertyStyles:function(e,t){var n,i;for(i in t)n=t[i],"string"==typeof n&&n.match(/\$\{\w+\}/)&&(e[i]=!0);return e},addRules:function(e){Array.prototype.push.apply(this.rules,e),this.propertyStyles=this.findPropertyStyles()},setDefaultStyle:function(e){this.defaultStyle=e,this.propertyStyles=this.findPropertyStyles()},getSymbolizerPrefix:function(e){for(var t=OpenLayers.Style.SYMBOLIZER_PREFIXES,n=0,i=t.length;n<i;n++)if(-1!=e.CLASS_NAME.indexOf(t[n]))return t[n]},clone:function(){var e=OpenLayers.Util.extend({},this);if(this.rules){e.rules=[];for(var t=0,n=this.rules.length;t<n;++t)e.rules.push(this.rules[t].clone())}return e.context=this.context&&OpenLayers.Util.extend({},this.context),t=OpenLayers.Util.extend({},this.defaultStyle),new OpenLayers.Style(t,e)},CLASS_NAME:"OpenLayers.Style"}),OpenLayers.Style.createLiteral=function(e,t,n,i){return"string"==typeof e&&-1!=e.indexOf("${")&&(e=OpenLayers.String.format(e,t,[n,i]),e=isNaN(e)||!e?e:parseFloat(e)),e},OpenLayers.Style.SYMBOLIZER_PREFIXES=["Point","Line","Polygon","Text","Raster"],OpenLayers.StyleMap=OpenLayers.Class({styles:null,extendDefault:!0,initialize:function(e,t){if(this.styles={default:new OpenLayers.Style(OpenLayers.Feature.Vector.style.default),select:new OpenLayers.Style(OpenLayers.Feature.Vector.style.select),temporary:new OpenLayers.Style(OpenLayers.Feature.Vector.style.temporary),delete:new OpenLayers.Style(OpenLayers.Feature.Vector.style.delete)},e instanceof OpenLayers.Style)this.styles.default=e,this.styles.select=e,this.styles.temporary=e,this.styles.delete=e;else if("object"==typeof e)for(var n in e)if(e[n]instanceof OpenLayers.Style)this.styles[n]=e[n];else{if("object"!=typeof e[n]){this.styles.default=new OpenLayers.Style(e),this.styles.select=new OpenLayers.Style(e),this.styles.temporary=new OpenLayers.Style(e),this.styles.delete=new OpenLayers.Style(e);break}this.styles[n]=new OpenLayers.Style(e[n])}OpenLayers.Util.extend(this,t)},destroy:function(){for(var e in this.styles)this.styles[e].destroy();this.styles=null},createSymbolizer:function(e,t){e||(e=new OpenLayers.Feature.Vector),this.styles[t]||(t="default"),e.renderIntent=t;var n={};return this.extendDefault&&"default"!=t&&(n=this.styles.default.createSymbolizer(e)),OpenLayers.Util.extend(n,this.styles[t].createSymbolizer(e))},addUniqueValueRules:function(e,t,n,i){var r,s=[];for(r in n)s.push(new OpenLayers.Rule({symbolizer:n[r],context:i,filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:t,value:r})}));this.styles[e].addRules(s)},CLASS_NAME:"OpenLayers.StyleMap"}),OpenLayers.Layer.Vector=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,isFixed:!1,features:null,filter:null,selectedFeatures:null,unrenderedFeatures:null,reportError:!0,style:null,styleMap:null,strategies:null,protocol:null,renderers:["SVG","VML","Canvas"],renderer:null,rendererOptions:null,geometryType:null,drawn:!1,ratio:1,initialize:function(e,t){if(OpenLayers.Layer.prototype.initialize.apply(this,arguments),this.renderer&&this.renderer.supported()||this.assignRenderer(),this.renderer&&this.renderer.supported()||(this.renderer=null,this.displayError()),this.styleMap||(this.styleMap=new OpenLayers.StyleMap),this.features=[],this.selectedFeatures=[],this.unrenderedFeatures={},this.strategies)for(var n=0,i=this.strategies.length;n<i;n++)this.strategies[n].setLayer(this)},destroy:function(){if(this.strategies){var e,t,n;for(t=0,n=this.strategies.length;t<n;t++)e=this.strategies[t],e.autoDestroy&&e.destroy();this.strategies=null}this.protocol&&(this.protocol.autoDestroy&&this.protocol.destroy(),this.protocol=null),this.destroyFeatures(),this.unrenderedFeatures=this.selectedFeatures=this.features=null,this.renderer&&this.renderer.destroy(),this.drawn=this.geometryType=this.renderer=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(e){null==e&&(e=new OpenLayers.Layer.Vector(this.name,this.getOptions())),e=OpenLayers.Layer.prototype.clone.apply(this,[e]);for(var t=this.features,n=t.length,i=Array(n),r=0;r<n;++r)i[r]=t[r].clone();return e.features=i,e},refresh:function(e){this.calculateInRange()&&this.visibility&&this.events.triggerEvent("refresh",e)},assignRenderer:function(){for(var e=0,t=this.renderers.length;e<t;e++){var n=this.renderers[e];if((n="function"==typeof n?n:OpenLayers.Renderer[n])&&n.prototype.supported()){this.renderer=new n(this.div,this.rendererOptions);break}}},displayError:function(){this.reportError&&OpenLayers.Console.userError(OpenLayers.i18n("browserNotSupported",{renderers:this.renderers.join("\n")}))},setMap:function(e){if(OpenLayers.Layer.prototype.setMap.apply(this,arguments),this.renderer){this.renderer.map=this.map;var t=this.map.getSize();t.w*=this.ratio,t.h*=this.ratio,this.renderer.setSize(t)}else this.map.removeLayer(this)},afterAdd:function(){if(this.strategies){var e,t,n;for(t=0,n=this.strategies.length;t<n;t++)e=this.strategies[t],e.autoActivate&&e.activate()}},removeMap:function(e){if(this.drawn=!1,this.strategies){var t,n;for(t=0,n=this.strategies.length;t<n;t++)e=this.strategies[t],e.autoActivate&&e.deactivate()}},onMapResize:function(){OpenLayers.Layer.prototype.onMapResize.apply(this,arguments);var e=this.map.getSize();e.w*=this.ratio,e.h*=this.ratio,this.renderer.setSize(e)},moveTo:function(e,t,n){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var i=!0;if(!n){this.renderer.root.style.visibility="hidden";var i=this.map.getSize(),r=i.w,i=i.h,r=r/2*this.ratio-r/2,i=i/2*this.ratio-i/2,r=r+this.map.layerContainerOriginPx.x,r=-Math.round(r),i=i+this.map.layerContainerOriginPx.y,i=-Math.round(i);if(this.div.style.left=r+"px",this.div.style.top=i+"px",r=this.map.getExtent().scale(this.ratio),i=this.renderer.setExtent(r,t),this.renderer.root.style.visibility="visible",!0===OpenLayers.IS_GECKO&&(this.div.scrollLeft=this.div.scrollLeft),!t&&i)for(var s in this.unrenderedFeatures)r=this.unrenderedFeatures[s],this.drawFeature(r)}if(!this.drawn||t||!i)for(this.drawn=!0,s=0,i=this.features.length;s<i;s++)this.renderer.locked=s!==i-1,r=this.features[s],this.drawFeature(r)},display:function(e){OpenLayers.Layer.prototype.display.apply(this,arguments);var t=this.div.style.display;t!=this.renderer.root.style.display&&(this.renderer.root.style.display=t)},addFeatures:function(e,t){OpenLayers.Util.isArray(e)||(e=[e]);var n=!t||!t.silent;if(n){var i={features:e};if(!1===this.events.triggerEvent("beforefeaturesadded",i))return;e=i.features}for(var i=[],r=0,s=e.length;r<s;r++){this.renderer.locked=r!=e.length-1;var a=e[r];if(this.geometryType&&!(a.geometry instanceof this.geometryType))throw new TypeError("addFeatures: component should be an "+this.geometryType.prototype.CLASS_NAME);if(a.layer=this,!a.style&&this.style&&(a.style=OpenLayers.Util.extend({},this.style)),n){if(!1===this.events.triggerEvent("beforefeatureadded",{feature:a}))continue;this.preFeatureInsert(a)}i.push(a),this.features.push(a),this.drawFeature(a),n&&(this.events.triggerEvent("featureadded",{feature:a}),this.onFeatureInsert(a))}n&&this.events.triggerEvent("featuresadded",{features:i})},removeFeatures:function(e,t){if(e&&0!==e.length){if(e===this.features)return this.removeAllFeatures(t);OpenLayers.Util.isArray(e)||(e=[e]),e===this.selectedFeatures&&(e=e.slice());var n=!t||!t.silent;n&&this.events.triggerEvent("beforefeaturesremoved",{features:e});for(var i=e.length-1;0<=i;i--){this.renderer.locked=!(0==i||!e[i-1].geometry);var r=e[i];delete this.unrenderedFeatures[r.id],n&&this.events.triggerEvent("beforefeatureremoved",{feature:r}),this.features=OpenLayers.Util.removeItem(this.features,r),r.layer=null,r.geometry&&this.renderer.eraseFeatures(r),-1!=OpenLayers.Util.indexOf(this.selectedFeatures,r)&&OpenLayers.Util.removeItem(this.selectedFeatures,r),n&&this.events.triggerEvent("featureremoved",{feature:r})}n&&this.events.triggerEvent("featuresremoved",{features:e})}},removeAllFeatures:function(e){e=!e||!e.silent;var t=this.features;e&&this.events.triggerEvent("beforefeaturesremoved",{features:t});for(var n,i=t.length-1;0<=i;i--)n=t[i],e&&this.events.triggerEvent("beforefeatureremoved",{feature:n}),n.layer=null,e&&this.events.triggerEvent("featureremoved",{feature:n});this.renderer.clear(),this.features=[],this.unrenderedFeatures={},this.selectedFeatures=[],e&&this.events.triggerEvent("featuresremoved",{features:t})},destroyFeatures:function(e,t){if(void 0==e&&(e=this.features),e){this.removeFeatures(e,t);for(var n=e.length-1;0<=n;n--)e[n].destroy()}},drawFeature:function(e,t){if(this.drawn){if("object"!=typeof t){t||e.state!==OpenLayers.State.DELETE||(t="delete");var n=t||e.renderIntent;(t=e.style||this.style)||(t=this.styleMap.createSymbolizer(e,n))}n=this.renderer.drawFeature(e,t),!1===n||null===n?this.unrenderedFeatures[e.id]=e:delete this.unrenderedFeatures[e.id]}},eraseFeatures:function(e){this.renderer.eraseFeatures(e)},getFeatureFromEvent:function(e){if(!this.renderer)throw Error("getFeatureFromEvent called on layer with no renderer. This usually means you destroyed a layer, but not some handler which is associated with it.");var t=null;return(e=this.renderer.getFeatureIdFromEvent(e))&&(t="string"==typeof e?this.getFeatureById(e):e),t},getFeatureBy:function(e,t){for(var n=null,i=0,r=this.features.length;i<r;++i)if(this.features[i][e]==t){n=this.features[i];break}return n},getFeatureById:function(e){return this.getFeatureBy("id",e)},getFeatureByFid:function(e){return this.getFeatureBy("fid",e)},getFeaturesByAttribute:function(e,t){var n,i,r=this.features.length,s=[];for(n=0;n<r;n++)(i=this.features[n])&&i.attributes&&i.attributes[e]===t&&s.push(i);return s},onFeatureInsert:function(e){},preFeatureInsert:function(e){},getDataExtent:function(){var e=null,t=this.features;if(t&&0<t.length)for(var n,i=0,r=t.length;i<r;i++)(n=t[i].geometry)&&(null===e&&(e=new OpenLayers.Bounds),e.extend(n.getBounds()));return e},CLASS_NAME:"OpenLayers.Layer.Vector"}),OpenLayers.Layer.Markers=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,markers:null,drawn:!1,initialize:function(e,t){OpenLayers.Layer.prototype.initialize.apply(this,arguments),this.markers=[]},destroy:function(){this.clearMarkers(),this.markers=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setOpacity:function(e){if(e!=this.opacity){this.opacity=e,e=0;for(var t=this.markers.length;e<t;e++)this.markers[e].setOpacity(this.opacity)}},moveTo:function(e,t,n){if(OpenLayers.Layer.prototype.moveTo.apply(this,arguments),t||!this.drawn){for(var i=0,r=this.markers.length;i<r;i++)this.drawMarker(this.markers[i]);this.drawn=!0}},addMarker:function(e){this.markers.push(e),1>this.opacity&&e.setOpacity(this.opacity),this.map&&this.map.getExtent()&&(e.map=this.map,this.drawMarker(e))},removeMarker:function(e){this.markers&&this.markers.length&&(OpenLayers.Util.removeItem(this.markers,e),e.erase())},clearMarkers:function(){if(null!=this.markers)for(;0<this.markers.length;)this.removeMarker(this.markers[0])},drawMarker:function(e){var t=this.map.getLayerPxFromLonLat(e.lonlat);null==t?e.display(!1):e.isDrawn()?e.icon&&e.icon.moveTo(t):(e=e.draw(t),this.div.appendChild(e))},getDataExtent:function(){var e=null;if(this.markers&&0<this.markers.length)for(var e=new OpenLayers.Bounds,t=0,n=this.markers.length;t<n;t++)e.extend(this.markers[t].lonlat);return e},CLASS_NAME:"OpenLayers.Layer.Markers"}),OpenLayers.Layer.TMS=OpenLayers.Class(OpenLayers.Layer.Grid,{serviceVersion:"1.0.0",layername:null,type:null,isBaseLayer:!0,tileOrigin:null,serverResolutions:null,zoomOffset:0,initialize:function(e,t,n){var i=[];i.push(e,t,{},n),OpenLayers.Layer.Grid.prototype.initialize.apply(this,i)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.TMS(this.name,this.url,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},getURL:function(e){e=this.adjustBounds(e);var t=this.getServerResolution(),n=Math.round((e.left-this.tileOrigin.lon)/(t*this.tileSize.w));return e=Math.round((e.bottom-this.tileOrigin.lat)/(t*this.tileSize.h)),t=this.getServerZoom(),n=this.serviceVersion+"/"+this.layername+"/"+t+"/"+n+"/"+e+"."+this.type,e=this.url,OpenLayers.Util.isArray(e)&&(e=this.selectUrl(n,e)),e+n},setMap:function(e){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.bottom))},CLASS_NAME:"OpenLayers.Layer.TMS"}),OpenLayers.Format=OpenLayers.Class({options:null,externalProjection:null,internalProjection:null,data:null,keepData:!1,initialize:function(e){OpenLayers.Util.extend(this,e),this.options=e},destroy:function(){},read:function(e){throw Error("Read not implemented.")},write:function(e){throw Error("Write not implemented.")},CLASS_NAME:"OpenLayers.Format"}),OpenLayers.Format.JSON=OpenLayers.Class(OpenLayers.Format,{indent:"    ",space:" ",newline:"\n",level:0,pretty:!1,nativeJSON:function(){return!(!window.JSON||"function"!=typeof JSON.parse||"function"!=typeof JSON.stringify)}(),read:function(a,b){var c;if(this.nativeJSON)c=JSON.parse(a,b);else try{if(/^[\],:{}\s]*$/.test(a.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))&&(c=eval("("+a+")"),"function"==typeof b)){var d=function(e,t){if(t&&"object"==typeof t)for(var n in t)t.hasOwnProperty(n)&&(t[n]=d(n,t[n]));return b(e,t)};c=d("",c)}}catch(e){}return this.keepData&&(this.data=c),c},write:function(e,t){this.pretty=!!t;var n=null,i=typeof e;if(this.serialize[i])try{n=!this.pretty&&this.nativeJSON?JSON.stringify(e):this.serialize[i].apply(this,[e])}catch(e){OpenLayers.Console.error("Trouble serializing: "+e)}return n},writeIndent:function(){var e=[];if(this.pretty)for(var t=0;t<this.level;++t)e.push(this.indent);return e.join("")},writeNewline:function(){return this.pretty?this.newline:""},writeSpace:function(){return this.pretty?this.space:""},serialize:{object:function(e){if(null==e)return"null";if(e.constructor==Date)return this.serialize.date.apply(this,[e]);if(e.constructor==Array)return this.serialize.array.apply(this,[e]);var t=["{"];this.level+=1;var n,i,r,s=!1;for(n in e)e.hasOwnProperty(n)&&(i=OpenLayers.Format.JSON.prototype.write.apply(this,[n,this.pretty]),r=OpenLayers.Format.JSON.prototype.write.apply(this,[e[n],this.pretty]),null!=i&&null!=r&&(s&&t.push(","),t.push(this.writeNewline(),this.writeIndent(),i,":",this.writeSpace(),r),s=!0));return--this.level,t.push(this.writeNewline(),this.writeIndent(),"}"),t.join("")},array:function(e){var t,n=["["];this.level+=1;for(var i=0,r=e.length;i<r;++i)t=OpenLayers.Format.JSON.prototype.write.apply(this,[e[i],this.pretty]),null!=t&&(0<i&&n.push(","),n.push(this.writeNewline(),this.writeIndent(),t));return--this.level,n.push(this.writeNewline(),this.writeIndent(),"]"),n.join("")},string:function(e){var t={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return/["\\\x00-\x1f]/.test(e)?'"'+e.replace(/([\x00-\x1f\\"])/g,function(e,n){var i=t[n];return i?i:(i=n.charCodeAt(),"\\u00"+Math.floor(i/16).toString(16)+(i%16).toString(16))})+'"':'"'+e+'"'},number:function(e){return isFinite(e)?String(e):"null"},boolean:function(e){return String(e)},date:function(e){function t(e){return 10>e?"0"+e:e}return'"'+e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+"T"+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())+'"'}},CLASS_NAME:"OpenLayers.Format.JSON"}),OpenLayers.Geometry.MultiLineString=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LineString"],split:function(e,t){for(var n,i,r,s,a=null,o=t&&t.mutual,l=[],h=[e],u=0,p=this.components.length;u<p;++u){i=this.components[u],r=!1;for(var c=0;c<h.length;++c)if(n=i.split(h[c],t)){if(o){r=n[0];for(var d=0,y=r.length;d<y;++d)0===d&&l.length?l[l.length-1].addComponent(r[d]):l.push(new OpenLayers.Geometry.MultiLineString([r[d]]));r=!0,n=n[1]}if(n.length){n.unshift(c,1),Array.prototype.splice.apply(h,n);break}}r||(l.length?l[l.length-1].addComponent(i.clone()):l=[new OpenLayers.Geometry.MultiLineString(i.clone())])}return l&&1<l.length?r=!0:l=[],h&&1<h.length?s=!0:h=[],(r||s)&&(a=o?[l,h]:h),a},splitWith:function(e,t){var n,i,r,s,a,o,l=null,h=t&&t.mutual;if(e instanceof OpenLayers.Geometry.LineString){o=[],a=[e];for(var u=0,p=this.components.length;u<p;++u){r=!1,i=this.components[u];for(var c=0;c<a.length;++c)if(n=a[c].split(i,t)){h&&(r=n[0],r.length&&(r.unshift(c,1),Array.prototype.splice.apply(a,r),c+=r.length-2),n=n[1],0===n.length&&(n=[i.clone()])),r=0;for(var d=n.length;r<d;++r)0===r&&o.length?o[o.length-1].addComponent(n[r]):o.push(new OpenLayers.Geometry.MultiLineString([n[r]]));r=!0}r||(o.length?o[o.length-1].addComponent(i.clone()):o=[new OpenLayers.Geometry.MultiLineString([i.clone()])])}}else l=e.split(this);return a&&1<a.length?s=!0:a=[],o&&1<o.length?r=!0:o=[],(s||r)&&(l=h?[a,o]:o),l},CLASS_NAME:"OpenLayers.Geometry.MultiLineString"}),OpenLayers.Format.GeoJSON=OpenLayers.Class(OpenLayers.Format.JSON,{ignoreExtraDims:!1,read:function(e,t,n){t=t?t:"FeatureCollection";var i=null;if(n="string"==typeof e?OpenLayers.Format.JSON.prototype.read.apply(this,[e,n]):e){if("string"!=typeof n.type)OpenLayers.Console.error("Bad GeoJSON - no type: "+e);else if(this.isValidType(n,t))switch(t){case"Geometry":try{i=this.parseGeometry(n)}catch(e){OpenLayers.Console.error(e)}break;case"Feature":try{i=this.parseFeature(n),i.type="Feature"}catch(e){OpenLayers.Console.error(e)}break;case"FeatureCollection":switch(i=[],n.type){case"Feature":try{i.push(this.parseFeature(n))}catch(e){i=null,OpenLayers.Console.error(e)}break;case"FeatureCollection":for(e=0,t=n.features.length;e<t;++e)try{i.push(this.parseFeature(n.features[e]))}catch(e){i=null,OpenLayers.Console.error(e)}break;default:try{var r=this.parseGeometry(n);i.push(new OpenLayers.Feature.Vector(r))}catch(e){i=null,OpenLayers.Console.error(e)}}}}else OpenLayers.Console.error("Bad JSON: "+e);return i},isValidType:function(e,t){var n=!1;switch(t){case"Geometry":-1==OpenLayers.Util.indexOf("Point MultiPoint LineString MultiLineString Polygon MultiPolygon Box GeometryCollection".split(" "),e.type)?OpenLayers.Console.error("Unsupported geometry type: "+e.type):n=!0;break;case"FeatureCollection":n=!0;break;default:e.type==t?n=!0:OpenLayers.Console.error("Cannot convert types from "+e.type+" to "+t)}return n},parseFeature:function(e){var t,n,i;n=e.properties?e.properties:{},i=e.geometry&&e.geometry.bbox||e.bbox;try{t=this.parseGeometry(e.geometry)}catch(e){throw e}return t=new OpenLayers.Feature.Vector(t,n),i&&(t.bounds=OpenLayers.Bounds.fromArray(i)),e.id&&(t.fid=e.id),t},parseGeometry:function(e){if(null==e)return null;var t,n=!1;if("GeometryCollection"==e.type){if(!OpenLayers.Util.isArray(e.geometries))throw"GeometryCollection must have geometries array: "+e;t=e.geometries.length;for(var n=Array(t),i=0;i<t;++i)n[i]=this.parseGeometry.apply(this,[e.geometries[i]]);t=new OpenLayers.Geometry.Collection(n),n=!0}else{if(!OpenLayers.Util.isArray(e.coordinates))throw"Geometry must have coordinates array: "+e;if(!this.parseCoords[e.type.toLowerCase()])throw"Unsupported geometry type: "+e.type;try{t=this.parseCoords[e.type.toLowerCase()].apply(this,[e.coordinates])}catch(e){throw e}}return this.internalProjection&&this.externalProjection&&!n&&t.transform(this.externalProjection,this.internalProjection),t},parseCoords:{point:function(e){if(0==this.ignoreExtraDims&&2!=e.length)throw"Only 2D points are supported: "+e;return new OpenLayers.Geometry.Point(e[0],e[1])},multipoint:function(e){for(var t=[],n=null,i=0,r=e.length;i<r;++i){try{n=this.parseCoords.point.apply(this,[e[i]])}catch(e){throw e}t.push(n)}return new OpenLayers.Geometry.MultiPoint(t)},linestring:function(e){for(var t=[],n=null,i=0,r=e.length;i<r;++i){try{n=this.parseCoords.point.apply(this,[e[i]])}catch(e){throw e}t.push(n)}return new OpenLayers.Geometry.LineString(t)},multilinestring:function(e){for(var t=[],n=null,i=0,r=e.length;i<r;++i){try{n=this.parseCoords.linestring.apply(this,[e[i]])}catch(e){throw e}t.push(n)}return new OpenLayers.Geometry.MultiLineString(t)},polygon:function(e){for(var t,n,i=[],r=0,s=e.length;r<s;++r){try{n=this.parseCoords.linestring.apply(this,[e[r]])}catch(e){throw e}t=new OpenLayers.Geometry.LinearRing(n.components),i.push(t)}return new OpenLayers.Geometry.Polygon(i)},multipolygon:function(e){for(var t=[],n=null,i=0,r=e.length;i<r;++i){try{n=this.parseCoords.polygon.apply(this,[e[i]])}catch(e){throw e}t.push(n)}return new OpenLayers.Geometry.MultiPolygon(t)},box:function(e){if(2!=e.length)throw"GeoJSON box coordinates must have 2 elements";return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(e[0][0],e[0][1]),new OpenLayers.Geometry.Point(e[1][0],e[0][1]),new OpenLayers.Geometry.Point(e[1][0],e[1][1]),new OpenLayers.Geometry.Point(e[0][0],e[1][1]),new OpenLayers.Geometry.Point(e[0][0],e[0][1])])])}},write:function(e,t){var n={type:null};if(OpenLayers.Util.isArray(e)){n.type="FeatureCollection";var i=e.length;n.features=Array(i);for(var r=0;r<i;++r){var s=e[r];if(!s instanceof OpenLayers.Feature.Vector)throw"FeatureCollection only supports collections of features: "+s;n.features[r]=this.extract.feature.apply(this,[s])}}else 0==e.CLASS_NAME.indexOf("OpenLayers.Geometry")?n=this.extract.geometry.apply(this,[e]):e instanceof OpenLayers.Feature.Vector&&(n=this.extract.feature.apply(this,[e]),e.layer&&e.layer.projection&&(n.crs=this.createCRSObject(e)));return OpenLayers.Format.JSON.prototype.write.apply(this,[n,t])},createCRSObject:function(e){e=e.layer.projection.toString();var t={};return e.match(/epsg:/i)&&(e=parseInt(e.substring(e.indexOf(":")+1)),t=4326==e?{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}}:{type:"name",properties:{name:"EPSG:"+e}}),t},extract:{feature:function(e){var t=this.extract.geometry.apply(this,[e.geometry]),t={type:"Feature",properties:e.attributes,geometry:t};return null!=e.fid&&(t.id=e.fid),t},geometry:function(e){if(null==e)return null;this.internalProjection&&this.externalProjection&&(e=e.clone(),
e.transform(this.internalProjection,this.externalProjection));var t=e.CLASS_NAME.split(".")[2];return e=this.extract[t.toLowerCase()].apply(this,[e]),"Collection"==t?{type:"GeometryCollection",geometries:e}:{type:t,coordinates:e}},point:function(e){return[e.x,e.y]},multipoint:function(e){for(var t=[],n=0,i=e.components.length;n<i;++n)t.push(this.extract.point.apply(this,[e.components[n]]));return t},linestring:function(e){for(var t=[],n=0,i=e.components.length;n<i;++n)t.push(this.extract.point.apply(this,[e.components[n]]));return t},multilinestring:function(e){for(var t=[],n=0,i=e.components.length;n<i;++n)t.push(this.extract.linestring.apply(this,[e.components[n]]));return t},polygon:function(e){for(var t=[],n=0,i=e.components.length;n<i;++n)t.push(this.extract.linestring.apply(this,[e.components[n]]));return t},multipolygon:function(e){for(var t=[],n=0,i=e.components.length;n<i;++n)t.push(this.extract.polygon.apply(this,[e.components[n]]));return t},collection:function(e){for(var t=e.components.length,n=Array(t),i=0;i<t;++i)n[i]=this.extract.geometry.apply(this,[e.components[i]]);return n}},CLASS_NAME:"OpenLayers.Format.GeoJSON"}),OpenLayers.Control=OpenLayers.Class({id:null,map:null,div:null,type:null,allowSelection:!1,displayClass:"",title:"",autoActivate:!1,active:null,handlerOptions:null,handler:null,eventListeners:null,events:null,initialize:function(e){this.displayClass=this.CLASS_NAME.replace("OpenLayers.","ol").replace(/\./g,""),OpenLayers.Util.extend(this,e),this.events=new OpenLayers.Events(this),this.eventListeners instanceof Object&&this.events.on(this.eventListeners),null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"))},destroy:function(){if(this.events&&(this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy(),this.events=null),this.eventListeners=null,this.handler&&(this.handler.destroy(),this.handler=null),this.handlers){for(var e in this.handlers)this.handlers.hasOwnProperty(e)&&"function"==typeof this.handlers[e].destroy&&this.handlers[e].destroy();this.handlers=null}this.map&&(this.map.removeControl(this),this.map=null),this.div=null},setMap:function(e){this.map=e,this.handler&&this.handler.setMap(e)},draw:function(e){return null==this.div&&(this.div=OpenLayers.Util.createDiv(this.id),this.div.className=this.displayClass,this.allowSelection||(this.div.className+=" olControlNoSelect",this.div.setAttribute("unselectable","on",0),this.div.onselectstart=OpenLayers.Function.False),""!=this.title&&(this.div.title=this.title)),null!=e&&(this.position=e.clone()),this.moveTo(this.position),this.div},moveTo:function(e){null!=e&&null!=this.div&&(this.div.style.left=e.x+"px",this.div.style.top=e.y+"px")},activate:function(){return!this.active&&(this.handler&&this.handler.activate(),this.active=!0,this.map&&OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active"),this.events.triggerEvent("activate"),!0)},deactivate:function(){return!!this.active&&(this.handler&&this.handler.deactivate(),this.active=!1,this.map&&OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active"),this.events.triggerEvent("deactivate"),!0)},CLASS_NAME:"OpenLayers.Control"}),OpenLayers.Control.TYPE_BUTTON=1,OpenLayers.Control.TYPE_TOGGLE=2,OpenLayers.Control.TYPE_TOOL=3,OpenLayers.Control.DrawFeature=OpenLayers.Class(OpenLayers.Control,{layer:null,callbacks:null,multi:!1,featureAdded:function(){},initialize:function(e,t,n){OpenLayers.Control.prototype.initialize.apply(this,[n]),this.callbacks=OpenLayers.Util.extend({done:this.drawFeature,modify:function(e,t){this.layer.events.triggerEvent("sketchmodified",{vertex:e,feature:t})},create:function(e,t){this.layer.events.triggerEvent("sketchstarted",{vertex:e,feature:t})}},this.callbacks),this.layer=e,this.handlerOptions=this.handlerOptions||{},this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{renderers:e.renderers,rendererOptions:e.rendererOptions}),"multi"in this.handlerOptions||(this.handlerOptions.multi=this.multi),(e=this.layer.styleMap&&this.layer.styleMap.styles.temporary)&&(this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new OpenLayers.StyleMap({default:e})})),this.handler=new t(this,this.callbacks,this.handlerOptions)},drawFeature:function(e){e=new OpenLayers.Feature.Vector(e),!1!==this.layer.events.triggerEvent("sketchcomplete",{feature:e})&&(e.state=OpenLayers.State.INSERT,this.layer.addFeatures([e]),this.featureAdded(e),this.events.triggerEvent("featureadded",{feature:e}))},insertXY:function(e,t){this.handler&&this.handler.line&&this.handler.insertXY(e,t)},insertDeltaXY:function(e,t){this.handler&&this.handler.line&&this.handler.insertDeltaXY(e,t)},insertDirectionLength:function(e,t){this.handler&&this.handler.line&&this.handler.insertDirectionLength(e,t)},insertDeflectionLength:function(e,t){this.handler&&this.handler.line&&this.handler.insertDeflectionLength(e,t)},undo:function(){return this.handler.undo&&this.handler.undo()},redo:function(){return this.handler.redo&&this.handler.redo()},finishSketch:function(){this.handler.finishGeometry()},cancel:function(){this.handler.cancel()},CLASS_NAME:"OpenLayers.Control.DrawFeature"}),OpenLayers.Control.MousePosition=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,element:null,prefix:"",separator:", ",suffix:"",numDigits:5,granularity:10,emptyString:null,lastXy:null,displayProjection:null,destroy:function(){this.deactivate(),OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return!!OpenLayers.Control.prototype.activate.apply(this,arguments)&&(this.map.events.register("mousemove",this,this.redraw),this.map.events.register("mouseout",this,this.reset),this.redraw(),!0)},deactivate:function(){return!!OpenLayers.Control.prototype.deactivate.apply(this,arguments)&&(this.map.events.unregister("mousemove",this,this.redraw),this.map.events.unregister("mouseout",this,this.reset),this.element.innerHTML="",!0)},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.element||(this.div.left="",this.div.top="",this.element=this.div),this.div},redraw:function(e){var t;null==e?this.reset():null==this.lastXy||Math.abs(e.xy.x-this.lastXy.x)>this.granularity||Math.abs(e.xy.y-this.lastXy.y)>this.granularity?this.lastXy=e.xy:(t=this.map.getLonLatFromPixel(e.xy))&&(this.displayProjection&&t.transform(this.map.getProjectionObject(),this.displayProjection),this.lastXy=e.xy,e=this.formatOutput(t),e!=this.element.innerHTML&&(this.element.innerHTML=e))},reset:function(e){null!=this.emptyString&&(this.element.innerHTML=this.emptyString)},formatOutput:function(e){var t=parseInt(this.numDigits);return this.prefix+e.lon.toFixed(t)+this.separator+e.lat.toFixed(t)+this.suffix},CLASS_NAME:"OpenLayers.Control.MousePosition"}),OpenLayers.Events.buttonclick=OpenLayers.Class({target:null,events:"mousedown mouseup click dblclick touchstart touchmove touchend keydown".split(" "),startRegEx:/^mousedown|touchstart$/,cancelRegEx:/^touchmove$/,completeRegEx:/^mouseup|touchend$/,isDeviceTouchCapable:"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch,initialize:function(e){for(this.target=e,e=this.events.length-1;0<=e;--e)this.target.register(this.events[e],this,this.buttonClick,{extension:!0})},destroy:function(){for(var e=this.events.length-1;0<=e;--e)this.target.unregister(this.events[e],this,this.buttonClick);delete this.target},getPressedButton:function(e){var t,n=3;do{if(OpenLayers.Element.hasClass(e,"olButton")){t=e;break}e=e.parentNode}while(0<--n&&e);return t},ignore:function(e){var t=3,n=!1;do{if("a"===e.nodeName.toLowerCase()){n=!0;break}e=e.parentNode}while(0<--t&&e);return n},buttonClick:function(e){var t=!0,n=OpenLayers.Event.element(e);if(n&&(OpenLayers.Event.isLeftClick(e)&&!this.isDeviceTouchCapable||!~e.type.indexOf("mouse")))if(n=this.getPressedButton(n)){if("keydown"===e.type)switch(e.keyCode){case OpenLayers.Event.KEY_RETURN:case OpenLayers.Event.KEY_SPACE:this.target.triggerEvent("buttonclick",{buttonElement:n}),OpenLayers.Event.stop(e),t=!1}else if(this.startEvt){if(this.completeRegEx.test(e.type)){var t=OpenLayers.Util.pagePosition(n),i=OpenLayers.Util.getViewportElement(),r=window.pageYOffset||i.scrollTop;t[0]-=window.pageXOffset||i.scrollLeft,t[1]-=r,this.target.triggerEvent("buttonclick",{buttonElement:n,buttonXY:{x:this.startEvt.clientX-t[0],y:this.startEvt.clientY-t[1]}})}this.cancelRegEx.test(e.type)&&e.touches&&this.startEvt.touches&&4<(4<Math.abs(e.touches[0].olClientX-this.startEvt.touches[0].olClientX)||Math.abs(e.touches[0].olClientY-this.startEvt.touches[0].olClientY))&&delete this.startEvt,OpenLayers.Event.stop(e),t=!1}this.startRegEx.test(e.type)&&(this.startEvt=e,OpenLayers.Event.stop(e),t=!1)}else t=!this.ignore(OpenLayers.Event.element(e)),delete this.startEvt;return t}}),OpenLayers.Control.Zoom=OpenLayers.Class(OpenLayers.Control,{zoomInText:"+",zoomInId:"olZoomInLink",zoomOutText:"−",zoomOutId:"olZoomOutLink",draw:function(){var e=OpenLayers.Control.prototype.draw.apply(this),t=this.getOrCreateLinks(e),n=t.zoomIn,t=t.zoomOut,i=this.map.events;return t.parentNode!==e&&(i=this.events,i.attachToElement(t.parentNode)),i.register("buttonclick",this,this.onZoomClick),this.zoomInLink=n,this.zoomOutLink=t,e},getOrCreateLinks:function(e){var t=document.getElementById(this.zoomInId),n=document.getElementById(this.zoomOutId);return t||(t=document.createElement("a"),t.href="#zoomIn",t.appendChild(document.createTextNode(this.zoomInText)),t.className="olControlZoomIn",e.appendChild(t)),OpenLayers.Element.addClass(t,"olButton"),n||(n=document.createElement("a"),n.href="#zoomOut",n.appendChild(document.createTextNode(this.zoomOutText)),n.className="olControlZoomOut",e.appendChild(n)),OpenLayers.Element.addClass(n,"olButton"),{zoomIn:t,zoomOut:n}},onZoomClick:function(e){e=e.buttonElement,e===this.zoomInLink?this.map.zoomIn():e===this.zoomOutLink&&this.map.zoomOut()},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onZoomClick),delete this.zoomInLink,delete this.zoomOutLink,OpenLayers.Control.prototype.destroy.apply(this)},CLASS_NAME:"OpenLayers.Control.Zoom"}),OpenLayers.Handler.Feature=OpenLayers.Class(OpenLayers.Handler,{EVENTMAP:{click:{in:"click",out:"clickout"},mousemove:{in:"over",out:"out"},dblclick:{in:"dblclick",out:null},mousedown:{in:null,out:null},mouseup:{in:null,out:null},touchstart:{in:"click",out:"clickout"}},feature:null,lastFeature:null,down:null,up:null,clickTolerance:4,geometryTypes:null,stopClick:!0,stopDown:!0,stopUp:!1,initialize:function(e,t,n,i){OpenLayers.Handler.prototype.initialize.apply(this,[e,n,i]),this.layer=t},touchstart:function(e){return this.startTouch(),!!OpenLayers.Event.isMultiTouch(e)||this.mousedown(e)},touchmove:function(e){OpenLayers.Event.preventDefault(e)},mousedown:function(e){return(OpenLayers.Event.isLeftClick(e)||OpenLayers.Event.isSingleTouch(e))&&(this.down=e.xy),!this.handle(e)||!this.stopDown},mouseup:function(e){return this.up=e.xy,!this.handle(e)||!this.stopUp},click:function(e){return!this.handle(e)||!this.stopClick},mousemove:function(e){return!this.callbacks.over&&!this.callbacks.out||(this.handle(e),!0)},dblclick:function(e){return!this.handle(e)},geometryTypeMatches:function(e){return null==this.geometryTypes||-1<OpenLayers.Util.indexOf(this.geometryTypes,e.geometry.CLASS_NAME)},handle:function(e){this.feature&&!this.feature.layer&&(this.feature=null);var t=e.type,n=!1,i=!!this.feature,r="click"==t||"dblclick"==t||"touchstart"==t;return(this.feature=this.layer.getFeatureFromEvent(e))&&!this.feature.layer&&(this.feature=null),this.lastFeature&&!this.lastFeature.layer&&(this.lastFeature=null),this.feature?("touchstart"===t&&OpenLayers.Event.preventDefault(e),e=this.feature!=this.lastFeature,this.geometryTypeMatches(this.feature)?(i&&e?(this.lastFeature&&this.triggerCallback(t,"out",[this.lastFeature]),this.triggerCallback(t,"in",[this.feature])):i&&!r||this.triggerCallback(t,"in",[this.feature]),this.lastFeature=this.feature,n=!0):(this.lastFeature&&(i&&e||r)&&this.triggerCallback(t,"out",[this.lastFeature]),this.feature=null)):this.lastFeature&&(i||r)&&this.triggerCallback(t,"out",[this.lastFeature]),n},triggerCallback:function(e,t,n){(t=this.EVENTMAP[e][t])&&("click"==e&&this.up&&this.down?(Math.sqrt(Math.pow(this.up.x-this.down.x,2)+Math.pow(this.up.y-this.down.y,2))<=this.clickTolerance&&this.callback(t,n),this.up=this.down=null):this.callback(t,n))},activate:function(){var e=!1;return OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.moveLayerToTop(),this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),e=!0),e},deactivate:function(){var e=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.moveLayerBack(),this.up=this.down=this.lastFeature=this.feature=null,this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),e=!0),e},handleMapEvents:function(e){"removelayer"!=e.type&&"order"!=e.property||this.moveLayerToTop()},moveLayerToTop:function(){var e=Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1;this.layer.setZIndex(e)},moveLayerBack:function(){var e=this.layer.getZIndex()-1;e>=this.map.Z_INDEX_BASE.Feature?this.layer.setZIndex(e):this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))},CLASS_NAME:"OpenLayers.Handler.Feature"}),OpenLayers.Layer.Vector.RootContainer=OpenLayers.Class(OpenLayers.Layer.Vector,{displayInLayerSwitcher:!1,layers:null,display:function(){},getFeatureFromEvent:function(e){for(var t,n=this.layers,i=0;i<n.length;i++)if(t=n[i].getFeatureFromEvent(e))return t},setMap:function(e){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments),this.collectRoots(),e.events.register("changelayer",this,this.handleChangeLayer)},removeMap:function(e){e.events.unregister("changelayer",this,this.handleChangeLayer),this.resetRoots(),OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments)},collectRoots:function(){for(var e,t=0;t<this.map.layers.length;++t)e=this.map.layers[t],-1!=OpenLayers.Util.indexOf(this.layers,e)&&e.renderer.moveRoot(this.renderer)},resetRoots:function(){for(var e,t=0;t<this.layers.length;++t)e=this.layers[t],this.renderer&&e.renderer.getRenderLayerId()==this.id&&this.renderer.moveRoot(e.renderer)},handleChangeLayer:function(e){var t=e.layer;"order"==e.property&&-1!=OpenLayers.Util.indexOf(this.layers,t)&&(this.resetRoots(),this.collectRoots())},CLASS_NAME:"OpenLayers.Layer.Vector.RootContainer"}),OpenLayers.Control.SelectFeature=OpenLayers.Class(OpenLayers.Control,{multipleKey:null,toggleKey:null,multiple:!1,clickout:!0,toggle:!1,hover:!1,highlightOnly:!1,box:!1,onBeforeSelect:function(){},onSelect:function(){},onUnselect:function(){},scope:null,geometryTypes:null,layer:null,layers:null,callbacks:null,selectStyle:null,renderIntent:"select",handlers:null,initialize:function(e,t){OpenLayers.Control.prototype.initialize.apply(this,[t]),null===this.scope&&(this.scope=this),this.initLayer(e);var n={click:this.clickFeature,clickout:this.clickoutFeature};this.hover&&(n.over=this.overFeature,n.out=this.outFeature),this.callbacks=OpenLayers.Util.extend(n,this.callbacks),this.handlers={feature:new OpenLayers.Handler.Feature(this,this.layer,this.callbacks,{geometryTypes:this.geometryTypes})},this.box&&(this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},{boxDivClassName:"olHandlerBoxSelectFeature"}))},initLayer:function(e){OpenLayers.Util.isArray(e)?(this.layers=e,this.layer=new OpenLayers.Layer.Vector.RootContainer(this.id+"_container",{layers:e})):this.layer=e},destroy:function(){this.active&&this.layers&&this.map.removeLayer(this.layer),OpenLayers.Control.prototype.destroy.apply(this,arguments),this.layers&&this.layer.destroy()},activate:function(){return this.active||(this.layers&&this.map.addLayer(this.layer),this.handlers.feature.activate(),this.box&&this.handlers.box&&this.handlers.box.activate()),OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.active&&(this.handlers.feature.deactivate(),this.handlers.box&&this.handlers.box.deactivate(),this.layers&&this.map.removeLayer(this.layer)),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},unselectAll:function(e){var t,n,i,r,s=this.layers||[this.layer];for(i=0;i<s.length;++i)if(t=s[i],r=0,null!=t.selectedFeatures)for(;t.selectedFeatures.length>r;)n=t.selectedFeatures[r],e&&e.except==n?++r:this.unselect(n)},clickFeature:function(e){this.hover||(-1<OpenLayers.Util.indexOf(e.layer.selectedFeatures,e)?this.toggleSelect()?this.unselect(e):this.multipleSelect()||this.unselectAll({except:e}):(this.multipleSelect()||this.unselectAll({except:e}),this.select(e)))},multipleSelect:function(){return this.multiple||this.handlers.feature.evt&&this.handlers.feature.evt[this.multipleKey]},toggleSelect:function(){return this.toggle||this.handlers.feature.evt&&this.handlers.feature.evt[this.toggleKey]},clickoutFeature:function(e){!this.hover&&this.clickout&&this.unselectAll()},overFeature:function(e){var t=e.layer;this.hover&&(this.highlightOnly?this.highlight(e):-1==OpenLayers.Util.indexOf(t.selectedFeatures,e)&&this.select(e))},outFeature:function(e){if(this.hover)if(this.highlightOnly){if(e._lastHighlighter==this.id)if(e._prevHighlighter&&e._prevHighlighter!=this.id){delete e._lastHighlighter;var t=this.map.getControl(e._prevHighlighter);t&&t.highlight(e)}else this.unhighlight(e)}else this.unselect(e)},highlight:function(e){var t=e.layer;!1!==this.events.triggerEvent("beforefeaturehighlighted",{feature:e})&&(e._prevHighlighter=e._lastHighlighter,e._lastHighlighter=this.id,t.drawFeature(e,this.selectStyle||this.renderIntent),this.events.triggerEvent("featurehighlighted",{feature:e}))},unhighlight:function(e){var t=e.layer;void 0==e._prevHighlighter?delete e._lastHighlighter:(e._prevHighlighter!=this.id&&(e._lastHighlighter=e._prevHighlighter),delete e._prevHighlighter),t.drawFeature(e,e.style||e.layer.style||"default"),this.events.triggerEvent("featureunhighlighted",{feature:e})},select:function(e){var t=this.onBeforeSelect.call(this.scope,e),n=e.layer;!1!==t&&(t=n.events.triggerEvent("beforefeatureselected",{feature:e}),!1!==t&&(n.selectedFeatures.push(e),this.highlight(e),this.handlers.feature.lastFeature||(this.handlers.feature.lastFeature=n.selectedFeatures[0]),n.events.triggerEvent("featureselected",{feature:e}),this.onSelect.call(this.scope,e)))},unselect:function(e){var t=e.layer;this.unhighlight(e),OpenLayers.Util.removeItem(t.selectedFeatures,e),t.events.triggerEvent("featureunselected",{feature:e}),this.onUnselect.call(this.scope,e)},selectBox:function(e){if(e instanceof OpenLayers.Bounds){var t=this.map.getLonLatFromPixel({x:e.left,y:e.bottom});e=this.map.getLonLatFromPixel({x:e.right,y:e.top}),t=new OpenLayers.Bounds(t.lon,t.lat,e.lon,e.lat),this.multipleSelect()||this.unselectAll(),e=this.multiple,this.multiple=!0;var n=this.layers||[this.layer];this.events.triggerEvent("boxselectionstart",{layers:n});for(var i,r=0;r<n.length;++r){i=n[r];for(var s=0,a=i.features.length;s<a;++s){var o=i.features[s];o.getVisibility()&&(null==this.geometryTypes||-1<OpenLayers.Util.indexOf(this.geometryTypes,o.geometry.CLASS_NAME))&&t.toGeometry().intersects(o.geometry)&&-1==OpenLayers.Util.indexOf(i.selectedFeatures,o)&&this.select(o)}}this.multiple=e,this.events.triggerEvent("boxselectionend",{layers:n})}},setMap:function(e){this.handlers.feature.setMap(e),this.box&&this.handlers.box.setMap(e),OpenLayers.Control.prototype.setMap.apply(this,arguments)},setLayer:function(e){var t=this.active;this.unselectAll(),this.deactivate(),this.layers&&(this.layer.destroy(),this.layers=null),this.initLayer(e),this.handlers.feature.layer=this.layer,t&&this.activate()},addLayer:function(e){var t=this.active;this.deactivate(),null==this.layers?null!=this.layer?(this.layers=[this.layer],this.layers.push(e)):this.layers=[e]:this.layers.push(e),this.initLayer(this.layers),this.handlers.feature.layer=this.layer,t&&this.activate()},CLASS_NAME:"OpenLayers.Control.SelectFeature"}),OpenLayers.Handler.Drag=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!0,dragging:!1,last:null,start:null,lastMoveEvt:null,oldOnselectstart:null,interval:0,timeoutId:null,documentDrag:!1,documentEvents:null,initialize:function(e,t,n){if(OpenLayers.Handler.prototype.initialize.apply(this,arguments),!0===this.documentDrag){var i=this;this._docMove=function(e){i.mousemove({xy:{x:e.clientX,y:e.clientY},element:document})},this._docUp=function(e){i.mouseup({xy:{x:e.clientX,y:e.clientY}})}}},dragstart:function(e){var t=!0;return this.dragging=!1,this.checkModifiers(e)&&this._pointerId==e.pointerId&&(OpenLayers.Event.isLeftClick(e)||OpenLayers.Event.isSingleTouch(e))?(this.started=!0,this.last=this.start=e.xy,OpenLayers.Element.addClass(this.map.viewPortDiv,"olDragDown"),this.down(e),this.callback("down",[e.xy]),OpenLayers.Event.preventDefault(e),this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart?document.onselectstart:OpenLayers.Function.True),document.onselectstart=OpenLayers.Function.False,t=!this.stopDown):(delete this._pointerId,this.started=!1,this.last=this.start=null),t},dragmove:function(e){return this.lastMoveEvt=e,!this.started||this._pointerId!=e.pointerId||this.timeoutId||e.xy.x==this.last.x&&e.xy.y==this.last.y||(!0===this.documentDrag&&this.documentEvents&&(e.element===document?(this.adjustXY(e),this.setEvent(e)):this.removeDocumentEvents()),0<this.interval&&(this.timeoutId=setTimeout(OpenLayers.Function.bind(this.removeTimeout,this),this.interval)),this.dragging=!0,this.move(e),this.callback("move",[e.xy]),this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart,document.onselectstart=OpenLayers.Function.False),this.last=e.xy),!0},dragend:function(e){if(this.started&&this._pointerId==e.pointerId){!0===this.documentDrag&&this.documentEvents&&(this.adjustXY(e),this.removeDocumentEvents());var t=this.start!=this.last;this.dragging=this.started=!1,delete this._pointerId,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown"),this.up(e),this.callback("up",[e.xy]),t&&this.callback("done",[e.xy]),document.onselectstart=this.oldOnselectstart}return!0},down:function(e){},move:function(e){},up:function(e){},out:function(e){},mousedown:function(e){return this.dragstart(e)},touchstart:function(e){return this.startTouch(),"_pointerId"in this||(this._pointerId=e.pointerId),this.dragstart(e)},mousemove:function(e){return this.dragmove(e)},touchmove:function(e){return this.dragmove(e)},removeTimeout:function(){this.timeoutId=null,this.dragging&&this.mousemove(this.lastMoveEvt)},mouseup:function(e){return this.dragend(e)},touchend:function(e){return e.xy=this.last,this.dragend(e)},mouseout:function(e){if(this.started&&OpenLayers.Util.mouseLeft(e,this.map.viewPortDiv))if(!0===this.documentDrag)this.addDocumentEvents();else{var t=this.start!=this.last;this.dragging=this.started=!1,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown"),this.out(e),this.callback("out",[]),t&&this.callback("done",[e.xy]),document.onselectstart&&(document.onselectstart=this.oldOnselectstart)}return!0},click:function(e){return this.start==this.last},activate:function(){var e=!1;return OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.dragging=!1,e=!0),e},deactivate:function(){var e=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.dragging=this.started=!1,this.last=this.start=null,e=!0,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown")),e},adjustXY:function(e){var t=OpenLayers.Util.pagePosition(this.map.viewPortDiv);e.xy.x-=t[0],e.xy.y-=t[1]},addDocumentEvents:function(){OpenLayers.Element.addClass(document.body,"olDragDown"),this.documentEvents=!0,OpenLayers.Event.observe(document,"mousemove",this._docMove),OpenLayers.Event.observe(document,"mouseup",this._docUp)},removeDocumentEvents:function(){OpenLayers.Element.removeClass(document.body,"olDragDown"),this.documentEvents=!1,OpenLayers.Event.stopObserving(document,"mousemove",this._docMove),OpenLayers.Event.stopObserving(document,"mouseup",this._docUp)},CLASS_NAME:"OpenLayers.Handler.Drag"}),OpenLayers.Handler.Box=OpenLayers.Class(OpenLayers.Handler,{dragHandler:null,boxDivClassName:"olHandlerBoxZoomBox",boxOffsets:null,initialize:function(e,t,n){OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.dragHandler=new OpenLayers.Handler.Drag(this,{down:this.startBox,move:this.moveBox,out:this.removeBox,up:this.endBox},{keyMask:this.keyMask})},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments),this.dragHandler&&(this.dragHandler.destroy(),this.dragHandler=null)},setMap:function(e){OpenLayers.Handler.prototype.setMap.apply(this,arguments),this.dragHandler&&this.dragHandler.setMap(e)},startBox:function(e){this.callback("start",[]),this.zoomBox=OpenLayers.Util.createDiv("zoomBox",{x:-9999,y:-9999}),this.zoomBox.className=this.boxDivClassName,this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1,this.map.viewPortDiv.appendChild(this.zoomBox),OpenLayers.Element.addClass(this.map.viewPortDiv,"olDrawBox")},moveBox:function(e){var t=this.dragHandler.start.x,n=this.dragHandler.start.y,i=Math.abs(t-e.x),r=Math.abs(n-e.y),s=this.getBoxOffsets();this.zoomBox.style.width=i+s.width+1+"px",this.zoomBox.style.height=r+s.height+1+"px",this.zoomBox.style.left=(e.x<t?t-i-s.left:t-s.left)+"px",this.zoomBox.style.top=(e.y<n?n-r-s.top:n-s.top)+"px"},endBox:function(e){if(5<Math.abs(this.dragHandler.start.x-e.x)||5<Math.abs(this.dragHandler.start.y-e.y)){var t=this.dragHandler.start;e=new OpenLayers.Bounds(Math.min(t.x,e.x),Math.max(t.y,e.y),Math.max(t.x,e.x),Math.min(t.y,e.y))}else e=this.dragHandler.start.clone();this.removeBox(),this.callback("done",[e])},removeBox:function(){this.map.viewPortDiv.removeChild(this.zoomBox),this.boxOffsets=this.zoomBox=null,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDrawBox")},activate:function(){return!!OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.dragHandler.activate(),!0)},deactivate:function(){return!!OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.dragHandler.deactivate()&&this.zoomBox&&this.removeBox(),!0)},getBoxOffsets:function(){if(!this.boxOffsets){var e=document.createElement("div");e.style.position="absolute",e.style.border="1px solid black",e.style.width="3px",document.body.appendChild(e);var t=3==e.clientWidth;document.body.removeChild(e);var e=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-left-width")),n=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-right-width")),i=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-top-width")),r=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-bottom-width"));this.boxOffsets={left:e,right:n,top:i,bottom:r,width:!1===t?e+n:0,height:!1===t?i+r:0}}return this.boxOffsets},CLASS_NAME:"OpenLayers.Handler.Box"}),OpenLayers.Control.ZoomBox=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,out:!1,keyMask:null,alwaysZoom:!1,zoomOnClick:!0,draw:function(){this.handler=new OpenLayers.Handler.Box(this,{done:this.zoomBox},{keyMask:this.keyMask})},zoomBox:function(e){if(e instanceof OpenLayers.Bounds){var t,n=e.getCenterPixel();if(this.out){t=Math.min(this.map.size.h/(e.bottom-e.top),this.map.size.w/(e.right-e.left));var i=this.map.getExtent(),r=this.map.getLonLatFromPixel(n),s=r.lon-i.getWidth()/2*t;e=r.lon+i.getWidth()/2*t;var a=r.lat-i.getHeight()/2*t;t=r.lat+i.getHeight()/2*t,t=new OpenLayers.Bounds(s,a,e,t)}else s=this.map.getLonLatFromPixel({x:e.left,y:e.bottom}),e=this.map.getLonLatFromPixel({x:e.right,y:e.top}),t=new OpenLayers.Bounds(s.lon,s.lat,e.lon,e.lat);s=this.map.getZoom(),a=this.map.getSize(),e=a.w/2,a=a.h/2,t=this.map.getZoomForExtent(t),i=this.map.getResolution(),r=this.map.getResolutionForZoom(t),i==r?this.map.setCenter(this.map.getLonLatFromPixel(n)):this.map.zoomTo(t,{x:(i*n.x-r*e)/(i-r),y:(i*n.y-r*a)/(i-r)}),s==this.map.getZoom()&&1==this.alwaysZoom&&this.map.zoomTo(s+(this.out?-1:1))}else this.zoomOnClick&&(this.out?this.map.zoomTo(this.map.getZoom()-1,e):this.map.zoomTo(this.map.getZoom()+1,e))},CLASS_NAME:"OpenLayers.Control.ZoomBox"}),OpenLayers.Control.DragPan=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,panned:!1,interval:0,documentDrag:!1,kinetic:null,enableKinetic:!0,kineticInterval:10,draw:function(){if(this.enableKinetic&&OpenLayers.Kinetic){var e={interval:this.kineticInterval};"object"==typeof this.enableKinetic&&(e=OpenLayers.Util.extend(e,this.enableKinetic)),this.kinetic=new OpenLayers.Kinetic(e)}this.handler=new OpenLayers.Handler.Drag(this,{move:this.panMap,done:this.panMapDone,down:this.panMapStart},{interval:this.interval,documentDrag:this.documentDrag})},panMapStart:function(){this.kinetic&&this.kinetic.begin()},panMap:function(e){this.kinetic&&this.kinetic.update(e),this.panned=!0,this.map.pan(this.handler.last.x-e.x,this.handler.last.y-e.y,{dragging:!0,animate:!1})},panMapDone:function(e){if(this.panned){var t=null;if(this.kinetic&&(t=this.kinetic.end(e)),this.map.pan(this.handler.last.x-e.x,this.handler.last.y-e.y,{dragging:!!t,animate:!1}),t){var n=this;this.kinetic.move(t,function(e,t,i){n.map.pan(e,t,{dragging:!i,animate:!1})})}this.panned=!1}},CLASS_NAME:"OpenLayers.Control.DragPan"}),OpenLayers.Handler.MouseWheel=OpenLayers.Class(OpenLayers.Handler,{wheelListener:null,interval:0,maxDelta:Number.POSITIVE_INFINITY,delta:0,cumulative:!0,initialize:function(e,t,n){OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.wheelListener=OpenLayers.Function.bindAsEventListener(this.onWheelEvent,this)},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments),this.wheelListener=null},onWheelEvent:function(e){if(this.map&&this.checkModifiers(e)){for(var t=!1,n=!1,i=!1,r=OpenLayers.Event.element(e);null!=r&&!i&&!t;){if(!t)try{var s,t=(s=r.currentStyle?r.currentStyle.overflow:document.defaultView.getComputedStyle(r,null).getPropertyValue("overflow"))&&"auto"==s||"scroll"==s}catch(e){}if(!n&&(n=OpenLayers.Element.hasClass(r,"olScrollable"),!n))for(var i=0,a=this.map.layers.length;i<a;i++){var o=this.map.layers[i];if(r==o.div||r==o.pane){n=!0;break}}i=r==this.map.div,r=r.parentNode}if(!t&&i){if(n)if(t=0,e.wheelDelta?(t=e.wheelDelta,0===t%160&&(t*=.75),t/=120):e.detail&&(t=-(e.detail/Math.abs(e.detail))),this.delta+=t,window.clearTimeout(this._timeoutId),this.interval&&Math.abs(this.delta)<this.maxDelta){var l=OpenLayers.Util.extend({},e);this._timeoutId=window.setTimeout(OpenLayers.Function.bind(function(){this.wheelZoom(l)},this),this.interval)}else this.wheelZoom(e);OpenLayers.Event.stop(e)}}},wheelZoom:function(e){var t=this.delta;this.delta=0,t&&(e.xy=this.map.events.getMousePosition(e),0>t?this.callback("down",[e,this.cumulative?Math.max(-this.maxDelta,t):-1]):this.callback("up",[e,this.cumulative?Math.min(this.maxDelta,t):1]))},activate:function(e){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){var t=this.wheelListener;return OpenLayers.Event.observe(window,"DOMMouseScroll",t),OpenLayers.Event.observe(window,"mousewheel",t),OpenLayers.Event.observe(document,"mousewheel",t),!0}return!1},deactivate:function(e){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){var t=this.wheelListener;return OpenLayers.Event.stopObserving(window,"DOMMouseScroll",t),OpenLayers.Event.stopObserving(window,"mousewheel",t),OpenLayers.Event.stopObserving(document,"mousewheel",t),!0}return!1},CLASS_NAME:"OpenLayers.Handler.MouseWheel"});OpenLayers.Handler.Click=OpenLayers.Class(OpenLayers.Handler,{delay:300,single:!0,double:!1,pixelTolerance:0,dblclickTolerance:13,stopSingle:!1,stopDouble:!1,timerId:null,down:null,last:null,first:null,rightclickTimerId:null,touchstart:function(e){return this.startTouch(),this.down=this.getEventInfo(e),
this.last=this.getEventInfo(e),!0},touchmove:function(e){return this.last=this.getEventInfo(e),!0},touchend:function(e){return this.down&&(e.xy=this.last.xy,e.lastTouches=this.last.touches,this.handleSingle(e),this.down=null),!0},mousedown:function(e){return this.down=this.getEventInfo(e),this.last=this.getEventInfo(e),!0},mouseup:function(e){var t=!0;return this.checkModifiers(e)&&this.control.handleRightClicks&&OpenLayers.Event.isRightClick(e)&&(t=this.rightclick(e)),t},rightclick:function(e){if(this.passesTolerance(e)){if(null!=this.rightclickTimerId)return this.clearTimer(),this.callback("dblrightclick",[e]),!this.stopDouble;e=this.double?OpenLayers.Util.extend({},e):this.callback("rightclick",[e]),e=OpenLayers.Function.bind(this.delayedRightCall,this,e),this.rightclickTimerId=window.setTimeout(e,this.delay)}return!this.stopSingle},delayedRightCall:function(e){this.rightclickTimerId=null,e&&this.callback("rightclick",[e])},click:function(e){return this.last||(this.last=this.getEventInfo(e)),this.handleSingle(e),!this.stopSingle},dblclick:function(e){return this.handleDouble(e),!this.stopDouble},handleDouble:function(e){this.passesDblclickTolerance(e)&&(this.double&&this.callback("dblclick",[e]),this.clearTimer())},handleSingle:function(e){this.passesTolerance(e)&&(null!=this.timerId?(this.last.touches&&1===this.last.touches.length&&(this.double&&OpenLayers.Event.preventDefault(e),this.handleDouble(e)),this.last.touches&&2===this.last.touches.length||this.clearTimer()):(this.first=this.getEventInfo(e),e=this.single?OpenLayers.Util.extend({},e):null,this.queuePotentialClick(e)))},queuePotentialClick:function(e){this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,e),this.delay)},passesTolerance:function(e){var t=!0;if(null!=this.pixelTolerance&&this.down&&this.down.xy&&(t=this.pixelTolerance>=this.down.xy.distanceTo(e.xy))&&this.touch&&this.down.touches.length===this.last.touches.length){e=0;for(var n=this.down.touches.length;e<n;++e)if(this.getTouchDistance(this.down.touches[e],this.last.touches[e])>this.pixelTolerance){t=!1;break}}return t},getTouchDistance:function(e,t){return Math.sqrt(Math.pow(e.clientX-t.clientX,2)+Math.pow(e.clientY-t.clientY,2))},passesDblclickTolerance:function(e){return e=!0,this.down&&this.first&&(e=this.down.xy.distanceTo(this.first.xy)<=this.dblclickTolerance),e},clearTimer:function(){null!=this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null),null!=this.rightclickTimerId&&(window.clearTimeout(this.rightclickTimerId),this.rightclickTimerId=null)},delayedCall:function(e){this.timerId=null,e&&this.callback("click",[e])},getEventInfo:function(e){var t;if(e.touches){var n=e.touches.length;t=Array(n);for(var i,r=0;r<n;r++)i=e.touches[r],t[r]={clientX:i.olClientX,clientY:i.olClientY}}return{xy:e.xy,touches:t}},deactivate:function(){var e=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.clearTimer(),this.last=this.first=this.down=null,e=!0),e},CLASS_NAME:"OpenLayers.Handler.Click"});OpenLayers.Control.Navigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,documentDrag:!1,zoomBox:null,zoomBoxEnabled:!0,zoomWheelEnabled:!0,mouseWheelOptions:null,handleRightClicks:!1,zoomBoxKeyMask:OpenLayers.Handler.MOD_SHIFT,autoActivate:!0,initialize:function(e){this.handlers={},OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate(),this.dragPan&&this.dragPan.destroy(),this.dragPan=null,this.zoomBox&&this.zoomBox.destroy(),this.zoomBox=null,this.pinchZoom&&this.pinchZoom.destroy(),this.pinchZoom=null,OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return this.dragPan.activate(),this.zoomWheelEnabled&&this.handlers.wheel.activate(),this.handlers.click.activate(),this.zoomBoxEnabled&&this.zoomBox.activate(),this.pinchZoom&&this.pinchZoom.activate(),OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.pinchZoom&&this.pinchZoom.deactivate(),this.zoomBox.deactivate(),this.dragPan.deactivate(),this.handlers.click.deactivate(),this.handlers.wheel.deactivate(),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},draw:function(){this.handleRightClicks&&(this.map.viewPortDiv.oncontextmenu=OpenLayers.Function.False),this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.defaultClick,dblclick:this.defaultDblClick,dblrightclick:this.defaultDblRightClick},{double:!0,stopDouble:!0}),this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions)),this.zoomBox=new OpenLayers.Control.ZoomBox({map:this.map,keyMask:this.zoomBoxKeyMask}),this.dragPan.draw(),this.zoomBox.draw(),this.handlers.wheel=new OpenLayers.Handler.MouseWheel(this,{up:this.wheelUp,down:this.wheelDown},OpenLayers.Util.extend(this.map.fractionalZoom?{}:{cumulative:!1,interval:50,maxDelta:6},this.mouseWheelOptions)),OpenLayers.Control.PinchZoom&&(this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},this.pinchZoomOptions)))},defaultClick:function(e){e.lastTouches&&2==e.lastTouches.length&&this.map.zoomOut()},defaultDblClick:function(e){this.map.zoomTo(this.map.zoom+1,e.xy)},defaultDblRightClick:function(e){this.map.zoomTo(this.map.zoom-1,e.xy)},wheelChange:function(e,t){this.map.fractionalZoom||(t=Math.round(t));var n,i=this.map.getZoom();n=Math.max(i+t,0),n=Math.min(n,this.map.getNumZoomLevels()),n!==i&&this.map.zoomTo(n,e.xy)},wheelUp:function(e,t){this.wheelChange(e,t||1)},wheelDown:function(e,t){this.wheelChange(e,t||-1)},disableZoomBox:function(){this.zoomBoxEnabled=!1,this.zoomBox.deactivate()},enableZoomBox:function(){this.zoomBoxEnabled=!0,this.active&&this.zoomBox.activate()},disableZoomWheel:function(){this.zoomWheelEnabled=!1,this.handlers.wheel.deactivate()},enableZoomWheel:function(){this.zoomWheelEnabled=!0,this.active&&this.handlers.wheel.activate()},CLASS_NAME:"OpenLayers.Control.Navigation"}),OpenLayers.Handler.Keyboard=OpenLayers.Class(OpenLayers.Handler,{KEY_EVENTS:["keydown","keyup"],eventListener:null,observeElement:null,initialize:function(e,t,n){OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.eventListener=OpenLayers.Function.bindAsEventListener(this.handleKeyEvent,this)},destroy:function(){this.deactivate(),this.eventListener=null,OpenLayers.Handler.prototype.destroy.apply(this,arguments)},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.observeElement=this.observeElement||document;for(var e=0,t=this.KEY_EVENTS.length;e<t;e++)OpenLayers.Event.observe(this.observeElement,this.KEY_EVENTS[e],this.eventListener);return!0}return!1},deactivate:function(){var e=!1;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){for(var e=0,t=this.KEY_EVENTS.length;e<t;e++)OpenLayers.Event.stopObserving(this.observeElement,this.KEY_EVENTS[e],this.eventListener);e=!0}return e},handleKeyEvent:function(e){this.checkModifiers(e)&&this.callback(e.type,[e])},CLASS_NAME:"OpenLayers.Handler.Keyboard"}),OpenLayers.Control.KeyboardDefaults=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,slideFactor:75,observeElement:null,draw:function(){this.handler=new OpenLayers.Handler.Keyboard(this,{keydown:this.defaultKeyPress},{observeElement:this.observeElement||document})},defaultKeyPress:function(e){var t,n=!0;if(t=OpenLayers.Event.element(e),!t||"INPUT"!=t.tagName&&"TEXTAREA"!=t.tagName&&"SELECT"!=t.tagName){switch(e.keyCode){case OpenLayers.Event.KEY_LEFT:this.map.pan(-this.slideFactor,0);break;case OpenLayers.Event.KEY_RIGHT:this.map.pan(this.slideFactor,0);break;case OpenLayers.Event.KEY_UP:this.map.pan(0,-this.slideFactor);break;case OpenLayers.Event.KEY_DOWN:this.map.pan(0,this.slideFactor);break;case 33:t=this.map.getSize(),this.map.pan(0,-.75*t.h);break;case 34:t=this.map.getSize(),this.map.pan(0,.75*t.h);break;case 35:t=this.map.getSize(),this.map.pan(.75*t.w,0);break;case 36:t=this.map.getSize(),this.map.pan(-.75*t.w,0);break;case 43:case 61:case 187:case 107:this.map.zoomIn();break;case 45:case 109:case 189:case 95:this.map.zoomOut();break;default:n=!1}n&&OpenLayers.Event.stop(e)}},CLASS_NAME:"OpenLayers.Control.KeyboardDefaults"}),OpenLayers.Control.Measure=OpenLayers.Class(OpenLayers.Control,{callbacks:null,displaySystem:"metric",geodesic:!1,displaySystemUnits:{geographic:["dd"],english:["mi","ft","in"],metric:["km","m"]},partialDelay:300,delayedTrigger:null,persist:!1,immediate:!1,initialize:function(e,t){OpenLayers.Control.prototype.initialize.apply(this,[t]);var n={done:this.measureComplete,point:this.measurePartial};this.immediate&&(n.modify=this.measureImmediate),this.callbacks=OpenLayers.Util.extend(n,this.callbacks),this.handlerOptions=OpenLayers.Util.extend({persist:this.persist},this.handlerOptions),this.handler=new e(this,this.callbacks,this.handlerOptions)},deactivate:function(){return this.cancelDelay(),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},cancel:function(){this.cancelDelay(),this.handler.cancel()},setImmediate:function(e){(this.immediate=e)?this.callbacks.modify=this.measureImmediate:delete this.callbacks.modify},updateHandler:function(e,t){var n=this.active;n&&this.deactivate(),this.handler=new e(this,this.callbacks,t),n&&this.activate()},measureComplete:function(e){this.cancelDelay(),this.measure(e,"measure")},measurePartial:function(e,t){this.cancelDelay(),t=t.clone(),this.handler.freehandMode(this.handler.evt)?this.measure(t,"measurepartial"):this.delayedTrigger=window.setTimeout(OpenLayers.Function.bind(function(){this.delayedTrigger=null,this.measure(t,"measurepartial")},this),this.partialDelay)},measureImmediate:function(e,t,n){n&&!this.handler.freehandMode(this.handler.evt)&&(this.cancelDelay(),this.measure(t.geometry,"measurepartial"))},cancelDelay:function(){null!==this.delayedTrigger&&(window.clearTimeout(this.delayedTrigger),this.delayedTrigger=null)},measure:function(e,t){var n,i;-1<e.CLASS_NAME.indexOf("LineString")?(n=this.getBestLength(e),i=1):(n=this.getBestArea(e),i=2),this.events.triggerEvent(t,{measure:n[0],units:n[1],order:i,geometry:e})},getBestArea:function(e){for(var t,n,i=this.displaySystemUnits[this.displaySystem],r=0,s=i.length;r<s&&(t=i[r],n=this.getArea(e,t),!(1<n));++r);return[n,t]},getArea:function(e,t){var n,i;this.geodesic?(n=e.getGeodesicArea(this.map.getProjectionObject()),i="m"):(n=e.getArea(),i=this.map.getUnits());var r=OpenLayers.INCHES_PER_UNIT[t];return r&&(n*=Math.pow(OpenLayers.INCHES_PER_UNIT[i]/r,2)),n},getBestLength:function(e){for(var t,n,i=this.displaySystemUnits[this.displaySystem],r=0,s=i.length;r<s&&(t=i[r],n=this.getLength(e,t),!(1<n));++r);return[n,t]},getLength:function(e,t){var n,i;this.geodesic?(n=e.getGeodesicLength(this.map.getProjectionObject()),i="m"):(n=e.getLength(),i=this.map.getUnits());var r=OpenLayers.INCHES_PER_UNIT[t];return r&&(n*=OpenLayers.INCHES_PER_UNIT[i]/r),n},CLASS_NAME:"OpenLayers.Control.Measure"}),OpenLayers.Control.LayerSwitcher=OpenLayers.Class(OpenLayers.Control,{layerStates:null,layersDiv:null,baseLayersDiv:null,baseLayers:null,dataLbl:null,dataLayersDiv:null,dataLayers:null,structuresCollapsed:!1,visionCollapsed:!1,minimizeDiv:null,maximizeDiv:null,ascending:!0,initialize:function(e){OpenLayers.Control.prototype.initialize.apply(this,arguments),this.events.fallThrough=!1,this.layerStates=[]},destroy:function(){this.clearLayersArray("base"),this.clearLayersArray("data"),this.map.events.un({buttonclick:this.onButtonClick,addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this}),this.events.unregister("buttonclick",this,this.onButtonClick),OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(e){OpenLayers.Control.prototype.setMap.apply(this,arguments),this.map.events.on({addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this}),this.outsideViewport?(this.events.attachToElement(this.div),this.events.register("buttonclick",this,this.onButtonClick)):this.map.events.register("buttonclick",this,this.onButtonClick)},draw:function(){return OpenLayers.Control.prototype.draw.apply(this),this.loadContents(),this.outsideViewport||this.minimizeControl(),this.redraw(),this.div},onButtonClick:function(e){e=e.buttonElement,e===this.minimizeDiv?this.minimizeControl():e===this.maximizeDiv?(this.maximizeControl(),this.isSmallScreen()&&this.onMaximizeWhenSmallScreen()):e._layerSwitcher===this.id&&(e.for&&(e=document.getElementById(e.for)),e.disabled||("radio"==e.type?(e.checked=!0,this.map.setBaseLayer(this.map.getLayer(e._layer))):(e.checked=!e.checked,this.updateMap())))},clearLayersArray:function(e){this[e+"LayersDiv"].innerHTML="",this[e+"Layers"]=[]},checkRedraw:function(){if(!this.layerStates.length||this.map.layers.length!=this.layerStates.length)return!0;for(var e=0,t=this.layerStates.length;e<t;e++){var n=this.layerStates[e],i=this.map.layers[e];if(n.name!=i.name||n.inRange!=i.inRange||n.id!=i.id||n.visibility!=i.visibility)return!0}return!1},toggleStructuresGroup:function(e){OpenLayers.Element.toggleClass(this.structuresElem,"collapsed"),OpenLayers.Element.hasClass(this.structuresElem,"collapsed")?(this.structuresHeader.innerHTML="+ Structures",this.structuresCollapsed=!0):(this.structuresHeader.innerHTML="&ndash; Structures",this.structuresCollapsed=!1),OpenLayers.Event.stop(e)},toggleVisionGroup:function(e){OpenLayers.Element.toggleClass(this.visionElem,"collapsed"),OpenLayers.Element.hasClass(this.visionElem,"collapsed")?(this.visionHeader.innerHTML="+ Vision",this.visionCollapsed=!0):(this.visionHeader.innerHTML="&ndash; Vision",this.visionCollapsed=!1),OpenLayers.Event.stop(e)},redraw:function(){if(!this.checkRedraw())return this.div;this.clearLayersArray("base"),this.clearLayersArray("data");var e=!1,t=!1,n=this.map.layers.length;this.layerStates=Array(n);for(var i=0;i<n;i++){var r=this.map.layers[i];this.layerStates[i]={name:r.name,visibility:r.visibility,inRange:r.inRange,id:r.id}}var s=this.map.layers.slice();for(this.ascending||s.reverse(),this.visionElem=document.createElement("li"),OpenLayers.Element.addClass(this.visionElem,"olButton"),this.visionHeader=document.createElement("div"),this.visionHeader.innerHTML="&ndash; Vision",OpenLayers.Element.addClass(this.visionHeader,"header"),this.visionElem.appendChild(this.visionHeader),this.visionList=document.createElement("ul"),this.visionElem.appendChild(this.visionList),this.dataLayersDiv.appendChild(this.visionElem),this.visionCollapsed&&(OpenLayers.Element.addClass(this.visionElem,"collapsed"),this.visionHeader.innerHTML="+ Vision"),this.visionHeader.addEventListener("click",this.toggleVisionGroup.bind(this),!1),this.visionHeader.addEventListener("touchend",this.toggleVisionGroup.bind(this),!1),this.structuresElem=document.createElement("li"),OpenLayers.Element.addClass(this.structuresElem,"olButton"),this.structuresHeader=document.createElement("div"),this.structuresHeader.innerHTML="&ndash; Structures",OpenLayers.Element.addClass(this.structuresHeader,"header"),this.structuresElem.appendChild(this.structuresHeader),this.structuresList=document.createElement("ul"),this.structuresElem.appendChild(this.structuresList),this.dataLayersDiv.appendChild(this.structuresElem),this.structuresCollapsed&&(OpenLayers.Element.addClass(this.structuresElem,"collapsed"),this.structuresHeader.innerHTML="+ Structures"),this.structuresHeader.addEventListener("click",this.toggleStructuresGroup.bind(this),!1),this.structuresHeader.addEventListener("touchend",this.toggleStructuresGroup.bind(this),!1),i=0,n=s.length;i<n;i++){var r=s[i],a=r.isBaseLayer;if(r.displayInLayerSwitcher){a?t=!0:e=!0;var o=a?r==this.map.baseLayer:r.getVisibility(),l=document.createElement("input"),h=OpenLayers.Util.createUniqueID(this.id+"_input_");l.id=h,l.name=a?this.id+"_baseLayers":r.name,l.type=a?"radio":"checkbox",l.value=r.name,l.checked=o,l.defaultChecked=o,l.className="olButton",l._layer=r.id,l._layerSwitcher=this.id,a||r.inRange||(l.disabled=!0),o=document.createElement("label"),o.for=l.id,OpenLayers.Element.addClass(o,"labelSpan olButton"),o._layer=r.id,o._layerSwitcher=this.id,a||r.inRange||(o.style.color="gray"),o.innerHTML=r.name,o.insertBefore(l,o.firstChild);var u=document.createElement("ul"),h=a?this.baseLayers:this.dataLayers;if(h.push({layer:r,inputElem:l,labelSpan:o,subLayersElem:u,subLayers:[]}),l=a?this.baseLayersDiv:this.dataLayersDiv,a=document.createElement("li"),a.appendChild(o),this.overlayGrouping[r.name])if("Structures"==this.overlayGrouping[r.name])this.structuresList.appendChild(a);else if("Vision"==this.overlayGrouping[r.name])this.visionList.appendChild(a);else{var p=this.map.getLayersByName(this.overlayGrouping[r.name])[0];p?(r=h.filter(function(e){return p.name===e.layer.name})[0],0===r.subLayers.length&&r.labelSpan.appendChild(r.subLayersElem),r.subLayersElem.appendChild(a)):l.insertBefore(a,l.firstChild)}else l.insertBefore(a,l.firstChild)}}return this.dataLbl.style.display=e?"":"none",this.baseLbl.style.display=t?"":"none",this.div},updateMap:function(){for(var e=0,t=this.baseLayers.length;e<t;e++){var n=this.baseLayers[e];n.inputElem.checked&&this.map.setBaseLayer(n.layer,!1)}for(e=0,t=this.dataLayers.length;e<t;e++)n=this.dataLayers[e],n.layer.setVisibility(n.inputElem.checked)},maximizeControl:function(e){this.div.style.width="",this.div.style.height="",this.showControls(!1),null!=e&&OpenLayers.Event.stop(e)},isSmallScreen:function(){return 768>=(0<window.innerWidth?window.innerWidth:screen.width)},minimizeControl:function(e){this.div.style.width="0px",this.div.style.height="0px",this.showControls(!0),null!=e&&OpenLayers.Event.stop(e)},showControls:function(e){this.maximizeDiv.style.display=e?"":"none",this.minimizeDiv.style.display=e?"none":"",this.layersDiv.style.display=e?"none":""},loadContents:function(){this.layersDiv=document.createElement("div"),this.layersDiv.id=this.id+"_layersDiv",OpenLayers.Element.addClass(this.layersDiv,"layersDiv"),OpenLayers.Element.addClass(this.layersDiv,"olButton"),this.baseLbl=document.createElement("div"),this.baseLbl.innerHTML=OpenLayers.i18n("Base Layer"),OpenLayers.Element.addClass(this.baseLbl,"baseLbl"),this.baseLayersDiv=document.createElement("ul"),OpenLayers.Element.addClass(this.baseLayersDiv,"controls-list baseLayersDiv right"),this.dataLbl=document.createElement("div"),this.dataLbl.innerHTML=OpenLayers.i18n("Overlays"),OpenLayers.Element.addClass(this.dataLbl,"dataLbl"),this.dataLayersDiv=document.createElement("ul"),OpenLayers.Element.addClass(this.dataLayersDiv,"controls-list right"),this.ascending?(this.layersDiv.appendChild(this.baseLbl),this.layersDiv.appendChild(this.baseLayersDiv),this.layersDiv.appendChild(this.dataLbl),this.layersDiv.appendChild(this.dataLayersDiv)):(this.layersDiv.appendChild(this.dataLbl),this.layersDiv.appendChild(this.dataLayersDiv),this.layersDiv.appendChild(this.baseLbl),this.layersDiv.appendChild(this.baseLayersDiv)),this.div.appendChild(this.layersDiv),this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MaximizeDiv",null,null,null,"absolute"),OpenLayers.Element.addClass(this.maximizeDiv,"maximizeDiv olButton"),this.maximizeDiv.style.display="none",this.div.appendChild(this.maximizeDiv),this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MinimizeDiv",null,null,null,"absolute"),OpenLayers.Element.addClass(this.minimizeDiv,"minimizeDiv olButton"),this.minimizeDiv.style.display="none",this.maximizeDiv.innerHTML="&equiv;",this.minimizeDiv.innerHTML="&times;",this.div.appendChild(this.minimizeDiv)},CLASS_NAME:"OpenLayers.Control.LayerSwitcher"}),OpenLayers.Handler.Pinch=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!1,pinching:!1,last:null,start:null,touchstart:function(e){var t=!0;if(this.pinching=!1,OpenLayers.Event.isMultiTouch(e))this.started=!0,this.last=this.start={distance:this.getDistance(e.touches),delta:0,scale:1},this.callback("start",[e,this.start]),t=!this.stopDown;else{if(this.started)return!1;this.started=!1,this.last=this.start=null}return OpenLayers.Event.preventDefault(e),t},touchmove:function(e){if(this.started&&OpenLayers.Event.isMultiTouch(e)){this.pinching=!0;var t=this.getPinchData(e);this.callback("move",[e,t]),this.last=t,OpenLayers.Event.stop(e)}else if(this.started)return!1;return!0},touchend:function(e){return!(this.started&&!OpenLayers.Event.isMultiTouch(e))||(this.pinching=this.started=!1,this.callback("done",[e,this.start,this.last]),this.last=this.start=null,!1)},activate:function(){var e=!1;return OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.pinching=!1,e=!0),e},deactivate:function(){var e=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.pinching=this.started=!1,this.last=this.start=null,e=!0),e},getDistance:function(e){var t=e[0];return e=e[1],Math.sqrt(Math.pow(t.olClientX-e.olClientX,2)+Math.pow(t.olClientY-e.olClientY,2))},getPinchData:function(e){return e=this.getDistance(e.touches),{distance:e,delta:this.last.distance-e,scale:e/this.start.distance}},CLASS_NAME:"OpenLayers.Handler.Pinch"}),OpenLayers.Control.PinchZoom=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,pinchOrigin:null,currentCenter:null,autoActivate:!0,preserveCenter:!1,initialize:function(e){OpenLayers.Control.prototype.initialize.apply(this,arguments),this.handler=new OpenLayers.Handler.Pinch(this,{start:this.pinchStart,move:this.pinchMove,done:this.pinchDone},this.handlerOptions)},pinchStart:function(e,t){var n=this.preserveCenter?this.map.getPixelFromLonLat(this.map.getCenter()):e.xy;this.currentCenter=this.pinchOrigin=n},pinchMove:function(e,t){var n=t.scale,i=this.map.layerContainerOriginPx,r=this.pinchOrigin,s=this.preserveCenter?this.map.getPixelFromLonLat(this.map.getCenter()):e.xy;this.map.applyTransform(Math.round(i.x+s.x-r.x+(n-1)*(i.x-r.x)),Math.round(i.y+s.y-r.y+(n-1)*(i.y-r.y)),n),this.currentCenter=s},pinchDone:function(e,t,n){if(this.map.applyTransform(),e=this.map.getZoomForResolution(this.map.getResolution()/n.scale,!0),e!==this.map.getZoom()||!this.currentCenter.equals(this.pinchOrigin)){t=this.map.getResolutionForZoom(e),n=this.map.getLonLatFromPixel(this.pinchOrigin);var i=this.currentCenter,r=this.map.getSize();n.lon+=t*(r.w/2-i.x),n.lat-=t*(r.h/2-i.y),this.map.div.clientWidth=this.map.div.clientWidth,this.map.setCenter(n,e)}},CLASS_NAME:"OpenLayers.Control.PinchZoom"}),OpenLayers.Control.TouchNavigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,clickHandlerOptions:null,documentDrag:!1,autoActivate:!0,initialize:function(e){this.handlers={},OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate(),this.dragPan&&this.dragPan.destroy(),this.dragPan=null,this.pinchZoom&&(this.pinchZoom.destroy(),delete this.pinchZoom),OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return!!OpenLayers.Control.prototype.activate.apply(this,arguments)&&(this.dragPan.activate(),this.handlers.click.activate(),this.pinchZoom.activate(),!0)},deactivate:function(){return!!OpenLayers.Control.prototype.deactivate.apply(this,arguments)&&(this.dragPan.deactivate(),this.handlers.click.deactivate(),this.pinchZoom.deactivate(),!0)},draw:function(){var e={click:this.defaultClick,dblclick:this.defaultDblClick},t=OpenLayers.Util.extend({double:!0,stopDouble:!0,pixelTolerance:2},this.clickHandlerOptions);this.handlers.click=new OpenLayers.Handler.Click(this,e,t),this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions)),this.dragPan.draw(),this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},this.pinchZoomOptions))},defaultClick:function(e){e.lastTouches&&2==e.lastTouches.length&&this.map.zoomOut()},defaultDblClick:function(e){this.map.zoomTo(this.map.zoom+1,e.xy)},CLASS_NAME:"OpenLayers.Control.TouchNavigation"}),OpenLayers.Strategy=OpenLayers.Class({layer:null,options:null,active:null,autoActivate:!0,autoDestroy:!0,initialize:function(e){OpenLayers.Util.extend(this,e),this.options=e,this.active=!1},destroy:function(){this.deactivate(),this.options=this.layer=null},setLayer:function(e){this.layer=e},activate:function(){return!this.active&&(this.active=!0)},deactivate:function(){return!!this.active&&(this.active=!1,!0)},CLASS_NAME:"OpenLayers.Strategy"}),OpenLayers.Strategy.Fixed=OpenLayers.Class(OpenLayers.Strategy,{preload:!1,activate:function(){var e=OpenLayers.Strategy.prototype.activate.apply(this,arguments);return e&&(this.layer.events.on({refresh:this.load,scope:this}),1==this.layer.visibility||this.preload?this.load():this.layer.events.on({visibilitychanged:this.load,scope:this})),e},deactivate:function(){var e=OpenLayers.Strategy.prototype.deactivate.call(this);return e&&this.layer.events.un({refresh:this.load,visibilitychanged:this.load,scope:this}),e},load:function(e){var t=this.layer;t.events.triggerEvent("loadstart",{filter:t.filter}),t.protocol.read(OpenLayers.Util.applyDefaults({callback:this.merge,filter:t.filter,scope:this},e)),t.events.un({visibilitychanged:this.load,scope:this})},merge:function(e){var t=this.layer;t.destroyFeatures();var n=e.features;if(n&&0<n.length){var i=t.projection,r=t.map.getProjectionObject();if(!r.equals(i))for(var s,a=0,o=n.length;a<o;++a)(s=n[a].geometry)&&s.transform(i,r);t.addFeatures(n)}t.events.triggerEvent("loadend",{response:e})},CLASS_NAME:"OpenLayers.Strategy.Fixed"}),OpenLayers.Handler.Point=OpenLayers.Class(OpenLayers.Handler,{point:null,layer:null,multi:!1,citeCompliant:!1,mouseDown:!1,stoppedDown:null,lastDown:null,lastUp:null,persist:!1,stopDown:!1,stopUp:!1,layerOptions:null,pixelTolerance:5,lastTouchPx:null,initialize:function(e,t,n){n&&n.layerOptions&&n.layerOptions.styleMap||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style.default,{})),OpenLayers.Handler.prototype.initialize.apply(this,arguments)},activate:function(){if(!OpenLayers.Handler.prototype.activate.apply(this,arguments))return!1;var e=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions);return this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,e),this.map.addLayer(this.layer),!0},createFeature:function(e){e=this.layer.getLonLatFromViewPortPx(e),e=new OpenLayers.Geometry.Point(e.lon,e.lat),this.point=new OpenLayers.Feature.Vector(e),this.callback("create",[this.point.geometry,this.point]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.point],{silent:!0})},deactivate:function(){return!!OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.cancel(),null!=this.layer.map&&(this.destroyFeature(!0),this.layer.destroy(!1)),this.layer=null,!0)},destroyFeature:function(e){!this.layer||!e&&this.persist||this.layer.destroyFeatures(),this.point=null},destroyPersistedFeature:function(){var e=this.layer;e&&1<e.features.length&&this.layer.features[0].destroy()},finalize:function(e){this.mouseDown=!1,this.lastTouchPx=this.lastUp=this.lastDown=null,this.callback(e?"cancel":"done",[this.geometryClone()]),this.destroyFeature(e)},cancel:function(){this.finalize(!0)},click:function(e){return OpenLayers.Event.stop(e),!1},dblclick:function(e){return OpenLayers.Event.stop(e),!1},modifyFeature:function(e){this.point||this.createFeature(e),e=this.layer.getLonLatFromViewPortPx(e),this.point.geometry.x=e.lon,this.point.geometry.y=e.lat,this.callback("modify",[this.point.geometry,this.point,!1]),this.point.geometry.clearBounds(),this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.point,this.style)},getGeometry:function(){var e=this.point&&this.point.geometry;return e&&this.multi&&(e=new OpenLayers.Geometry.MultiPoint([e])),e},geometryClone:function(){var e=this.getGeometry();return e&&e.clone()},mousedown:function(e){return this.down(e)},touchstart:function(e){return this.startTouch(),this.lastTouchPx=e.xy,this.down(e)},mousemove:function(e){return this.move(e)},touchmove:function(e){return this.lastTouchPx=e.xy,this.move(e)},mouseup:function(e){return this.up(e)},touchend:function(e){return e.xy=this.lastTouchPx,this.up(e)},down:function(e){return this.mouseDown=!0,this.lastDown=e.xy,this.touch||this.modifyFeature(e.xy),this.stoppedDown=this.stopDown,!this.stopDown},move:function(e){return this.touch||this.mouseDown&&!this.stoppedDown||this.modifyFeature(e.xy),!0},up:function(e){return this.mouseDown=!1,this.stoppedDown=this.stopDown,!(!(!this.checkModifiers(e)||this.lastUp&&this.lastUp.equals(e.xy))&&this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance))||(this.touch&&this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=e.xy,this.finalize(),!this.stopUp)},mouseout:function(e){OpenLayers.Util.mouseLeft(e,this.map.viewPortDiv)&&(this.stoppedDown=this.stopDown,this.mouseDown=!1)},passesTolerance:function(e,t,n){var i=!0;return null!=n&&e&&t&&e.distanceTo(t)>n&&(i=!1),i},CLASS_NAME:"OpenLayers.Handler.Point"}),OpenLayers.Handler.Path=OpenLayers.Class(OpenLayers.Handler.Point,{line:null,maxVertices:null,doubleTouchTolerance:20,freehand:!1,freehandToggle:"shiftKey",timerId:null,redoStack:null,createFeature:function(e){e=this.layer.getLonLatFromViewPortPx(e),e=new OpenLayers.Geometry.Point(e.lon,e.lat),this.point=new OpenLayers.Feature.Vector(e),this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([this.point.geometry])),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.line,this.point],{silent:!0})},destroyFeature:function(e){OpenLayers.Handler.Point.prototype.destroyFeature.call(this,e),this.line=null},destroyPersistedFeature:function(){var e=this.layer;e&&2<e.features.length&&this.layer.features[0].destroy()},removePoint:function(){this.point&&this.layer.removeFeatures([this.point])},addPoint:function(e){this.layer.removeFeatures([this.point]),e=this.layer.getLonLatFromViewPortPx(e),this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(e.lon,e.lat)),this.line.geometry.addComponent(this.point.geometry,this.line.geometry.components.length),this.layer.addFeatures([this.point]),this.callback("point",[this.point.geometry,this.getGeometry()]),this.callback("modify",[this.point.geometry,this.getSketch()]),this.drawFeature(),delete this.redoStack},insertXY:function(e,t){this.line.geometry.addComponent(new OpenLayers.Geometry.Point(e,t),this.getCurrentPointIndex()),this.drawFeature(),delete this.redoStack},insertDeltaXY:function(e,t){var n=this.getCurrentPointIndex()-1,n=this.line.geometry.components[n];!n||isNaN(n.x)||isNaN(n.y)||this.insertXY(n.x+e,n.y+t)},insertDirectionLength:function(e,t){e*=Math.PI/180,this.insertDeltaXY(t*Math.cos(e),t*Math.sin(e))},insertDeflectionLength:function(e,t){var n=this.getCurrentPointIndex()-1;if(0<n){var i=this.line.geometry.components[n],n=this.line.geometry.components[n-1];this.insertDirectionLength(180*Math.atan2(i.y-n.y,i.x-n.x)/Math.PI+e,t)}},getCurrentPointIndex:function(){return this.line.geometry.components.length-1},undo:function(){var e=this.line.geometry,t=e.components,n=this.getCurrentPointIndex()-1,i=t[n],r=e.removeComponent(i);return r&&(this.touch&&0<n&&(t=e.components,e=t[n-1],n=this.getCurrentPointIndex(),t=t[n],t.x=e.x,t.y=e.y),this.redoStack||(this.redoStack=[]),this.redoStack.push(i),this.drawFeature()),r},redo:function(){var e=this.redoStack&&this.redoStack.pop();return e&&(this.line.geometry.addComponent(e,this.getCurrentPointIndex()),this.drawFeature()),!!e},freehandMode:function(e){return this.freehandToggle&&e[this.freehandToggle]?!this.freehand:this.freehand},modifyFeature:function(e,t){this.line||this.createFeature(e);var n=this.layer.getLonLatFromViewPortPx(e);this.point.geometry.x=n.lon,this.point.geometry.y=n.lat,
this.callback("modify",[this.point.geometry,this.getSketch(),t]),this.point.geometry.clearBounds(),this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.line,this.style),this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.line},getGeometry:function(){var e=this.line&&this.line.geometry;return e&&this.multi&&(e=new OpenLayers.Geometry.MultiLineString([e])),e},touchstart:function(e){return this.timerId&&this.passesTolerance(this.lastTouchPx,e.xy,this.doubleTouchTolerance)?(this.finishGeometry(),window.clearTimeout(this.timerId),this.timerId=null,!1):(this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null),this.timerId=window.setTimeout(OpenLayers.Function.bind(function(){this.timerId=null},this),300),OpenLayers.Handler.Point.prototype.touchstart.call(this,e))},down:function(e){var t=this.stopDown;return this.freehandMode(e)&&(t=!0,this.touch&&(this.modifyFeature(e.xy,!!this.lastUp),OpenLayers.Event.stop(e))),this.touch||this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)||this.modifyFeature(e.xy,!!this.lastUp),this.mouseDown=!0,this.lastDown=e.xy,this.stoppedDown=t,!t},move:function(e){return this.stoppedDown&&this.freehandMode(e)?(this.persist&&this.destroyPersistedFeature(),this.maxVertices&&this.line&&this.line.geometry.components.length===this.maxVertices?(this.removePoint(),this.finalize()):this.addPoint(e.xy),!1):(this.touch||this.mouseDown&&!this.stoppedDown||this.modifyFeature(e.xy,!!this.lastUp),!0)},up:function(e){return!this.mouseDown||this.lastUp&&this.lastUp.equals(e.xy)||(this.stoppedDown&&this.freehandMode(e)?(this.persist&&this.destroyPersistedFeature(),this.removePoint(),this.finalize()):this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(e.xy),null==this.lastUp&&this.persist&&this.destroyPersistedFeature(),this.addPoint(e.xy),this.lastUp=e.xy,this.line.geometry.components.length===this.maxVertices+1&&this.finishGeometry())),this.stoppedDown=this.stopDown,this.mouseDown=!1,!this.stopUp},finishGeometry:function(){this.line.geometry.removeComponent(this.line.geometry.components[this.line.geometry.components.length-1]),this.removePoint(),this.finalize()},dblclick:function(e){return this.freehandMode(e)||this.finishGeometry(),!1},CLASS_NAME:"OpenLayers.Handler.Path"}),OpenLayers.Handler.Polygon=OpenLayers.Class(OpenLayers.Handler.Path,{holeModifier:null,drawingHole:!1,polygon:null,createFeature:function(e){e=this.layer.getLonLatFromViewPortPx(e),e=new OpenLayers.Geometry.Point(e.lon,e.lat),this.point=new OpenLayers.Feature.Vector(e),this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LinearRing([this.point.geometry])),this.polygon=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([this.line.geometry])),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.polygon,this.point],{silent:!0})},addPoint:function(e){if(!this.drawingHole&&this.holeModifier&&this.evt&&this.evt[this.holeModifier])for(var t,n=this.point.geometry,i=this.control.layer.features,r=i.length-1;0<=r;--r)if(t=i[r].geometry,(t instanceof OpenLayers.Geometry.Polygon||t instanceof OpenLayers.Geometry.MultiPolygon)&&t.intersects(n)){n=i[r],this.control.layer.removeFeatures([n],{silent:!0}),this.control.layer.events.registerPriority("sketchcomplete",this,this.finalizeInteriorRing),this.control.layer.events.registerPriority("sketchmodified",this,this.enforceTopology),n.geometry.addComponent(this.line.geometry),this.polygon=n,this.drawingHole=!0;break}OpenLayers.Handler.Path.prototype.addPoint.apply(this,arguments)},getCurrentPointIndex:function(){return this.line.geometry.components.length-2},enforceTopology:function(e){e=e.vertex;var t=this.line.geometry.components;this.polygon.geometry.intersects(e)||(t=t[t.length-3],e.x=t.x,e.y=t.y)},finishGeometry:function(){this.line.geometry.removeComponent(this.line.geometry.components[this.line.geometry.components.length-2]),this.removePoint(),this.finalize()},finalizeInteriorRing:function(){var e=this.line.geometry,t=0!==e.getArea();if(t){for(var n=this.polygon.geometry.components,i=n.length-2;0<=i;--i)if(e.intersects(n[i])){t=!1;break}if(t)e:for(i=n.length-2;0<i;--i)for(var r=n[i].components,s=0,a=r.length;s<a;++s)if(e.containsPoint(r[s])){t=!1;break e}}return t?this.polygon.state!==OpenLayers.State.INSERT&&(this.polygon.state=OpenLayers.State.UPDATE):this.polygon.geometry.removeComponent(e),this.restoreFeature(),!1},cancel:function(){return this.drawingHole&&(this.polygon.geometry.removeComponent(this.line.geometry),this.restoreFeature(!0)),OpenLayers.Handler.Path.prototype.cancel.apply(this,arguments)},restoreFeature:function(e){this.control.layer.events.unregister("sketchcomplete",this,this.finalizeInteriorRing),this.control.layer.events.unregister("sketchmodified",this,this.enforceTopology),this.layer.removeFeatures([this.polygon],{silent:!0}),this.control.layer.addFeatures([this.polygon],{silent:!0}),this.drawingHole=!1,e||this.control.layer.events.triggerEvent("sketchcomplete",{feature:this.polygon})},destroyFeature:function(e){OpenLayers.Handler.Path.prototype.destroyFeature.call(this,e),this.polygon=null},drawFeature:function(){this.layer.drawFeature(this.polygon,this.style),this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.polygon},getGeometry:function(){var e=this.polygon&&this.polygon.geometry;return e&&this.multi&&(e=new OpenLayers.Geometry.MultiPolygon([e])),e},CLASS_NAME:"OpenLayers.Handler.Polygon"}),OpenLayers.Handler.RegularPolygon=OpenLayers.Class(OpenLayers.Handler.Drag,{sides:4,radius:null,snapAngle:null,snapToggle:"shiftKey",layerOptions:null,persist:!1,irregular:!1,citeCompliant:!1,angle:null,fixedRadius:!1,feature:null,layer:null,origin:null,initialize:function(e,t,n){n&&n.layerOptions&&n.layerOptions.styleMap||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style.default,{})),OpenLayers.Handler.Drag.prototype.initialize.apply(this,[e,t,n]),this.options=n?n:{}},setOptions:function(e){OpenLayers.Util.extend(this.options,e),OpenLayers.Util.extend(this,e)},activate:function(){var e=!1;return OpenLayers.Handler.Drag.prototype.activate.apply(this,arguments)&&(e=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions),this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,e),this.map.addLayer(this.layer),e=!0),e},deactivate:function(){var e=!1;return OpenLayers.Handler.Drag.prototype.deactivate.apply(this,arguments)&&(this.dragging&&this.cancel(),null!=this.layer.map&&(this.layer.destroy(!1),this.feature&&this.feature.destroy()),this.feature=this.layer=null,e=!0),e},down:function(e){this.fixedRadius=!!this.radius,e=this.layer.getLonLatFromViewPortPx(e.xy),this.origin=new OpenLayers.Geometry.Point(e.lon,e.lat),this.fixedRadius&&!this.irregular||(this.radius=this.map.getResolution()),this.persist&&this.clear(),this.feature=new OpenLayers.Feature.Vector,this.createGeometry(),this.callback("create",[this.origin,this.feature]),this.layer.addFeatures([this.feature],{silent:!0}),this.layer.drawFeature(this.feature,this.style)},move:function(e){var t=this.layer.getLonLatFromViewPortPx(e.xy),t=new OpenLayers.Geometry.Point(t.lon,t.lat);this.irregular?(e=Math.sqrt(2)*Math.abs(t.y-this.origin.y)/2,this.radius=Math.max(this.map.getResolution()/2,e)):this.fixedRadius?this.origin=t:(this.calculateAngle(t,e),this.radius=Math.max(this.map.getResolution()/2,t.distanceTo(this.origin))),this.modifyGeometry(),this.irregular&&(e=t.x-this.origin.x,t=t.y-this.origin.y,this.feature.geometry.resize(1,this.origin,0==t?e/(this.radius*Math.sqrt(2)):e/t),this.feature.geometry.move(e/2,t/2)),this.layer.drawFeature(this.feature,this.style)},up:function(e){this.finalize(),this.start==this.last&&this.callback("done",[e.xy])},out:function(e){this.finalize()},createGeometry:function(){this.angle=Math.PI*(1/this.sides-.5),this.snapAngle&&(this.angle+=Math.PI/180*this.snapAngle),this.feature.geometry=OpenLayers.Geometry.Polygon.createRegularPolygon(this.origin,this.radius,this.sides,this.snapAngle)},modifyGeometry:function(){var e,t,n=this.feature.geometry.components[0];n.components.length!=this.sides+1&&(this.createGeometry(),n=this.feature.geometry.components[0]);for(var i=0;i<this.sides;++i)t=n.components[i],e=this.angle+2*i*Math.PI/this.sides,t.x=this.origin.x+this.radius*Math.cos(e),t.y=this.origin.y+this.radius*Math.sin(e),t.clearBounds()},calculateAngle:function(e,t){var n=Math.atan2(e.y-this.origin.y,e.x-this.origin.x);if(this.snapAngle&&this.snapToggle&&!t[this.snapToggle]){var i=Math.PI/180*this.snapAngle;this.angle=Math.round(n/i)*i}else this.angle=n},cancel:function(){this.callback("cancel",null),this.finalize()},finalize:function(){this.origin=null,this.radius=this.options.radius},clear:function(){this.layer&&(this.layer.renderer.clear(),this.layer.destroyFeatures())},callback:function(e,t){this.callbacks[e]&&this.callbacks[e].apply(this.control,[this.feature.geometry.clone()]),this.persist||"done"!=e&&"cancel"!=e||this.clear()},CLASS_NAME:"OpenLayers.Handler.RegularPolygon"}),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.InteractiveMap=e()}}(function(){var e;return function e(t,n,i){function r(a,o){if(!n[a]){if(!t[a]){var l="function"==typeof require&&require;if(!o&&l)return l(a,!0);if(s)return s(a,!0);var h=new Error("Cannot find module '"+a+"'");throw h.code="MODULE_NOT_FOUND",h}var u=n[a]={exports:{}};t[a][0].call(u.exports,function(e){var n=t[a][1][e];return r(n?n:e)},u,u.exports,e,t,n,i)}return n[a].exports}for(var s="function"==typeof require&&require,a=0;a<i.length;a++)r(i[a]);return r}({1:[function(t,n,i){!function(t,r){if("object"==typeof i&&"object"==typeof n)n.exports=r();else if("function"==typeof e&&e.amd)e([],r);else{var s=r();for(var a in s)("object"==typeof i?i:t)[a]=s[a]}}(this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return e[i].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){"use strict";function i(){var e="undefined"==typeof JSON?{}:JSON;r.setupJSON(e)}var r=n(2),s=n(3);i();var a=window._rollbarConfig,o=a&&a.globalAlias||"Rollbar",l=window[o]&&"undefined"!=typeof window[o].shimId;!l&&a?r.wrapper.init(a):(window.Rollbar=r.wrapper,window.RollbarNotifier=s.Notifier),e.exports=r.wrapper},function(e,t,n){"use strict";function i(e,t,n){!n[4]&&window._rollbarWrappedError&&(n[4]=window._rollbarWrappedError,window._rollbarWrappedError=null),e.uncaughtError.apply(e,n),t&&t.apply(window,n)}function r(e,t){if(t.hasOwnProperty&&t.hasOwnProperty("addEventListener")){var n=t.addEventListener;t.addEventListener=function(t,i,r){n.call(this,t,e.wrap(i),r)};var i=t.removeEventListener;t.removeEventListener=function(e,t,n){i.call(this,e,t&&t._wrapped||t,n)}}}var s=n(3),a=n(8),o=s.Notifier;window._rollbarWrappedError=null;var l={};l.init=function(e,t){var n=new o(t);if(n.configure(e),e.captureUncaught){var s;t&&a.isType(t._rollbarOldOnError,"function")?s=t._rollbarOldOnError:window.onerror&&!window.onerror.belongsToShim&&(s=window.onerror),window.onerror=function(){var e=Array.prototype.slice.call(arguments,0);i(n,s,e)};var l,h,u=["EventTarget","Window","Node","ApplicationCache","AudioTrackList","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"];for(l=0;l<u.length;++l)h=u[l],window[h]&&window[h].prototype&&r(n,window[h].prototype)}return e.captureUnhandledRejections&&(t&&a.isType(t._unhandledRejectionHandler,"function")&&window.removeEventListener("unhandledrejection",t._unhandledRejectionHandler),n._unhandledRejectionHandler=function(e){var t=e.reason,i=e.promise,r=e.detail;!t&&r&&(t=r.reason,i=r.promise),n.unhandledRejection(t,i)},window.addEventListener("unhandledrejection",n._unhandledRejectionHandler)),window.Rollbar=n,o.processPayloads(),n},e.exports={wrapper:l,setupJSON:s.setupJSON}},function(e,t,n){"use strict";function i(e){w=e,v.setupJSON(e)}function r(e,t){return function(){var n=t||this;try{return e.apply(n,arguments)}catch(e){}}}function s(){y||(y=setTimeout(c,1e3))}function a(){return x}function o(e){x=x||this;var t="https://"+o.DEFAULT_ENDPOINT;this.options={enabled:!0,endpoint:t,environment:"production",scrubFields:f([],o.DEFAULT_SCRUB_FIELDS),checkIgnore:null,logLevel:o.DEFAULT_LOG_LEVEL,reportLevel:o.DEFAULT_REPORT_LEVEL,uncaughtErrorLevel:o.DEFAULT_UNCAUGHT_ERROR_LEVEL,payload:{}},this.lastError=null,this.plugins={},this.parentNotifier=e,e&&(e.hasOwnProperty("shimId")?e.notifier=this:this.configure(e.options))}function l(e){window._rollbarPayloadQueue.push(e),s()}function h(e){return r(function(){var t=this._getLogArgs(arguments);return this._log(e||t.level||this.options.logLevel||o.DEFAULT_LOG_LEVEL,t.message,t.err,t.custom,t.callback)})}function u(e,t){e||(e=t?w.stringify(t):"");var n={body:e};return t&&(n.extra=f(!0,{},t)),{message:n}}function p(e,t,n){var i=m.guessErrorClass(t.message),r=t.name||i[0],s=i[1],a={exception:{class:r,message:s}};if(e&&(a.exception.description=e||"uncaught exception"),t.stack){var o,l,h,p,c,d,y,v;for(a.frames=[],y=0;y<t.stack.length;++y)o=t.stack[y],l={filename:o.url?g.sanitizeUrl(o.url):"(unknown)",lineno:o.line||null,method:o.func&&"?"!==o.func?o.func:"[anonymous]",colno:o.column},h=p=c=null,d=o.context?o.context.length:0,d&&(v=Math.floor(d/2),p=o.context.slice(0,v),h=o.context[v],c=o.context.slice(v)),h&&(l.code=h),(p||c)&&(l.context={},p&&p.length&&(l.context.pre=p),c&&c.length&&(l.context.post=c)),o.args&&(l.args=o.args),a.frames.push(l);return a.frames.reverse(),n&&(a.extra=f(!0,{},n)),{trace:a}}return u(r+": "+s,n)}function c(){var e;try{for(;e=window._rollbarPayloadQueue.shift();)d(e)}finally{y=void 0}}function d(e){var t=e.endpointUrl,n=e.accessToken,i=e.payload,r=e.callback||function(){},s=(new Date).getTime();s-b>=6e4&&(b=s,C=0);var a=window._globalRollbarOptions.maxItems,h=window._globalRollbarOptions.itemsPerMinute,u=function(){return!i.ignoreRateLimit&&a>=1&&S>=a},p=function(){return!i.ignoreRateLimit&&h>=1&&C>=h};return u()?void r(new Error(a+" max items reached")):p()?void r(new Error(h+" items per minute reached")):(S++,C++,u()&&x._log(x.options.uncaughtErrorLevel,"maxItems has been hit. Ignoring errors for the remainder of the current page load.",null,{maxItems:a},null,!1,!0),i.ignoreRateLimit&&delete i.ignoreRateLimit,void L.post(t,n,i,function(t,n){return t?(t instanceof O&&(e.callback=function(){},setTimeout(function(){l(e)},o.RETRY_DELAY)),r(t)):r(null,n)}))}var y,f=n(4),m=n(5),g=n(8),v=n(10),L=v.XHR,O=v.ConnectionError,w=null;o.NOTIFIER_VERSION="1.9.2",o.DEFAULT_ENDPOINT="api.rollbar.com/api/1/",o.DEFAULT_SCRUB_FIELDS=["pw","pass","passwd","password","secret","confirm_password","confirmPassword","password_confirmation","passwordConfirmation","access_token","accessToken","secret_key","secretKey","secretToken"],o.DEFAULT_LOG_LEVEL="debug",o.DEFAULT_REPORT_LEVEL="debug",o.DEFAULT_UNCAUGHT_ERROR_LEVEL="error",o.DEFAULT_ITEMS_PER_MIN=60,o.DEFAULT_MAX_ITEMS=0,o.LEVELS={debug:0,info:1,warning:2,error:3,critical:4},o.RETRY_DELAY=1e4,window._rollbarPayloadQueue=window._rollbarPayloadQueue||[],window._globalRollbarOptions={startTime:(new Date).getTime(),maxItems:o.DEFAULT_MAX_ITEMS,itemsPerMinute:o.DEFAULT_ITEMS_PER_MIN};var x,E=o.prototype;E._getLogArgs=function(e){for(var t,n,i,s,a,l,h=this.options.logLevel||o.DEFAULT_LOG_LEVEL,u=[],p=0;p<e.length;++p)l=e[p],a=g.typeName(l),"string"===a?t?u.push(l):t=l:"function"===a?s=r(l,this):"date"===a?u.push(l):"error"===a||l instanceof Error||"undefined"!=typeof DOMException&&l instanceof DOMException?n?u.push(l):n=l:"object"!==a&&"array"!==a||(i?u.push(l):i=l);return u.length&&(i=i||{},i.extraArgs=u),{level:h,message:t,err:n,custom:i,callback:s}},E._route=function(e){var t=this.options.endpoint,n=/\/$/.test(t),i=/^\//.test(e);return n&&i?e=e.substring(1):n||i||(e="/"+e),t+e},E._processShimQueue=function(e){for(var t,n,i,r,s,a,l,h={};n=e.shift();)t=n.shim,i=n.method,r=n.args,s=t.parentShim,l=h[t.shimId],l||(s?(a=h[s.shimId],l=new o(a)):l=this,h[t.shimId]=l),l[i]&&g.isType(l[i],"function")&&l[i].apply(l,r)},E._buildPayload=function(e,t,n,i,r){var s=this.options.accessToken,a=this.options.environment,l=f(!0,{},this.options.payload),h=g.uuid4();if(void 0===o.LEVELS[t])throw new Error("Invalid level");if(!n&&!i&&!r)throw new Error("No message, stack info or custom data");var u={environment:a,endpoint:this.options.endpoint,uuid:h,level:t,platform:"browser",framework:"browser-js",language:"javascript",body:this._buildBody(n,i,r),request:{url:window.location.href,query_string:window.location.search,user_ip:"$remote_ip"},client:{runtime_ms:e.getTime()-window._globalRollbarOptions.startTime,timestamp:Math.round(e.getTime()/1e3),javascript:{browser:window.navigator.userAgent,language:window.navigator.language,cookie_enabled:window.navigator.cookieEnabled,screen:{width:window.screen.width,height:window.screen.height},plugins:this._getBrowserPlugins()}},server:{},notifier:{name:"rollbar-browser-js",version:o.NOTIFIER_VERSION}};l.body&&delete l.body;var p={access_token:s,data:f(!0,u,l)};return this._scrub(p.data),p},E._buildBody=function(e,t,n){var i;return i=t?p(e,t,n):u(e,n)},E._getBrowserPlugins=function(){if(!this._browserPlugins){var e,t,n=window.navigator.plugins||[],i=n.length,r=[];for(t=0;t<i;++t)e=n[t],r.push({name:e.name,description:e.description});this._browserPlugins=r}return this._browserPlugins},E._scrub=function(e){function t(e,t,n,i,r,s){return t+g.redact(s)}function n(e){var n;if(g.isType(e,"string"))for(n=0;n<o.length;++n)e=e.replace(o[n],t);return e}function i(e,t){var n;for(n=0;n<a.length;++n)if(a[n].test(e)){t=g.redact(t);break}return t}function r(e,t){var r=i(e,t);return r===t?n(r):r}var s=this.options.scrubFields,a=this._getScrubFieldRegexs(s),o=this._getScrubQueryParamRegexs(s);return g.traverse(e,r),e},E._getScrubFieldRegexs=function(e){for(var t,n=[],i=0;i<e.length;++i)t="\\[?(%5[bB])?"+e[i]+"\\[?(%5[bB])?\\]?(%5[dD])?",n.push(new RegExp(t,"i"));return n},E._getScrubQueryParamRegexs=function(e){for(var t,n=[],i=0;i<e.length;++i)t="\\[?(%5[bB])?"+e[i]+"\\[?(%5[bB])?\\]?(%5[dD])?",n.push(new RegExp("("+t+"=)([^&\\n]+)","igm"));return n},E._urlIsWhitelisted=function(e){var t,n,i,r,s,a,o,l,h,u;try{if(t=this.options.hostWhiteList,n=e&&e.data&&e.data.body&&e.data.body.trace,!t||0===t.length)return!0;if(!n)return!0;for(o=t.length,s=n.frames.length,h=0;h<s;h++){if(i=n.frames[h],r=i.filename,!g.isType(r,"string"))return!0;for(u=0;u<o;u++)if(a=t[u],l=new RegExp(a),l.test(r))return!0}}catch(e){return this.configure({hostWhiteList:null}),!0}return!1},E._messageIsIgnored=function(e){var t,n,i,r,s,a,o,l,h;try{if(s=!1,i=this.options.ignoredMessages,!i||0===i.length)return!1;if(o=e&&e.data&&e.data.body,l=o&&o.trace&&o.trace.exception&&o.trace.exception.message,h=o&&o.message&&o.message.body,t=l||h,!t)return!1;for(r=i.length,n=0;n<r&&(a=new RegExp(i[n],"gi"),!(s=a.test(t)));n++);}catch(e){void this.configure({ignoredMessages:null})}return s},E._enqueuePayload=function(e,t,n,i){var r={callback:i,accessToken:this.options.accessToken,endpointUrl:this._route("item/"),payload:e},s=function(){if(i){var e="This item was not sent to Rollbar because it was ignored. This can happen if a custom checkIgnore() function was used or if the item's level was less than the notifier' reportLevel. See https://rollbar.com/docs/notifier/rollbar.js/configuration for more details.";i(null,{err:0,result:{id:null,uuid:null,message:e}})}};if(this._internalCheckIgnore(t,n,e))return void s();try{if(g.isType(this.options.checkIgnore,"function")&&this.options.checkIgnore(t,n,e))return void s()}catch(e){void this.configure({checkIgnore:null})}if(this._urlIsWhitelisted(e)&&!this._messageIsIgnored(e)){if(this.options.verbose&&e.data&&e.data.body&&e.data.body.trace){var a=e.data.body.trace;a.exception.message}g.isType(this.options.logFunction,"function")&&this.options.logFunction(r);try{g.isType(this.options.transform,"function")&&this.options.transform(e)}catch(e){void this.configure({transform:null})}this.options.enabled&&l(r)}},E._internalCheckIgnore=function(e,t,n){var i=t[0],r=o.LEVELS[i]||0,s=o.LEVELS[this.options.reportLevel]||0;if(r<s)return!0;var a=this.options?this.options.plugins:{};if(a&&a.jquery&&a.jquery.ignoreAjaxErrors)try{return!!n.data.body.message.extra.isAjax}catch(e){return!1}return!1},E._log=function(e,t,n,i,r,s,a){var o=null;if(n)try{if(o=n._savedStackTrace?n._savedStackTrace:m.parse(n),n===this.lastError)return;this.lastError=n}catch(e){t=n.message||n.description||t||String(n),n=null}var l=this._buildPayload(new Date,e,t,o,i);a&&(l.ignoreRateLimit=!0),this._enqueuePayload(l,!!s,[e,t,n,i],r)},E.log=h(),E.debug=h("debug"),E.info=h("info"),E.warn=h("warning"),E.warning=h("warning"),E.error=h("error"),E.critical=h("critical"),E.uncaughtError=r(function(e,t,n,i,r,s){if(s=s||null,r&&g.isType(r,"error"))return void this._log(this.options.uncaughtErrorLevel,e,r,s,null,!0);if(t&&g.isType(t,"error"))return void this._log(this.options.uncaughtErrorLevel,e,t,s,null,!0);var a={url:t||"",line:n};a.func=m.guessFunctionName(a.url,a.line),a.context=m.gatherContext(a.url,a.line);var o={mode:"onerror",message:r?String(r):e||"uncaught exception",url:document.location.href,stack:[a],useragent:navigator.userAgent},l=this._buildPayload(new Date,this.options.uncaughtErrorLevel,e,o,s);this._enqueuePayload(l,!0,[this.options.uncaughtErrorLevel,e,t,n,i,r])}),E.unhandledRejection=r(function(e,t){if(null==e)return void x._log(x.options.uncaughtErrorLevel,"unhandled rejection was null or undefined!",null,{},null,!1,!1);var n=e.message||(e?String(e):"unhandled rejection"),i=e._rollbarContext||t._rollbarContext||null;if(e&&g.isType(e,"error"))return void this._log(this.options.uncaughtErrorLevel,n,e,i,null,!0);var r={url:"",line:0};r.func=m.guessFunctionName(r.url,r.line),r.context=m.gatherContext(r.url,r.line);var s={mode:"unhandledrejection",message:n,url:document.location.href,stack:[r],useragent:navigator.userAgent},a=this._buildPayload(new Date,this.options.uncaughtErrorLevel,n,s,i);this._enqueuePayload(a,!0,[this.options.uncaughtErrorLevel,n,r.url,r.line,0,e,t])}),E.global=r(function(e){e=e||{};var t={startTime:e.startTime,maxItems:e.maxItems,itemsPerMinute:e.itemsPerMinute};f(!0,window._globalRollbarOptions,t),void 0!==e.maxItems&&(S=0),void 0!==e.itemsPerMinute&&(C=0)}),E.configure=r(function(e,t){var n=f(!0,{},e);f(!t,this.options,n),this.global(n)}),E.scope=r(function(e){var t=new o(this);return f(!0,t.options.payload,e),t}),E.wrap=function(e,t){try{var n;if(n=g.isType(t,"function")?t:function(){return t||{}},!g.isType(e,"function"))return e;if(e._isWrap)return e;if(!e._wrapped){e._wrapped=function(){try{return e.apply(this,arguments)}catch(t){throw"string"==typeof t&&(t=new String(t)),t.stack||(t._savedStackTrace=m.parse(t)),t._rollbarContext=n()||{},t._rollbarContext._wrappedSource=e.toString(),window._rollbarWrappedError=t,t}},e._wrapped._isWrap=!0;for(var i in e)e.hasOwnProperty(i)&&(e._wrapped[i]=e[i])}return e._wrapped}catch(t){return e}},E.loadFull=function(){},o.processPayloads=function(e){return e?void c():void s()};var b=(new Date).getTime(),S=0,C=0;e.exports={Notifier:o,setupJSON:i,topLevelNotifier:a}},function(e,t){"use strict";var n=Object.prototype.hasOwnProperty,i=Object.prototype.toString,r=function(e){return"function"==typeof Array.isArray?Array.isArray(e):"[object Array]"===i.call(e)},s=function(e){if(!e||"[object Object]"!==i.call(e))return!1;var t=n.call(e,"constructor"),r=e.constructor&&e.constructor.prototype&&n.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!t&&!r)return!1;var s;for(s in e);return"undefined"==typeof s||n.call(e,s)};e.exports=function e(){var t,n,i,a,o,l,h=arguments[0],u=1,p=arguments.length,c=!1;for("boolean"==typeof h?(c=h,h=arguments[1]||{},u=2):("object"!=typeof h&&"function"!=typeof h||null==h)&&(h={});u<p;++u)if(t=arguments[u],null!=t)for(n in t)i=h[n],a=t[n],h!==a&&(c&&a&&(s(a)||(o=r(a)))?(o?(o=!1,l=i&&r(i)?i:[]):l=i&&s(i)?i:{},h[n]=e(c,l,a)):"undefined"!=typeof a&&(h[n]=a));return h}},function(e,t,n){"use strict";function i(){return u}function r(){return null}function s(e){var t={};return t._stackFrame=e,t.url=e.fileName,t.line=e.lineNumber,t.func=e.functionName,t.column=e.columnNumber,t.args=e.args,t.context=r(t.url,t.line),t}function a(e){function t(){var t=[];try{t=h.parse(e)}catch(e){t=[]}for(var n=[],i=0;i<t.length;i++)n.push(new s(t[i]));return n}return{stack:t(),message:e.message,name:e.name}}function o(e){return new a(e)}function l(e){if(!e)return["Unknown error. There was no error message to display.",""];var t=e.match(p),n="(unknown)";return t&&(n=t[t.length-1],e=e.replace((t[t.length-2]||"")+n+":",""),e=e.replace(/(^[\s]+|[\s]+$)/g,"")),[n,e]}var h=n(6),u="?",p=new RegExp("^(([a-zA-Z0-9-_$ ]*): *)?(Uncaught )?([a-zA-Z0-9-_$ ]*): ");e.exports={guessFunctionName:i,guessErrorClass:l,gatherContext:r,parse:o,Stack:a,Frame:s}},function(e,t,n){var i,r,s;!function(a,o){"use strict";r=[n(7)],i=o,s="function"==typeof i?i.apply(t,r):i,!(void 0!==s&&(e.exports=s))}(this,function(e){"use strict";function t(e,t,n){if("function"==typeof Array.prototype.map)return e.map(t,n);for(var i=new Array(e.length),r=0;r<e.length;r++)i[r]=t.call(n,e[r]);return i}function n(e,t,n){if("function"==typeof Array.prototype.filter)return e.filter(t,n);for(var i=[],r=0;r<e.length;r++)t.call(n,e[r])&&i.push(e[r]);return i}var i=/(^|@)\S+\:\d+/,r=/^\s*at .*(\S+\:\d+|\(native\))/m,s=/^(eval@)?(\[native code\])?$/;return{parse:function(e){if("undefined"!=typeof e.stacktrace||"undefined"!=typeof e["opera#sourceloc"])return this.parseOpera(e);if(e.stack&&e.stack.match(r))return this.parseV8OrIE(e);if(e.stack)return this.parseFFOrSafari(e);throw new Error("Cannot parse given Error object")},extractLocation:function(e){if(e.indexOf(":")===-1)return[e];var t=e.replace(/[\(\)\s]/g,"").split(":"),n=t.pop(),i=t[t.length-1];if(!isNaN(parseFloat(i))&&isFinite(i)){var r=t.pop();return[t.join(":"),r,n]}return[t.join(":"),n,void 0]},parseV8OrIE:function(i){var s=n(i.stack.split("\n"),function(e){return!!e.match(r)},this);return t(s,function(t){t.indexOf("(eval ")>-1&&(t=t.replace(/eval code/g,"eval").replace(/(\(eval at [^\()]*)|(\)\,.*$)/g,""));var n=t.replace(/^\s+/,"").replace(/\(eval code/g,"(").split(/\s+/).slice(1),i=this.extractLocation(n.pop()),r=n.join(" ")||void 0,s="eval"===i[0]?void 0:i[0];return new e(r,void 0,s,i[1],i[2],t)},this)},parseFFOrSafari:function(i){var r=n(i.stack.split("\n"),function(e){return!e.match(s)},this);return t(r,function(t){if(t.indexOf(" > eval")>-1&&(t=t.replace(/ line (\d+)(?: > eval line \d+)* > eval\:\d+\:\d+/g,":$1")),t.indexOf("@")===-1&&t.indexOf(":")===-1)return new e(t);var n=t.split("@"),i=this.extractLocation(n.pop()),r=n.shift()||void 0;return new e(r,void 0,i[0],i[1],i[2],t)},this)},parseOpera:function(e){return!e.stacktrace||e.message.indexOf("\n")>-1&&e.message.split("\n").length>e.stacktrace.split("\n").length?this.parseOpera9(e):e.stack?this.parseOpera11(e):this.parseOpera10(e)},parseOpera9:function(t){for(var n=/Line (\d+).*script (?:in )?(\S+)/i,i=t.message.split("\n"),r=[],s=2,a=i.length;s<a;s+=2){var o=n.exec(i[s]);o&&r.push(new e(void 0,void 0,o[2],o[1],void 0,i[s]))}return r},parseOpera10:function(t){for(var n=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,i=t.stacktrace.split("\n"),r=[],s=0,a=i.length;s<a;s+=2){var o=n.exec(i[s]);o&&r.push(new e(o[3]||void 0,void 0,o[2],o[1],void 0,i[s]))}return r},parseOpera11:function(r){var s=n(r.stack.split("\n"),function(e){return!!e.match(i)&&!e.match(/^Error created at/)},this);return t(s,function(t){var n,i=t.split("@"),r=this.extractLocation(i.pop()),s=i.shift()||"",a=s.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^\)]*\)/g,"")||void 0;s.match(/\(([^\)]*)\)/)&&(n=s.replace(/^[^\(]+\(([^\)]*)\)$/,"$1"));var o=void 0===n||"[arguments not available]"===n?void 0:n.split(",");return new e(a,o,r[0],r[1],r[2],t)},this)}}})},function(e,t,n){var i,r,s;!function(n,a){"use strict";r=[],i=a,s="function"==typeof i?i.apply(t,r):i,!(void 0!==s&&(e.exports=s))}(this,function(){"use strict";function e(e){return!isNaN(parseFloat(e))&&isFinite(e)}function t(e,t,n,i,r,s){void 0!==e&&this.setFunctionName(e),void 0!==t&&this.setArgs(t),void 0!==n&&this.setFileName(n),void 0!==i&&this.setLineNumber(i),void 0!==r&&this.setColumnNumber(r),void 0!==s&&this.setSource(s)}return t.prototype={getFunctionName:function(){return this.functionName},setFunctionName:function(e){this.functionName=String(e)},getArgs:function(){return this.args},setArgs:function(e){if("[object Array]"!==Object.prototype.toString.call(e))throw new TypeError("Args must be an Array");this.args=e},getFileName:function(){return this.fileName},setFileName:function(e){this.fileName=String(e)},getLineNumber:function(){return this.lineNumber},setLineNumber:function(t){if(!e(t))throw new TypeError("Line Number must be a Number");this.lineNumber=Number(t)},getColumnNumber:function(){return this.columnNumber},setColumnNumber:function(t){if(!e(t))throw new TypeError("Column Number must be a Number");this.columnNumber=Number(t)},getSource:function(){return this.source},setSource:function(e){this.source=String(e)},toString:function(){var t=this.getFunctionName()||"{anonymous}",n="("+(this.getArgs()||[]).join(",")+")",i=this.getFileName()?"@"+this.getFileName():"",r=e(this.getLineNumber())?":"+this.getLineNumber():"",s=e(this.getColumnNumber())?":"+this.getColumnNumber():"";return t+n+i+r+s}},t})},function(e,t,n){"use strict";function i(e){return{}.toString.call(e).match(/\s([a-zA-Z]+)/)[1].toLowerCase()}function r(e,t){return i(e)===t}function s(e){if(!r(e,"string"))throw new Error("received invalid input");for(var t=u,n=t.parser[t.strictMode?"strict":"loose"].exec(e),i={},s=14;s--;)i[t.key[s]]=n[s]||"";return i[t.q.name]={},i[t.key[12]].replace(t.q.parser,function(e,n,r){n&&(i[t.q.name][n]=r)}),i}function a(e){var t=s(e);return""===t.anchor&&(t.source=t.source.replace("#","")),e=t.source.replace("?"+t.query,"")}function o(e,t){var n,i,s,a=r(e,"object"),l=r(e,"array"),h=[];if(a)for(n in e)e.hasOwnProperty(n)&&h.push(n);else if(l)for(s=0;s<e.length;++s)h.push(s);for(s=0;s<h.length;++s)n=h[s],i=e[n],a=r(i,"object"),l=r(i,"array"),a||l?e[n]=o(i,t):e[n]=t(n,i);return e}function l(e){return e=String(e),new Array(e.length+1).join("*")}function h(){var e=(new Date).getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:7&n|8).toString(16)});return t}n(9);var u={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},p={isType:r,parseUri:s,parseUriOptions:u,redact:l,sanitizeUrl:a,traverse:o,typeName:i,uuid4:h};e.exports=p},function(e,t){!function(e){"use strict";e.console=e.console||{};for(var t,n,i=e.console,r={},s=function(){},a="memory".split(","),o="assert,clear,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profiles,profileEnd,show,table,time,timeEnd,timeline,timelineEnd,timeStamp,trace,warn".split(",");t=a.pop();)i[t]||(i[t]=r);
for(;n=o.pop();)i[n]||(i[n]=s)}("undefined"==typeof window?this:window)},function(e,t,n){"use strict";function i(e){a=e}function r(e){this.name="Connection Error",this.message=e,this.stack=(new Error).stack}var s=n(8),a=null;r.prototype=Object.create(Error.prototype),r.prototype.constructor=r;var o={XMLHttpFactories:[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],createXMLHTTPObject:function(){var e,t=!1,n=o.XMLHttpFactories,i=n.length;for(e=0;e<i;e++)try{t=n[e]();break}catch(e){}return t},post:function(e,t,n,i){if(!s.isType(n,"object"))throw new Error("Expected an object to POST");n=a.stringify(n),i=i||function(){};var l=o.createXMLHTTPObject();if(l)try{try{var h=function(){try{if(h&&4===l.readyState){h=void 0;var e=a.parse(l.responseText);200===l.status?i(null,e):s.isType(l.status,"number")&&l.status>=400&&l.status<600?(403==l.status&&void 0,i(new Error(String(l.status)))):i(new r("XHR response had no status code (likely connection failure)"))}}catch(e){var t;t=e&&e.stack?e:new Error(e),i(t)}};l.open("POST",e,!0),l.setRequestHeader&&(l.setRequestHeader("Content-Type","application/json"),l.setRequestHeader("X-Rollbar-Access-Token",t)),l.onreadystatechange=h,l.send(n)}catch(t){if("undefined"!=typeof XDomainRequest){"http:"===window.location.href.substring(0,5)&&"https"===e.substring(0,5)&&(e="http"+e.substring(5));var u=function(){i(new r("Request timed out"))},p=function(){i(new Error("Error during request"))},c=function(){i(null,a.parse(l.responseText))};l=new XDomainRequest,l.onprogress=function(){},l.ontimeout=u,l.onerror=p,l.onload=c,l.open("POST",e,!0),l.send(n)}}}catch(e){i(e)}}};e.exports={XHR:o,setupJSON:i,ConnectionError:r}}])})},{}],2:[function(e,t,n){function i(t,n){function i(e){h(this,!this.treeVisible),R()}function h(e,t){var n=Ee(e.lonlat.lon,e.lonlat.lat);if(e.treeVisible=t,e.setOpacity(t?1:.4),Oe){var i=Te.WorldXYtoGridXY(n.x,n.y);Te.toggleTree(i.x,i.y)}var r="Click to cut down tree.<br>This will affect the ward vision simulation.";t?delete xe[e.tree_loc]:(r="Click to regrow tree.<br>This will affect the ward vision simulation.",xe[e.tree_loc]=e),e.feature.data.popupContentHTML=r,e.feature.popup&&e.feature.popup.setContentHTML(r)}function u(e,t){var n,i,r;e.object.showInfo?(he.removeFeatures(e.object.day_vision_feature),ue.removeFeatures(e.object.night_vision_feature),pe.removeFeatures(e.object.true_sight_feature),ce.removeFeatures(e.object.attack_range_feature),e.object.vision_feature&&fe.removeFeatures(e.object.vision_feature),e.object.vision_center_feature&&fe.removeFeatures(e.object.vision_center_feature),t||l.removeQueryStringValue("tower_vision",e.object.tower_loc.x+","+e.object.tower_loc.y)):(r=new OpenLayers.Geometry.Point(e.object.lonlat.lon,e.object.lonlat.lat),n=OpenLayers.Geometry.Polygon.createRegularPolygon(r,Ce(e.object.day_vision_radius),30),i=new OpenLayers.Feature.Vector(n),he.addFeatures(i),e.object.day_vision_feature=i,n=OpenLayers.Geometry.Polygon.createRegularPolygon(r,Ce(e.object.true_sight_radius),30),i=new OpenLayers.Feature.Vector(n,null,ve.lightblue),pe.addFeatures(i),e.object.true_sight_feature=i,n=OpenLayers.Geometry.Polygon.createRegularPolygon(r,Ce(e.object.night_vision_radius),30),i=new OpenLayers.Feature.Vector(n),ue.addFeatures(i),e.object.night_vision_feature=i,n=OpenLayers.Geometry.Polygon.createRegularPolygon(r,Ce(e.object.attack_range_radius),30),i=new OpenLayers.Feature.Vector(n,null,ve.red),ce.addFeatures(i),e.object.attack_range_feature=i,t||l.addQueryStringValue("tower_vision",e.object.tower_loc.x+","+e.object.tower_loc.y),Oe&&B(e.object.lonlat,e.object,q)),e.object.showInfo=!e.object.showInfo}function c(e){return function(t){var n=te.getLonLatFromPixel(t.xy),i=d(n,e);i&&l.addQueryStringValue(i.ward_type,i.ward_loc)}}function d(e,t,n){if(ee.containsLonLat(e)){var i=X[t],r=E(i.icon_path,e),s=OpenLayers.Geometry.Polygon.createRegularPolygon(new OpenLayers.Geometry.Point(r.lonlat.lon,r.lonlat.lat),Ce(i.radius),40),a=new OpenLayers.Feature.Vector(s);if(me.addMarker(r),ye.addFeatures(a),r.radius_feature=a,r.ward_type=t,r.ward_loc=t,void 0==n){var o=Ee(e.lon,e.lat);o.x=o.x.toFixed(0),o.y=o.y.toFixed(0),r.ward_loc=o.x+","+o.y}else r.ward_loc=n;return Oe&&"observer"==t&&B(e,r,X.observer.radius),r.events.register("click",r,y),r.events.register("touchstart",r,y),r}}function y(e){this.radius_feature&&ye.removeFeatures(this.radius_feature),this.vision_feature&&fe.removeFeatures(this.vision_feature),this.vision_center_feature&&fe.removeFeatures(this.vision_center_feature),me.removeMarker(this),OpenLayers.Event.stop(e),l.removeQueryStringValue(this.ward_type,this.ward_loc),this.events.unregister("click",this,y),this.events.unregister("touchstart",this,y)}function f(e){}function m(e){var t="";t+=1==e.order?"Distance: "+Pe(e.order,e.units,e.measure).toFixed(0)+" units":"Distance: "+Pe(e.order,e.units,e.measure).toFixed(0)+" units<sup>2</sup>",document.getElementById("output").innerHTML=t,V=Pe(e.order,e.units,e.measure),document.getElementById("traveltime").innerHTML=(V/document.getElementById("movespeed").value).toFixed(2),document.getElementById("traveltime-container").style.display=""}function g(e){var t=document.getElementById("output"),n="";n+=1==e.order?"Radius: "+Pe(e.order,e.units,e.measure).toFixed(0)+" units":"Distance: "+Pe(e.order,e.units,e.measure).toFixed(0)+" units<sup>2</sup>",t.innerHTML=n}function v(e){var t,n,i=document.getElementById("output"),r="",s=this;j.select.deactivate(),1==e.order?(e.measure>0&&(t="km"==e.units?OpenLayers.Geometry.Polygon.createRegularPolygon(new OpenLayers.Geometry.Point(e.geometry.components[0].x,e.geometry.components[0].y),1e3*e.measure,30):OpenLayers.Geometry.Polygon.createRegularPolygon(new OpenLayers.Geometry.Point(e.geometry.components[0].x,e.geometry.components[0].y),e.measure,30),n=new OpenLayers.Feature.Vector(t),de.removeFeatures(e.geometry.circle_features),"circle_features"in e.geometry?(e.geometry.circle_features.length=0,e.geometry.circle_features.push(n)):e.geometry.circle_features=[n],n.measure_control=this,n.is_measuring=!0,de.addFeatures(n),e.geometry.components.length>2&&setTimeout(function(){n.is_measuring=!1,j.select.activate(),s.cancel()},0)),r+="Radius: "+Pe(e.order,e.units,e.measure).toFixed(0)+" units"):r+="Distance: "+Pe(e.order,e.units,e.measure).toFixed(0)+" units<sup>2</sup>",i.innerHTML=r}function L(){var e;l.setQueryString("mode",null);for(var t in j)e=j[t],this.value==t&&this.checked?(l.setQueryString("mode",t),e.activate()):e.deactivate(),"polygonControl"!=this.value&&"circle"!=this.value||!this.checked?j.select.deactivate():j.select.activate();document.getElementById("output").innerHTML="",document.getElementById("traveltime-container").style.display="none"}function O(e){null==this.popup?(this.popup=this.createPopup(this.closeBox),te.addPopup(this.popup),this.popup.show()):this.popup.toggle(),currentPopup=this.popup,OpenLayers.Event.stop(e)}function w(e){null==this.popup?(this.popup=this.createPopup(this.closeBox),te.addPopup(this.popup),this.popup.show()):this.popup.toggle(),currentPopup=this.popup,OpenLayers.Event.stop(e)}function x(e,t,n,i,r,s){var a,o=new OpenLayers.Feature(e,t);return o.closeBox=r,o.popupClass=n,o.data.popupContentHTML=i,o.data.overflow=s?"auto":"hidden",a=o.createMarker(),a.feature=o,"Towers"==e.name?(a.events.register("mouseover",o,O),a.events.register("mouseout",o,O)):"Trees"==e.name&&Oe&&(a.events.register("mouseover",o,w),a.events.register("mouseout",o,w)),e.addMarker(a),a}function E(e,t){var n=new OpenLayers.Size(21,25),i=new OpenLayers.Pixel(-(n.w/2),-n.h),r=new OpenLayers.Icon(e,n,i),s=new OpenLayers.Marker(t,r);return s}function b(e,t){var n=be(e.x-32,e.y-32),i=be(e.x-32,e.y+32),r=be(e.x+32,e.y+32),s=be(e.x+32,e.y-32),a=[new OpenLayers.Geometry.Point(n.x,n.y),new OpenLayers.Geometry.Point(i.x,i.y),new OpenLayers.Geometry.Point(r.x,r.y),new OpenLayers.Geometry.Point(s.x,s.y)],o=new OpenLayers.Geometry.LinearRing(a),l=new OpenLayers.Feature.Vector(o,null,t);return l}function S(e,t){return function(n){var i=this.map.getResolution(),r=Math.round((n.left-this.maxExtent.left)/(i*this.tileSize.w)),s=Math.round((this.maxExtent.top-n.top)/(i*this.tileSize.h)),a=te.getZoom(),o=a+"/tile_"+r+"_"+s+"."+this.type,l=this.url;return l instanceof Array&&(l=this.selectUrl(o,l)),l+e+"/"+t+"/"+o}}function C(){for(k in Le)xe[k]&&h(Le[k],!0);ne.forEach(function(e){var t=te.getLayersByName(ie[e])[0];t&&(te.removeLayer(t),t.destroy())}),he.destroyFeatures(),ue.destroyFeatures(),pe.destroyFeatures(),ce.destroyFeatures(),te.events.unregister("changelayer",te,_)}function P(e){var t,n={},i=te.getLayersByName("Placed Wards")[0];ne.forEach(function(i){if(e[i])if("trigger_multiple"!=i&&"ent_dota_tree"!=i&&"no_wards"!=i&&"ent_fow_blocker_node"!=i){n[i]=new OpenLayers.Layer.Markers(ie[i],{visibility:!1}),te.addLayer(n[i]);for(var r=0;r<e[i].length;r++){var s=be(e[i][r].x,e[i][r].y);t=x(n[i],new OpenLayers.LonLat(s.x,s.y),OpenLayers.Popup.FramedCloud,"Click to toggle range overlay",!1),t.day_vision_radius=q,t.night_vision_radius=Z,t.true_sight_radius=Y,t.attack_range_radius=K,t.showInfo=!1,"npc_dota_tower"==i&&(t.events.register("click",n[i],u),t.events.register("touchstart",n[i],u),t.tower_loc=e[i][r])}}else"ent_dota_tree"==i?(n[i]=new OpenLayers.Layer.Markers(ie[i],{visibility:!1}),te.addLayer(n[i]),n[i].data=e[i]):"trigger_multiple"==i&&M(n,i,"npc_dota_neutral_spawner_box",e[i]);else Oe&&("no_wards"===i?H(n,i,ie[i],ve.red):"ent_fow_blocker_node"===i&&H(n,i,ie[i],ve.lightblue))}),G=e,te.raiseLayer(i,te.layers.length),te.events.register("changelayer",te,_),I()}function _(e){"visibility"!==e.property||e.layer.name!=ie.ent_dota_tree||e.layer.loaded||T(),"visibility"===e.property&&(e.layer.isBaseLayer?l.setQueryString("BaseLayer",e.layer.name.replace(/ /g,"")):l.setQueryString(e.layer.name.replace(/ /g,""),!!e.layer.visibility||null))}function T(){for(var e=te.getLayersByName(ie.ent_dota_tree)[0],t=0;t<e.data.length;t++){var n=be(e.data[t].x,e.data[t].y);marker=x(e,new OpenLayers.LonLat(n.x,n.y),OpenLayers.Popup.FramedCloud,"Click to cut down tree.<br>This will affect the ward vision simulation.",!1),marker.treeVisible=!0,marker.tree_loc=e.data[t].x+","+e.data[t].y,Oe&&marker.events.register("click",marker,i),Le[e.data[t].x+","+e.data[t].y]=marker}e.loaded=!e.loaded}function M(e,t,n,i){e[n]=new OpenLayers.Layer.Vector(ie[t]),te.addLayer(e[n]),e[n].setVisibility(!1);for(var r=0;r<i.length;r++){pnt=[];for(var s=0;s<i[r].length;s++){var a=be(i[r][s].x,i[r][s].y);pnt.push(new OpenLayers.Geometry.Point(a.x,a.y))}ln=new OpenLayers.Geometry.LinearRing(pnt),pf=new OpenLayers.Feature.Vector(ln,null,ve.green),e[n].addFeatures([pf])}}function I(){var e=l.getParameterByName("mode");if(e){var t=document.getElementById(e+"Toggle");t&&(t.checked=!0,L.call(t))}var n=l.getParameterByName("zoom");n&&te.zoomTo(parseInt(n));var i=l.getParameterByName("x"),r=l.getParameterByName("y");if(i&&r){var s=be(i,r);te.setCenter(new OpenLayers.LonLat(s.x,s.y),void 0,!1,!1)}for(var a=["observer","sentry"],p=0;p<a.length;p++){var c=l.getParameterByName(a[p]);c&&(ward_coordinates=o(c," ;").split(";"),ward_coordinates.map(function(e){var t=e.split(","),n=be(parseFloat(t[0]),parseFloat(t[1]));d(new OpenLayers.LonLat(n.x,n.y),a[p],e)}))}var y=l.getParameterByName("BaseLayer");if(y)for(var p=0;p<re.length;p++){var f=re[p],m=f.name.replace(/ /g,"");if(y===m){te.setBaseLayer(f);break}}for(k in ie){var m=ie[k].replace(/ /g,"");if(value=l.getParameterByName(m),value){var f=te.getLayersByName(ie[k])[0];f&&f.setVisibility("true"==value)}}var g=l.getParameterByName("cut_trees");if(g){var f=te.getLayersByName(ie.ent_dota_tree)[0];f.loaded||T(),cut_tree_coordinates=o(g," ;").split(";");for(var p=0;p<cut_tree_coordinates.length;p++)Le[cut_tree_coordinates[p]]&&h(Le[cut_tree_coordinates[p]],!1)}var v=l.getParameterByName("tower_vision");if(v){var f=te.getLayersByName(ie.npc_dota_tower)[0];tower_vision_coordinates=o(v," ;").split(";");for(var p=0;p<tower_vision_coordinates.length;p++)for(var O=0;O<f.markers.length;O++)f.markers[O].tower_loc.x+","+f.markers[O].tower_loc.y==tower_vision_coordinates[p]&&u({object:f.markers[O]},!0)}}function R(){var e=Object.keys(xe).join(";");l.setQueryString("cut_trees",e||null)}function N(e,t){var n=new XMLHttpRequest;return n.open("GET",e,!0),n.onload=function(){if(n.status>=200&&n.status<400){var e=JSON.parse(n.responseText);t(e)}else alert("Error loading page.")},n.onerror=function(){alert("Error loading page.")},n.send(),n}function D(e,t,n){var i;return function(){var r=this,s=arguments;clearTimeout(i),i=setTimeout(function(){i=null,n||e.apply(r,s)},t),n&&!i&&e.apply(r,s)}}function F(e){document.querySelector(".controls").style.display="none",document.getElementById("controls-max").style.display="block",this.style.display="none",e&&e.preventDefault()}function A(){var e=l.getParameterByName("data");e&&(document.getElementById("dataControl").value=e),Oe="687"!=e,document.getElementById("visionSimulationControl").disabled=!Oe,document.getElementById("alwaysSimulateControl").disabled=!Oe,N(Q+z()+"/mapdata.json",P)}function z(){return document.getElementById("dataControl").value}function B(e,t,n){if(Te.ready){var i=Ee(e.lon,e.lat),r=Te.WorldXYtoGridXY(i.x,i.y);if(Te.isValidXY(r.x,r.y,!0,!0,!0)){var s=b(Te.GridXYtoWorldXY(r.x,r.y),ve.green);t&&(fe.addFeatures([s]),t.vision_center_feature=s),Te.updateVisibility(r.x,r.y,Se(n));var o=a(Te.grid,Te.lights),l=o.map(function(e){var t=e.map(function(e){var t=Te.GridXYtoWorldXY(e.x,e.y),n=be(t.x,t.y);return new OpenLayers.Geometry.Point(n.x,n.y)}),n=new OpenLayers.Geometry.LinearRing(t);return new OpenLayers.Geometry.Polygon([n])}),h=new OpenLayers.Geometry.MultiPolygon(l),u=new OpenLayers.Feature.Vector(h,null,ve.yellow);t?(fe.addFeatures([u]),t.vision_feature=u):le.addFeatures([u])}}}function U(){te.getSize()?A():(Me++,Me<ke?(te.updateSize(),setTimeout(U,250)):(p.error("Max init check exceeded"),alert("There was a problem loading the map.")))}function H(e,t,n,i){var r=Q+z()+"/"+t+"2.json";e[t]=new OpenLayers.Layer.Vector(n,{strategies:[new OpenLayers.Strategy.Fixed],protocol:new OpenLayers.Protocol.HTTP({url:r,format:new OpenLayers.Format.GeoJSON}),visibility:!1}),e[t].style=i,te.addLayer(e[t])}var G,j,V,W="img/",X={observer:{icon_path:W+"ward_observer.png",radius:1600},sentry:{icon_path:W+"ward_sentry.png",radius:850}},q=1900,Z=800,Y=700,K=700,Q="data/",$=e("./mapConstants"),J=e("./conversionFunctions"),ee=new OpenLayers.Bounds(0,0,$.map_w,$.map_h),te=new OpenLayers.Map("map1",{theme:null,maxExtent:ee,numZoomLevels:5,maxResolution:Math.pow(2,4),units:"m"}),ne=["no_wards","ent_fow_blocker_node","trigger_multiple","npc_dota_roshan_spawner","ent_dota_tree","dota_item_rune_spawner","dota_item_rune_spawner_bounty","ent_dota_shop","npc_dota_barracks","npc_dota_building","npc_dota_healer","npc_dota_fort","npc_dota_tower"],ie={npc_dota_roshan_spawner:"Roshan",dota_item_rune_spawner:"Runes",dota_item_rune_spawner_bounty:"Bounty Runes",ent_dota_tree:"Trees",npc_dota_healer:"Shrines",npc_dota_fort:"Ancients",ent_dota_shop:"Shops",npc_dota_tower:"Towers",npc_dota_barracks:"Barracks",npc_dota_building:"Buildings",trigger_multiple:"Neutral Camps Spawn Boxes",npc_dota_neutral_spawner:"Neutral Camps",no_wards:"Invalid Ward Locations",ent_fow_blocker_node:"Vision Blocker"},re=[new OpenLayers.Layer.TMS("7.00 Default",t,{type:"jpg",getURL:S("700","default")}),new OpenLayers.Layer.TMS("6.87 Default",t,{type:"jpg",getURL:S("687","default")}),new OpenLayers.Layer.TMS("6.87 Desert",t,{type:"jpg",getURL:S("687","desert")}),new OpenLayers.Layer.TMS("6.87 Immortal Gardens",t,{type:"jpg",getURL:S("687","immortalgardens")})],se={"Day Vision Range":"Towers","Night Vision Range":"Towers","True Sight Range":"Towers","Attack Range":"Towers",Towers:"Structures",Shrines:"Structures",Ancients:"Structures",Barracks:"Structures",Buildings:"Structures",Shops:"Structures","Invalid Ward Locations":"Vision","Vision Blocker":"Vision","Placed Wards":"Vision","Ward Vision":"Vision","Ward Vision with Fog":"Vision"},ae=new OpenLayers.Control.LayerSwitcher({ascending:!1,overlayGrouping:se,onMaximizeWhenSmallScreen:F.bind(document.getElementById("controls-min"))}),oe=new OpenLayers.Control.MousePosition,le=new OpenLayers.Layer.Vector("Cursor",{displayInLayerSwitcher:!1}),he=new OpenLayers.Layer.Vector("Day Vision Range"),ue=new OpenLayers.Layer.Vector("Night Vision Range"),pe=new OpenLayers.Layer.Vector("True Sight Range"),ce=new OpenLayers.Layer.Vector("Attack Range"),de=new OpenLayers.Layer.Vector("Drawn Circles"),ye=new OpenLayers.Layer.Vector("Ward Vision"),fe=new OpenLayers.Layer.Vector("Ward Vision with Fog"),me=new OpenLayers.Layer.Markers("Placed Wards"),ge=OpenLayers.Util.getParameters(window.location.href).renderer,ve=e("./styleConstants"),Le={},Oe=!0,we=!0,xe={},Ee=(J.reverseLerp,J.latLonToWorld),be=J.worldToLatLon,Se=J.getTileRadius,Ce=J.getScaledRadius,Pe=J.calculateDistance;OpenLayers.ImgPath=W,re.forEach(function(e){te.addLayer(e)}),te.addLayer(le),te.addLayer(he),te.addLayer(ue),te.addLayer(pe),te.addLayer(ce),te.addLayer(de),te.addLayer(ye),te.addLayer(fe),te.addLayer(me),te.addControl(oe),te.addControl(new OpenLayers.Control.TouchNavigation({dragPanOptions:{enableKinetic:!0}})),te.addControl(new OpenLayers.Control.KeyboardDefaults),te.addControl(ae),ae.maximizeControl(),te.getCenter()||te.zoomToMaxExtent(),OpenLayers.Control.Click=OpenLayers.Class(OpenLayers.Control,{defaultHandlerOptions:{single:!0,double:!1,pixelTolerance:0,stopSingle:!1,stopDouble:!1},initialize:function(e){this.handlerOptions=OpenLayers.Util.extend({},this.defaultHandlerOptions),OpenLayers.Control.prototype.initialize.apply(this,arguments),this.handler=new OpenLayers.Handler.Click(this,{click:this.onClick,dblclick:this.onDblclick},this.handlerOptions)},onClick:f,onDblclick:function(e){var t=document.getElementById(this.key+"Output"),n="dblclick "+e.xy;t.value=t.value+n+"\n"}}),ge=ge?[ge]:OpenLayers.Layer.Vector.prototype.renderers,j={line:new OpenLayers.Control.Measure(OpenLayers.Handler.Path,{persist:!0,immediate:!0,handlerOptions:{layerOptions:{renderers:ge}}}),circle:new OpenLayers.Control.Measure(OpenLayers.Handler.Path,{persist:!1,immediate:!0,handlerOptions:{layerOptions:{renderers:ge}}}),observer:new OpenLayers.Control.Click({onClick:c("observer"),handlerOptions:{single:!0}}),sentry:new OpenLayers.Control.Click({onClick:c("sentry"),handlerOptions:{single:!0}}),polygonControl:new OpenLayers.Control.DrawFeature(de,OpenLayers.Handler.RegularPolygon,{handlerOptions:{sides:30}}),select:new OpenLayers.Control.SelectFeature(de,{hover:!0,highlightOnly:!1,callbacks:{click:function(e){var t=document.getElementById("output");e.measure_control&&e.is_measuring?(e.measure_control.cancel(),e.is_measuring=!1,this.highlight(e)):(t.innerHTML="",de.removeFeatures(e))}},overFeature:function(e){var t=document.getElementById("output"),n="Radius: "+(.565352*Math.sqrt(e.geometry.getArea())*$.scale).toFixed(0)+" units";t.innerHTML=n,this.highlight(e)},outFeature:function(e){var t=document.getElementById("output");t.innerHTML="",this.unhighlight(e)}})};for(var _e in j)"line"==_e&&j[_e].events.on({measure:m,measurepartial:m}),"circle"==_e&&j[_e].events.on({measure:g,measurepartial:v}),te.addControl(j[_e]);te.events.register("zoomend",te,D(function(){l.setQueryString("zoom",te.getZoom())},500)),te.events.register("moveend",te,D(function(){var e=te.getCenter();if(e){var t=Ee(e.lon,e.lat);l.setQueryString("x",t.x.toFixed(0)),l.setQueryString("y",t.y.toFixed(0))}},500)),oe.formatOutput=function(e){var t=Ee(e.lon,e.lat);return t.x.toFixed(0)+", "+t.y.toFixed(0)},te.events.register("mousemove",te,function(e){if(le.destroyFeatures(),Oe&&Te.ready&&document.getElementById("observerToggle").checked){var t=te.getLonLatFromPixel(e.xy);if(!ee.containsLonLat(t))return;var n=Ee(t.lon,t.lat),i=Te.WorldXYtoGridXY(n.x,n.y),r=Te.tree_relations[i.key],s=!1;if(r)for(var a=0;a<r.length;a++){var o=r[a];if(s=Te.tree_state[o.key])break}var l=ve.green;Te.isValidXY(i.x,i.y,!0,!0,!0)||(l=ve.red);var h=b(Te.GridXYtoWorldXY(i.x,i.y),l);le.addFeatures([h]),we&&B(t,null,X.observer.radius)}}),document.getElementById("controls-max").addEventListener("click",function(e){document.querySelector(".controls").style.display="",document.getElementById("controls-min").style.display="block",this.style.display="none",ae.isSmallScreen()&&ae.minimizeControl(),e&&e.preventDefault()},!1),document.getElementById("controls-min").addEventListener("click",F,!1),ae.isSmallScreen()&&(F.call(document.getElementById("controls-min")),ae.minimizeControl()),document.getElementById("coordControl").addEventListener("change",function(e){this.checked?document.querySelector(".olControlMousePosition").style.display="block":document.querySelector(".olControlMousePosition").style.display="none"},!1),document.getElementById("visionSimulationControl").addEventListener("change",function(e){Oe=this.checked,document.getElementById("alwaysSimulateControl").disabled=!this.checked},!1),document.getElementById("alwaysSimulateControl").addEventListener("change",function(e){we=this.checked},!1),document.getElementById("movespeed").addEventListener("change",function(e){document.getElementById("traveltime").innerHTML=(V/document.getElementById("movespeed").value).toFixed(2)},!1),document.getElementById("navigateToggle").addEventListener("click",L,!1),document.getElementById("lineToggle").addEventListener("click",L,!1),document.getElementById("circleToggle").addEventListener("click",L,!1),document.getElementById("observerToggle").addEventListener("click",L,!1),document.getElementById("sentryToggle").addEventListener("click",L,!1),document.getElementById("reset").addEventListener("click",function(){history&&history.replaceState&&history.replaceState(null,"",window.location.href.split("?")[0]),C(),de.destroyFeatures(),ye.destroyFeatures(),fe.destroyFeatures(),me.clearMarkers(),j.line.cancel(),j.circle.cancel(),te.setBaseLayer(re[0]),te.zoomToMaxExtent(),document.getElementById("dataControl").selectedIndex=0,A()},!1),document.getElementById("dataControl").addEventListener("change",function(){l.setQueryString("data",document.getElementById("dataControl").value),C(),A()},!1);var Te=(Date.now(),new r(s,n,function(){U()})),Me=0,ke=40}var r=e("dota-vision-simulation"),s=e("dota-vision-simulation/src/worlddata.json"),a=e("./getLightUnion"),o=e("./util/trim"),l=e("./util/queryString"),h=e("rollbar-browser"),u={accessToken:"fe7cf327f2b24bb8991e252239f6200f",captureUncaught:!0,ignoredMessages:["SecurityError: DOM Exception 18: An attempt was made to break through the security policy of the user agent.","SecurityError:  An attempt was made to break through the security policy of the user agent.","Script error."],payload:{environment:"production",client:{javascript:{source_map_enabled:!0,code_version:"d42ce1745dc43e4a4fda9b941b0654425b09d561",guess_uncaught_frames:!0}}}},p=h.init(u);t.exports=i},{"./conversionFunctions":3,"./getLightUnion":4,"./mapConstants":5,"./styleConstants":6,"./util/queryString":7,"./util/trim":8,"dota-vision-simulation":13,"dota-vision-simulation/src/worlddata.json":14,"rollbar-browser":1}],3:[function(e,t,n){function i(e,t,n){return n*(t-e)+e}function r(e,t,n){return(n-e)/(t-e)}function s(e,t){var n=i(u.map_x_boundaries[0],u.map_x_boundaries[1],e/u.map_w),r=i(u.map_y_boundaries[0],u.map_y_boundaries[1],(u.map_h-t)/u.map_h);return{x:n,y:r}}function a(e,t){var n=r(u.map_x_boundaries[0],u.map_x_boundaries[1],e)*u.map_w,i=u.map_h-r(u.map_y_boundaries[0],u.map_y_boundaries[1],t)*u.map_h;return{x:n,y:i}}function o(e){return parseInt(Math.floor(e/64))}function l(e){return e/(u.map_x_boundaries[1]-u.map_x_boundaries[0])*u.map_w}function h(e,t,n){return 1==e&&"km"==t?n*u.scale*1e3:n*u.scale}var u=e("./mapConstants");t.exports={lerp:i,reverseLerp:r,latLonToWorld:s,worldToLatLon:a,getTileRadius:o,getScaledRadius:l,calculateDistance:h}},{"./mapConstants":5}],4:[function(e,t,n){function i(e,t,n,r,s){for(var a=c(r),o=[[1,0],[0,-1],[-1,0],[0,1]],l=0;l<o.length;l++){var h=a.x+o[l][0],u=a.y+o[l][1];if(e[h]&&e[h][u]){var p=e[h][u].key;!n[p]&&t[p]&&(n[p]=s,i(e,t,n,p,s))}}}function r(e,t){var n={},r=1;for(var s in t)n[s]||(n[s]=r,i(e,t,n,s,r),r++);for(var a=[],o=1;o<r;o++)a.push(l(e,n,o));return a}function s(e,t,n,i){var r=n.x+i[0],s=n.y+i[1];if(!e[r]||!e[r][s])return!0;var a=e[r][s].key;return!t[a]}function a(e,t,n){for(var i=0;i<8;i+=2){var r=n.x+Math.round(Math.cos(2*Math.PI-Math.PI/4*i)),s=n.y+Math.round(Math.sin(2*Math.PI-Math.PI/4*i));if(!e[r]||!e[r][s])return i;var a=e[r][s].key;if(!t[a])return i}return null}function o(e,t){return(e%t+t)%t}function l(e,t,n){var i,r=[],s=null;for(var o in t){var l=c(o);if(s=a(e,t,l),t[o]==n&&null!==s){i=o;break}}for(var h=u(e,t,i,s);i!==h.key||s!==h.dir;)r.push(h.point),h=u(e,t,h.key,h.dir);return r.push(h.point),r}function h(e,t,n,i,r,a,o){var l=n.x+r[0],h=n.y+r[1];if(e[l]&&e[l][h]){var u=e[n.x+r[0]][n.y+r[1]];return t[u.key]==t[i]&&s(e,t,u,o)?{key:u.key,dir:a}:void 0}}function u(e,t,n,i){var r,a=c(n),l=Math.round(Math.cos(2*Math.PI-Math.PI/4*i)),u=Math.round(Math.sin(2*Math.PI-Math.PI/4*i)),p=o(i+2,8),y=Math.round(Math.cos(2*Math.PI-Math.PI/4*p)),f=Math.round(Math.sin(2*Math.PI-Math.PI/4*p)),m=o(i-1,8),g=Math.round(Math.cos(2*Math.PI-Math.PI/4*m)),v=Math.round(Math.sin(2*Math.PI-Math.PI/4*m));if(s(e,t,a,[y,f]))return{key:n,dir:o(i+2,8),point:d(a.x+g/2,a.y+v/2)};if(r||(r=h(e,t,a,n,[y,f],i,[l,u])),!r){var L=o(i+1,8),O=Math.round(Math.cos(2*Math.PI-Math.PI/4*L)),w=Math.round(Math.sin(2*Math.PI-Math.PI/4*L)),x=o(i-2,8),E=Math.round(Math.cos(2*Math.PI-Math.PI/4*x)),b=Math.round(Math.sin(2*Math.PI-Math.PI/4*x));r=h(e,t,a,n,[O,w],x,[E,b])}return r?(r.point=d(a.x+g/2,a.y+v/2),r):void 0}var p=e("dota-vision-simulation"),c=p.prototype.key2pt,d=(p.prototype.xy2key,p.prototype.xy2pt);t.exports=r},{"dota-vision-simulation":13}],5:[function(e,t,n){var i={map_w:16384,map_h:16384,map_x_boundaries:[-8475.58617377,9327.49124559],map_y_boundaries:[9028.52473332,-8836.61406266]};i.scale=Math.abs(i.map_x_boundaries[1]-i.map_x_boundaries[0])/i.map_w,t.exports=i},{}],6:[function(e,t,n){t.exports={lightblue:{strokeColor:"#007FFF",strokeOpacity:1,strokeWidth:1,fillColor:"#007FFF",fillOpacity:.4},red:{strokeColor:"#FF0000",strokeOpacity:1,strokeWidth:1,fillColor:"#FF0000",fillOpacity:.4},green:{strokeColor:"#00FF00",strokeOpacity:1,strokeWidth:1,fillColor:"#00FF00",fillOpacity:.4},yellow:{strokeColor:"#FFFF00",strokeOpacity:1,strokeWidth:1,fillColor:"#FFFF00",fillOpacity:.4}}},{}],7:[function(e,t,n){function i(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),n=t.exec(location.search);return null==n?"":decodeURIComponent(n[1].replace(/\+/g," "))}function r(e,t){history&&history.replaceState&&history.replaceState(null,"",o(e,t))}function s(e,t){var n=i(e);n=l(l(n," ;")+";"+t," ;"),history&&history.replaceState&&history.replaceState(null,"",o(e,n))}function a(e,t){var n=i(e);n=l(l(n," ;").replace(t,"").replace(/;;/g,"")," ;"),history&&history.replaceState&&history.replaceState(null,"",o(e,""!=n?n:null))}function o(e,t,n){n||(n=window.location.href);var i,r=new RegExp("([?&])"+e+"=.*?(&|#|$)(.*)","gi");if(r.test(n))return"undefined"!=typeof t&&null!==t?n.replace(r,"$1"+e+"="+t+"$2$3"):(i=n.split("#"),n=i[0].replace(r,"$1$3").replace(/(&|\?)$/,""),"undefined"!=typeof i[1]&&null!==i[1]&&(n+="#"+i[1]),n);if("undefined"!=typeof t&&null!==t){var s=n.indexOf("?")!==-1?"&":"?";return i=n.split("#"),n=i[0]+s+e+"="+t,"undefined"!=typeof i[1]&&null!==i[1]&&(n+="#"+i[1]),n}return n}var l=e("./trim");t.exports={getParameterByName:i,setQueryString:r,addQueryStringValue:s,removeQueryStringValue:a,updateQueryString:o}},{"./trim":8}],8:[function(e,t,n){function i(e){return e.replace(/[\[\](){}?*+\^$\\.|\-]/g,"\\$&")}var r=function(e,t,n){if(n=n||"g","string"!=typeof e||"string"!=typeof t||"string"!=typeof n)throw new TypeError("argument must be string");if(!/^[gi]*$/.test(n))throw new TypeError("Invalid flags supplied '"+n.match(new RegExp("[^gi]*"))+"'");return t=i(t),e.replace(new RegExp("^["+t+"]+|["+t+"]+$",n),"")};t.exports=r},{}],9:[function(e,t,n){function i(e){this.imagePath=e,self.canvas=null,self.png=null}var r=e("png-js");i.prototype.load=function(e){var t=this;Date.now();t.canvas=document.createElement("canvas"),r.load(this.imagePath,t.canvas,function(n){t.png=n,t.ctx=t.canvas.getContext("2d"),e()})},i.prototype.scan=function(e,t,n,i,r){for(var s=this.ctx.getImageData(e,0,t,n),a=s.data,o=0;o<a.length;o+=4){var l=a[o],h=a[o+1],u=a[o+2],p=(a[o+3],Math.floor(o/4%t)),c=Math.floor(o/4/n);i(p,c,[l,h,u],r)}},t.exports=i},{"png-js":10}],10:[function(e,t,n){var i,r=e("./zlib");i=function(){function e(e){var t,n,i,r,s,a,o,l,h,u,p,c;for(this.data=e,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.text={},i=null;;){switch(t=this.readUInt32(),o=function(){var e,t;for(t=[],r=e=0;e<4;r=++e)t.push(String.fromCharCode(this.data[this.pos++]));return t}.call(this).join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"PLTE":this.palette=this.read(t);break;case"IDAT":for("fdAT"===o&&(this.pos+=4,t-=4),e=(null!=i?i.data:void 0)||this.imgData,r=u=0;0<=t?u<t:u>t;r=0<=t?++u:--u)e.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(this.transparency.indexed=this.read(t),l=255-this.transparency.indexed.length,l>0)for(r=p=0;0<=l?p<l:p>l;r=0<=l?++p:--p)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(t)[0];break;case 2:this.transparency.rgb=this.read(t)}break;case"tEXt":h=this.read(t),s=h.indexOf(0),a=String.fromCharCode.apply(String,h.slice(0,s)),this.text[a]=String.fromCharCode.apply(String,h.slice(s+1));break;case"IEND":return i&&this.animation.frames.push(i),this.colors=function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(this),this.hasAlphaChannel=4===(c=this.colorType)||6===c,n=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*n,this.colorSpace=function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=t}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}return e.load=function(t,n,i){var r;return"function"==typeof n&&(i=n),r=new XMLHttpRequest,r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=function(){var t,s;return t=new Uint8Array(r.response||r.mozResponseArrayBuffer),s=new e(t),"function"==typeof(null!=n?n.getContext:void 0)&&s.render(n),"function"==typeof i?i(s):void 0},r.send(null)},e.prototype.read=function(e){var t,n,i;for(i=[],t=n=0;0<=e?n<e:n>e;t=0<=e?++n:--n)i.push(this.data[this.pos++]);return i},e.prototype.readUInt32=function(){var e,t,n,i;return e=this.data[this.pos++]<<24,t=this.data[this.pos++]<<16,n=this.data[this.pos++]<<8,i=this.data[this.pos++],e|t|n|i},e.prototype.readUInt16=function(){var e,t;return e=this.data[this.pos++]<<8,t=this.data[this.pos++],e|t},e.prototype.decodePixels=function(e){var t,n,i,s,a,o,l,h,u,p,c,d,y,f,m,g,v,L,O,w,x,E,b;if(null==e&&(e=this.imgData),0===e.length)return new Uint8Array(0);for(e=new r(e),e=e.getBytes(),d=this.pixelBitlength/8,g=d*this.width,y=new Uint8Array(g*this.height),o=e.length,m=0,f=0,n=0;f<o;){switch(e[f++]){case 0:for(s=O=0;O<g;s=O+=1)y[n++]=e[f++];break;case 1:for(s=w=0;w<g;s=w+=1)t=e[f++],a=s<d?0:y[n-d],y[n++]=(t+a)%256;break;case 2:for(s=x=0;x<g;s=x+=1)t=e[f++],i=(s-s%d)/d,v=m&&y[(m-1)*g+i*d+s%d],y[n++]=(v+t)%256;break;case 3:for(s=E=0;E<g;s=E+=1)t=e[f++],i=(s-s%d)/d,a=s<d?0:y[n-d],v=m&&y[(m-1)*g+i*d+s%d],y[n++]=(t+Math.floor((a+v)/2))%256;
break;case 4:for(s=b=0;b<g;s=b+=1)t=e[f++],i=(s-s%d)/d,a=s<d?0:y[n-d],0===m?v=L=0:(v=y[(m-1)*g+i*d+s%d],L=i&&y[(m-1)*g+(i-1)*d+s%d]),l=a+v-L,h=Math.abs(l-a),p=Math.abs(l-v),c=Math.abs(l-L),u=h<=p&&h<=c?a:p<=c?v:L,y[n++]=(t+u)%256;break;default:throw new Error("Invalid filter algorithm: "+e[f-1])}m++}return y},e.prototype.decodePalette=function(){var e,t,n,i,r,s,a,o,l,h;for(i=this.palette,a=this.transparency.indexed||[],s=new Uint8Array((a.length||0)+i.length),r=0,n=i.length,e=0,t=o=0,l=i.length;o<l;t=o+=3)s[r++]=i[t],s[r++]=i[t+1],s[r++]=i[t+2],s[r++]=null!=(h=a[e++])?h:255;return s},e.prototype.copyToImageData=function(e,t){var n,i,r,s,a,o,l,h,u,p,c;if(i=this.colors,u=null,n=this.hasAlphaChannel,this.palette.length&&(u=null!=(c=this._decodedPalette)?c:this._decodedPalette=this.decodePalette(),i=4,n=!0),r=e.data||e,h=r.length,a=u||t,s=o=0,1===i)for(;s<h;)l=u?4*t[s/4]:o,p=a[l++],r[s++]=p,r[s++]=p,r[s++]=p,r[s++]=n?a[l++]:255,o=l;else for(;s<h;)l=u?4*t[s/4]:o,r[s++]=a[l++],r[s++]=a[l++],r[s++]=a[l++],r[s++]=n?a[l++]:255,o=l},e.prototype.decode=function(){var e;return e=new Uint8Array(this.width*this.height*4),this.copyToImageData(e,this.decodePixels()),e},e.prototype.render=function(e){var t,n;return e.width=this.width,e.height=this.height,t=e.getContext("2d"),n=t.createImageData(this.width,this.height),this.copyToImageData(n,this.decodePixels()),t.putImageData(n,0,0)},e}(),t.exports=i},{"./zlib":11}],11:[function(e,t,n){var i=function(){function e(){this.pos=0,this.bufferLength=0,this.eof=!1,this.buffer=null}return e.prototype={ensureBuffer:function(e){var t=this.buffer,n=t?t.byteLength:0;if(e<n)return t;for(var i=512;i<e;)i<<=1;for(var r=new Uint8Array(i),s=0;s<n;++s)r[s]=t[s];return this.buffer=r},getByte:function(){for(var e=this.pos;this.bufferLength<=e;){if(this.eof)return null;this.readBlock()}return this.buffer[this.pos++]},getBytes:function(e){var t=this.pos;if(e){this.ensureBuffer(t+e);for(var n=t+e;!this.eof&&this.bufferLength<n;)this.readBlock();var i=this.bufferLength;n>i&&(n=i)}else{for(;!this.eof;)this.readBlock();var n=this.bufferLength}return this.pos=n,this.buffer.subarray(t,n)},lookChar:function(){for(var e=this.pos;this.bufferLength<=e;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos])},getChar:function(){for(var e=this.pos;this.bufferLength<=e;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos++])},makeSubStream:function(e,t,n){for(var i=e+t;this.bufferLength<=i&&!this.eof;)this.readBlock();return new Stream(this.buffer,e,t,n)},skip:function(e){e||(e=1),this.pos+=e},reset:function(){this.pos=0}},e}(),r=function(){function e(e){throw new Error(e)}function t(t){var n=0,r=t[n++],s=t[n++];r!=-1&&s!=-1||e("Invalid header in flate stream"),8!=(15&r)&&e("Unknown compression method in flate stream"),((r<<8)+s)%31!=0&&e("Bad FCHECK in flate stream"),32&s&&e("FDICT bit set in flate stream"),this.bytes=t,this.bytesPos=n,this.codeSize=0,this.codeBuf=0,i.call(this)}var n=new Uint32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),r=new Uint32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),s=new Uint32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,724993,727041,794625,798721,868353,876545]),a=[new Uint32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,459020,524392,524328,59e4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],o=[new Uint32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];return t.prototype=Object.create(i.prototype),t.prototype.getBits=function(t){for(var n,i=this.codeSize,r=this.codeBuf,s=this.bytes,a=this.bytesPos;i<t;)"undefined"==typeof(n=s[a++])&&e("Bad encoding in flate stream"),r|=n<<i,i+=8;return n=r&(1<<t)-1,this.codeBuf=r>>t,this.codeSize=i-=t,this.bytesPos=a,n},t.prototype.getCode=function(t){for(var n=t[0],i=t[1],r=this.codeSize,s=this.codeBuf,a=this.bytes,o=this.bytesPos;r<i;){var l;"undefined"==typeof(l=a[o++])&&e("Bad encoding in flate stream"),s|=l<<r,r+=8}var h=n[s&(1<<i)-1],u=h>>16,p=65535&h;return(0==r||r<u||0==u)&&e("Bad encoding in flate stream"),this.codeBuf=s>>u,this.codeSize=r-u,this.bytesPos=o,p},t.prototype.generateHuffmanTable=function(e){for(var t=e.length,n=0,i=0;i<t;++i)e[i]>n&&(n=e[i]);for(var r=1<<n,s=new Uint32Array(r),a=1,o=0,l=2;a<=n;++a,o<<=1,l<<=1)for(var h=0;h<t;++h)if(e[h]==a){for(var u=0,p=o,i=0;i<a;++i)u=u<<1|1&p,p>>=1;for(var i=u;i<r;i+=l)s[i]=a<<16|h;++o}return[s,n]},t.prototype.readBlock=function(){function t(e,t,n,i,r){for(var s=e.getBits(n)+i;s-- >0;)t[E++]=r}var i=this.getBits(3);if(1&i&&(this.eof=!0),i>>=1,0==i){var l,h=this.bytes,u=this.bytesPos;"undefined"==typeof(l=h[u++])&&e("Bad block header in flate stream");var p=l;"undefined"==typeof(l=h[u++])&&e("Bad block header in flate stream"),p|=l<<8,"undefined"==typeof(l=h[u++])&&e("Bad block header in flate stream");var c=l;"undefined"==typeof(l=h[u++])&&e("Bad block header in flate stream"),c|=l<<8,c!=(65535&~p)&&e("Bad uncompressed block length in flate stream"),this.codeBuf=0,this.codeSize=0;var d=this.bufferLength,y=this.ensureBuffer(d+p),f=d+p;this.bufferLength=f;for(var m=d;m<f;++m){if("undefined"==typeof(l=h[u++])){this.eof=!0;break}y[m]=l}return void(this.bytesPos=u)}var g,v;if(1==i)g=a,v=o;else if(2==i){for(var L=this.getBits(5)+257,O=this.getBits(5)+1,w=this.getBits(4)+4,x=Array(n.length),E=0;E<w;)x[n[E++]]=this.getBits(3);for(var b=this.generateHuffmanTable(x),S=0,E=0,C=L+O,P=new Array(C);E<C;){var _=this.getCode(b);16==_?t(this,P,2,3,S):17==_?t(this,P,3,3,S=0):18==_?t(this,P,7,11,S=0):P[E++]=S=_}g=this.generateHuffmanTable(P.slice(0,L)),v=this.generateHuffmanTable(P.slice(L,C))}else e("Unknown block type in flate stream");for(var y=this.buffer,T=y?y.length:0,M=this.bufferLength;;){var k=this.getCode(g);if(k<256)M+1>=T&&(y=this.ensureBuffer(M+1),T=y.length),y[M++]=k;else{if(256==k)return void(this.bufferLength=M);k-=257,k=r[k];var I=k>>16;I>0&&(I=this.getBits(I));var S=(65535&k)+I;k=this.getCode(v),k=s[k],I=k>>16,I>0&&(I=this.getBits(I));var R=(65535&k)+I;M+S>=T&&(y=this.ensureBuffer(M+S),T=y.length);for(var N=0;N<S;++N,++M)y[M]=y[M-R]}}},t}();t.exports=r},{}],12:[function(e,t,n){function i(e,t){return e>0&&t<0||!(t>0&&e<0)&&e<t}function r(e,t){return!i(e,t)}function s(e,t,n){return t<n?t<=e&&e<=n:t<=e&&e<=Math.PI||-Math.PI<=e&&e<=n}function a(e){return e>Math.PI?-(2*Math.PI-e):e<-Math.PI?2*Math.PI+e:e}function o(e,t){return e>0&&t<0?Math.abs(Math.PI-e-(-Math.PI-t)):t>0&&e<0?Math.abs(-e+t):e<=0&&t<=0?r(e,t)?-e+Math.PI-(-Math.PI-t):Math.abs(t-e):r(e,t)?Math.PI+(Math.PI-e)+t:Math.abs(t-e)}function l(e){for(var t=0,n=0;n<e.length;n++)t+=o(e[n][0],e[n][1]);return t}var h={DIRS:{4:[[0,-1],[1,0],[0,1],[-1,0]],8:[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],6:[[-1,-1],[1,-1],[2,0],[1,1],[-1,1],[-2,0]]}};Number.prototype.mod=function(e){return(this%e+e)%e},Object.create||(Object.create=function(e){var t=function(){};return t.prototype=e,new t}),Function.prototype.extend=function(e){return this.prototype=Object.create(e.prototype),this.prototype.constructor=this,this},"undefined"!=typeof window&&(window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return setTimeout(e,1e3/60)},window.cancelAnimationFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||function(e){return clearTimeout(e)}),h.FOV=function(e,t){this._lightPasses=e,this._options={topology:8};for(var n in t)this._options[n]=t[n]},h.FOV.prototype.compute=function(e,t,n,i){},h.FOV.prototype._getCircle=function(e,t,n){var i,r,s,a=[];switch(this._options.topology){case 4:r=1,s=[0,1],i=[h.DIRS[8][7],h.DIRS[8][1],h.DIRS[8][3],h.DIRS[8][5]];break;case 6:i=h.DIRS[6],r=1,s=[-1,1];break;case 8:i=h.DIRS[4],r=2,s=[-1,1]}for(var o=e+s[0]*n,l=t+s[1]*n,u=0;u<i.length;u++)for(var p=0;p<n*r;p++)a.push([o,l]),o+=i[u][0],l+=i[u][1];return a},h.FOV.PreciseShadowcasting=function(e,t){h.FOV.call(this,e,t)},h.FOV.PreciseShadowcasting.extend(h.FOV),h.FOV.PreciseShadowcasting.prototype.compute=function(e,t,n,i){if(i(e,t,0,1),i(e-1,t-1,0,1),i(e,t-1,0,1),i(e+1,t-1,0,1),i(e-1,t,0,1),i(e+1,t,0,1),i(e-1,t+1,0,1),i(e,t+1,0,1),i(e+1,t+1,0,1),i(e-1,t-2,0,1),i(e,t-2,0,1),i(e+1,t-2,0,1),i(e-2,t-1,0,1),i(e-2,t,0,1),i(e-2,t+1,0,1),i(e+2,t-1,0,1),i(e+2,t,0,1),i(e+2,t+1,0,1),i(e-1,t+2,0,1),i(e,t+2,0,1),i(e+1,t+2,0,1),this._lightPasses(e,t))for(var r,s,o,l,h,u,p,c,d,y,f,m,g,v,L,O,w=[],x={},E=1;E<=n;E++){var b=this._getCircle(e,t,E),S=b.length;x={};for(var C=0;C<S;C++){r=b[C][0],s=b[C][1];var P=r+","+s,_=_=this.walls[P];if(_&&_.length){for(var T=!1,M=0;M<_.length;M++){var O=_[M];g=O[1],v=O[2],m=O[3],p=g-e,c=v-t,d=Math.sqrt(p*p+c*c),d>.5&&(y=Math.asin(m/d),f=Math.atan2(c,p),l=a(f-y),h=a(f+y),o=!this._lightPasses(r,s),dx1=r-e,dy1=s-t,L=Math.sqrt(dx1*dx1+dy1*dy1),L<d&&(x[O[1]+","+O[2]]=[O[1],O[2]]),p=r-e,c=s-t,d=Math.sqrt(p*p+c*c),y=Math.asin(m/d),f=Math.atan2(c,p),l=a(f-y),h=a(f+y),u=this._checkVisibility(f,l,h,!1,w),u||(T=!0))}u&&!T&&i(r,s,E,u)}else if(g=r,v=s,m=Math.SQRT2/2,p=g-e,c=v-t,d=Math.sqrt(p*p+c*c),d>.5&&(y=Math.asin(m/d),f=Math.atan2(c,p),l=a(f-y),h=a(f+y),o=!this._lightPasses(r,s),u=this._checkVisibility(f,l,h,o,w),u&&i(r,s,E,u),this.done))return}for(var k in x)if(g=x[k][0],v=x[k][1],p=g-e,c=v-t,d=Math.sqrt(p*p+c*c),m=Math.SQRT2-.01,d>.5&&(y=Math.asin(m/d),f=Math.atan2(c,p),l=a(f-y),h=a(f+y),u=this._checkVisibility(f,l,h,!0,w),this.done))return}},h.FOV.PreciseShadowcasting.prototype._checkVisibility=function(e,t,n,i,r){for(var a=!i,o=0;o<r.length;o++){var l=r[o];if(s(e,l[0],l[1])){if(!i)return!1;a=!1}}return i&&(t<0&&n>=0?(this._mergeShadows(e,0,n,i,r),this.done=!1,this._mergeShadows(e,t,0,i,r)):this._mergeShadows(e,t,n,i,r),1!=r.length||s(t,r[0][0],r[0][1])&&s(n,r[0][0],r[0][1])||t==r[0][0]||n==r[0][1]||(this.done=!0)),a},h.FOV.PreciseShadowcasting.prototype._mergeShadows=function(e,t,n,r,a){for(var o=0,h=!1,u=0;o<a.length;){var p=a[o];if(u=o,s(t,p[0],p[1])){h=!0;break}if(o>0&&s(t,a[o-1][1],p[0])){h=!1;break}if(i(t,p[1])){if(i(t,p[0]))break;o++}else o++,u=o}for(var c=a.length-1,d=!1,y=0;c>=0;){var p=a[c];if(y=c,s(n,p[0],p[1])){d=!0;break}if(i(n,p[0]))c--,y=c;else{if(!i(n,p[1]))break;c--}}if(u==a.length&&!h&&0==y&&d&&(u=0),0==a.length)a.push([t,n]);else{var f=[h?a[u][0]:t,d?a[y][1]:n];y=Math.max(u,y);var m=l(a),g=!1;s(0,f[0],f[1])&&0!=f[0]&&0!=f[1]?(a.splice(u,u!=y||h!=d||h?y-u+1:0,[f[0],0]),0!=a[0][0]&&a[0][1]!=f[1]&&a.splice(u+1,0,[0,f[1]]),g=!0):a.splice(u,u!=y||h!=d||h?y-u+1:0,f);var v=l(a);if(v<m&&(this.done=!0),0==f[0]||g)for(var L=0;0!=a[0][0]&&(a.push(a.shift()),!(L>=a.length));)L++}},t.exports=h},{}],13:[function(e,t,n){function i(e){if(e in c)return c[e];var t=e.split(",").map(function(e){return parseInt(e)}),n={x:t[0],y:t[1],key:e};return c[e]=n,n}function r(e,t){return e+","+t}function s(e,t){return{x:e,y:t,key:e+","+t}}function a(e){return e.x+","+e.y}function o(e,t){var n=(Date.now(),{});for(var i in e){var r=e[i];if(r.z>t)e:for(var s=-1;s<=1;s++)for(var a=-1;a<=1;a++)if(0!==s||0!==a){var o=r.x+s+","+(r.y+a);if(e[o]&&e[o].z<=t){n[r.key]=r;break e}}}return n}function l(e,t,n,i,r,s){for(var a in n)t<i[a]&&r[a]&&s[a].forEach(function(t){var i=t.x+","+t.y;e[i]=(e[i]||[]).concat([["tree",n[a].x,n[a].y,Math.SQRT2]])})}function h(e,t,n,i){function r(e,t,n,i,r){var s={};return e.scan(t,n,i,r,s),s}function a(e,t,n,i){var r=d.ImageXYtoGridXY(e,t);0===n[0]&&(i[r.x+","+r.y]=r)}function o(e,t,n,i){var r=d.ImageXYtoGridXY(e,t);r.z=n[0],i[r.x+","+r.y]=r,d.elevationValues.indexOf(n[0])==-1&&d.elevationValues.push(n[0])}function h(e,t,n,i){var r=d.ImageXYtoGridXY(e,t);if(0==n[1]&&0==n[2]){var a=s(r.x-.5,r.y-.5),o=n[0]+40,l=a.key;d.tree[l]=a,d.tree_elevations[l]=o,d.tree_blocks[l]=[],d.tree_state[l]=!0,[Math.floor,Math.ceil].forEach(function(e){[Math.floor,Math.ceil].forEach(function(t){var n=s(e(a.x),t(a.y));d.tree_relations[n.key]=(d.tree_relations[n.key]||[]).concat(a),d.tree_blocks[l].push(n)})})}}var d=this;this.opts=i||{},this.grid=[],this.gridnav=null,this.ent_fow_blocker_node=null,this.tools_no_wards=null,this.elevationValues=[],this.elevationGrid=null,this.elevationWalls={},this.treeWalls={},this.tree={},this.tree_blocks={},this.tree_relations={},this.tree_elevations={},this.tree_state={},this.walls={},this.radius=this.opts.radius||parseInt(25),this.lights={},this.worldMinX=e.worldMinX,this.worldMinY=e.worldMinY,this.worldMaxX=e.worldMaxX,this.worldMaxY=e.worldMaxY,this.worldWidth=this.worldMaxX-this.worldMinX,this.worldHeight=this.worldMaxY-this.worldMinY,this.gridWidth=this.worldWidth/64+1,this.gridHeight=this.worldHeight/64+1,this.ready=!1,this.imageHandler=new u(t);Date.now();this.imageHandler.load(function(){Date.now();d.gridnav=r(d.imageHandler,2*d.gridWidth,d.gridWidth,d.gridHeight,a),d.ent_fow_blocker_node=r(d.imageHandler,3*d.gridWidth,d.gridWidth,d.gridHeight,a),d.tools_no_wards=r(d.imageHandler,4*d.gridWidth,d.gridWidth,d.gridHeight,a),r(d.imageHandler,d.gridWidth,d.gridWidth,d.gridHeight,h),d.elevationGrid=r(d.imageHandler,0,d.gridWidth,d.gridHeight,o);Date.now();d.elevationValues.forEach(function(e){d.treeWalls[e]={},l(d.treeWalls[e],e,d.tree,d.tree_elevations,d.tree_state,d.tree_blocks)});for(var e=(Date.now(),0);e<d.gridWidth;e++){d.grid[e]=[];for(var t=0;t<d.gridHeight;t++){var i=s(e,t);c[i.key]=i,d.grid[e].push(i)}}Date.now();d.ready=!0,n()}),this.lightPassesCallback=function(e,t){var n=e+","+t;return!(n in d.elevationWalls[d.elevation]||n in d.ent_fow_blocker_node||n in d.treeWalls[d.elevation]&&d.treeWalls[d.elevation][n].length>0)},this.fov=new p.FOV.PreciseShadowcasting(this.lightPassesCallback,{topology:8})}var u=e("./imageHandler.js"),p=e("./rot6.js"),c={};h.prototype.updateVisibility=function(e,t,n){var i=this,s=r(e,t);n=n||i.radius,this.elevation=this.elevationGrid[s].z,this.walls=this.treeWalls[this.elevation],this.elevationWalls[this.elevation]||(this.elevationWalls[this.elevation]=o(this.elevationGrid,this.elevation)),this.fov.walls=this.walls,this.lights={},this.fov.compute(e,t,n,function(s,a,o,l){var h=r(s,a);if(i.elevationGrid[h]){var u=i.tree_relations[h],p=!1;if(u)for(var c=0;c<u.length;c++){var d=u[c];if(p=i.tree_state[d.key]&&i.tree_elevations[d.key]>i.elevation)break}1==l&&!i.ent_fow_blocker_node[h]&&!p&&(e-s)*(e-s)+(t-a)*(t-a)<n*n&&(i.lights[h]=255)}})},h.prototype.isValidXY=function(e,t,n,i,s){if(!this.ready)return!1;var a=r(e,t),o=!1;if(s){var l=this.tree_relations[a];if(l)for(var h=0;h<l.length;h++){var u=l[h];if(o=this.tree_state[u.key])break}}return!(!(e>=0&&e<this.gridWidth&&t>=0&&t<this.gridHeight)||n&&this.gridnav[a]||i&&this.tools_no_wards[a]||s&&o)},h.prototype.toggleTree=function(e,t){var n=this,i=r(e,t),s=!!this.tree_relations[i];if(s)for(var a=this.tree_relations[i],o=0;o<a.length;o++){var l=a[o];this.tree_state[l.key]=!this.tree_state[l.key],this.elevationValues.forEach(function(e){e<n.tree_elevations[l.key]&&(n.tree_blocks[l.key].forEach(function(t){for(var i=n.treeWalls[e][t.key].length-1;i>=0;i--)l.x==n.treeWalls[e][t.key][i][1]&&l.y==n.treeWalls[e][t.key][i][2]&&n.treeWalls[e][t.key].splice(i,1)}),n.tree_state[l.key]&&n.tree_blocks[l.key].forEach(function(t){n.treeWalls[e][t.key]=(n.treeWalls[e][t.key]||[]).concat([["tree",l.x,l.y,Math.SQRT2]])}))})}return s},h.prototype.setRadius=function(e){this.radius=e},h.prototype.WorldXYtoGridXY=function(e,t,n){var i=(e-this.worldMinX)/64,r=(t-this.worldMinY)/64;return n||(i=parseInt(Math.round(i)),r=parseInt(Math.round(r))),{x:i,y:r,key:i+","+r}},h.prototype.GridXYtoWorldXY=function(e,t){return{x:64*e+this.worldMinX,y:64*t+this.worldMinY}},h.prototype.GridXYtoImageXY=function(e,t){return{x:e,y:this.gridHeight-t-1}},h.prototype.ImageXYtoGridXY=function(e,t){var n=this.gridHeight-t-1;return{x:e,y:n,key:e+","+n}},h.prototype.WorldXYtoImageXY=function(e,t){var n=this.WorldXYtoGridXY(e,t);return this.GridXYtoImageXY(n.x,n.y)},h.prototype.key2pt=i,h.prototype.xy2key=r,h.prototype.xy2pt=s,h.prototype.pt2key=a,t.exports=h},{"./imageHandler.js":9,"./rot6.js":12}],14:[function(e,t,n){t.exports={worldMinX:-8288,worldMaxX:8288,worldMinY:-8288,worldMaxY:8288}},{}]},{},[2])(2)});
//# sourceMappingURL=bundle.min.js.d42ce17.map
