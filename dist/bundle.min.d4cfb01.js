var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,i){if(i.get||i.set)throw new TypeError("ES3 does not support getters and setters.");e!=Array.prototype&&e!=Object.prototype&&(e[t]=i.value)},$jscomp.getGlobal=function(e){return"undefined"!=typeof window&&window===e?e:"undefined"!=typeof global&&null!=global?global:e},$jscomp.global=$jscomp.getGlobal(this),$jscomp.polyfill=function(e,t,i,n){if(t){for(i=$jscomp.global,e=e.split("."),n=0;n<e.length-1;n++){var s=e[n];s in i||(i[s]={}),i=i[s]}e=e[e.length-1],n=i[e],t=t(n),t!=n&&null!=t&&$jscomp.defineProperty(i,e,{configurable:!0,writable:!0,value:t})}},$jscomp.polyfill("Array.prototype.fill",function(e){return e?e:function(e,t,i){var n=this.length||0;for(0>t&&(t=Math.max(0,n+t)),(null==i||i>n)&&(i=n),i=Number(i),0>i&&(i=Math.max(0,n+i)),t=Number(t||0);t<i;t++)this[t]=e;return this}},"es6-impl","es3");var OpenLayers={VERSION_NUMBER:"Release 2.14 dev",singleFile:!0,_getScriptLocation:function(){for(var e,t=/(^|(.*?\/))(OpenLayers[^\/]*?\.js)(\?|$)/,i=document.getElementsByTagName("script"),n="",s=0,r=i.length;s<r;s++)if((e=i[s].getAttribute("src"))&&(e=e.match(t))){n=e[1];break}return function(){return n}}(),ImgPath:""};OpenLayers.Class=function(){var e=arguments.length,t=arguments[0],i=arguments[e-1],n="function"==typeof i.initialize?i.initialize:function(){t.prototype.initialize.apply(this,arguments)};return 1<e?(e=[n,t].concat(Array.prototype.slice.call(arguments).slice(1,e-1),i),OpenLayers.inherit.apply(null,e)):n.prototype=i,n},OpenLayers.inherit=function(e,t){var i=function(){};i.prototype=t.prototype,e.prototype=new i;var n,s,i=2;for(n=arguments.length;i<n;i++)s=arguments[i],"function"==typeof s&&(s=s.prototype),OpenLayers.Util.extend(e.prototype,s)},OpenLayers.Util=OpenLayers.Util||{},OpenLayers.Util.extend=function(e,t){if(e=e||{},t){for(var i in t){var n=t[i];void 0!==n&&(e[i]=n)}"function"==typeof window.Event&&t instanceof window.Event||!t.hasOwnProperty||!t.hasOwnProperty("toString")||(e.toString=t.toString)}return e},OpenLayers.String={startsWith:function(e,t){return 0==e.indexOf(t)},contains:function(e,t){return-1!=e.indexOf(t)},trim:function(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},camelize:function(e){e=e.split("-");for(var t=e[0],i=1,n=e.length;i<n;i++)var s=e[i],t=t+(s.charAt(0).toUpperCase()+s.substring(1));return t},format:function(e,t,i){return t||(t=window),e.replace(OpenLayers.String.tokenRegEx,function(e,n){for(var s,r=n.split(/\.+/),a=0;a<r.length&&(0==a&&(s=t),void 0!==s);a++)s=s[r[a]];return"function"==typeof s&&(s=i?s.apply(null,i):s()),"undefined"==typeof s?"undefined":s})},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(e){return OpenLayers.String.numberRegEx.test(e)},numericIf:function(e,t){var i=e;return!0===t&&null!=e&&e.replace&&(e=e.replace(/^\s*|\s*$/g,"")),OpenLayers.String.isNumeric(e)?parseFloat(e):i}},OpenLayers.Number={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(e,t){var i=0;return 0<t&&(i=parseFloat(e.toPrecision(t))),i},format:function(e,t,i,n){t="undefined"!=typeof t?t:0,i="undefined"!=typeof i?i:OpenLayers.Number.thousandsSeparator,n="undefined"!=typeof n?n:OpenLayers.Number.decimalSeparator,null!=t&&(e=parseFloat(e.toFixed(t)));var s=e.toString().split(".");if(1==s.length&&null==t&&(t=0),e=s[0],i)for(var r=/(-?[0-9]+)([0-9]{3})/;r.test(e);)e=e.replace(r,"$1"+i+"$2");return 0==t?t=e:(i=1<s.length?s[1]:"0",null!=t&&(i+=Array(t-i.length+1).join("0")),t=e+n+i),t},zeroPad:function(e,t,i){for(e=e.toString(i||10);e.length<t;)e="0"+e;return e}},OpenLayers.Function={bind:function(e,t){var i=Array.prototype.slice.call(arguments,2);return function(){var n=i.concat(Array.prototype.slice.call(arguments,0));return e.apply(t,n)}},bindAsEventListener:function(e,t){return function(i){return e.call(t,i||window.event)}},False:function(){return!1},True:function(){return!0},Void:function(){}},OpenLayers.Array={filter:function(e,t,i){var n=[];if(Array.prototype.filter)n=e.filter(t,i);else{var s=e.length;if("function"!=typeof t)throw new TypeError;for(var r=0;r<s;r++)if(r in e){var a=e[r];t.call(i,a,r,e)&&n.push(a)}}return n}},OpenLayers.Bounds=OpenLayers.Class({left:null,bottom:null,right:null,top:null,centerLonLat:null,initialize:function(e,t,i,n){OpenLayers.Util.isArray(e)&&(n=e[3],i=e[2],t=e[1],e=e[0]),null!=e&&(this.left=OpenLayers.Util.toFloat(e)),null!=t&&(this.bottom=OpenLayers.Util.toFloat(t)),null!=i&&(this.right=OpenLayers.Util.toFloat(i)),null!=n&&(this.top=OpenLayers.Util.toFloat(n))},clone:function(){return new OpenLayers.Bounds(this.left,this.bottom,this.right,this.top)},equals:function(e){var t=!1;return null!=e&&(t=this.left==e.left&&this.right==e.right&&this.top==e.top&&this.bottom==e.bottom),t},toString:function(){return[this.left,this.bottom,this.right,this.top].join()},toArray:function(e){return!0===e?[this.bottom,this.left,this.top,this.right]:[this.left,this.bottom,this.right,this.top]},toBBOX:function(e,t){null==e&&(e=6);var i=Math.pow(10,e),n=Math.round(this.left*i)/i,s=Math.round(this.bottom*i)/i,r=Math.round(this.right*i)/i,i=Math.round(this.top*i)/i;return!0===t?s+","+n+","+i+","+r:n+","+s+","+r+","+i},toGeometry:function(){return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(this.left,this.bottom),new OpenLayers.Geometry.Point(this.right,this.bottom),new OpenLayers.Geometry.Point(this.right,this.top),new OpenLayers.Geometry.Point(this.left,this.top)])])},getWidth:function(){return this.right-this.left},getHeight:function(){return this.top-this.bottom},getSize:function(){return new OpenLayers.Size(this.getWidth(),this.getHeight())},getCenterPixel:function(){return new OpenLayers.Pixel((this.left+this.right)/2,(this.bottom+this.top)/2)},getCenterLonLat:function(){return this.centerLonLat||(this.centerLonLat=new OpenLayers.LonLat((this.left+this.right)/2,(this.bottom+this.top)/2)),this.centerLonLat},scale:function(e,t){null==t&&(t=this.getCenterLonLat());var i,n;return"OpenLayers.LonLat"==t.CLASS_NAME?(i=t.lon,n=t.lat):(i=t.x,n=t.y),new OpenLayers.Bounds((this.left-i)*e+i,(this.bottom-n)*e+n,(this.right-i)*e+i,(this.top-n)*e+n)},add:function(e,t){if(null==e||null==t)throw new TypeError("Bounds.add cannot receive null values");return new OpenLayers.Bounds(this.left+e,this.bottom+t,this.right+e,this.top+t)},extend:function(e){if(e)switch(e.CLASS_NAME){case"OpenLayers.LonLat":this.extendXY(e.lon,e.lat);break;case"OpenLayers.Geometry.Point":this.extendXY(e.x,e.y);break;case"OpenLayers.Bounds":this.centerLonLat=null,(null==this.left||e.left<this.left)&&(this.left=e.left),(null==this.bottom||e.bottom<this.bottom)&&(this.bottom=e.bottom),(null==this.right||e.right>this.right)&&(this.right=e.right),(null==this.top||e.top>this.top)&&(this.top=e.top)}},extendXY:function(e,t){this.centerLonLat=null,(null==this.left||e<this.left)&&(this.left=e),(null==this.bottom||t<this.bottom)&&(this.bottom=t),(null==this.right||e>this.right)&&(this.right=e),(null==this.top||t>this.top)&&(this.top=t)},containsLonLat:function(e,t){"boolean"==typeof t&&(t={inclusive:t}),t=t||{};var i=this.contains(e.lon,e.lat,t.inclusive),n=t.worldBounds;return n&&!i&&(i=n.getWidth(),i=this.containsLonLat({lon:e.lon-Math.round((e.lon-(n.left+n.right)/2)/i)*i,lat:e.lat},{inclusive:t.inclusive})),i},containsPixel:function(e,t){return this.contains(e.x,e.y,t)},contains:function(e,t,i){return null==i&&(i=!0),null!=e&&null!=t&&(e=OpenLayers.Util.toFloat(e),t=OpenLayers.Util.toFloat(t),i?e>=this.left&&e<=this.right&&t>=this.bottom&&t<=this.top:e>this.left&&e<this.right&&t>this.bottom&&t<this.top)},intersectsBounds:function(e,t){if("boolean"==typeof t&&(t={inclusive:t}),t=t||{},t.worldBounds){var i=this.wrapDateLine(t.worldBounds);e=e.wrapDateLine(t.worldBounds)}else i=this;null==t.inclusive&&(t.inclusive=!0);var n=!1,s=i.left==e.right||i.right==e.left||i.top==e.bottom||i.bottom==e.top;if(t.inclusive||!s)var n=e.top>=i.bottom&&e.top<=i.top||i.top>e.bottom&&i.top<e.top,s=e.left>=i.left&&e.left<=i.right||i.left>=e.left&&i.left<=e.right,r=e.right>=i.left&&e.right<=i.right||i.right>=e.left&&i.right<=e.right,n=(e.bottom>=i.bottom&&e.bottom<=i.top||i.bottom>=e.bottom&&i.bottom<=e.top||n)&&(s||r);if(t.worldBounds&&!n){var a=t.worldBounds,s=a.getWidth(),r=!a.containsBounds(i),a=!a.containsBounds(e);r&&!a?(e=e.add(-s,0),n=i.intersectsBounds(e,{inclusive:t.inclusive})):a&&!r&&(i=i.add(-s,0),n=e.intersectsBounds(i,{inclusive:t.inclusive}))}return n},containsBounds:function(e,t,i){null==t&&(t=!1),null==i&&(i=!0);var n=this.contains(e.left,e.bottom,i),s=this.contains(e.right,e.bottom,i),r=this.contains(e.left,e.top,i);return e=this.contains(e.right,e.top,i),t?n||s||r||e:n&&s&&r&&e},determineQuadrant:function(e){var t="",i=this.getCenterLonLat(),t=t+(e.lat<i.lat?"b":"t");return t+=e.lon<i.lon?"l":"r"},transform:function(e,t){this.centerLonLat=null;var i=OpenLayers.Projection.transform({x:this.left,y:this.bottom},e,t),n=OpenLayers.Projection.transform({x:this.right,y:this.bottom},e,t),s=OpenLayers.Projection.transform({x:this.left,y:this.top},e,t),r=OpenLayers.Projection.transform({x:this.right,y:this.top},e,t);return this.left=Math.min(i.x,s.x),this.bottom=Math.min(i.y,n.y),this.right=Math.max(n.x,r.x),this.top=Math.max(s.y,r.y),this},wrapDateLine:function(e,t){t=t||{};var i=t.leftTolerance||0,n=t.rightTolerance||0,s=this.clone();if(e){for(var r=e.getWidth();s.left<e.left&&s.right-n<=e.left;)s=s.add(r,0);for(;s.left+i>=e.right&&s.right>e.right;)s=s.add(-r,0);i=s.left+i,i<e.right&&i>e.left&&s.right-n>e.right&&(s=s.add(-r,0))}return s},CLASS_NAME:"OpenLayers.Bounds"}),OpenLayers.Bounds.fromString=function(e,t){var i=e.split(",");return OpenLayers.Bounds.fromArray(i,t)},OpenLayers.Bounds.fromArray=function(e,t){return!0===t?new OpenLayers.Bounds(e[1],e[0],e[3],e[2]):new OpenLayers.Bounds(e[0],e[1],e[2],e[3])},OpenLayers.Bounds.fromSize=function(e){return new OpenLayers.Bounds(0,e.h,e.w,0)},OpenLayers.Bounds.oppositeQuadrant=function(e){var t;return t=""+("t"==e.charAt(0)?"b":"t"),t+="l"==e.charAt(1)?"r":"l"},OpenLayers.Element={visible:function(e){return"none"!=OpenLayers.Util.getElement(e).style.display},toggle:function(){for(var e=0,t=arguments.length;e<t;e++){var i=OpenLayers.Util.getElement(arguments[e]),n=OpenLayers.Element.visible(i)?"none":"";i.style.display=n}},remove:function(e){e=OpenLayers.Util.getElement(e),e.parentNode.removeChild(e)},getHeight:function(e){return e=OpenLayers.Util.getElement(e),e.offsetHeight},hasClass:function(e,t){var i=e.className;return!!i&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(i)},addClass:function(e,t){return OpenLayers.Element.hasClass(e,t)||(e.className+=(e.className?" ":"")+t),e},removeClass:function(e,t){var i=e.className;return i&&(e.className=OpenLayers.String.trim(i.replace(new RegExp("(^|\\s+)"+t+"(\\s+|$)")," "))),e},toggleClass:function(e,t){return OpenLayers.Element.hasClass(e,t)?OpenLayers.Element.removeClass(e,t):OpenLayers.Element.addClass(e,t),e},getStyle:function(e,t){e=OpenLayers.Util.getElement(e);var i=null;if(e&&e.style){i=e.style[OpenLayers.String.camelize(t)],i||(document.defaultView&&document.defaultView.getComputedStyle?i=(i=document.defaultView.getComputedStyle(e,null))?i.getPropertyValue(t):null:e.currentStyle&&(i=e.currentStyle[OpenLayers.String.camelize(t)]));var n=["left","top","right","bottom"];window.opera&&-1!=OpenLayers.Util.indexOf(n,t)&&"static"==OpenLayers.Element.getStyle(e,"position")&&(i="auto")}return"auto"==i?null:i}},OpenLayers.LonLat=OpenLayers.Class({lon:0,lat:0,initialize:function(e,t){OpenLayers.Util.isArray(e)&&(t=e[1],e=e[0]),this.lon=OpenLayers.Util.toFloat(e),this.lat=OpenLayers.Util.toFloat(t)},toString:function(){return"lon="+this.lon+",lat="+this.lat},toShortString:function(){return this.lon+", "+this.lat},clone:function(){return new OpenLayers.LonLat(this.lon,this.lat)},add:function(e,t){if(null==e||null==t)throw new TypeError("LonLat.add cannot receive null values");return new OpenLayers.LonLat(this.lon+OpenLayers.Util.toFloat(e),this.lat+OpenLayers.Util.toFloat(t))},equals:function(e){var t=!1;return null!=e&&(t=this.lon==e.lon&&this.lat==e.lat||isNaN(this.lon)&&isNaN(this.lat)&&isNaN(e.lon)&&isNaN(e.lat)),t},transform:function(e,t){var i=OpenLayers.Projection.transform({x:this.lon,y:this.lat},e,t);return this.lon=i.x,this.lat=i.y,this},wrapDateLine:function(e){var t=this.clone();if(e){for(;t.lon<e.left;)t.lon+=e.getWidth();for(;t.lon>e.right;)t.lon-=e.getWidth()}return t},CLASS_NAME:"OpenLayers.LonLat"}),OpenLayers.LonLat.fromString=function(e){return e=e.split(","),new OpenLayers.LonLat(e[0],e[1])},OpenLayers.LonLat.fromArray=function(e){var t=OpenLayers.Util.isArray(e);return new OpenLayers.LonLat(t&&e[0],t&&e[1])},OpenLayers.Pixel=OpenLayers.Class({x:0,y:0,initialize:function(e,t){this.x=parseFloat(e),this.y=parseFloat(t)},toString:function(){return"x="+this.x+",y="+this.y},clone:function(){return new OpenLayers.Pixel(this.x,this.y)},equals:function(e){var t=!1;return null!=e&&(t=this.x==e.x&&this.y==e.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(e.x)&&isNaN(e.y)),t},distanceTo:function(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))},add:function(e,t){if(null==e||null==t)throw new TypeError("Pixel.add cannot receive null values");return new OpenLayers.Pixel(this.x+e,this.y+t)},offset:function(e){var t=this.clone();return e&&(t=this.add(e.x,e.y)),t},CLASS_NAME:"OpenLayers.Pixel"}),OpenLayers.Size=OpenLayers.Class({w:0,h:0,initialize:function(e,t){this.w=parseFloat(e),this.h=parseFloat(t)},toString:function(){return"w="+this.w+",h="+this.h},clone:function(){return new OpenLayers.Size(this.w,this.h)},equals:function(e){var t=!1;return null!=e&&(t=this.w==e.w&&this.h==e.h||isNaN(this.w)&&isNaN(this.h)&&isNaN(e.w)&&isNaN(e.h)),t},CLASS_NAME:"OpenLayers.Size"}),OpenLayers.Console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},userError:function(e){alert(e)},assert:function(){},dir:function(){},dirxml:function(){},trace:function(){},group:function(){},groupEnd:function(){},time:function(){},timeEnd:function(){},profile:function(){},profileEnd:function(){},count:function(){},CLASS_NAME:"OpenLayers.Console"},function(){for(var e=document.getElementsByTagName("script"),t=0,i=e.length;t<i;++t)if(-1!=e[t].src.indexOf("firebug.js")&&console){OpenLayers.Util.extend(OpenLayers.Console,console);break}}(),OpenLayers.Lang={code:null,defaultCode:"en",getCode:function(){return OpenLayers.Lang.code||OpenLayers.Lang.setCode(),OpenLayers.Lang.code},setCode:function(e){var t;if(e||(e="msie"==OpenLayers.BROWSER_NAME?navigator.userLanguage:navigator.language),e=e.split("-"),e[0]=e[0].toLowerCase(),"object"==typeof OpenLayers.Lang[e[0]]&&(t=e[0]),e[1]){var i=e[0]+"-"+e[1].toUpperCase();"object"==typeof OpenLayers.Lang[i]&&(t=i)}t||(OpenLayers.Console.warn("Failed to find OpenLayers.Lang."+e.join("-")+" dictionary, falling back to default language"),t=OpenLayers.Lang.defaultCode),OpenLayers.Lang.code=t},translate:function(e,t){var i=OpenLayers.Lang[OpenLayers.Lang.getCode()];return(i=i&&i[e])||(i=e),t&&(i=OpenLayers.String.format(i,t)),i}},OpenLayers.i18n=OpenLayers.Lang.translate,OpenLayers.Util=OpenLayers.Util||{},OpenLayers.Util.getElement=function(){for(var e=[],t=0,i=arguments.length;t<i;t++){var n=arguments[t];if("string"==typeof n&&(n=document.getElementById(n)),1==arguments.length)return n;e.push(n)}return e},OpenLayers.Util.isElement=function(e){return!(!e||1!==e.nodeType)},OpenLayers.Util.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},OpenLayers.Util.removeItem=function(e,t){for(var i=e.length-1;0<=i;i--)e[i]==t&&e.splice(i,1);return e},OpenLayers.Util.indexOf=function(e,t){if("function"==typeof e.indexOf)return e.indexOf(t);for(var i=0,n=e.length;i<n;i++)if(e[i]==t)return i;return-1},OpenLayers.Util.dotless=/\./g,OpenLayers.Util.modifyDOMElement=function(e,t,i,n,s,r,a,o){t&&(e.id=t.replace(OpenLayers.Util.dotless,"_")),i&&(e.style.left=i.x+"px",e.style.top=i.y+"px"),n&&(e.style.width=n.w+"px",e.style.height=n.h+"px"),s&&(e.style.position=s),r&&(e.style.border=r),a&&(e.style.overflow=a),0<=parseFloat(o)&&1>parseFloat(o)?(e.style.filter="alpha(opacity="+100*o+")",e.style.opacity=o):1==parseFloat(o)&&(e.style.filter="",e.style.opacity="")},OpenLayers.Util.createDiv=function(e,t,i,n,s,r,a,o){var l=document.createElement("div");return n&&(l.style.backgroundImage="url("+n+")"),e||(e=OpenLayers.Util.createUniqueID("OpenLayersDiv")),s||(s="absolute"),OpenLayers.Util.modifyDOMElement(l,e,t,i,s,r,a,o),l},OpenLayers.Util.createImage=function(e,t,i,n,s,r,a,o){var l=document.createElement("img");return e||(e=OpenLayers.Util.createUniqueID("OpenLayersDiv")),s||(s="relative"),OpenLayers.Util.modifyDOMElement(l,e,t,i,s,r,null,a),o&&(t=function(){l.style.display="",OpenLayers.Event.stopObservingElement(l)},l.style.display="none",OpenLayers.Event.observe(l,"load",t),OpenLayers.Event.observe(l,"error",t)),l.style.alt=e,l.galleryImg="no",n&&(l.src=n),l},OpenLayers.IMAGE_RELOAD_ATTEMPTS=0,OpenLayers.Util.alphaHackNeeded=null,OpenLayers.Util.alphaHack=function(){if(null==OpenLayers.Util.alphaHackNeeded){var e=navigator.appVersion.split("MSIE"),e=parseFloat(e[1]),t=!1;try{t=!!document.body.filters}catch(e){}OpenLayers.Util.alphaHackNeeded=t&&5.5<=e&&7>e}return OpenLayers.Util.alphaHackNeeded},OpenLayers.Util.modifyAlphaImageDiv=function(e,t,i,n,s,r,a,o,l){OpenLayers.Util.modifyDOMElement(e,t,i,n,r,null,null,l),t=e.childNodes[0],s&&(t.src=s),OpenLayers.Util.modifyDOMElement(t,e.id+"_innerImage",null,n,"relative",a),OpenLayers.Util.alphaHack()&&("none"!=e.style.display&&(e.style.display="inline-block"),null==o&&(o="scale"),e.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+t.src+"', sizingMethod='"+o+"')",0<=parseFloat(e.style.opacity)&&1>parseFloat(e.style.opacity)&&(e.style.filter+=" alpha(opacity="+100*e.style.opacity+")"),t.style.filter="alpha(opacity=0)")},OpenLayers.Util.createAlphaImageDiv=function(e,t,i,n,s,r,a,o,l){var h=OpenLayers.Util.createDiv();return l=OpenLayers.Util.createImage(null,null,null,null,null,null,null,l),l.className="olAlphaImg",h.appendChild(l),OpenLayers.Util.modifyAlphaImageDiv(h,e,t,i,n,s,r,a,o),h},OpenLayers.Util.upperCaseObject=function(e){var t,i={};for(t in e)i[t.toUpperCase()]=e[t];return i},OpenLayers.Util.applyDefaults=function(e,t){e=e||{};var i,n="function"==typeof window.Event&&t instanceof window.Event;for(i in t)(void 0===e[i]||!n&&t.hasOwnProperty&&t.hasOwnProperty(i)&&!e.hasOwnProperty(i))&&(e[i]=t[i]);return!n&&t&&t.hasOwnProperty&&t.hasOwnProperty("toString")&&!e.hasOwnProperty("toString")&&(e.toString=t.toString),e},OpenLayers.Util.getParameterString=function(e){var t,i=[];for(t in e){var n=e[t];if(null!=n&&"function"!=typeof n){if("object"==typeof n&&n.constructor==Array){for(var s,r=[],a=0,o=n.length;a<o;a++)s=n[a],r.push(encodeURIComponent(null===s||void 0===s?"":s));n=r.join(",")}else n=encodeURIComponent(n);i.push(encodeURIComponent(t)+"="+n)}}return i.join("&")},OpenLayers.Util.urlAppend=function(e,t){var i=e;if(t)var n=(e+" ").split(/[?&]/),i=i+(" "===n.pop()?t:n.length?"&"+t:"?"+t);return i},OpenLayers.Util.getImagesLocation=function(){return OpenLayers.ImgPath||OpenLayers._getScriptLocation()+"img/"},OpenLayers.Util.getImageLocation=function(e){return OpenLayers.Util.getImagesLocation()+e},OpenLayers.Util.Try=function(){for(var e=null,t=0,i=arguments.length;t<i;t++){var n=arguments[t];try{e=n();break}catch(e){}}return e},OpenLayers.Util.getXmlNodeValue=function(e){var t=null;return OpenLayers.Util.Try(function(){t=e.text,t||(t=e.textContent),t||(t=e.firstChild.nodeValue)},function(){t=e.textContent}),t},OpenLayers.Util.mouseLeft=function(e,t){for(var i=e.relatedTarget?e.relatedTarget:e.toElement;i!=t&&null!=i;)i=i.parentNode;return i!=t},OpenLayers.Util.DEFAULT_PRECISION=14,OpenLayers.Util.toFloat=function(e,t){return null==t&&(t=OpenLayers.Util.DEFAULT_PRECISION),"number"!=typeof e&&(e=parseFloat(e)),0===t?e:parseFloat(e.toPrecision(t))},OpenLayers.Util.rad=function(e){return e*Math.PI/180},OpenLayers.Util.deg=function(e){return 180*e/Math.PI},OpenLayers.Util.VincentyConstants={a:6378137,b:6356752.3142,f:1/298.257223563},OpenLayers.Util.distVincenty=function(e,t){for(var i=OpenLayers.Util.VincentyConstants,n=i.a,s=i.b,i=i.f,r=OpenLayers.Util.rad(t.lon-e.lon),a=Math.atan((1-i)*Math.tan(OpenLayers.Util.rad(e.lat))),o=Math.atan((1-i)*Math.tan(OpenLayers.Util.rad(t.lat))),l=Math.sin(a),a=Math.cos(a),h=Math.sin(o),o=Math.cos(o),u=r,p=2*Math.PI,c=20;1e-12<Math.abs(u-p)&&0<--c;){var y=Math.sin(u),d=Math.cos(u),m=Math.sqrt(o*y*o*y+(a*h-l*o*d)*(a*h-l*o*d));if(0==m)return 0;var d=l*h+a*o*d,f=Math.atan2(m,d),g=Math.asin(a*o*y/m),v=Math.cos(g)*Math.cos(g),y=d-2*l*h/v,L=i/16*v*(4+i*(4-3*v)),p=u,u=r+(1-L)*i*Math.sin(g)*(f+L*m*(y+L*d*(-1+2*y*y)))}return 0==c?NaN:(n=v*(n*n-s*s)/(s*s),i=n/1024*(256+n*(-128+n*(74-47*n))),(s*(1+n/16384*(4096+n*(-768+n*(320-175*n))))*(f-i*m*(y+i/4*(d*(-1+2*y*y)-i/6*y*(-3+4*m*m)*(-3+4*y*y))))).toFixed(3)/1e3)},OpenLayers.Util.destinationVincenty=function(e,t,i){var n=OpenLayers.Util,s=n.VincentyConstants,r=s.a,a=s.b,s=s.f,o=e.lon,l=e.lat;e=n.rad(t),t=Math.sin(e),e=Math.cos(e);for(var h=(1-s)*Math.tan(n.rad(l)),l=1/Math.sqrt(1+h*h),u=h*l,p=Math.atan2(h,e),h=l*t,c=1-h*h,r=c*(r*r-a*a)/(a*a),y=1+r/16384*(4096+r*(-768+r*(320-175*r))),d=r/1024*(256+r*(-128+r*(74-47*r))),r=i/(a*y),m=2*Math.PI;1e-12<Math.abs(r-m);)var f=Math.cos(2*p+r),g=Math.sin(r),v=Math.cos(r),L=d*g*(f+d/4*(v*(-1+2*f*f)-d/6*f*(-3+4*g*g)*(-3+4*f*f))),m=r,r=i/(a*y)+L;return i=u*g-l*v*e,i=Math.atan2(u*v+l*g*e,(1-s)*Math.sqrt(h*h+i*i)),a=s/16*c*(4+s*(4-3*c)),new OpenLayers.LonLat(o+n.deg(Math.atan2(g*t,l*v-u*g*e)-(1-a)*s*h*(r+a*g*(f+a*v*(-1+2*f*f)))),n.deg(i))},OpenLayers.Util.getParameters=function(e,t){t=t||{},e=null===e||void 0===e?window.location.href:e;var i="";if(OpenLayers.String.contains(e,"?"))var n=e.indexOf("?")+1,i=OpenLayers.String.contains(e,"#")?e.indexOf("#"):e.length,i=e.substring(n,i);for(var n={},i=i.split(/[&;]/),s=0,r=i.length;s<r;++s){var a=i[s].split("=");if(a[0]){var o=a[0];try{o=decodeURIComponent(o)}catch(e){o=unescape(o)}a=(a[1]||"").replace(/\+/g," ");try{a=decodeURIComponent(a)}catch(e){a=unescape(a)}!1!==t.splitArgs&&(a=a.split(",")),1==a.length&&(a=a[0]),n[o]=a}}return n},OpenLayers.Util.lastSeqID=0,OpenLayers.Util.createUniqueID=function(e){return e=null==e?"id_":e.replace(OpenLayers.Util.dotless,"_"),OpenLayers.Util.lastSeqID+=1,e+OpenLayers.Util.lastSeqID},OpenLayers.INCHES_PER_UNIT={inches:1,ft:12,mi:63360,m:39.37,km:39370,dd:4374754,yd:36},OpenLayers.INCHES_PER_UNIT.in=OpenLayers.INCHES_PER_UNIT.inches,OpenLayers.INCHES_PER_UNIT.degrees=OpenLayers.INCHES_PER_UNIT.dd,OpenLayers.INCHES_PER_UNIT.nmi=1852*OpenLayers.INCHES_PER_UNIT.m,OpenLayers.METERS_PER_INCH=.0254000508001016,OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{Inch:OpenLayers.INCHES_PER_UNIT.inches,Meter:1/OpenLayers.METERS_PER_INCH,Foot:.3048006096012192/OpenLayers.METERS_PER_INCH,IFoot:.3048/OpenLayers.METERS_PER_INCH,ClarkeFoot:.3047972651151/OpenLayers.METERS_PER_INCH,SearsFoot:.30479947153867626/OpenLayers.METERS_PER_INCH,GoldCoastFoot:.3047997101815088/OpenLayers.METERS_PER_INCH,IInch:.0254/OpenLayers.METERS_PER_INCH,MicroInch:254e-7/OpenLayers.METERS_PER_INCH,Mil:2.54e-8/OpenLayers.METERS_PER_INCH,Centimeter:.01/OpenLayers.METERS_PER_INCH,Kilometer:1e3/OpenLayers.METERS_PER_INCH,Yard:.9144018288036576/OpenLayers.METERS_PER_INCH,SearsYard:.914398414616029/OpenLayers.METERS_PER_INCH,IndianYard:.9143985307444408/OpenLayers.METERS_PER_INCH,IndianYd37:.91439523/OpenLayers.METERS_PER_INCH,IndianYd62:.9143988/OpenLayers.METERS_PER_INCH,IndianYd75:.9143985/OpenLayers.METERS_PER_INCH,IndianFoot:.30479951/OpenLayers.METERS_PER_INCH,IndianFt37:.30479841/OpenLayers.METERS_PER_INCH,IndianFt62:.3047996/OpenLayers.METERS_PER_INCH,IndianFt75:.3047995/OpenLayers.METERS_PER_INCH,Mile:1609.3472186944373/OpenLayers.METERS_PER_INCH,IYard:.9144/OpenLayers.METERS_PER_INCH,IMile:1609.344/OpenLayers.METERS_PER_INCH,NautM:1852/OpenLayers.METERS_PER_INCH,"Lat-66":110943.31648893273/OpenLayers.METERS_PER_INCH,"Lat-83":110946.25736872235/OpenLayers.METERS_PER_INCH,Decimeter:.1/OpenLayers.METERS_PER_INCH,Millimeter:.001/OpenLayers.METERS_PER_INCH,Dekameter:10/OpenLayers.METERS_PER_INCH,Decameter:10/OpenLayers.METERS_PER_INCH,Hectometer:100/OpenLayers.METERS_PER_INCH,GermanMeter:1.0000135965/OpenLayers.METERS_PER_INCH,CaGrid:.999738/OpenLayers.METERS_PER_INCH,ClarkeChain:20.1166194976/OpenLayers.METERS_PER_INCH,GunterChain:20.11684023368047/OpenLayers.METERS_PER_INCH,BenoitChain:20.116782494375872/OpenLayers.METERS_PER_INCH,SearsChain:20.11676512155/OpenLayers.METERS_PER_INCH,ClarkeLink:.201166194976/OpenLayers.METERS_PER_INCH,GunterLink:.2011684023368047/OpenLayers.METERS_PER_INCH,BenoitLink:.20116782494375873/OpenLayers.METERS_PER_INCH,SearsLink:.2011676512155/OpenLayers.METERS_PER_INCH,Rod:5.02921005842012/OpenLayers.METERS_PER_INCH,IntnlChain:20.1168/OpenLayers.METERS_PER_INCH,IntnlLink:.201168/OpenLayers.METERS_PER_INCH,Perch:5.02921005842012/OpenLayers.METERS_PER_INCH,Pole:5.02921005842012/OpenLayers.METERS_PER_INCH,Furlong:201.1684023368046/OpenLayers.METERS_PER_INCH,Rood:3.778266898/OpenLayers.METERS_PER_INCH,CapeFoot:.3047972615/OpenLayers.METERS_PER_INCH,Brealey:375/OpenLayers.METERS_PER_INCH,ModAmFt:.304812252984506/OpenLayers.METERS_PER_INCH,Fathom:1.8288/OpenLayers.METERS_PER_INCH,"NautM-UK":1853.184/OpenLayers.METERS_PER_INCH,"50kilometers":5e4/OpenLayers.METERS_PER_INCH,"150kilometers":15e4/OpenLayers.METERS_PER_INCH}),OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{mm:OpenLayers.INCHES_PER_UNIT.Meter/1e3,cm:OpenLayers.INCHES_PER_UNIT.Meter/100,dm:100*OpenLayers.INCHES_PER_UNIT.Meter,km:1e3*OpenLayers.INCHES_PER_UNIT.Meter,kmi:OpenLayers.INCHES_PER_UNIT.nmi,fath:OpenLayers.INCHES_PER_UNIT.Fathom,ch:OpenLayers.INCHES_PER_UNIT.IntnlChain,link:OpenLayers.INCHES_PER_UNIT.IntnlLink,"us-in":OpenLayers.INCHES_PER_UNIT.inches,"us-ft":OpenLayers.INCHES_PER_UNIT.Foot,"us-yd":OpenLayers.INCHES_PER_UNIT.Yard,"us-ch":OpenLayers.INCHES_PER_UNIT.GunterChain,"us-mi":OpenLayers.INCHES_PER_UNIT.Mile,"ind-yd":OpenLayers.INCHES_PER_UNIT.IndianYd37,"ind-ft":OpenLayers.INCHES_PER_UNIT.IndianFt37,"ind-ch":20.11669506/OpenLayers.METERS_PER_INCH}),OpenLayers.DOTS_PER_INCH=72,OpenLayers.Util.normalizeScale=function(e){return 1<e?1/e:e},OpenLayers.Util.getResolutionFromScale=function(e,t){var i;return e&&(null==t&&(t="degrees"),i=1/(OpenLayers.Util.normalizeScale(e)*OpenLayers.INCHES_PER_UNIT[t]*OpenLayers.DOTS_PER_INCH)),i},OpenLayers.Util.getScaleFromResolution=function(e,t){return null==t&&(t="degrees"),e*OpenLayers.INCHES_PER_UNIT[t]*OpenLayers.DOTS_PER_INCH},OpenLayers.Util.pagePosition=function(e){var t=[0,0],i=OpenLayers.Util.getViewportElement();if(!e||e==window||e==i)return t;var n=OpenLayers.IS_GECKO&&document.getBoxObjectFor&&"absolute"==OpenLayers.Element.getStyle(e,"position")&&(""==e.style.top||""==e.style.left);if(e.getBoundingClientRect)e=e.getBoundingClientRect(),n=window.pageYOffset||i.scrollTop,t[0]=e.left+(window.pageXOffset||i.scrollLeft),t[1]=e.top+n;else if(document.getBoxObjectFor&&!n)e=document.getBoxObjectFor(e),i=document.getBoxObjectFor(i),t[0]=e.screenX-i.screenX,t[1]=e.screenY-i.screenY;else{if(t[0]=e.offsetLeft,t[1]=e.offsetTop,i=e.offsetParent,i!=e)for(;i;)t[0]+=i.offsetLeft,t[1]+=i.offsetTop,i=i.offsetParent;for(n=OpenLayers.BROWSER_NAME,("opera"==n||"safari"==n&&"absolute"==OpenLayers.Element.getStyle(e,"position"))&&(t[1]-=document.body.offsetTop),i=e.offsetParent;i&&i!=document.body;)t[0]-=i.scrollLeft,"opera"==n&&"TR"==i.tagName||(t[1]-=i.scrollTop),i=i.offsetParent}return t},OpenLayers.Util.getViewportElement=function(){var e=arguments.callee.viewportElement;return void 0==e&&(e="msie"==OpenLayers.BROWSER_NAME&&"CSS1Compat"!=document.compatMode?document.body:document.documentElement,arguments.callee.viewportElement=e),e},OpenLayers.Util.isEquivalentUrl=function(e,t,i){i=i||{},OpenLayers.Util.applyDefaults(i,{ignoreCase:!0,ignorePort80:!0,ignoreHash:!0,splitArgs:!1}),e=OpenLayers.Util.createUrlObject(e,i),t=OpenLayers.Util.createUrlObject(t,i);for(var n in e)if("args"!==n&&e[n]!=t[n])return!1;for(n in e.args){if(e.args[n]!=t.args[n])return!1;delete t.args[n]}for(n in t.args)return!1;return!0},OpenLayers.Util.createUrlObject=function(e,t){if(t=t||{},!/^\w+:\/\//.test(e)){var i=window.location,n=i.port?":"+i.port:"",n=i.protocol+"//"+i.host.split(":").shift()+n;0===e.indexOf("/")?e=n+e:(i=i.pathname.split("/"),i.pop(),e=n+i.join("/")+"/"+e)}t.ignoreCase&&(e=e.toLowerCase()),i=document.createElement("a"),i.href=e,n={},n.host=i.host.split(":").shift(),n.protocol=i.protocol,n.port=t.ignorePort80?"80"==i.port||"0"==i.port?"":i.port:""==i.port||"0"==i.port?"80":i.port,n.hash=t.ignoreHash||"#"===i.hash?"":i.hash;var s=i.search;return s||(s=e.indexOf("?"),s=-1!=s?e.substr(s):""),n.args=OpenLayers.Util.getParameters(s,{splitArgs:t.splitArgs}),n.pathname="/"==i.pathname.charAt(0)?i.pathname:"/"+i.pathname,n},OpenLayers.Util.removeTail=function(e){var t=e.indexOf("?"),i=e.indexOf("#");return-1==t?-1!=i?e.substr(0,i):e:-1!=i?e.substr(0,Math.min(t,i)):e.substr(0,t)},OpenLayers.IS_GECKO=function(){var e=navigator.userAgent.toLowerCase();return-1==e.indexOf("webkit")&&-1!=e.indexOf("gecko")}(),OpenLayers.CANVAS_SUPPORTED=function(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))}(),OpenLayers.BROWSER_NAME=function(){var e="",t=navigator.userAgent.toLowerCase();return-1!=t.indexOf("opera")?e="opera":-1!=t.indexOf("msie")?e="msie":-1!=t.indexOf("safari")?e="safari":-1!=t.indexOf("mozilla")&&(e=-1!=t.indexOf("firefox")?"firefox":"mozilla"),e}(),OpenLayers.Util.getBrowserName=function(){return OpenLayers.BROWSER_NAME},OpenLayers.Util.getRenderedDimensions=function(e,t,i){var n,s,r=document.createElement("div");r.style.visibility="hidden";for(var a=i&&i.containerElement?i.containerElement:document.body,o=!1,l=null,h=a;h&&"body"!=h.tagName.toLowerCase();){var u=OpenLayers.Element.getStyle(h,"position");if("absolute"==u){o=!0;break}if(u&&"static"!=u)break;h=h.parentNode}if(!o||0!==a.clientHeight&&0!==a.clientWidth||(l=document.createElement("div"),l.style.visibility="hidden",l.style.position="absolute",l.style.overflow="visible",l.style.width=document.body.clientWidth+"px",l.style.height=document.body.clientHeight+"px",l.appendChild(r)),r.style.position="absolute",t&&(t.w?(n=t.w,r.style.width=n+"px"):t.h&&(s=t.h,r.style.height=s+"px")),i&&i.displayClass&&(r.className=i.displayClass),t=document.createElement("div"),t.innerHTML=e,t.style.overflow="visible",t.childNodes)for(e=0,i=t.childNodes.length;e<i;e++)t.childNodes[e].style&&(t.childNodes[e].style.overflow="visible");return r.appendChild(t),l?a.appendChild(l):a.appendChild(r),n||(n=parseInt(t.scrollWidth),r.style.width=n+"px"),s||(s=parseInt(t.scrollHeight)),r.removeChild(t),l?(l.removeChild(r),a.removeChild(l)):a.removeChild(r),new OpenLayers.Size(n,s)},OpenLayers.Util.getScrollbarWidth=function(){var e=OpenLayers.Util._scrollbarWidth;if(null==e){var t,i;t=document.createElement("div"),t.style.position="absolute",t.style.top="-1000px",t.style.left="-1000px",t.style.width="100px",t.style.height="50px",t.style.overflow="hidden",i=document.createElement("div"),i.style.width="100%",i.style.height="200px",t.appendChild(i),document.body.appendChild(t),e=i.offsetWidth,t.style.overflow="scroll",t=i.offsetWidth,document.body.removeChild(document.body.lastChild),OpenLayers.Util._scrollbarWidth=e-t,e=OpenLayers.Util._scrollbarWidth}return e},OpenLayers.Util.getFormattedLonLat=function(e,t,i){i||(i="dms"),e=(e+540)%360-180;var n=Math.abs(e),s=Math.floor(n),r=n=(n-s)/(1/60),n=Math.floor(n),r=Math.round((r-n)/(1/60)*10),r=r/10;return 60<=r&&(r-=60,n+=1,60<=n&&(n-=60,s+=1)),10>s&&(s="0"+s),s+="°",0<=i.indexOf("dm")&&(10>n&&(n="0"+n),s+=n+"'",0<=i.indexOf("dms")&&(10>r&&(r="0"+r),s+=r+'"')),
s="lon"==t?s+(0>e?OpenLayers.i18n("W"):OpenLayers.i18n("E")):s+(0>e?OpenLayers.i18n("S"):OpenLayers.i18n("N"))},OpenLayers.Util.getConstructor=function(e){var t=e.split(".");e="OpenLayers"===t[0]?OpenLayers:window[t[0]];for(var i=1,n=t.length;i<n;++i)e=e[t[i]];return e},OpenLayers.Event={observers:!1,KEY_SPACE:32,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(e){return e.target||e.srcElement},isSingleTouch:function(e){return e.touches&&1==e.touches.length},isMultiTouch:function(e){return e.touches&&1<e.touches.length},isTouchEvent:function(e){return 0===(""+e.type).indexOf("touch")||"pointerType"in e&&(e.pointerType===e.MSPOINTER_TYPE_TOUCH||"touch"===e.pointerType)},isLeftClick:function(e){return e.which&&1==e.which||e.button&&1==e.button},isRightClick:function(e){return e.which&&3==e.which||e.button&&2==e.button},stop:function(e,t){t||OpenLayers.Event.preventDefault(e),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},preventDefault:function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},findElement:function(e,t){for(var i=OpenLayers.Event.element(e);i.parentNode&&(!i.tagName||i.tagName.toUpperCase()!=t.toUpperCase());)i=i.parentNode;return i},observe:function(e,t,i,n){if(e=OpenLayers.Util.getElement(e),n=n||!1,"keypress"==t&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||e.attachEvent)&&(t="keydown"),this.observers||(this.observers={}),!e._eventCacheID){var s="eventCacheID_";e.id&&(s=e.id+"_"+s),e._eventCacheID=OpenLayers.Util.createUniqueID(s)}s=e._eventCacheID,this.observers[s]||(this.observers[s]=[]),this.observers[s].push({element:e,name:t,observer:i,useCapture:n}),e.addEventListener?e.addEventListener(t,i,n):e.attachEvent&&e.attachEvent("on"+t,i)},stopObservingElement:function(e){e=OpenLayers.Util.getElement(e)._eventCacheID,this._removeElementObservers(OpenLayers.Event.observers[e])},_removeElementObservers:function(e){if(e)for(var t=e.length-1;0<=t;t--){var i=e[t];OpenLayers.Event.stopObserving.apply(this,[i.element,i.name,i.observer,i.useCapture])}},stopObserving:function(e,t,i,n){n=n||!1,e=OpenLayers.Util.getElement(e);var s=e._eventCacheID;"keypress"==t&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||e.detachEvent)&&(t="keydown");var r=!1,a=OpenLayers.Event.observers[s];if(a)for(var o=0;!r&&o<a.length;){var l=a[o];if(l.name==t&&l.observer==i&&l.useCapture==n){a.splice(o,1),0==a.length&&delete OpenLayers.Event.observers[s],r=!0;break}o++}return r&&(e.removeEventListener?e.removeEventListener(t,i,n):e&&e.detachEvent&&e.detachEvent("on"+t,i)),r},unloadCache:function(){if(OpenLayers.Event&&OpenLayers.Event.observers){for(var e in OpenLayers.Event.observers)OpenLayers.Event._removeElementObservers.apply(this,[OpenLayers.Event.observers[e]]);OpenLayers.Event.observers=!1}},CLASS_NAME:"OpenLayers.Event"},OpenLayers.Event.observe(window,"unload",OpenLayers.Event.unloadCache,!1),OpenLayers.Events=OpenLayers.Class({BROWSER_EVENTS:"mouseover mouseout mousedown mouseup mousemove click dblclick rightclick dblrightclick resize focus blur touchstart touchmove touchend keydown".split(" "),TOUCH_MODEL_POINTER:"pointer",TOUCH_MODEL_MSPOINTER:"MSPointer",TOUCH_MODEL_TOUCH:"touch",listeners:null,object:null,element:null,eventHandler:null,fallThrough:null,includeXY:!1,extensions:null,extensionCount:null,clearMouseListener:null,initialize:function(e,t,i,n,s){OpenLayers.Util.extend(this,s),this.object=e,this.fallThrough=n,this.listeners={},this.extensions={},this.extensionCount={},this._pointerTouches=[],null!=t&&this.attachToElement(t)},destroy:function(){for(var e in this.extensions)"boolean"!=typeof this.extensions[e]&&this.extensions[e].destroy();this.extensions=null,this.element&&(OpenLayers.Event.stopObservingElement(this.element),this.element.hasScrollEvent&&OpenLayers.Event.stopObserving(window,"scroll",this.clearMouseListener)),this.eventHandler=this.fallThrough=this.object=this.listeners=this.element=null},addEventType:function(e){},attachToElement:function(e){this.element?OpenLayers.Event.stopObservingElement(this.element):(this.eventHandler=OpenLayers.Function.bindAsEventListener(this.handleBrowserEvent,this),this.clearMouseListener=OpenLayers.Function.bind(this.clearMouseCache,this)),this.element=e;for(var t,i=this.getTouchModel(),n=0,s=this.BROWSER_EVENTS.length;n<s;n++)t=this.BROWSER_EVENTS[n],OpenLayers.Event.observe(e,t,this.eventHandler),i!==this.TOUCH_MODEL_POINTER&&i!==this.TOUCH_MODEL_MSPOINTER||0!==t.indexOf("touch")||this.addPointerTouchListener(e,t,this.eventHandler);OpenLayers.Event.observe(e,"dragstart",OpenLayers.Event.stop)},on:function(e){for(var t in e)"scope"!=t&&e.hasOwnProperty(t)&&this.register(t,e.scope,e[t])},register:function(e,t,i,n){if(e in OpenLayers.Events&&!this.extensions[e]&&(this.extensions[e]=new OpenLayers.Events[e](this)),null!=i){null==t&&(t=this.object);var s=this.listeners[e];s||(s=[],this.listeners[e]=s,this.extensionCount[e]=0),t={obj:t,func:i},n?(s.splice(this.extensionCount[e],0,t),"object"==typeof n&&n.extension&&this.extensionCount[e]++):s.push(t)}},registerPriority:function(e,t,i){this.register(e,t,i,!0)},un:function(e){for(var t in e)"scope"!=t&&e.hasOwnProperty(t)&&this.unregister(t,e.scope,e[t])},unregister:function(e,t,i){if(null==t&&(t=this.object),e=this.listeners[e],null!=e)for(var n=0,s=e.length;n<s;n++)if(e[n].obj==t&&e[n].func==i){e.splice(n,1);break}},remove:function(e){null!=this.listeners[e]&&(this.listeners[e]=[])},triggerEvent:function(e,t){var i=this.listeners[e];if(i&&0!=i.length){null==t&&(t={}),t.object=this.object,t.element=this.element,t.type||(t.type=e);for(var n,i=i.slice(),s=0,r=i.length;s<r&&(n=i[s],n=n.func.apply(n.obj,[t]),void 0==n||0!=n);s++);return this.fallThrough||OpenLayers.Event.stop(t,!0),n}},handleBrowserEvent:function(e){var t=e.type,i=this.listeners[t];if(i&&0!=i.length){if((i=e.touches)&&i[0]){for(var n,s=0,r=0,a=i.length,o=0;o<a;++o)n=this.getTouchClientXY(i[o]),s+=n.clientX,r+=n.clientY;e.clientX=s/a,e.clientY=r/a}this.includeXY&&(e.xy=this.getMousePosition(e)),this.triggerEvent(t,e)}},getTouchClientXY:function(e){var t=window.olMockWin||window,i=t.pageXOffset,t=t.pageYOffset,n=e.clientX,s=e.clientY;return 0===e.pageY&&Math.floor(s)>Math.floor(e.pageY)||0===e.pageX&&Math.floor(n)>Math.floor(e.pageX)?(n-=i,s-=t):(s<e.pageY-t||n<e.pageX-i)&&(n=e.pageX-i,s=e.pageY-t),e.olClientX=n,e.olClientY=s,{clientX:n,clientY:s}},clearMouseCache:function(){this.element.scrolls=null,this.element.lefttop=null,this.element.offsets=null},getMousePosition:function(e){if(this.includeXY?this.element.hasScrollEvent||(OpenLayers.Event.observe(window,"scroll",this.clearMouseListener),this.element.hasScrollEvent=!0):this.clearMouseCache(),!this.element.scrolls){var t=OpenLayers.Util.getViewportElement();this.element.scrolls=[window.pageXOffset||t.scrollLeft,window.pageYOffset||t.scrollTop]}return this.element.lefttop||(this.element.lefttop=[document.documentElement.clientLeft||0,document.documentElement.clientTop||0]),this.element.offsets||(this.element.offsets=OpenLayers.Util.pagePosition(this.element)),new OpenLayers.Pixel(e.clientX+this.element.scrolls[0]-this.element.offsets[0]-this.element.lefttop[0],e.clientY+this.element.scrolls[1]-this.element.offsets[1]-this.element.lefttop[1])},getTouchModel:function(){return"_TOUCH_MODEL"in OpenLayers.Events||(OpenLayers.Events._TOUCH_MODEL=window.PointerEvent&&"pointer"||window.MSPointerEvent&&"MSPointer"||"ontouchdown"in document&&"touch"||null),OpenLayers.Events._TOUCH_MODEL},addPointerTouchListener:function(e,t,i){function n(e){i(OpenLayers.Util.applyDefaults({stopPropagation:function(){for(var e=s.length-1;0<=e;--e)s[e].stopPropagation()},preventDefault:function(){for(var e=s.length-1;0<=e;--e)s[e].preventDefault()},type:t},e))}var s=this._pointerTouches;switch(t){case"touchstart":return this.addPointerTouchListenerStart(e,t,n);case"touchend":return this.addPointerTouchListenerEnd(e,t,n);case"touchmove":return this.addPointerTouchListenerMove(e,t,n);default:throw"Unknown touch event type"}},addPointerTouchListenerStart:function(e,t,i){var n=this._pointerTouches;OpenLayers.Event.observe(e,this.getTouchModel()===this.TOUCH_MODEL_MSPOINTER?"MSPointerDown":"pointerdown",function(e){if(OpenLayers.Event.isTouchEvent(e)){for(var t=!1,s=0,r=n.length;s<r;++s)if(n[s].pointerId==e.pointerId){t=!0;break}t||n.push(e),e.touches=n.slice(),i(e)}}),OpenLayers.Event.observe(e,this.getTouchModel()===this.TOUCH_MODEL_MSPOINTER?"MSPointerOut":"pointerout",function(e){if(OpenLayers.Event.isTouchEvent(e))for(var t=0,i=n.length;t<i;++t)if(n[t].pointerId==e.pointerId){0!=this.clientWidth&&0!=this.clientHeight&&(Math.ceil(e.clientX)>=this.clientWidth||Math.ceil(e.clientY)>=this.clientHeight)&&n.splice(t,1);break}})},addPointerTouchListenerMove:function(e,t,i){var n=this._pointerTouches;OpenLayers.Event.observe(e,this.getTouchModel()===this.TOUCH_MODEL_MSPOINTER?"MSPointerMove":"pointermove",function(e){if(OpenLayers.Event.isTouchEvent(e)&&(1!=n.length||n[0].pageX!=e.pageX||n[0].pageY!=e.pageY)){for(var t=0,s=n.length;t<s;++t)if(n[t].pointerId==e.pointerId){n[t]=e;break}e.touches=n.slice(),i(e)}})},addPointerTouchListenerEnd:function(e,t,i){var n=this._pointerTouches;OpenLayers.Event.observe(e,this.getTouchModel()===this.TOUCH_MODEL_MSPOINTER?"MSPointerUp":"pointerup",function(e){if(OpenLayers.Event.isTouchEvent(e)){for(var t=0,s=n.length;t<s;++t)if(n[t].pointerId==e.pointerId){n.splice(t,1);break}e.touches=n.slice(),i(e)}})},CLASS_NAME:"OpenLayers.Events"}),OpenLayers.Handler=OpenLayers.Class({id:null,control:null,map:null,keyMask:null,active:!1,evt:null,touch:!1,initialize:function(e,t,i){OpenLayers.Util.extend(this,i),this.control=e,this.callbacks=t,(e=this.map||e.map)&&this.setMap(e),this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},setMap:function(e){this.map=e},checkModifiers:function(e){return null==this.keyMask||((e.shiftKey?OpenLayers.Handler.MOD_SHIFT:0)|(e.ctrlKey?OpenLayers.Handler.MOD_CTRL:0)|(e.altKey?OpenLayers.Handler.MOD_ALT:0)|(e.metaKey?OpenLayers.Handler.MOD_META:0))==this.keyMask},activate:function(){if(this.active)return!1;for(var e=OpenLayers.Events.prototype.BROWSER_EVENTS,t=0,i=e.length;t<i;t++)this[e[t]]&&this.register(e[t],this[e[t]]);return this.active=!0},deactivate:function(){if(!this.active)return!1;for(var e=OpenLayers.Events.prototype.BROWSER_EVENTS,t=0,i=e.length;t<i;t++)this[e[t]]&&this.unregister(e[t],this[e[t]]);return this.active=this.touch=!1,!0},startTouch:function(){if(!this.touch){this.touch=!0;for(var e="mousedown mouseup mousemove click dblclick mouseout".split(" "),t=0,i=e.length;t<i;t++)this[e[t]]&&this.unregister(e[t],this[e[t]])}},callback:function(e,t){e&&this.callbacks[e]&&this.callbacks[e].apply(this.control,t)},register:function(e,t){this.map.events.registerPriority(e,this,t),this.map.events.registerPriority(e,this,this.setEvent)},unregister:function(e,t){this.map.events.unregister(e,this,t),this.map.events.unregister(e,this,this.setEvent)},setEvent:function(e){return this.evt=e,!0},destroy:function(){this.deactivate(),this.control=this.map=null},CLASS_NAME:"OpenLayers.Handler"}),OpenLayers.Handler.MOD_NONE=0,OpenLayers.Handler.MOD_SHIFT=1,OpenLayers.Handler.MOD_CTRL=2,OpenLayers.Handler.MOD_ALT=4,OpenLayers.Handler.MOD_META=8,OpenLayers.Icon=OpenLayers.Class({url:null,size:null,offset:null,calculateOffset:null,imageDiv:null,px:null,initialize:function(e,t,i,n){this.url=e,this.size=t||{w:20,h:20},this.offset=i||{x:-(this.size.w/2),y:-(this.size.h/2)},this.calculateOffset=n,e=OpenLayers.Util.createUniqueID("OL_Icon_"),this.imageDiv=OpenLayers.Util.createAlphaImageDiv(e)},destroy:function(){this.erase(),OpenLayers.Event.stopObservingElement(this.imageDiv.firstChild),this.imageDiv.innerHTML="",this.imageDiv=null},clone:function(){return new OpenLayers.Icon(this.url,this.size,this.offset,this.calculateOffset)},setSize:function(e){null!=e&&(this.size=e),this.draw()},setUrl:function(e){null!=e&&(this.url=e),this.draw()},draw:function(e){return OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,this.size,this.url,"absolute"),this.moveTo(e),this.imageDiv},erase:function(){null!=this.imageDiv&&null!=this.imageDiv.parentNode&&OpenLayers.Element.remove(this.imageDiv)},setOpacity:function(e){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,null,null,null,null,null,e)},moveTo:function(e){null!=e&&(this.px=e),null!=this.imageDiv&&(null==this.px?this.display(!1):(this.calculateOffset&&(this.offset=this.calculateOffset(this.size)),OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,{x:this.px.x+this.offset.x,y:this.px.y+this.offset.y})))},display:function(e){this.imageDiv.style.display=e?"":"none"},isDrawn:function(){return this.imageDiv&&this.imageDiv.parentNode&&11!=this.imageDiv.parentNode.nodeType},CLASS_NAME:"OpenLayers.Icon"}),OpenLayers.Marker=OpenLayers.Class({icon:null,lonlat:null,events:null,map:null,initialize:function(e,t){this.lonlat=e;var i=t?t:OpenLayers.Marker.defaultIcon();null==this.icon?this.icon=i:(this.icon.url=i.url,this.icon.size=i.size,this.icon.offset=i.offset,this.icon.calculateOffset=i.calculateOffset),this.events=new OpenLayers.Events(this,this.icon.imageDiv)},destroy:function(){this.erase(),this.map=null,this.events.destroy(),this.events=null,null!=this.icon&&(this.icon.destroy(),this.icon=null)},draw:function(e){return this.icon.draw(e)},erase:function(){null!=this.icon&&this.icon.erase()},moveTo:function(e){null!=e&&null!=this.icon&&this.icon.moveTo(e),this.lonlat=this.map.getLonLatFromLayerPx(e)},isDrawn:function(){return this.icon&&this.icon.isDrawn()},onScreen:function(){var e=!1;return this.map&&(e=this.map.getExtent().containsLonLat(this.lonlat)),e},inflate:function(e){this.icon&&this.icon.setSize({w:this.icon.size.w*e,h:this.icon.size.h*e})},setOpacity:function(e){this.icon.setOpacity(e)},setUrl:function(e){this.icon.setUrl(e)},display:function(e){this.icon.display(e)},CLASS_NAME:"OpenLayers.Marker"}),OpenLayers.Marker.defaultIcon=function(){return new OpenLayers.Icon(OpenLayers.Util.getImageLocation("marker.png"),{w:21,h:25},{x:-10.5,y:-25})},OpenLayers.Util=OpenLayers.Util||{},OpenLayers.Util.vendorPrefix=function(){function e(e){return e?e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()}).replace(/^ms-/,"-ms-"):null}function t(e,t){if(void 0===a[t]){var i,s=0,r=n.length,o="undefined"!=typeof e.cssText;for(a[t]=null;s<r;s++)if((i=n[s])?(o||(i=i.toLowerCase()),i=i+t.charAt(0).toUpperCase()+t.slice(1)):i=t,void 0!==e[i]){a[t]=i;break}}return a[t]}function i(e){return t(s,e)}var n=["","O","ms","Moz","Webkit"],s=document.createElement("div").style,r={},a={};return{css:function(t){if(void 0===r[t]){var n=t.replace(/(-[\s\S])/g,function(e){return e.charAt(1).toUpperCase()}),n=i(n);r[t]=e(n)}return r[t]},js:t,style:i,cssCache:r,jsCache:a}}(),OpenLayers.Animation=function(e){var t=OpenLayers.Util.vendorPrefix.js(e,"requestAnimationFrame"),i=!!t,n=function(){var i=e[t]||function(t,i){e.setTimeout(t,16)};return function(t,n){i.apply(e,[t,n])}}(),s=0,r={};return{isNative:i,requestFrame:n,start:function(e,t,i){t=0<t?t:Number.POSITIVE_INFINITY;var a=++s,o=+new Date;return r[a]=function(){r[a]&&+new Date-o<=t?(e(),r[a]&&n(r[a],i)):delete r[a]},n(r[a],i),a},stop:function(e){delete r[e]}}}(window),OpenLayers.Kinetic=OpenLayers.Class({threshold:0,deceleration:.0035,nbPoints:100,delay:200,points:void 0,timerId:void 0,initialize:function(e){OpenLayers.Util.extend(this,e)},begin:function(){OpenLayers.Animation.stop(this.timerId),this.timerId=void 0,this.points=[]},update:function(e){this.points.unshift({xy:e,tick:(new Date).getTime()}),this.points.length>this.nbPoints&&this.points.pop()},end:function(e){for(var t,i,n=(new Date).getTime(),s=0,r=this.points.length;s<r&&(i=this.points[s],!(n-i.tick>this.delay));s++)t=i;if(t&&(s=(new Date).getTime()-t.tick,n=Math.sqrt(Math.pow(e.x-t.xy.x,2)+Math.pow(e.y-t.xy.y,2)),s=n/s,!(0==s||s<this.threshold)))return n=Math.asin((e.y-t.xy.y)/n),t.xy.x<=e.x&&(n=Math.PI-n),{speed:s,theta:n}},move:function(e,t){var i=e.speed,n=Math.cos(e.theta),s=-Math.sin(e.theta),r=(new Date).getTime(),a=0,o=0;this.timerId=OpenLayers.Animation.start(OpenLayers.Function.bind(function(){if(null!=this.timerId){var e,l,h=(new Date).getTime()-r,u=-this.deceleration*Math.pow(h,2)/2+i*h,p=u*n,u=u*s;e=!1,0>=-this.deceleration*h+i&&(OpenLayers.Animation.stop(this.timerId),this.timerId=null,e=!0),h=p-a,l=u-o,a=p,o=u,t(h,l,e)}},this))},CLASS_NAME:"OpenLayers.Kinetic"}),OpenLayers.Tween=OpenLayers.Class({easing:null,begin:null,finish:null,duration:null,callbacks:null,time:null,minFrameRate:null,startTime:null,animationId:null,playing:!1,initialize:function(e){this.easing=e?e:OpenLayers.Easing.Expo.easeOut},start:function(e,t,i,n){this.playing=!0,this.begin=e,this.finish=t,this.duration=i,this.callbacks=n.callbacks,this.minFrameRate=n.minFrameRate||30,this.time=0,this.startTime=(new Date).getTime(),OpenLayers.Animation.stop(this.animationId),this.animationId=null,this.callbacks&&this.callbacks.start&&this.callbacks.start.call(this,this.begin),this.animationId=OpenLayers.Animation.start(OpenLayers.Function.bind(this.play,this))},stop:function(){this.playing&&(this.callbacks&&this.callbacks.done&&this.callbacks.done.call(this,this.finish),OpenLayers.Animation.stop(this.animationId),this.animationId=null,this.playing=!1)},play:function(){var e,t={};for(e in this.begin){var i=this.begin[e],n=this.finish[e];if(null==i||null==n||isNaN(i)||isNaN(n))throw new TypeError("invalid value for Tween");t[e]=this.easing.apply(this,[this.time,i,n-i,this.duration])}this.time++,this.callbacks&&this.callbacks.eachStep&&((new Date).getTime()-this.startTime)/this.time<=1e3/this.minFrameRate&&this.callbacks.eachStep.call(this,t),this.time>this.duration&&this.stop()},CLASS_NAME:"OpenLayers.Tween"}),OpenLayers.Easing={CLASS_NAME:"OpenLayers.Easing"},OpenLayers.Easing.Linear={easeIn:function(e,t,i,n){return i*e/n+t},easeOut:function(e,t,i,n){return i*e/n+t},easeInOut:function(e,t,i,n){return i*e/n+t},CLASS_NAME:"OpenLayers.Easing.Linear"},OpenLayers.Easing.Expo={easeIn:function(e,t,i,n){return 0==e?t:i*Math.pow(2,10*(e/n-1))+t},easeOut:function(e,t,i,n){return e==n?t+i:i*(-Math.pow(2,-10*e/n)+1)+t},easeInOut:function(e,t,i,n){return 0==e?t:e==n?t+i:1>(e/=n/2)?i/2*Math.pow(2,10*(e-1))+t:i/2*(-Math.pow(2,-10*--e)+2)+t},CLASS_NAME:"OpenLayers.Easing.Expo"},OpenLayers.Easing.Quad={easeIn:function(e,t,i,n){return i*(e/=n)*e+t},easeOut:function(e,t,i,n){return-i*(e/=n)*(e-2)+t},easeInOut:function(e,t,i,n){return 1>(e/=n/2)?i/2*e*e+t:-i/2*(--e*(e-2)-1)+t},CLASS_NAME:"OpenLayers.Easing.Quad"},OpenLayers.Projection=OpenLayers.Class({proj:null,projCode:null,titleRegEx:/\+title=[^\+]*/,initialize:function(e,t){OpenLayers.Util.extend(this,t),this.projCode=e,"object"==typeof Proj4js&&(this.proj=new Proj4js.Proj(e))},getCode:function(){return this.proj?this.proj.srsCode:this.projCode},getUnits:function(){return this.proj?this.proj.units:null},toString:function(){return this.getCode()},equals:function(e){var t=!1;return e&&(e instanceof OpenLayers.Projection||(e=new OpenLayers.Projection(e)),"object"==typeof Proj4js&&this.proj.defData&&e.proj.defData?t=this.proj.defData.replace(this.titleRegEx,"")==e.proj.defData.replace(this.titleRegEx,""):e.getCode&&(t=this.getCode(),e=e.getCode(),t=t==e||!!OpenLayers.Projection.transforms[t]&&OpenLayers.Projection.transforms[t][e]===OpenLayers.Projection.nullTransform)),t},destroy:function(){delete this.proj,delete this.projCode},CLASS_NAME:"OpenLayers.Projection"}),OpenLayers.Projection.transforms={},OpenLayers.Projection.defaults={"EPSG:4326":{units:"degrees",maxExtent:[-180,-90,180,90],worldExtent:[-180,-90,180,90],yx:!0},"CRS:84":{units:"degrees",maxExtent:[-180,-90,180,90],worldExtent:[-180,-90,180,90]},"EPSG:900913":{units:"m",maxExtent:[-20037508.34,-20037508.34,20037508.34,20037508.34],worldExtent:[-180,-89,180,89]}},OpenLayers.Projection.addTransform=function(e,t,i){if(i===OpenLayers.Projection.nullTransform){var n=OpenLayers.Projection.defaults[e];n&&!OpenLayers.Projection.defaults[t]&&(OpenLayers.Projection.defaults[t]=n)}OpenLayers.Projection.transforms[e]||(OpenLayers.Projection.transforms[e]={}),OpenLayers.Projection.transforms[e][t]=i},OpenLayers.Projection.transform=function(e,t,i){if(t&&i)if(t instanceof OpenLayers.Projection||(t=new OpenLayers.Projection(t)),i instanceof OpenLayers.Projection||(i=new OpenLayers.Projection(i)),t.proj&&i.proj)e=Proj4js.transform(t.proj,i.proj,e);else{t=t.getCode(),i=i.getCode();var n=OpenLayers.Projection.transforms;n[t]&&n[t][i]&&n[t][i](e)}return e},OpenLayers.Projection.nullTransform=function(e){return e},function(){function e(e){return e.x=180*e.x/20037508.34,e.y=180/Math.PI*(2*Math.atan(Math.exp(e.y/20037508.34*Math.PI))-Math.PI/2),e}function t(e){return e.x=20037508.34*e.x/180,e.y=Math.max(-20037508.34,Math.min(Math.log(Math.tan((90+e.y)*Math.PI/360))/Math.PI*20037508.34,20037508.34)),e}function i(i,n){var s,r,a,o,l,h=OpenLayers.Projection.addTransform,u=OpenLayers.Projection.nullTransform;for(s=0,r=n.length;s<r;++s)for(a=n[s],h(i,a,t),h(a,i,e),l=s+1;l<r;++l)o=n[l],h(a,o,u),h(o,a,u)}var n,s=["EPSG:900913","EPSG:3857","EPSG:102113","EPSG:102100","OSGEO:41001"],r=["CRS:84","urn:ogc:def:crs:EPSG:6.6:4326","EPSG:4326"];for(n=s.length-1;0<=n;--n)i(s[n],r);for(n=r.length-1;0<=n;--n)i(r[n],s)}(),OpenLayers.Map=OpenLayers.Class({Z_INDEX_BASE:{BaseLayer:100,Overlay:325,Feature:725,Popup:750,Control:1e3},id:null,fractionalZoom:!1,events:null,allOverlays:!1,div:null,dragging:!1,size:null,viewPortDiv:null,layerContainerOrigin:null,layerContainerDiv:null,layers:null,controls:null,popups:null,baseLayer:null,center:null,resolution:null,zoom:0,panRatio:1.5,options:null,tileSize:null,projection:"EPSG:4326",units:null,resolutions:null,maxResolution:null,minResolution:null,maxScale:null,minScale:null,maxExtent:null,minExtent:null,restrictedExtent:null,numZoomLevels:16,theme:null,displayProjection:null,fallThrough:!1,autoUpdateSize:!0,eventListeners:null,panTween:null,panMethod:OpenLayers.Easing.Expo.easeOut,panDuration:50,zoomTween:null,zoomMethod:OpenLayers.Easing.Quad.easeOut,zoomDuration:20,paddingForPopups:null,layerContainerOriginPx:null,minPx:null,maxPx:null,initialize:function(e,t){var i=OpenLayers.Util.isElement(e);if(1!==arguments.length||"object"!=typeof e||i||(e=(t=e)&&t.div),this.tileSize=new OpenLayers.Size(OpenLayers.Map.TILE_WIDTH,OpenLayers.Map.TILE_HEIGHT),this.paddingForPopups=new OpenLayers.Bounds(15,15,15,15),this.theme=OpenLayers._getScriptLocation()+"theme/default/style.css",this.options=OpenLayers.Util.extend({},t),OpenLayers.Util.extend(this,t),OpenLayers.Util.applyDefaults(this,OpenLayers.Projection.defaults[this.projection instanceof OpenLayers.Projection?this.projection.projCode:this.projection]),!this.maxExtent||this.maxExtent instanceof OpenLayers.Bounds||(this.maxExtent=new OpenLayers.Bounds(this.maxExtent)),!this.minExtent||this.minExtent instanceof OpenLayers.Bounds||(this.minExtent=new OpenLayers.Bounds(this.minExtent)),!this.restrictedExtent||this.restrictedExtent instanceof OpenLayers.Bounds||(this.restrictedExtent=new OpenLayers.Bounds(this.restrictedExtent)),!this.center||this.center instanceof OpenLayers.LonLat||(this.center=new OpenLayers.LonLat(this.center)),this.layers=[],this.id=OpenLayers.Util.createUniqueID("OpenLayers.Map_"),this.div=OpenLayers.Util.getElement(e),this.div||(this.div=document.createElement("div"),this.div.style.height="1px",this.div.style.width="1px"),OpenLayers.Element.addClass(this.div,"olMap"),i=this.id+"_OpenLayers_ViewPort",this.viewPortDiv=OpenLayers.Util.createDiv(i,null,null,null,"relative",null,"hidden"),this.viewPortDiv.style.width="100%",this.viewPortDiv.style.height="100%",this.viewPortDiv.className="olMapViewport",this.div.appendChild(this.viewPortDiv),this.events=new OpenLayers.Events(this,this.viewPortDiv,null,this.fallThrough,{includeXY:!0}),OpenLayers.TileManager&&null!==this.tileManager&&(this.tileManager instanceof OpenLayers.TileManager||(this.tileManager=new OpenLayers.TileManager(this.tileManager)),this.tileManager.addMap(this)),i=this.id+"_OpenLayers_Container",this.layerContainerDiv=OpenLayers.Util.createDiv(i),this.layerContainerDiv.style.zIndex=this.Z_INDEX_BASE.Popup-1,this.layerContainerOriginPx={x:0,y:0},this.applyTransform(),this.viewPortDiv.appendChild(this.layerContainerDiv),this.updateSize(),this.eventListeners instanceof Object&&this.events.on(this.eventListeners),!0===this.autoUpdateSize&&(this.updateSizeDestroy=OpenLayers.Function.bind(this.updateSize,this),OpenLayers.Event.observe(window,"resize",this.updateSizeDestroy)),this.theme){for(var i=!0,n=document.getElementsByTagName("link"),s=0,r=n.length;s<r;++s)if(OpenLayers.Util.isEquivalentUrl(n.item(s).href,this.theme)){i=!1;break}i&&(i=document.createElement("link"),i.setAttribute("rel","stylesheet"),i.setAttribute("type","text/css"),i.setAttribute("href",this.theme),document.getElementsByTagName("head")[0].appendChild(i))}for(null==this.controls&&(this.controls=[],null!=OpenLayers.Control&&(OpenLayers.Control.Navigation?this.controls.push(new OpenLayers.Control.Navigation):OpenLayers.Control.TouchNavigation&&this.controls.push(new OpenLayers.Control.TouchNavigation),OpenLayers.Control.Zoom?this.controls.push(new OpenLayers.Control.Zoom):OpenLayers.Control.PanZoom&&this.controls.push(new OpenLayers.Control.PanZoom),OpenLayers.Control.ArgParser&&this.controls.push(new OpenLayers.Control.ArgParser),OpenLayers.Control.Attribution&&this.controls.push(new OpenLayers.Control.Attribution))),s=0,r=this.controls.length;s<r;s++)this.addControlToMap(this.controls[s]);this.popups=[],this.unloadDestroy=OpenLayers.Function.bind(this.destroy,this),OpenLayers.Event.observe(window,"unload",this.unloadDestroy),t&&t.layers&&(delete this.center,delete this.zoom,this.addLayers(t.layers),t.center&&!this.getCenter()&&this.setCenter(t.center,t.zoom)),this.panMethod&&(this.panTween=new OpenLayers.Tween(this.panMethod)),this.zoomMethod&&this.applyTransform.transform&&(this.zoomTween=new OpenLayers.Tween(this.zoomMethod))},getViewport:function(){return this.viewPortDiv},render:function(e){this.div=OpenLayers.Util.getElement(e),OpenLayers.Element.addClass(this.div,"olMap"),this.viewPortDiv.parentNode.removeChild(this.viewPortDiv),this.div.appendChild(this.viewPortDiv),this.updateSize()},unloadDestroy:null,updateSizeDestroy:null,destroy:function(){if(!this.unloadDestroy)return!1;if(this.panTween&&(this.panTween.stop(),this.panTween=null),this.zoomTween&&(this.zoomTween.stop(),this.zoomTween=null),OpenLayers.Event.stopObserving(window,"unload",this.unloadDestroy),this.unloadDestroy=null,this.updateSizeDestroy&&OpenLayers.Event.stopObserving(window,"resize",this.updateSizeDestroy),this.paddingForPopups=null,null!=this.controls){for(var e=this.controls.length-1;0<=e;--e)this.controls[e].destroy();this.controls=null}if(null!=this.layers){for(e=this.layers.length-1;0<=e;--e)this.layers[e].destroy(!1);this.layers=null}this.viewPortDiv&&this.viewPortDiv.parentNode&&this.viewPortDiv.parentNode.removeChild(this.viewPortDiv),this.viewPortDiv=null,this.tileManager&&(this.tileManager.removeMap(this),this.tileManager=null),this.eventListeners&&(this.events.un(this.eventListeners),this.eventListeners=null),this.events.destroy(),this.options=this.events=null},setOptions:function(e){var t=this.minPx&&e.restrictedExtent!=this.restrictedExtent;OpenLayers.Util.extend(this,e),t&&this.moveTo(this.getCachedCenter(),this.zoom,{forceZoomChange:!0})},getTileSize:function(){return this.tileSize},getBy:function(e,t,i){var n="function"==typeof i.test;return OpenLayers.Array.filter(this[e],function(e){return e[t]==i||n&&i.test(e[t])})},getLayersBy:function(e,t){return this.getBy("layers",e,t)},getLayersByName:function(e){return this.getLayersBy("name",e)},getLayersByClass:function(e){return this.getLayersBy("CLASS_NAME",e)},getControlsBy:function(e,t){return this.getBy("controls",e,t)},getControlsByClass:function(e){return this.getControlsBy("CLASS_NAME",e)},getLayer:function(e){for(var t=null,i=0,n=this.layers.length;i<n;i++){var s=this.layers[i];if(s.id==e){t=s;break}}return t},setLayerZIndex:function(e,t){e.setZIndex(this.Z_INDEX_BASE[e.isBaseLayer?"BaseLayer":"Overlay"]+5*t)},resetLayersZIndex:function(){for(var e=0,t=this.layers.length;e<t;e++)this.setLayerZIndex(this.layers[e],e)},addLayer:function(e){for(var t=0,i=this.layers.length;t<i;t++)if(this.layers[t]==e)return!1;return!1!==this.events.triggerEvent("preaddlayer",{layer:e})&&(this.allOverlays&&(e.isBaseLayer=!1),e.div.className="olLayerDiv",e.div.style.overflow="",this.setLayerZIndex(e,this.layers.length),e.isFixed?this.viewPortDiv.appendChild(e.div):this.layerContainerDiv.appendChild(e.div),this.layers.push(e),e.setMap(this),e.isBaseLayer||this.allOverlays&&!this.baseLayer?null==this.baseLayer?this.setBaseLayer(e):e.setVisibility(!1):e.redraw(),this.events.triggerEvent("addlayer",{layer:e}),e.events.triggerEvent("added",{map:this,layer:e}),e.afterAdd(),!0)},addLayers:function(e){for(var t=0,i=e.length;t<i;t++)this.addLayer(e[t])},removeLayer:function(e,t){if(!1!==this.events.triggerEvent("preremovelayer",{layer:e})){if(null==t&&(t=!0),e.isFixed?this.viewPortDiv.removeChild(e.div):this.layerContainerDiv.removeChild(e.div),OpenLayers.Util.removeItem(this.layers,e),e.removeMap(this),e.map=null,this.baseLayer==e&&(this.baseLayer=null,t))for(var i=0,n=this.layers.length;i<n;i++){var s=this.layers[i];if(s.isBaseLayer||this.allOverlays){this.setBaseLayer(s);break}}this.resetLayersZIndex(),this.events.triggerEvent("removelayer",{layer:e}),e.events.triggerEvent("removed",{map:this,layer:e})}},getNumLayers:function(){return this.layers.length},getLayerIndex:function(e){return OpenLayers.Util.indexOf(this.layers,e)},setLayerIndex:function(e,t){var i=this.getLayerIndex(e);if(0>t?t=0:t>this.layers.length&&(t=this.layers.length),i!=t){this.layers.splice(i,1),this.layers.splice(t,0,e);for(var i=0,n=this.layers.length;i<n;i++)this.setLayerZIndex(this.layers[i],i);this.events.triggerEvent("changelayer",{layer:e,property:"order"}),this.allOverlays&&(0===t?this.setBaseLayer(e):this.baseLayer!==this.layers[0]&&this.setBaseLayer(this.layers[0]))}},raiseLayer:function(e,t){var i=this.getLayerIndex(e)+t;this.setLayerIndex(e,i)},setBaseLayer:function(e){if(e!=this.baseLayer&&-1!=OpenLayers.Util.indexOf(this.layers,e)){var t=this.getCachedCenter(),i=this.getResolution(),n=OpenLayers.Util.getResolutionFromScale(this.getScale(),e.units);null==this.baseLayer||this.allOverlays||this.baseLayer.setVisibility(!1),this.baseLayer=e,this.allOverlays&&!this.baseLayer.visibility||(this.baseLayer.setVisibility(!0),!1===this.baseLayer.inRange&&this.baseLayer.redraw()),null!=t&&(e=this.getZoomForResolution(n||this.resolution,!0),this.setCenter(t,e,!1,i!=n)),this.events.triggerEvent("changebaselayer",{layer:this.baseLayer})}},addControl:function(e,t){this.controls.push(e),this.addControlToMap(e,t)},addControls:function(e,t){for(var i=1===arguments.length?[]:t,n=0,s=e.length;n<s;n++)this.addControl(e[n],i[n]?i[n]:null)},addControlToMap:function(e,t){e.outsideViewport=null!=e.div,this.displayProjection&&!e.displayProjection&&(e.displayProjection=this.displayProjection),e.setMap(this);var i=e.draw(t);i&&!e.outsideViewport&&(i.style.zIndex=this.Z_INDEX_BASE.Control+this.controls.length,this.viewPortDiv.appendChild(i)),e.autoActivate&&e.activate()},getControl:function(e){for(var t=null,i=0,n=this.controls.length;i<n;i++){var s=this.controls[i];if(s.id==e){t=s;break}}return t},removeControl:function(e){e&&e==this.getControl(e.id)&&(e.div&&e.div.parentNode==this.viewPortDiv&&this.viewPortDiv.removeChild(e.div),OpenLayers.Util.removeItem(this.controls,e))},addPopup:function(e,t){if(t)for(var i=this.popups.length-1;0<=i;--i)this.removePopup(this.popups[i]);e.map=this,this.popups.push(e),(i=e.draw())&&(i.style.zIndex=this.Z_INDEX_BASE.Popup+this.popups.length,this.layerContainerDiv.appendChild(i))},removePopup:function(e){if(OpenLayers.Util.removeItem(this.popups,e),
e.div)try{this.layerContainerDiv.removeChild(e.div)}catch(e){}e.map=null},getSize:function(){var e=null;return null!=this.size&&(e=this.size.clone()),e},updateSize:function(){var e=this.getCurrentSize();if(e&&!isNaN(e.h)&&!isNaN(e.w)){this.events.clearMouseCache();var t=this.getSize();if(null==t&&(this.size=t=e),!e.equals(t)){for(this.size=e,e=0,t=this.layers.length;e<t;e++)this.layers[e].onMapResize();e=this.getCachedCenter(),null!=this.baseLayer&&null!=e&&(t=this.getZoom(),this.zoom=null,this.setCenter(e,t))}}this.events.triggerEvent("updatesize")},getCurrentSize:function(){var e=new OpenLayers.Size(this.div.clientWidth,this.div.clientHeight);return(0==e.w&&0==e.h||isNaN(e.w)&&isNaN(e.h))&&(e.w=this.div.offsetWidth,e.h=this.div.offsetHeight),(0==e.w&&0==e.h||isNaN(e.w)&&isNaN(e.h))&&(e.w=parseInt(this.div.style.width),e.h=parseInt(this.div.style.height)),e},calculateBounds:function(e,t){var i=null;if(null==e&&(e=this.getCachedCenter()),null==t&&(t=this.getResolution()),null!=e&&null!=t)var i=this.size.w*t/2,n=this.size.h*t/2,i=new OpenLayers.Bounds(e.lon-i,e.lat-n,e.lon+i,e.lat+n);return i},getCenter:function(){var e=null,t=this.getCachedCenter();return t&&(e=t.clone()),e},getCachedCenter:function(){return!this.center&&this.size&&(this.center=this.getLonLatFromViewPortPx({x:this.size.w/2,y:this.size.h/2})),this.center},getZoom:function(){return this.zoom},pan:function(e,t,i){if(i=OpenLayers.Util.applyDefaults(i,{animate:!0,dragging:!1}),i.dragging)0==e&&0==t||this.moveByPx(e,t);else{var n=this.getViewPortPxFromLonLat(this.getCachedCenter());e=n.add(e,t),!this.dragging&&e.equals(n)||(n=this.getLonLatFromViewPortPx(e),i.animate?this.panTo(n):(this.moveTo(n),this.dragging&&(this.dragging=!1,this.events.triggerEvent("moveend"))))}},panTo:function(e){if(this.panTween&&this.getExtent().scale(this.panRatio).containsLonLat(e)){var t=this.getCachedCenter();if(!e.equals(t)){var t=this.getPixelFromLonLat(t),i=this.getPixelFromLonLat(e),n=0,s=0;this.panTween.start({x:0,y:0},{x:i.x-t.x,y:i.y-t.y},this.panDuration,{callbacks:{eachStep:OpenLayers.Function.bind(function(e){this.moveByPx(e.x-n,e.y-s),n=Math.round(e.x),s=Math.round(e.y)},this),done:OpenLayers.Function.bind(function(t){this.moveTo(e),this.dragging=!1,this.events.triggerEvent("moveend")},this)}})}}else this.setCenter(e)},setCenter:function(e,t,i,n){this.panTween&&this.panTween.stop(),this.zoomTween&&this.zoomTween.stop(),this.moveTo(e,t,{dragging:i,forceZoomChange:n})},moveByPx:function(e,t){var i=this.size.w/2,n=this.size.h/2,s=i+e,r=n+t,a=this.baseLayer.wrapDateLine,o=0,l=0;if(this.restrictedExtent&&(o=i,l=n,a=!1),e=a||s<=this.maxPx.x-o&&s>=this.minPx.x+o?Math.round(e):0,t=r<=this.maxPx.y-l&&r>=this.minPx.y+l?Math.round(t):0,e||t){for(this.dragging||(this.dragging=!0,this.events.triggerEvent("movestart")),this.center=null,e&&(this.layerContainerOriginPx.x-=e,this.minPx.x-=e,this.maxPx.x-=e),t&&(this.layerContainerOriginPx.y-=t,this.minPx.y-=t,this.maxPx.y-=t),this.applyTransform(),n=0,s=this.layers.length;n<s;++n)i=this.layers[n],i.visibility&&(i===this.baseLayer||i.inRange)&&(i.moveByPx(e,t),i.events.triggerEvent("move"));this.events.triggerEvent("move")}},adjustZoom:function(e){if(this.baseLayer&&this.baseLayer.wrapDateLine){var t=this.baseLayer.resolutions,i=this.getMaxExtent().getWidth()/this.size.w;if(this.getResolutionForZoom(e)>i)if(this.fractionalZoom)e=this.getZoomForResolution(i);else for(var n=0|e,s=t.length;n<s;++n)if(t[n]<=i){e=n;break}}return e},getMinZoom:function(){return this.adjustZoom(0)},moveTo:function(e,t,i){null==e||e instanceof OpenLayers.LonLat||(e=new OpenLayers.LonLat(e)),i||(i={}),null!=t&&(t=parseFloat(t),this.fractionalZoom||(t=Math.round(t)));var n=t;t=this.adjustZoom(t),t!==n&&(e=this.getCenter());var n=i.dragging||this.dragging,s=i.forceZoomChange;if(this.getCachedCenter()||this.isValidLonLat(e)||(e=this.maxExtent.getCenterLonLat(),this.center=e.clone()),null!=this.restrictedExtent){null==e&&(e=this.center),null==t&&(t=this.getZoom());var r=this.getResolutionForZoom(t),r=this.calculateBounds(e,r);if(!this.restrictedExtent.containsBounds(r)){var a=this.restrictedExtent.getCenterLonLat();r.getWidth()>this.restrictedExtent.getWidth()?e=new OpenLayers.LonLat(a.lon,e.lat):r.left<this.restrictedExtent.left?e=e.add(this.restrictedExtent.left-r.left,0):r.right>this.restrictedExtent.right&&(e=e.add(this.restrictedExtent.right-r.right,0)),r.getHeight()>this.restrictedExtent.getHeight()?e=new OpenLayers.LonLat(e.lon,a.lat):r.bottom<this.restrictedExtent.bottom?e=e.add(0,this.restrictedExtent.bottom-r.bottom):r.top>this.restrictedExtent.top&&(e=e.add(0,this.restrictedExtent.top-r.top))}}if(s=s||this.isValidZoomLevel(t)&&t!=this.getZoom(),r=this.isValidLonLat(e)&&!e.equals(this.center),s||r||n){if(n||this.events.triggerEvent("movestart",{zoomChanged:s}),r&&(!s&&this.center&&this.centerLayerContainer(e),this.center=e.clone()),e=s?this.getResolutionForZoom(t):this.getResolution(),s||null==this.layerContainerOrigin){this.layerContainerOrigin=this.getCachedCenter(),this.layerContainerOriginPx.x=0,this.layerContainerOriginPx.y=0,this.applyTransform();var r=this.getMaxExtent({restricted:!0}),o=r.getCenterLonLat(),a=this.center.lon-o.lon,o=o.lat-this.center.lat,l=Math.round(r.getWidth()/e),h=Math.round(r.getHeight()/e);this.minPx={x:(this.size.w-l)/2-a/e,y:(this.size.h-h)/2-o/e},this.maxPx={x:this.minPx.x+Math.round(r.getWidth()/e),y:this.minPx.y+Math.round(r.getHeight()/e)}}for(s&&(this.zoom=t,this.resolution=e),e=this.getExtent(),this.baseLayer.visibility&&(this.baseLayer.moveTo(e,s,i.dragging),i.dragging||this.baseLayer.events.triggerEvent("moveend",{zoomChanged:s})),e=this.baseLayer.getExtent(),t=this.layers.length-1;0<=t;--t)r=this.layers[t],r===this.baseLayer||r.isBaseLayer||(a=r.calculateInRange(),r.inRange!=a&&((r.inRange=a)||r.display(!1),this.events.triggerEvent("changelayer",{layer:r,property:"visibility"})),a&&r.visibility&&(r.moveTo(e,s,i.dragging),i.dragging||r.events.triggerEvent("moveend",{zoomChanged:s})));if(this.events.triggerEvent("move"),n||this.events.triggerEvent("moveend"),s){for(t=0,i=this.popups.length;t<i;t++)this.popups[t].updatePosition();this.events.triggerEvent("zoomend")}}},centerLayerContainer:function(e){var t=this.getViewPortPxFromLonLat(this.layerContainerOrigin),i=this.getViewPortPxFromLonLat(e);if(null!=t&&null!=i){var n=this.layerContainerOriginPx.x;e=this.layerContainerOriginPx.y;var s=Math.round(t.x-i.x),t=Math.round(t.y-i.y);this.applyTransform(this.layerContainerOriginPx.x=s,this.layerContainerOriginPx.y=t),n-=s,e-=t,this.minPx.x-=n,this.maxPx.x-=n,this.minPx.y-=e,this.maxPx.y-=e}},isValidZoomLevel:function(e){return null!=e&&0<=e&&e<this.getNumZoomLevels()},isValidLonLat:function(e){var t=!1;return null!=e&&(t=this.getMaxExtent(),t=t.containsLonLat(e,{worldBounds:this.baseLayer.wrapDateLine&&t})),t},getProjection:function(){var e=this.getProjectionObject();return e?e.getCode():null},getProjectionObject:function(){var e=null;return null!=this.baseLayer&&(e=this.baseLayer.projection),e},getMaxResolution:function(){var e=null;return null!=this.baseLayer&&(e=this.baseLayer.maxResolution),e},getMaxExtent:function(e){var t=null;return e&&e.restricted&&this.restrictedExtent?t=this.restrictedExtent:null!=this.baseLayer&&(t=this.baseLayer.maxExtent),t},getNumZoomLevels:function(){var e=null;return null!=this.baseLayer&&(e=this.baseLayer.numZoomLevels),e},getExtent:function(){var e=null;return null!=this.baseLayer&&(e=this.baseLayer.getExtent()),e},getResolution:function(){var e=null;return null!=this.baseLayer?e=this.baseLayer.getResolution():!0===this.allOverlays&&0<this.layers.length&&(e=this.layers[0].getResolution()),e},getUnits:function(){var e=null;return null!=this.baseLayer&&(e=this.baseLayer.units),e},getScale:function(){var e=null;return null!=this.baseLayer&&(e=this.getResolution(),e=OpenLayers.Util.getScaleFromResolution(e,this.baseLayer.units)),e},getZoomForExtent:function(e,t){var i=null;return null!=this.baseLayer&&(i=this.baseLayer.getZoomForExtent(e,t)),i},getResolutionForZoom:function(e){var t=null;return this.baseLayer&&(t=this.baseLayer.getResolutionForZoom(e)),t},getZoomForResolution:function(e,t){var i=null;return null!=this.baseLayer&&(i=this.baseLayer.getZoomForResolution(e,t)),i},zoomTo:function(e,t){var i=this;if(i.isValidZoomLevel(e)){i.baseLayer.wrapDateLine&&(e=i.adjustZoom(e));var n=t?i.getZoomTargetCenter(t,i.getResolutionForZoom(e)):i.getCenter();if(n&&i.events.triggerEvent("zoomstart",{center:n,zoom:e}),i.zoomTween){i.zoomTween.stop();var s=i.getResolution(),r=i.getResolutionForZoom(e),s={scale:s/r};t||(r=i.getSize(),t={x:r.w/2,y:r.h/2}),i.zoomTween.start({scale:1},s,i.zoomDuration,{minFrameRate:50,callbacks:{eachStep:function(e){var n=i.layerContainerOriginPx;e=e.scale,i.applyTransform(n.x+((e-1)*(n.x-t.x)|0),n.y+((e-1)*(n.y-t.y)|0),e)},done:function(e){i.applyTransform();var s=i.getResolution()/e.scale,r=i.getZoomForResolution(s,!0);e=1===e.scale?n:i.getZoomTargetCenter(t,s),i.moveTo(e,r)}}})}else i.setCenter(n,e)}},zoomIn:function(){this.zoomTween&&this.zoomTween.stop(),this.zoomTo(this.getZoom()+1)},zoomOut:function(){this.zoomTween&&this.zoomTween.stop(),this.zoomTo(this.getZoom()-1)},zoomToExtent:function(e,t){e instanceof OpenLayers.Bounds||(e=new OpenLayers.Bounds(e));var i=e.getCenterLonLat();if(this.baseLayer.wrapDateLine){for(i=this.getMaxExtent(),e=e.clone();e.right<e.left;)e.right+=i.getWidth();i=e.getCenterLonLat().wrapDateLine(i)}this.setCenter(i,this.getZoomForExtent(e,t))},zoomToMaxExtent:function(e){e=this.getMaxExtent({restricted:!e||e.restricted}),this.zoomToExtent(e)},zoomToScale:function(e,t){var i=OpenLayers.Util.getResolutionFromScale(e,this.baseLayer.units),n=this.size.w*i/2,i=this.size.h*i/2,s=this.getCachedCenter(),n=new OpenLayers.Bounds(s.lon-n,s.lat-i,s.lon+n,s.lat+i);this.zoomToExtent(n,t)},getLonLatFromViewPortPx:function(e){var t=null;return null!=this.baseLayer&&(t=this.baseLayer.getLonLatFromViewPortPx(e)),t},getViewPortPxFromLonLat:function(e){var t=null;return null!=this.baseLayer&&(t=this.baseLayer.getViewPortPxFromLonLat(e)),t},getZoomTargetCenter:function(e,t){var i=null,n=this.getSize(),s=n.w/2-e.x,n=e.y-n.h/2,r=this.getLonLatFromPixel(e);return r&&(i=new OpenLayers.LonLat(r.lon+s*t,r.lat+n*t)),i},getLonLatFromPixel:function(e){return this.getLonLatFromViewPortPx(e)},getPixelFromLonLat:function(e){return e=this.getViewPortPxFromLonLat(e),e.x=Math.round(e.x),e.y=Math.round(e.y),e},getGeodesicPixelSize:function(e){var t=e?this.getLonLatFromPixel(e):this.getCachedCenter()||new OpenLayers.LonLat(0,0),i=this.getResolution();e=t.add(-i/2,0);var n=t.add(i/2,0),s=t.add(0,-i/2),t=t.add(0,i/2),i=new OpenLayers.Projection("EPSG:4326"),r=this.getProjectionObject()||i;return r.equals(i)||(e.transform(r,i),n.transform(r,i),s.transform(r,i),t.transform(r,i)),new OpenLayers.Size(OpenLayers.Util.distVincenty(e,n),OpenLayers.Util.distVincenty(s,t))},getViewPortPxFromLayerPx:function(e){var t=null;return null!=e&&(t=e.add(this.layerContainerOriginPx.x,this.layerContainerOriginPx.y)),t},getLayerPxFromViewPortPx:function(e){var t=null;return null!=e&&(t=e.add(-this.layerContainerOriginPx.x,-this.layerContainerOriginPx.y),isNaN(t.x)||isNaN(t.y))&&(t=null),t},getLonLatFromLayerPx:function(e){return e=this.getViewPortPxFromLayerPx(e),this.getLonLatFromViewPortPx(e)},getLayerPxFromLonLat:function(e){return e=this.getPixelFromLonLat(e),this.getLayerPxFromViewPortPx(e)},applyTransform:function(e,t,i){i=i||1;var n=this.layerContainerOriginPx,s=1!==i;e=e||n.x,t=t||n.y;var r=this.layerContainerDiv.style,a=this.applyTransform.transform,o=this.applyTransform.template;if(void 0===a&&(a=OpenLayers.Util.vendorPrefix.style("transform"),this.applyTransform.transform=a)){var l=OpenLayers.Element.getStyle(this.viewPortDiv,OpenLayers.Util.vendorPrefix.css("transform"));l&&"none"===l||(o=["translate3d(",",0) ","scale3d(",",1)"],r[a]=[o[0],"0,0",o[1]].join("")),o&&~r[a].indexOf(o[0])||(o=["translate(",") ","scale(",")"]),this.applyTransform.template=o}null===a||"translate3d("!==o[0]&&!0!==s?(r.left=e+"px",r.top=t+"px",null!==a&&(r[a]="")):(!0===s&&"translate("===o[0]&&(e-=n.x,t-=n.y,r.left=n.x+"px",r.top=n.y+"px"),r[a]=[o[0],e,"px,",t,"px",o[1],o[2],i,",",i,o[3]].join(""))},CLASS_NAME:"OpenLayers.Map"}),OpenLayers.Map.TILE_WIDTH=256,OpenLayers.Map.TILE_HEIGHT=256,OpenLayers.Layer=OpenLayers.Class({id:null,name:null,div:null,opacity:1,alwaysInRange:null,RESOLUTION_PROPERTIES:"scales resolutions maxScale minScale maxResolution minResolution numZoomLevels maxZoomLevel".split(" "),events:null,map:null,isBaseLayer:!1,alpha:!1,displayInLayerSwitcher:!0,visibility:!0,attribution:null,inRange:!1,imageSize:null,options:null,eventListeners:null,gutter:0,projection:null,units:null,scales:null,resolutions:null,maxExtent:null,minExtent:null,maxResolution:null,minResolution:null,numZoomLevels:null,minScale:null,maxScale:null,displayOutsideMaxExtent:!1,wrapDateLine:!1,metadata:null,initialize:function(e,t){this.metadata={},t=OpenLayers.Util.extend({},t),null!=this.alwaysInRange&&(t.alwaysInRange=this.alwaysInRange),this.addOptions(t),this.name=e,null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"),this.div=OpenLayers.Util.createDiv(this.id),this.div.style.width="100%",this.div.style.height="100%",this.div.dir="ltr",this.events=new OpenLayers.Events(this,this.div),this.eventListeners instanceof Object)&&this.events.on(this.eventListeners)},destroy:function(e){null==e&&(e=!0),null!=this.map&&this.map.removeLayer(this,e),this.options=this.div=this.name=this.map=this.projection=null,this.events&&(this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy()),this.events=this.eventListeners=null},clone:function(e){return null==e&&(e=new OpenLayers.Layer(this.name,this.getOptions())),OpenLayers.Util.applyDefaults(e,this),e.map=null,e},getOptions:function(){var e,t={};for(e in this.options)t[e]=this[e];return t},setName:function(e){e!=this.name&&(this.name=e,null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"name"}))},addOptions:function(e,t){if(null==this.options&&(this.options={}),e&&("string"==typeof e.projection&&(e.projection=new OpenLayers.Projection(e.projection)),e.projection&&OpenLayers.Util.applyDefaults(e,OpenLayers.Projection.defaults[e.projection.getCode()]),!e.maxExtent||e.maxExtent instanceof OpenLayers.Bounds||(e.maxExtent=new OpenLayers.Bounds(e.maxExtent)),!e.minExtent||e.minExtent instanceof OpenLayers.Bounds||(e.minExtent=new OpenLayers.Bounds(e.minExtent))),OpenLayers.Util.extend(this.options,e),OpenLayers.Util.extend(this,e),this.projection&&this.projection.getUnits()&&(this.units=this.projection.getUnits()),this.map){var i,n=this.map.getResolution(),s=this.RESOLUTION_PROPERTIES.concat(["projection","units","minExtent","maxExtent"]);for(i in e)if(e.hasOwnProperty(i)&&0<=OpenLayers.Util.indexOf(s,i)){this.initResolutions(),t&&this.map.baseLayer===this&&(this.map.setCenter(this.map.getCenter(),this.map.getZoomForResolution(n),!1,!0),this.map.events.triggerEvent("changebaselayer",{layer:this}));break}}},onMapResize:function(){},redraw:function(){var e=!1;if(this.map){this.inRange=this.calculateInRange();var t=this.getExtent();t&&this.inRange&&this.visibility&&(this.moveTo(t,!0,!1),this.events.triggerEvent("moveend",{zoomChanged:!0}),e=!0)}return e},moveTo:function(e,t,i){e=this.visibility,this.isBaseLayer||(e=e&&this.inRange),this.display(e)},moveByPx:function(e,t){},setMap:function(e){null==this.map&&(this.map=e,this.maxExtent=this.maxExtent||this.map.maxExtent,this.minExtent=this.minExtent||this.map.minExtent,this.projection=this.projection||this.map.projection,"string"==typeof this.projection&&(this.projection=new OpenLayers.Projection(this.projection)),this.projection&&this.projection.getUnits()?this.units=this.projection.getUnits():this.units=this.units||this.map.units,this.initResolutions(),this.isBaseLayer||(this.inRange=this.calculateInRange(),this.div.style.display=this.visibility&&this.inRange?"":"none"),this.setTileSize())},afterAdd:function(){},removeMap:function(e){},getImageSize:function(e){return this.imageSize||this.tileSize},setTileSize:function(e){this.tileSize=e=e?e:this.tileSize?this.tileSize:this.map.getTileSize(),this.gutter&&(this.imageSize=new OpenLayers.Size(e.w+2*this.gutter,e.h+2*this.gutter))},getVisibility:function(){return this.visibility},setVisibility:function(e){e!=this.visibility&&(this.visibility=e,this.display(e),this.redraw(),null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"visibility"}),this.events.triggerEvent("visibilitychanged"))},display:function(e){e!=("none"!=this.div.style.display)&&(this.div.style.display=e&&this.calculateInRange()?"block":"none")},calculateInRange:function(){var e=!1;return this.alwaysInRange?e=!0:this.map&&(e=this.map.getResolution(),e=e>=this.minResolution&&e<=this.maxResolution),e},setIsBaseLayer:function(e){e!=this.isBaseLayer&&(this.isBaseLayer=e,null!=this.map&&this.map.events.triggerEvent("changebaselayer",{layer:this}))},initResolutions:function(){var e,t,i,n={},s=!0;for(e=0,t=this.RESOLUTION_PROPERTIES.length;e<t;e++)i=this.RESOLUTION_PROPERTIES[e],n[i]=this.options[i],s&&this.options[i]&&(s=!1);if(null==this.options.alwaysInRange&&(this.alwaysInRange=s),null==n.resolutions&&(n.resolutions=this.resolutionsFromScales(n.scales)),null==n.resolutions&&(n.resolutions=this.calculateResolutions(n)),null==n.resolutions){for(e=0,t=this.RESOLUTION_PROPERTIES.length;e<t;e++)i=this.RESOLUTION_PROPERTIES[e],n[i]=null!=this.options[i]?this.options[i]:this.map[i];null==n.resolutions&&(n.resolutions=this.resolutionsFromScales(n.scales)),null==n.resolutions&&(n.resolutions=this.calculateResolutions(n))}var r;this.options.maxResolution&&"auto"!==this.options.maxResolution&&(r=this.options.maxResolution),this.options.minScale&&(r=OpenLayers.Util.getResolutionFromScale(this.options.minScale,this.units));var a;if(this.options.minResolution&&"auto"!==this.options.minResolution&&(a=this.options.minResolution),this.options.maxScale&&(a=OpenLayers.Util.getResolutionFromScale(this.options.maxScale,this.units)),n.resolutions&&(n.resolutions.sort(function(e,t){return t-e}),r||(r=n.resolutions[0]),a||(a=n.resolutions[n.resolutions.length-1])),this.resolutions=n.resolutions){for(t=this.resolutions.length,this.scales=Array(t),e=0;e<t;e++)this.scales[e]=OpenLayers.Util.getScaleFromResolution(this.resolutions[e],this.units);this.numZoomLevels=t}(this.minResolution=a)&&(this.maxScale=OpenLayers.Util.getScaleFromResolution(a,this.units)),(this.maxResolution=r)&&(this.minScale=OpenLayers.Util.getScaleFromResolution(r,this.units))},resolutionsFromScales:function(e){if(null!=e){var t,i,n;for(n=e.length,t=Array(n),i=0;i<n;i++)t[i]=OpenLayers.Util.getResolutionFromScale(e[i],this.units);return t}},calculateResolutions:function(e){var t,i,n=e.maxResolution;if(null!=e.minScale?n=OpenLayers.Util.getResolutionFromScale(e.minScale,this.units):"auto"==n&&null!=this.maxExtent&&(t=this.map.getSize(),i=this.maxExtent.getWidth()/t.w,t=this.maxExtent.getHeight()/t.h,n=Math.max(i,t)),i=e.minResolution,null!=e.maxScale?i=OpenLayers.Util.getResolutionFromScale(e.maxScale,this.units):"auto"==e.minResolution&&null!=this.minExtent&&(t=this.map.getSize(),i=this.minExtent.getWidth()/t.w,t=this.minExtent.getHeight()/t.h,i=Math.max(i,t)),"number"!=typeof n&&"number"!=typeof i&&null!=this.maxExtent&&(n=this.map.getTileSize(),n=Math.max(this.maxExtent.getWidth()/n.w,this.maxExtent.getHeight()/n.h)),t=e.maxZoomLevel,e=e.numZoomLevels,"number"==typeof i&&"number"==typeof n&&void 0===e?e=Math.floor(Math.log(n/i)/Math.log(2))+1:void 0===e&&null!=t&&(e=t+1),!("number"!=typeof e||0>=e||"number"!=typeof n&&"number"!=typeof i)){t=Array(e);var s=2;"number"==typeof i&&"number"==typeof n&&(s=Math.pow(n/i,1/(e-1)));var r;if("number"==typeof n)for(r=0;r<e;r++)t[r]=n/Math.pow(s,r);else for(r=0;r<e;r++)t[e-1-r]=i*Math.pow(s,r);return t}},getResolution:function(){var e=this.map.getZoom();return this.getResolutionForZoom(e)},getExtent:function(){return this.map.calculateBounds()},getZoomForExtent:function(e,t){var i=this.map.getSize(),i=Math.max(e.getWidth()/i.w,e.getHeight()/i.h);return this.getZoomForResolution(i,t)},getDataExtent:function(){},getResolutionForZoom:function(e){if(e=Math.max(0,Math.min(e,this.resolutions.length-1)),this.map.fractionalZoom){var t=Math.floor(e);e=this.resolutions[t]-(e-t)*(this.resolutions[t]-this.resolutions[Math.ceil(e)])}else e=this.resolutions[Math.round(e)];return e},getZoomForResolution:function(e,t){var i,n;if(this.map.fractionalZoom){var s,r=0,a=this.resolutions[r],o=this.resolutions[this.resolutions.length-1];for(i=0,n=this.resolutions.length;i<n;++i)if(s=this.resolutions[i],s>=e&&(a=s,r=i),s<=e){o=s;break}i=a-o,i=0<i?r+(a-e)/i:r}else{for(a=Number.POSITIVE_INFINITY,i=0,n=this.resolutions.length;i<n;i++)if(t){if(r=Math.abs(this.resolutions[i]-e),r>a)break;a=r}else if(this.resolutions[i]<e)break;i=Math.max(0,i-1)}return i},getLonLatFromViewPortPx:function(e){var t=null,i=this.map;if(null!=e&&i.minPx){var t=i.getResolution(),n=i.getMaxExtent({restricted:!0}),t=new OpenLayers.LonLat((e.x-i.minPx.x)*t+n.left,(i.minPx.y-e.y)*t+n.top);this.wrapDateLine&&(t=t.wrapDateLine(this.maxExtent))}return t},getViewPortPxFromLonLat:function(e,t){var i=null;return null!=e&&(t=t||this.map.getResolution(),i=this.map.calculateBounds(null,t),i=new OpenLayers.Pixel(1/t*(e.lon-i.left),1/t*(i.top-e.lat))),i},setOpacity:function(e){if(e!=this.opacity){this.opacity=e;for(var t=this.div.childNodes,i=0,n=t.length;i<n;++i){var s=t[i].firstChild||t[i],r=t[i].lastChild;r&&"iframe"===r.nodeName.toLowerCase()&&(s=r.parentNode),OpenLayers.Util.modifyDOMElement(s,null,null,null,null,null,null,e)}null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"})}},getZIndex:function(){return this.div.style.zIndex},setZIndex:function(e){this.div.style.zIndex=e},adjustBounds:function(e){if(this.gutter){var t=this.gutter*this.map.getResolution();e=new OpenLayers.Bounds(e.left-t,e.bottom-t,e.right+t,e.top+t)}return this.wrapDateLine&&(t={rightTolerance:this.getResolution(),leftTolerance:this.getResolution()},e=e.wrapDateLine(this.maxExtent,t)),e},CLASS_NAME:"OpenLayers.Layer"}),OpenLayers.Layer.HTTPRequest=OpenLayers.Class(OpenLayers.Layer,{URL_HASH_FACTOR:(Math.sqrt(5)-1)/2,url:null,params:null,reproject:!1,initialize:function(e,t,i,n){OpenLayers.Layer.prototype.initialize.apply(this,[e,n]),this.url=t,this.params||(this.params=OpenLayers.Util.extend({},i))},destroy:function(){this.params=this.url=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.HTTPRequest(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.prototype.clone.apply(this,[e])},setUrl:function(e){this.url=e},mergeNewParams:function(e){return this.params=OpenLayers.Util.extend(this.params,e),e=this.redraw(),null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"params"}),e},redraw:function(e){return e?(this.events.triggerEvent("refresh"),this.mergeNewParams({_olSalt:Math.random()})):OpenLayers.Layer.prototype.redraw.apply(this,[])},selectUrl:function(e,t){for(var i=1,n=0,s=e.length;n<s;n++)i*=e.charCodeAt(n)*this.URL_HASH_FACTOR,i-=Math.floor(i);return t[Math.floor(i*t.length)]},getFullRequestString:function(e,t){var i=t||this.url,n=OpenLayers.Util.extend({},this.params),n=OpenLayers.Util.extend(n,e),s=OpenLayers.Util.getParameterString(n);OpenLayers.Util.isArray(i)&&(i=this.selectUrl(s,i));var r,s=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(i));for(r in n)r.toUpperCase()in s&&delete n[r];return s=OpenLayers.Util.getParameterString(n),OpenLayers.Util.urlAppend(i,s)},CLASS_NAME:"OpenLayers.Layer.HTTPRequest"}),OpenLayers.Tile=OpenLayers.Class({events:null,eventListeners:null,id:null,layer:null,url:null,bounds:null,size:null,position:null,isLoading:!1,initialize:function(e,t,i,n,s,r){this.layer=e,this.position=t.clone(),this.setBounds(i),this.url=n,s&&(this.size=s.clone()),this.id=OpenLayers.Util.createUniqueID("Tile_"),OpenLayers.Util.extend(this,r),this.events=new OpenLayers.Events(this),this.eventListeners instanceof Object&&this.events.on(this.eventListeners)},unload:function(){this.isLoading&&(this.isLoading=!1,this.events.triggerEvent("unload"))},destroy:function(){this.position=this.size=this.bounds=this.layer=null,this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy(),this.events=this.eventListeners=null},draw:function(e){e||this.clear();var t=this.shouldDraw();return t&&!e&&!1===this.events.triggerEvent("beforedraw")&&(t=null),t},shouldDraw:function(){var e=!1,t=this.layer.maxExtent;if(t){var i=this.layer.map,i=i.baseLayer.wrapDateLine&&i.getMaxExtent();this.bounds.intersectsBounds(t,{inclusive:!1,worldBounds:i})&&(e=!0)}return e||this.layer.displayOutsideMaxExtent},setBounds:function(e){if(e=e.clone(),this.layer.map.baseLayer.wrapDateLine){var t=this.layer.map.getMaxExtent(),i=this.layer.map.getResolution();e=e.wrapDateLine(t,{leftTolerance:i,rightTolerance:i})}this.bounds=e},moveTo:function(e,t,i){null==i&&(i=!0),this.setBounds(e),this.position=t.clone(),i&&this.draw()},clear:function(e){},CLASS_NAME:"OpenLayers.Tile"}),OpenLayers.Tile.Image=OpenLayers.Class(OpenLayers.Tile,{url:null,imgDiv:null,frame:null,imageReloadAttempts:null,layerAlphaHack:null,asyncRequestId:null,maxGetUrlLength:null,canvasContext:null,crossOriginKeyword:null,initialize:function(e,t,i,n,s,r){OpenLayers.Tile.prototype.initialize.apply(this,arguments),this.url=n,this.layerAlphaHack=this.layer.alpha&&OpenLayers.Util.alphaHack(),(null!=this.maxGetUrlLength||this.layer.gutter||this.layerAlphaHack)&&(this.frame=document.createElement("div"),this.frame.style.position="absolute",this.frame.style.overflow="hidden"),null!=this.maxGetUrlLength&&OpenLayers.Util.extend(this,OpenLayers.Tile.Image.IFrame)},destroy:function(){this.imgDiv&&(this.clear(),this.frame=this.imgDiv=null),this.asyncRequestId=null,OpenLayers.Tile.prototype.destroy.apply(this,arguments)},draw:function(){var e=OpenLayers.Tile.prototype.draw.apply(this,arguments);return e?(this.layer!=this.layer.map.baseLayer&&this.layer.reproject&&(this.bounds=this.getBoundsFromBaseLayer(this.position)),this.isLoading?this._loadEvent="reload":(this.isLoading=!0,this._loadEvent="loadstart"),this.renderTile(),this.positionTile()):!1===e&&this.unload(),e},renderTile:function(){if(this.layer.async){var e=this.asyncRequestId=(this.asyncRequestId||0)+1;this.layer.getURLasync(this.bounds,function(t){e==this.asyncRequestId&&(this.url=t,this.initImage())},this)}else this.url=this.layer.getURL(this.bounds),this.initImage()},positionTile:function(){var e=this.getTile().style,t=this.frame?this.size:this.layer.getImageSize(this.bounds),i=1;this.layer instanceof OpenLayers.Layer.Grid&&(i=this.layer.getServerResolution()/this.layer.map.getResolution()),e.left=this.position.x+"px",e.top=this.position.y+"px",e.width=Math.round(i*t.w)+"px",e.height=Math.round(i*t.h)+"px"},clear:function(){OpenLayers.Tile.prototype.clear.apply(this,arguments);var e=this.imgDiv;if(e){var t=this.getTile();t.parentNode===this.layer.div&&this.layer.div.removeChild(t),this.setImgSrc(),!0===this.layerAlphaHack&&(e.style.filter=""),OpenLayers.Element.removeClass(e,"olImageLoadError")}this.canvasContext=null},getImage:function(){if(!this.imgDiv){this.imgDiv=OpenLayers.Tile.Image.IMAGE.cloneNode(!1);var e=this.imgDiv.style;if(this.frame){var t=0,i=0;this.layer.gutter&&(t=this.layer.gutter/this.layer.tileSize.w*100,i=this.layer.gutter/this.layer.tileSize.h*100),e.left=-t+"%",e.top=-i+"%",e.width=2*t+100+"%",e.height=2*i+100+"%"}e.visibility="hidden",e.opacity=0,1>this.layer.opacity&&(e.filter="alpha(opacity="+100*this.layer.opacity+")"),e.position="absolute",this.layerAlphaHack&&(e.paddingTop=e.height,e.height="0",e.width="100%"),this.frame&&this.frame.appendChild(this.imgDiv)}return this.imgDiv},setImage:function(e){this.imgDiv=e},initImage:function(){if(this.url||this.imgDiv){this.events.triggerEvent("beforeload"),this.layer.div.appendChild(this.getTile()),this.events.triggerEvent(this._loadEvent);var e=this.getImage(),t=e.getAttribute("src")||"";this.url&&OpenLayers.Util.isEquivalentUrl(t,this.url)?this._loadTimeout=window.setTimeout(OpenLayers.Function.bind(this.onImageLoad,this),0):(this.stopLoading(),this.crossOriginKeyword&&e.removeAttribute("crossorigin"),OpenLayers.Event.observe(e,"load",OpenLayers.Function.bind(this.onImageLoad,this)),OpenLayers.Event.observe(e,"error",OpenLayers.Function.bind(this.onImageError,this)),this.imageReloadAttempts=0,this.setImgSrc(this.url))}else this.isLoading=!1},setImgSrc:function(e){var t=this.imgDiv;e?(t.style.visibility="hidden",t.style.opacity=0,this.crossOriginKeyword&&("data:"!==e.substr(0,5)?t.setAttribute("crossorigin",this.crossOriginKeyword):t.removeAttribute("crossorigin")),t.src=e):(this.stopLoading(),this.imgDiv=null,t.parentNode&&t.parentNode.removeChild(t))},getTile:function(){return this.frame?this.frame:this.getImage()},createBackBuffer:function(){if(this.imgDiv&&!this.isLoading){var e;return this.frame?(e=this.frame.cloneNode(!1),e.appendChild(this.imgDiv)):e=this.imgDiv,this.imgDiv=null,e}},onImageLoad:function(){var e=this.imgDiv;this.stopLoading(),e.style.visibility="inherit",e.style.opacity=this.layer.opacity,this.isLoading=!1,this.canvasContext=null,this.events.triggerEvent("loadend"),!0===this.layerAlphaHack&&(e.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+e.src+"', sizingMethod='scale')")},onImageError:function(){var e=this.imgDiv;null!=e.src&&(this.imageReloadAttempts++,this.imageReloadAttempts<=OpenLayers.IMAGE_RELOAD_ATTEMPTS?this.setImgSrc(this.layer.getURL(this.bounds)):(OpenLayers.Element.addClass(e,"olImageLoadError"),this.events.triggerEvent("loaderror"),this.onImageLoad()))},stopLoading:function(){OpenLayers.Event.stopObservingElement(this.imgDiv),window.clearTimeout(this._loadTimeout),delete this._loadTimeout},getCanvasContext:function(){if(OpenLayers.CANVAS_SUPPORTED&&this.imgDiv&&!this.isLoading){if(!this.canvasContext){var e=document.createElement("canvas");e.width=this.size.w,e.height=this.size.h,this.canvasContext=e.getContext("2d"),this.canvasContext.drawImage(this.imgDiv,0,0)}return this.canvasContext}},CLASS_NAME:"OpenLayers.Tile.Image"}),OpenLayers.Tile.Image.IMAGE=function(){var e=new Image;return e.className="olTileImage",e.galleryImg="no",e}(),OpenLayers.Layer.Grid=OpenLayers.Class(OpenLayers.Layer.HTTPRequest,{tileSize:null,tileOriginCorner:"bl",tileOrigin:null,tileOptions:null,tileClass:OpenLayers.Tile.Image,grid:null,singleTile:!1,ratio:1.5,buffer:0,transitionEffect:"resize",numLoadingTiles:0,serverResolutions:null,loading:!1,backBuffer:null,gridResolution:null,backBufferResolution:null,backBufferLonLat:null,backBufferTimerId:null,removeBackBufferDelay:null,className:null,gridLayout:null,rowSign:null,transitionendEvents:["transitionend","webkitTransitionEnd","otransitionend","oTransitionEnd"],initialize:function(e,t,i,n){OpenLayers.Layer.HTTPRequest.prototype.initialize.apply(this,arguments),this.grid=[],this._removeBackBuffer=OpenLayers.Function.bind(this.removeBackBuffer,this),this.initProperties(),this.rowSign="t"===this.tileOriginCorner.substr(0,1)?1:-1},initProperties:function(){void 0===this.options.removeBackBufferDelay&&(this.removeBackBufferDelay=this.singleTile?0:2500),void 0===this.options.className&&(this.className=this.singleTile?"olLayerGridSingleTile":"olLayerGrid")},setMap:function(e){OpenLayers.Layer.HTTPRequest.prototype.setMap.call(this,e),OpenLayers.Element.addClass(this.div,this.className)},removeMap:function(e){this.removeBackBuffer()},destroy:function(){this.removeBackBuffer(),this.clearGrid(),this.tileSize=this.grid=null,OpenLayers.Layer.HTTPRequest.prototype.destroy.apply(this,arguments)},clearGrid:function(){if(this.grid){for(var e=0,t=this.grid.length;e<t;e++)for(var i=this.grid[e],n=0,s=i.length;n<s;n++)this.destroyTile(i[n]);
this.grid=[],this.gridLayout=this.gridResolution=null}},addOptions:function(e,t){var i=void 0!==e.singleTile&&e.singleTile!==this.singleTile;OpenLayers.Layer.HTTPRequest.prototype.addOptions.apply(this,arguments),this.map&&i&&(this.initProperties(),this.clearGrid(),this.tileSize=this.options.tileSize,this.setTileSize(),this.visibility&&this.moveTo(null,!0))},clone:function(e){return null==e&&(e=new OpenLayers.Layer.Grid(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.HTTPRequest.prototype.clone.apply(this,[e]),null!=this.tileSize&&(e.tileSize=this.tileSize.clone()),e.grid=[],e.gridResolution=null,e.backBuffer=null,e.backBufferTimerId=null,e.loading=!1,e.numLoadingTiles=0,e},moveTo:function(e,t,i){if(OpenLayers.Layer.HTTPRequest.prototype.moveTo.apply(this,arguments),e=e||this.map.getExtent(),null!=e){var n=!this.grid.length||t,s=this.getTilesBounds(),r=this.map.getResolution();this.getServerResolution(r),this.singleTile?(n||!i&&!s.containsBounds(e))&&(t&&"resize"!==this.transitionEffect&&this.removeBackBuffer(),t&&"resize"!==this.transitionEffect||this.applyBackBuffer(r),this.initSingleTile(e)):(n=n||!s.intersectsBounds(e,{worldBounds:this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent()}))?(!t||"resize"!==this.transitionEffect&&this.gridResolution!==r||this.applyBackBuffer(r),this.initGriddedTiles(e)):this.moveGriddedTiles()}},getTileData:function(e){var t=null,i=e.lon,n=e.lat,s=this.grid.length;if(this.map&&s){var r=this.map.getResolution();e=this.tileSize.w;var a=this.tileSize.h,o=this.grid[0][0].bounds,l=o.left,o=o.top;if(i<l&&this.map.baseLayer.wrapDateLine)var h=this.map.getMaxExtent().getWidth(),i=i+h*Math.ceil((l-i)/h);i=(i-l)/(r*e),n=(o-n)/(r*a),r=Math.floor(i),l=Math.floor(n),0<=l&&l<s&&(s=this.grid[l][r])&&(t={tile:s,i:Math.floor((i-r)*e),j:Math.floor((n-l)*a)})}return t},destroyTile:function(e){this.removeTileMonitoringHooks(e),e.destroy()},getServerResolution:function(e){var t=Number.POSITIVE_INFINITY;if(e=e||this.map.getResolution(),this.serverResolutions&&-1===OpenLayers.Util.indexOf(this.serverResolutions,e)){var i,n,s,r;for(i=this.serverResolutions.length-1;0<=i&&(s=this.serverResolutions[i],n=Math.abs(s-e),!(n>t));i--)t=n,r=s;e=r}return e},getServerZoom:function(){var e=this.getServerResolution();return this.serverResolutions?OpenLayers.Util.indexOf(this.serverResolutions,e):this.map.getZoomForResolution(e)+(this.zoomOffset||0)},applyBackBuffer:function(e){null!==this.backBufferTimerId&&this.removeBackBuffer();var t=this.backBuffer;if(!t){if(t=this.createBackBuffer(),!t)return;e===this.gridResolution?this.div.insertBefore(t,this.div.firstChild):this.map.baseLayer.div.parentNode.insertBefore(t,this.map.baseLayer.div),this.backBuffer=t;var i=this.grid[0][0].bounds;this.backBufferLonLat={lon:i.left,lat:i.top},this.backBufferResolution=this.gridResolution}for(var n,i=this.backBufferResolution/e,s=t.childNodes,r=s.length-1;0<=r;--r)n=s[r],n.style.top=(i*n._i*t._th|0)+"px",n.style.left=(i*n._j*t._tw|0)+"px",n.style.width=Math.round(i*n._w)+"px",n.style.height=Math.round(i*n._h)+"px";e=this.getViewPortPxFromLonLat(this.backBufferLonLat,e),i=this.map.layerContainerOriginPx.y,t.style.left=Math.round(e.x-this.map.layerContainerOriginPx.x)+"px",t.style.top=Math.round(e.y-i)+"px"},createBackBuffer:function(){var e;if(0<this.grid.length){e=document.createElement("div"),e.id=this.div.id+"_bb",e.className="olBackBuffer",e.style.position="absolute";var t=this.map;e.style.zIndex="resize"===this.transitionEffect?this.getZIndex()-1:t.Z_INDEX_BASE.BaseLayer-(t.getNumLayers()-t.getLayerIndex(this));for(var t=0,i=this.grid.length;t<i;t++)for(var n=0,s=this.grid[t].length;n<s;n++){var r=this.grid[t][n],a=this.grid[t][n].createBackBuffer();a&&(a._i=t,a._j=n,a._w=this.singleTile?this.getImageSize(r.bounds).w:r.size.w,a._h=r.size.h,a.id=r.id+"_bb",e.appendChild(a))}e._tw=this.tileSize.w,e._th=this.tileSize.h}return e},removeBackBuffer:function(){if(this._transitionElement){for(var e=this.transitionendEvents.length-1;0<=e;--e)OpenLayers.Event.stopObserving(this._transitionElement,this.transitionendEvents[e],this._removeBackBuffer);delete this._transitionElement}this.backBuffer&&(this.backBuffer.parentNode&&this.backBuffer.parentNode.removeChild(this.backBuffer),this.backBufferResolution=this.backBuffer=null,null!==this.backBufferTimerId&&(window.clearTimeout(this.backBufferTimerId),this.backBufferTimerId=null))},moveByPx:function(e,t){this.singleTile||this.moveGriddedTiles()},setTileSize:function(e){this.singleTile&&(e=this.map.getSize(),e.h=parseInt(e.h*this.ratio,10),e.w=parseInt(e.w*this.ratio,10)),OpenLayers.Layer.HTTPRequest.prototype.setTileSize.apply(this,[e])},getTilesBounds:function(){var e=null,t=this.grid.length;if(t)var e=this.grid[t-1][0].bounds,t=this.grid[0].length*e.getWidth(),i=this.grid.length*e.getHeight(),e=new OpenLayers.Bounds(e.left,e.bottom,e.left+t,e.bottom+i);return e},initSingleTile:function(e){this.events.triggerEvent("retile");var t=e.getCenterLonLat(),i=e.getWidth()*this.ratio;e=e.getHeight()*this.ratio,t=new OpenLayers.Bounds(t.lon-i/2,t.lat-e/2,t.lon+i/2,t.lat+e/2),this.gridResolution=this.getServerResolution(),(i=this.maxExtent)&&(!this.displayOutsideMaxExtent||this.map.baseLayer.wrapDateLine&&this.maxExtent.equals(this.map.getMaxExtent()))&&(t.left=Math.max(t.left,i.left),t.right=Math.min(t.right,i.right)),i=this.map.getLayerPxFromLonLat({lon:t.left,lat:t.top}),this.grid.length||(this.grid[0]=[]),(e=this.grid[0][0])?e.moveTo(t,i):(e=this.addTile(t,i),this.addTileMonitoringHooks(e),e.draw(),this.grid[0][0]=e),this.removeExcessTiles(1,1)},calculateGridLayout:function(e,t,i){var n=i*this.tileSize.w;i*=this.tileSize.h;var s=Math.floor((e.left-t.lon)/n)-this.buffer,r=this.rowSign;return e=Math[~r?"floor":"ceil"](r*(t.lat-e.top+i)/i)-this.buffer*r,{tilelon:n,tilelat:i,startcol:s,startrow:e}},getImageSize:function(e){var t=OpenLayers.Layer.HTTPRequest.prototype.getImageSize.apply(this,arguments);return this.singleTile&&(t=new OpenLayers.Size(Math.round(e.getWidth()/this.gridResolution),t.h)),t},getTileOrigin:function(){var e=this.tileOrigin;if(!e)var e=this.getMaxExtent(),t={tl:["left","top"],tr:["right","top"],bl:["left","bottom"],br:["right","bottom"]}[this.tileOriginCorner],e=new OpenLayers.LonLat(e[t[0]],e[t[1]]);return e},getTileBoundsForGridIndex:function(e,t){var i=this.getTileOrigin(),n=this.gridLayout,s=n.tilelon,r=n.tilelat,a=n.startcol,n=n.startrow,o=this.rowSign;return new OpenLayers.Bounds(i.lon+(a+t)*s,i.lat-(n+e*o)*r*o,i.lon+(a+t+1)*s,i.lat-(n+(e-1)*o)*r*o)},initGriddedTiles:function(e){this.events.triggerEvent("retile");var t=this.map.getSize(),i=this.getTileOrigin(),n=this.map.getResolution(),s=this.getServerResolution(),r=n/s,n=this.tileSize.w/r,r=this.tileSize.h/r,a=Math.ceil(t.h/r)+2*this.buffer+1,t=Math.ceil(t.w/n)+2*this.buffer+1;this.gridLayout=s=this.calculateGridLayout(e,i,s);var i=s.tilelon,o=s.tilelat,s=this.map.layerContainerOriginPx.x,l=this.map.layerContainerOriginPx.y,h=this.getTileBoundsForGridIndex(0,0),u=this.map.getViewPortPxFromLonLat(new OpenLayers.LonLat(h.left,h.top));u.x=Math.round(u.x)-s,u.y=Math.round(u.y)-l;var s=[],l=this.map.getCenter(),p=0;do{var c=this.grid[p];c||(c=[],this.grid.push(c));var y=0;do{var h=this.getTileBoundsForGridIndex(p,y),d=u.clone();d.x+=y*Math.round(n),d.y+=p*Math.round(r);var m=c[y];m?m.moveTo(h,d,!1):(m=this.addTile(h,d),this.addTileMonitoringHooks(m),c.push(m)),d=h.getCenterLonLat(),s.push({tile:m,distance:Math.pow(d.lon-l.lon,2)+Math.pow(d.lat-l.lat,2)}),y+=1}while(h.right<=e.right+i*this.buffer||y<t);p+=1}while(h.bottom>=e.bottom-o*this.buffer||p<a);for(this.removeExcessTiles(p,y),this.gridResolution=n=this.getServerResolution(),s.sort(function(e,t){return e.distance-t.distance}),e=0,n=s.length;e<n;++e)s[e].tile.draw()},getMaxExtent:function(){return this.maxExtent},addTile:function(e,t){var i=new this.tileClass(this,t,e,null,this.tileSize,this.tileOptions);return this.events.triggerEvent("addtile",{tile:i}),i},addTileMonitoringHooks:function(e){e.onLoadStart=function(){!1===this.loading&&(this.loading=!0,this.events.triggerEvent("loadstart")),this.events.triggerEvent("tileloadstart",{tile:e}),this.numLoadingTiles++,!this.singleTile&&this.backBuffer&&this.gridResolution===this.backBufferResolution&&OpenLayers.Element.addClass(e.getTile(),"olTileReplacing")},e.onLoadEnd=function(t){if(this.numLoadingTiles--,t="unload"===t.type,this.events.triggerEvent("tileloaded",{tile:e,aborted:t}),!this.singleTile&&!t&&this.backBuffer&&this.gridResolution===this.backBufferResolution){var i=e.getTile();if("none"===OpenLayers.Element.getStyle(i,"display")){var n=document.getElementById(e.id+"_bb");n&&n.parentNode.removeChild(n)}OpenLayers.Element.removeClass(i,"olTileReplacing")}if(0===this.numLoadingTiles){if(this.backBuffer)if(0===this.backBuffer.childNodes.length)this.removeBackBuffer();else{for(this._transitionElement=t?this.div.lastChild:e.imgDiv,t=this.transitionendEvents,i=t.length-1;0<=i;--i)OpenLayers.Event.observe(this._transitionElement,t[i],this._removeBackBuffer);this.backBufferTimerId=window.setTimeout(this._removeBackBuffer,this.removeBackBufferDelay)}this.loading=!1,this.events.triggerEvent("loadend")}},e.onLoadError=function(){this.events.triggerEvent("tileerror",{tile:e})},e.events.on({loadstart:e.onLoadStart,loadend:e.onLoadEnd,unload:e.onLoadEnd,loaderror:e.onLoadError,scope:this})},removeTileMonitoringHooks:function(e){e.unload(),e.events.un({loadstart:e.onLoadStart,loadend:e.onLoadEnd,unload:e.onLoadEnd,loaderror:e.onLoadError,scope:this})},moveGriddedTiles:function(){for(var e=this.buffer+1;;){var t=this.grid[0][0],i=t.position.x+this.map.layerContainerOriginPx.x,t=t.position.y+this.map.layerContainerOriginPx.y,n=this.getServerResolution()/this.map.getResolution(),n={w:Math.round(this.tileSize.w*n),h:Math.round(this.tileSize.h*n)};if(i>-n.w*(e-1))this.shiftColumn(!0,n);else if(i<-n.w*e)this.shiftColumn(!1,n);else if(t>-n.h*(e-1))this.shiftRow(!0,n);else{if(!(t<-n.h*e))break;this.shiftRow(!1,n)}}},shiftRow:function(e,t){var i=this.grid,n=e?0:i.length-1,s=e?-1:1;this.gridLayout.startrow+=s*this.rowSign;for(var r=i[n],a=i[e?"pop":"shift"](),o=0,l=a.length;o<l;o++){var h=a[o],u=r[o].position.clone();u.y+=t.h*s,h.moveTo(this.getTileBoundsForGridIndex(n,o),u)}i[e?"unshift":"push"](a)},shiftColumn:function(e,t){var i=this.grid,n=e?0:i[0].length-1,s=e?-1:1;this.gridLayout.startcol+=s;for(var r=0,a=i.length;r<a;r++){var o=i[r],l=o[n].position.clone(),h=o[e?"pop":"shift"]();l.x+=t.w*s,h.moveTo(this.getTileBoundsForGridIndex(r,n),l),o[e?"unshift":"push"](h)}},removeExcessTiles:function(e,t){for(var i,n;this.grid.length>e;){var s=this.grid.pop();for(i=0,n=s.length;i<n;i++){var r=s[i];this.destroyTile(r)}}for(i=0,n=this.grid.length;i<n;i++)for(;this.grid[i].length>t;)s=this.grid[i],r=s.pop(),this.destroyTile(r)},onMapResize:function(){this.singleTile&&(this.clearGrid(),this.setTileSize())},getTileBounds:function(e){var t=this.maxExtent,i=this.getResolution(),n=i*this.tileSize.w,i=i*this.tileSize.h,s=this.getLonLatFromViewPortPx(e);return e=t.left+n*Math.floor((s.lon-t.left)/n),t=t.bottom+i*Math.floor((s.lat-t.bottom)/i),new OpenLayers.Bounds(e,t,e+n,t+i)},CLASS_NAME:"OpenLayers.Layer.Grid"}),OpenLayers.TileManager=OpenLayers.Class({cacheSize:256,tilesPerFrame:2,frameDelay:16,moveDelay:100,zoomDelay:200,maps:null,tileQueueId:null,tileQueue:null,tileCache:null,tileCacheIndex:null,initialize:function(e){OpenLayers.Util.extend(this,e),this.maps=[],this.tileQueueId={},this.tileQueue={},this.tileCache={},this.tileCacheIndex=[]},addMap:function(e){if(!this._destroyed&&OpenLayers.Layer.Grid){this.maps.push(e),this.tileQueue[e.id]=[];for(var t=0,i=e.layers.length;t<i;++t)this.addLayer({layer:e.layers[t]});e.events.on({move:this.move,zoomend:this.zoomEnd,changelayer:this.changeLayer,addlayer:this.addLayer,preremovelayer:this.removeLayer,scope:this})}},removeMap:function(e){if(!this._destroyed&&OpenLayers.Layer.Grid){if(window.clearTimeout(this.tileQueueId[e.id]),e.layers)for(var t=0,i=e.layers.length;t<i;++t)this.removeLayer({layer:e.layers[t]});e.events&&e.events.un({move:this.move,zoomend:this.zoomEnd,changelayer:this.changeLayer,addlayer:this.addLayer,preremovelayer:this.removeLayer,scope:this}),delete this.tileQueue[e.id],delete this.tileQueueId[e.id],OpenLayers.Util.removeItem(this.maps,e)}},move:function(e){this.updateTimeout(e.object,this.moveDelay,!0)},zoomEnd:function(e){this.updateTimeout(e.object,this.zoomDelay)},changeLayer:function(e){"visibility"!==e.property&&"params"!==e.property||this.updateTimeout(e.object,0)},addLayer:function(e){if(e=e.layer,e instanceof OpenLayers.Layer.Grid){e.events.on({addtile:this.addTile,refresh:this.handleLayerRefresh,retile:this.clearTileQueue,scope:this});var t,i,n;for(t=e.grid.length-1;0<=t;--t)for(i=e.grid[t].length-1;0<=i;--i)n=e.grid[t][i],this.addTile({tile:n}),n.url&&!n.imgDiv&&this.manageTileCache({object:n})}},removeLayer:function(e){if(e=e.layer,e instanceof OpenLayers.Layer.Grid&&(this.clearTileQueue({object:e}),e.events&&e.events.un({addtile:this.addTile,refresh:this.handleLayerRefresh,retile:this.clearTileQueue,scope:this}),e.grid)){var t,i,n;for(t=e.grid.length-1;0<=t;--t)for(i=e.grid[t].length-1;0<=i;--i)n=e.grid[t][i],this.unloadTile({object:n})}},handleLayerRefresh:function(e){if(e=e.object,e.grid){var t,i,n;for(t=e.grid.length-1;0<=t;--t)for(i=e.grid[t].length-1;0<=i;--i)n=e.grid[t][i],OpenLayers.Util.removeItem(this.tileCacheIndex,n.url),delete this.tileCache[n.url]}},updateTimeout:function(e,t,i){window.clearTimeout(this.tileQueueId[e.id]);var n=this.tileQueue[e.id];i&&!n.length||(this.tileQueueId[e.id]=window.setTimeout(OpenLayers.Function.bind(function(){this.drawTilesFromQueue(e),n.length&&this.updateTimeout(e,this.frameDelay)},this),t))},addTile:function(e){e.tile instanceof OpenLayers.Tile.Image?e.tile.layer.singleTile||e.tile.events.on({beforedraw:this.queueTileDraw,beforeload:this.manageTileCache,loadend:this.addToCache,unload:this.unloadTile,scope:this}):this.removeLayer({layer:e.tile.layer})},unloadTile:function(e){e=e.object,e.events.un({beforedraw:this.queueTileDraw,beforeload:this.manageTileCache,loadend:this.addToCache,unload:this.unloadTile,scope:this}),OpenLayers.Util.removeItem(this.tileQueue[e.layer.map.id],e)},queueTileDraw:function(e){e=e.object;var t=!1,i=e.layer,n=i.getURL(e.bounds),s=this.tileCache[n];return s&&"olTileImage"!==s.className&&(delete this.tileCache[n],OpenLayers.Util.removeItem(this.tileCacheIndex,n),s=null),!i.url||!i.async&&s||(t=this.tileQueue[i.map.id],~OpenLayers.Util.indexOf(t,e)||t.push(e),t=!0),!t},drawTilesFromQueue:function(e){var t=this.tileQueue[e.id],i=this.tilesPerFrame;for(e=e.zoomTween&&e.zoomTween.playing;!e&&t.length&&i;)t.shift().draw(!0),--i},manageTileCache:function(e){e=e.object;var t=this.tileCache[e.url];t&&(t.parentNode&&OpenLayers.Element.hasClass(t.parentNode,"olBackBuffer")&&(t.parentNode.removeChild(t),t.id=null),t.parentNode||(t.style.visibility="hidden",t.style.opacity=0,e.setImage(t),OpenLayers.Util.removeItem(this.tileCacheIndex,e.url),this.tileCacheIndex.push(e.url)))},addToCache:function(e){e=e.object,this.tileCache[e.url]||OpenLayers.Element.hasClass(e.imgDiv,"olImageLoadError")||(this.tileCacheIndex.length>=this.cacheSize&&(delete this.tileCache[this.tileCacheIndex[0]],this.tileCacheIndex.shift()),this.tileCache[e.url]=e.imgDiv,this.tileCacheIndex.push(e.url))},clearTileQueue:function(e){e=e.object;for(var t=this.tileQueue[e.map.id],i=t.length-1;0<=i;--i)t[i].layer===e&&t.splice(i,1)},destroy:function(){for(var e=this.maps.length-1;0<=e;--e)this.removeMap(this.maps[e]);this.tileCacheIndex=this.tileCache=this.tileQueueId=this.tileQueue=this.maps=null,this._destroyed=!0}}),OpenLayers.Renderer=OpenLayers.Class({container:null,root:null,extent:null,locked:!1,size:null,resolution:null,map:null,featureDx:0,initialize:function(e,t){this.container=OpenLayers.Util.getElement(e),OpenLayers.Util.extend(this,t)},destroy:function(){this.map=this.resolution=this.size=this.extent=this.container=null},supported:function(){return!1},setExtent:function(e,t){if(this.extent=e.clone(),this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var i=e.getWidth()/this.map.getExtent().getWidth();e=e.scale(1/i),this.extent=e.wrapDateLine(this.map.getMaxExtent()).scale(i)}return t&&(this.resolution=null),!0},setSize:function(e){this.size=e.clone(),this.resolution=null},getResolution:function(){return this.resolution=this.resolution||this.map.getResolution()},drawFeature:function(e,t){if(null==t&&(t=e.style),e.geometry){var i=e.geometry.getBounds();if(i){var n;if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(n=this.map.getMaxExtent()),i.intersectsBounds(this.extent,{worldBounds:n})?this.calculateFeatureDx(i,n):t={display:"none"},i=this.drawGeometry(e.geometry,t,e.id),"none"!=t.display&&t.label&&!1!==i){if(n=e.geometry.getCentroid(),t.labelXOffset||t.labelYOffset){var s=isNaN(t.labelXOffset)?0:t.labelXOffset,r=isNaN(t.labelYOffset)?0:t.labelYOffset,a=this.getResolution();n.move(s*a,r*a)}this.drawText(e.id,t,n)}else this.removeText(e.id);return i}}},calculateFeatureDx:function(e,t){if(this.featureDx=0,t){var i=t.getWidth();this.featureDx=Math.round(((e.left+e.right)/2-(this.extent.left+this.extent.right)/2)/i)*i}},drawGeometry:function(e,t,i){},drawText:function(e,t,i){},removeText:function(e){},clear:function(){},getFeatureIdFromEvent:function(e){},eraseFeatures:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=0,i=e.length;t<i;++t){var n=e[t];this.eraseGeometry(n.geometry,n.id),this.removeText(n.id)}},eraseGeometry:function(e,t){},moveRoot:function(e){},getRenderLayerId:function(){return this.container.id},applyDefaultSymbolizer:function(e){var t=OpenLayers.Util.extend({},OpenLayers.Renderer.defaultSymbolizer);return!1===e.stroke&&(delete t.strokeWidth,delete t.strokeColor),!1===e.fill&&delete t.fillColor,OpenLayers.Util.extend(t,e),t},CLASS_NAME:"OpenLayers.Renderer"}),OpenLayers.Renderer.defaultSymbolizer={fillColor:"#000000",strokeColor:"#000000",strokeWidth:2,fillOpacity:1,strokeOpacity:1,pointRadius:0,labelAlign:"cm"},OpenLayers.Renderer.symbol={star:[350,75,379,161,469,161,397,215,423,301,350,250,277,301,303,215,231,161,321,161,350,75],cross:[4,0,6,0,6,4,10,4,10,6,6,6,6,10,4,10,4,6,0,6,0,4,4,4,4,0],x:[0,0,25,0,50,35,75,0,100,0,65,50,100,100,75,100,50,65,25,100,0,100,35,50,0,0],square:[0,0,0,1,1,1,1,0,0,0],triangle:[0,10,10,10,5,0,0,10]},OpenLayers.Renderer.Canvas=OpenLayers.Class(OpenLayers.Renderer,{hitDetection:!0,hitOverflow:0,canvas:null,features:null,pendingRedraw:!1,cachedSymbolBounds:{},initialize:function(e,t){OpenLayers.Renderer.prototype.initialize.apply(this,arguments),this.root=document.createElement("canvas"),this.container.appendChild(this.root),this.canvas=this.root.getContext("2d"),this._clearRectId=OpenLayers.Util.createUniqueID(),this.features={},this.hitDetection&&(this.hitCanvas=document.createElement("canvas"),this.hitContext=this.hitCanvas.getContext("2d"))},setExtent:function(){return OpenLayers.Renderer.prototype.setExtent.apply(this,arguments),!1},eraseGeometry:function(e,t){this.eraseFeatures(this.features[t][0])},supported:function(){return OpenLayers.CANVAS_SUPPORTED},setSize:function(e){this.size=e.clone();var t=this.root;t.style.width=e.w+"px",t.style.height=e.h+"px",t.width=e.w,t.height=e.h,this.resolution=null,this.hitDetection&&(t=this.hitCanvas,t.style.width=e.w+"px",t.style.height=e.h+"px",t.width=e.w,t.height=e.h)},drawFeature:function(e,t){var i;if(e.geometry){t=this.applyDefaultSymbolizer(t||e.style),i=e.geometry.getBounds();var n;this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(n=this.map.getMaxExtent()),n=i&&i.intersectsBounds(this.extent,{worldBounds:n}),(i="none"!==t.display&&!!i&&n)?this.features[e.id]=[e,t]:delete this.features[e.id],this.pendingRedraw=!0}return this.pendingRedraw&&!this.locked&&(this.redraw(),this.pendingRedraw=!1),i},drawGeometry:function(e,t,i){var n=e.CLASS_NAME;if("OpenLayers.Geometry.Collection"==n||"OpenLayers.Geometry.MultiPoint"==n||"OpenLayers.Geometry.MultiLineString"==n||"OpenLayers.Geometry.MultiPolygon"==n)for(var n=this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent(),s=0;s<e.components.length;s++)this.calculateFeatureDx(e.components[s].getBounds(),n),this.drawGeometry(e.components[s],t,i);else switch(e.CLASS_NAME){case"OpenLayers.Geometry.Point":this.drawPoint(e,t,i);break;case"OpenLayers.Geometry.LineString":this.drawLineString(e,t,i);break;case"OpenLayers.Geometry.LinearRing":this.drawLinearRing(e,t,i);break;case"OpenLayers.Geometry.Polygon":this.drawPolygon(e,t,i)}},drawExternalGraphic:function(e,t,i){var n=new Image,s=t.title||t.graphicTitle;s&&(n.title=s);var r=t.graphicWidth||t.graphicHeight,a=t.graphicHeight||t.graphicWidth,r=r?r:2*t.pointRadius,a=a?a:2*t.pointRadius,o=void 0!=t.graphicXOffset?t.graphicXOffset:-(.5*r),l=void 0!=t.graphicYOffset?t.graphicYOffset:-(.5*a),h=this._clearRectId,u=t.graphicOpacity||t.fillOpacity;n.onload=OpenLayers.Function.bind(function(){if(this.features[i]&&h===this._clearRectId){var t=this.getLocalXY(e),s=t[0],t=t[1];if(!isNaN(s)&&!isNaN(t)){var s=s+o|0,t=t+l|0,p=this.canvas;p.globalAlpha=u;var c=OpenLayers.Renderer.Canvas.drawImageScaleFactor||(OpenLayers.Renderer.Canvas.drawImageScaleFactor=/android 2.1/.test(navigator.userAgent.toLowerCase())?320/window.screen.width:1);p.drawImage(n,s*c,t*c,r*c,a*c),this.hitDetection&&(this.setHitContextStyle("fill",i),this.hitContext.fillRect(s,t,r,a))}}},this),n.src=t.externalGraphic,n.complete&&(n.onload(),n.onload=null)},drawNamedSymbol:function(e,t,i){var n,s,r,a;r=Math.PI/180;var o=OpenLayers.Renderer.symbol[t.graphicName];if(!o)throw Error(t.graphicName+" is not a valid symbol name");if(!(!o.length||2>o.length||(e=this.getLocalXY(e),s=e[0],a=e[1],isNaN(s)||isNaN(a)))){if(this.canvas.lineCap="round",this.canvas.lineJoin="round",this.hitDetection&&(this.hitContext.lineCap="round",this.hitContext.lineJoin="round"),t.graphicName in this.cachedSymbolBounds)n=this.cachedSymbolBounds[t.graphicName];else{for(n=new OpenLayers.Bounds,e=0;e<o.length;e+=2)n.extend(new OpenLayers.LonLat(o[e],o[e+1]));this.cachedSymbolBounds[t.graphicName]=n}if(this.canvas.save(),this.hitDetection&&this.hitContext.save(),this.canvas.translate(s,a),this.hitDetection&&this.hitContext.translate(s,a),e=r*t.rotation,isNaN(e)||(this.canvas.rotate(e),this.hitDetection&&this.hitContext.rotate(e)),r=2*t.pointRadius/Math.max(n.getWidth(),n.getHeight()),this.canvas.scale(r,r),this.hitDetection&&this.hitContext.scale(r,r),e=n.getCenterLonLat().lon,n=n.getCenterLonLat().lat,this.canvas.translate(-e,-n),this.hitDetection&&this.hitContext.translate(-e,-n),a=t.strokeWidth,t.strokeWidth=a/r,!1!==t.fill){for(this.setCanvasStyle("fill",t),this.canvas.beginPath(),e=0;e<o.length;e+=2)n=o[e],s=o[e+1],0==e&&this.canvas.moveTo(n,s),this.canvas.lineTo(n,s);if(this.canvas.closePath(),this.canvas.fill(),this.hitDetection){for(this.setHitContextStyle("fill",i,t),this.hitContext.beginPath(),e=0;e<o.length;e+=2)n=o[e],s=o[e+1],0==e&&this.canvas.moveTo(n,s),this.hitContext.lineTo(n,s);this.hitContext.closePath(),this.hitContext.fill()}}if(!1!==t.stroke){for(this.setCanvasStyle("stroke",t),this.canvas.beginPath(),e=0;e<o.length;e+=2)n=o[e],s=o[e+1],0==e&&this.canvas.moveTo(n,s),this.canvas.lineTo(n,s);if(this.canvas.closePath(),this.canvas.stroke(),this.hitDetection){for(this.setHitContextStyle("stroke",i,t,r),this.hitContext.beginPath(),e=0;e<o.length;e+=2)n=o[e],s=o[e+1],0==e&&this.hitContext.moveTo(n,s),this.hitContext.lineTo(n,s);this.hitContext.closePath(),this.hitContext.stroke()}}t.strokeWidth=a,this.canvas.restore(),this.hitDetection&&this.hitContext.restore(),this.setCanvasStyle("reset")}},setCanvasStyle:function(e,t){"fill"===e?(this.canvas.globalAlpha=t.fillOpacity,this.canvas.fillStyle=t.fillColor):"stroke"===e?(this.canvas.globalAlpha=t.strokeOpacity,this.canvas.strokeStyle=t.strokeColor,this.canvas.lineWidth=t.strokeWidth):(this.canvas.globalAlpha=0,this.canvas.lineWidth=1)},featureIdToHex:function(e){e=Number(e.split("_").pop())+1,16777216<=e&&(this.hitOverflow=e-16777215,e=e%16777216+1),e="000000"+e.toString(16);var t=e.length;return e="#"+e.substring(t-6,t)},setHitContextStyle:function(e,t,i,n){t=this.featureIdToHex(t),"fill"==e?(this.hitContext.globalAlpha=1,this.hitContext.fillStyle=t):"stroke"==e?(this.hitContext.globalAlpha=1,this.hitContext.strokeStyle=t,"undefined"==typeof n?this.hitContext.lineWidth=i.strokeWidth+2:isNaN(n)||(this.hitContext.lineWidth=i.strokeWidth+2/n)):(this.hitContext.globalAlpha=0,this.hitContext.lineWidth=1)},drawPoint:function(e,t,i){if(!1!==t.graphic)if(t.externalGraphic)this.drawExternalGraphic(e,t,i);else if(t.graphicName&&"circle"!=t.graphicName)this.drawNamedSymbol(e,t,i);else{var n=this.getLocalXY(e);if(e=n[0],n=n[1],!isNaN(e)&&!isNaN(n)){var s=2*Math.PI,r=t.pointRadius;!1!==t.fill&&(this.setCanvasStyle("fill",t),this.canvas.beginPath(),this.canvas.arc(e,n,r,0,s,!0),this.canvas.fill(),this.hitDetection&&(this.setHitContextStyle("fill",i,t),this.hitContext.beginPath(),this.hitContext.arc(e,n,r,0,s,!0),this.hitContext.fill())),!1!==t.stroke&&(this.setCanvasStyle("stroke",t),this.canvas.beginPath(),this.canvas.arc(e,n,r,0,s,!0),this.canvas.stroke(),this.hitDetection&&(this.setHitContextStyle("stroke",i,t),this.hitContext.beginPath(),this.hitContext.arc(e,n,r,0,s,!0),this.hitContext.stroke()),this.setCanvasStyle("reset"))}}},drawLineString:function(e,t,i){t=OpenLayers.Util.applyDefaults({fill:!1},t),this.drawLinearRing(e,t,i)},drawLinearRing:function(e,t,i){!1!==t.fill&&(this.setCanvasStyle("fill",t),this.renderPath(this.canvas,e,t,i,"fill"),this.hitDetection&&(this.setHitContextStyle("fill",i,t),this.renderPath(this.hitContext,e,t,i,"fill"))),!1!==t.stroke&&(this.setCanvasStyle("stroke",t),this.renderPath(this.canvas,e,t,i,"stroke"),this.hitDetection&&(this.setHitContextStyle("stroke",i,t),this.renderPath(this.hitContext,e,t,i,"stroke"))),this.setCanvasStyle("reset")},renderPath:function(e,t,i,n,s){t=t.components,i=t.length,e.beginPath(),n=this.getLocalXY(t[0]);var r=n[1];if(!isNaN(n[0])&&!isNaN(r)){for(e.moveTo(n[0],n[1]),n=1;n<i;++n)r=this.getLocalXY(t[n]),e.lineTo(r[0],r[1]);"fill"===s?e.fill():e.stroke()}},drawPolygon:function(e,t,i){e=e.components;var n=e.length;this.drawLinearRing(e[0],t,i);for(var s=1;s<n;++s)this.canvas.globalCompositeOperation="destination-out",this.hitDetection&&(this.hitContext.globalCompositeOperation="destination-out"),this.drawLinearRing(e[s],OpenLayers.Util.applyDefaults({stroke:!1,fillOpacity:1},t),i),this.canvas.globalCompositeOperation="source-over",this.hitDetection&&(this.hitContext.globalCompositeOperation="source-over"),this.drawLinearRing(e[s],OpenLayers.Util.applyDefaults({fill:!1},t),i)},drawText:function(e,t){var i=this.getLocalXY(e);this.setCanvasStyle("reset"),this.canvas.fillStyle=t.fontColor,this.canvas.globalAlpha=t.fontOpacity||1;var n=[t.fontStyle?t.fontStyle:"normal","normal",t.fontWeight?t.fontWeight:"normal",t.fontSize?t.fontSize:"1em",t.fontFamily?t.fontFamily:"sans-serif"].join(" "),s=t.label.split("\n"),r=s.length;if(this.canvas.fillText){this.canvas.font=n,this.canvas.textAlign=OpenLayers.Renderer.Canvas.LABEL_ALIGN[t.labelAlign[0]]||"center",this.canvas.textBaseline=OpenLayers.Renderer.Canvas.LABEL_ALIGN[t.labelAlign[1]]||"middle";var a=OpenLayers.Renderer.Canvas.LABEL_FACTOR[t.labelAlign[1]];for(null==a&&(a=-.5),n=this.canvas.measureText("Mg").height||this.canvas.measureText("xx").width,i[1]+=n*a*(r-1),a=0;a<r;a++)t.labelOutlineWidth&&(this.canvas.save(),this.canvas.globalAlpha=t.labelOutlineOpacity||t.fontOpacity||1,this.canvas.strokeStyle=t.labelOutlineColor,this.canvas.lineWidth=t.labelOutlineWidth,this.canvas.strokeText(s[a],i[0],i[1]+n*a+1),this.canvas.restore()),this.canvas.fillText(s[a],i[0],i[1]+n*a)}else if(this.canvas.mozDrawText){this.canvas.mozTextStyle=n;var o=OpenLayers.Renderer.Canvas.LABEL_FACTOR[t.labelAlign[0]];for(null==o&&(o=-.5),a=OpenLayers.Renderer.Canvas.LABEL_FACTOR[t.labelAlign[1]],null==a&&(a=-.5),n=this.canvas.mozMeasureText("xx"),i[1]+=n*(1+a*r),a=0;a<r;a++){var l=i[0]+o*this.canvas.mozMeasureText(s[a]),h=i[1]+a*n;this.canvas.translate(l,h),this.canvas.mozDrawText(s[a]),this.canvas.translate(-l,-h)}}this.setCanvasStyle("reset")},getLocalXY:function(e){var t=this.getResolution(),i=this.extent;return[(e.x-this.featureDx)/t+-i.left/t,i.top/t-e.y/t]},clear:function(){this.clearCanvas(),this.features={}},clearCanvas:function(){var e=this.root.height,t=this.root.width;this.canvas.clearRect(0,0,t,e),this._clearRectId=OpenLayers.Util.createUniqueID(),this.hitDetection&&this.hitContext.clearRect(0,0,t,e)},getFeatureIdFromEvent:function(e){var t;if(this.hitDetection&&"none"!==this.root.style.display&&!this.map.dragging&&(e=e.xy,e=this.hitContext.getImageData(0|e.x,0|e.y,1,1).data,255===e[3]&&(e=e[2]+256*(e[1]+256*e[0])))){e="OpenLayers_Feature_Vector_"+(e-1+this.hitOverflow);try{t=this.features[e][0]}catch(e){}}return t},eraseFeatures:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=0;t<e.length;++t)delete this.features[e[t].id];this.redraw()},redraw:function(){if(!this.locked){this.clearCanvas();var e,t,i,n,s=[],r=this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent();for(n in this.features)this.features.hasOwnProperty(n)&&(e=this.features[n][0],t=e.geometry,this.calculateFeatureDx(t.getBounds(),r),i=this.features[n][1],this.drawGeometry(t,i,e.id),i.label&&s.push([e,i]));for(t=0,i=s.length;t<i;++t)e=s[t],this.drawText(e[0].geometry.getCentroid(),e[1])}},CLASS_NAME:"OpenLayers.Renderer.Canvas"}),OpenLayers.Renderer.Canvas.LABEL_ALIGN={l:"left",r:"right",t:"top",b:"bottom"},OpenLayers.Renderer.Canvas.LABEL_FACTOR={l:0,r:-1,t:0,b:-1},OpenLayers.Renderer.Canvas.drawImageScaleFactor=null,OpenLayers.ElementsIndexer=OpenLayers.Class({maxZIndex:null,order:null,indices:null,compare:null,initialize:function(e){this.compare=e?OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_Y_ORDER:OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_DRAWING_ORDER,this.clear()},insert:function(e){this.exists(e)&&this.remove(e);var t=e.id;this.determineZIndex(e);for(var i,n=-1,s=this.order.length;1<s-n;)i=parseInt((n+s)/2),0<this.compare(this,e,OpenLayers.Util.getElement(this.order[i]))?n=i:s=i;return this.order.splice(s,0,t),this.indices[t]=this.getZIndex(e),this.getNextElement(s)},remove:function(e){e=e.id;var t=OpenLayers.Util.indexOf(this.order,e);0<=t&&(this.order.splice(t,1),delete this.indices[e],this.maxZIndex=0<this.order.length?this.indices[this.order[this.order.length-1]]:0)},clear:function(){this.order=[],this.indices={},this.maxZIndex=0},exists:function(e){return null!=this.indices[e.id]},getZIndex:function(e){return e._style.graphicZIndex},determineZIndex:function(e){var t=e._style.graphicZIndex;null==t?(t=this.maxZIndex,e._style.graphicZIndex=t):t>this.maxZIndex&&(this.maxZIndex=t)},getNextElement:function(e){e+=1;for(var t=void 0;e<this.order.length&&void 0==t;e++)t=OpenLayers.Util.getElement(this.order[e]);return t||null},CLASS_NAME:"OpenLayers.ElementsIndexer"}),OpenLayers.ElementsIndexer.IndexingMethods={Z_ORDER:function(e,t,i){t=e.getZIndex(t);var n=0;return i&&(e=e.getZIndex(i),n=t-e),n},Z_ORDER_DRAWING_ORDER:function(e,t,i){return e=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(e,t,i),i&&0==e&&(e=1),e},Z_ORDER_Y_ORDER:function(e,t,i){return e=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(e,t,i),i&&0===e&&(t=i._boundsBottom-t._boundsBottom,e=0===t?1:t),e}},OpenLayers.Renderer.Elements=OpenLayers.Class(OpenLayers.Renderer,{rendererRoot:null,root:null,vectorRoot:null,textRoot:null,xmlns:null,xOffset:0,indexer:null,BACKGROUND_ID_SUFFIX:"_background",LABEL_ID_SUFFIX:"_label",LABEL_OUTLINE_SUFFIX:"_outline",initialize:function(e,t){OpenLayers.Renderer.prototype.initialize.apply(this,arguments),this.rendererRoot=this.createRenderRoot(),this.root=this.createRoot("_root"),this.vectorRoot=this.createRoot("_vroot"),this.textRoot=this.createRoot("_troot"),this.root.appendChild(this.vectorRoot),
this.root.appendChild(this.textRoot),this.rendererRoot.appendChild(this.root),this.container.appendChild(this.rendererRoot),t&&(t.zIndexing||t.yOrdering)&&(this.indexer=new OpenLayers.ElementsIndexer(t.yOrdering))},destroy:function(){this.clear(),this.xmlns=this.root=this.rendererRoot=null,OpenLayers.Renderer.prototype.destroy.apply(this,arguments)},clear:function(){var e,t=this.vectorRoot;if(t)for(;e=t.firstChild;)t.removeChild(e);if(t=this.textRoot)for(;e=t.firstChild;)t.removeChild(e);this.indexer&&this.indexer.clear()},setExtent:function(e,t){var i=OpenLayers.Renderer.prototype.setExtent.apply(this,arguments),n=this.getResolution();if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var s,r=e.getWidth()/this.map.getExtent().getWidth();e=e.scale(1/r),r=this.map.getMaxExtent(),r.right>e.left&&r.right<e.right?s=!0:r.left>e.left&&r.left<e.right&&(s=!1),(s!==this.rightOfDateLine||t)&&(i=!1,this.xOffset=!0===s?r.getWidth()/n:0),this.rightOfDateLine=s}return i},getNodeType:function(e,t){},drawGeometry:function(e,t,i){var n=e.CLASS_NAME,s=!0;if("OpenLayers.Geometry.Collection"==n||"OpenLayers.Geometry.MultiPoint"==n||"OpenLayers.Geometry.MultiLineString"==n||"OpenLayers.Geometry.MultiPolygon"==n){for(var n=0,r=e.components.length;n<r;n++)s=this.drawGeometry(e.components[n],t,i)&&s;return s}return n=s=!1,"none"!=t.display&&(t.backgroundGraphic?this.redrawBackgroundNode(e.id,e,t,i):n=!0,s=this.redrawNode(e.id,e,t,i)),0==s&&(t=document.getElementById(e.id))&&(t._style.backgroundGraphic&&(n=!0),t.parentNode.removeChild(t)),n&&(t=document.getElementById(e.id+this.BACKGROUND_ID_SUFFIX))&&t.parentNode.removeChild(t),s},redrawNode:function(e,t,i,n){return i=this.applyDefaultSymbolizer(i),e=this.nodeFactory(e,this.getNodeType(t,i)),e._featureId=n,e._boundsBottom=t.getBounds().bottom,e._geometryClass=t.CLASS_NAME,e._style=i,t=this.drawGeometryNode(e,t,i),!1!==t&&(e=t.node,this.indexer?(i=this.indexer.insert(e))?this.vectorRoot.insertBefore(e,i):this.vectorRoot.appendChild(e):e.parentNode!==this.vectorRoot&&this.vectorRoot.appendChild(e),this.postDraw(e),t.complete)},redrawBackgroundNode:function(e,t,i,n){return i=OpenLayers.Util.extend({},i),i.externalGraphic=i.backgroundGraphic,i.graphicXOffset=i.backgroundXOffset,i.graphicYOffset=i.backgroundYOffset,i.graphicZIndex=i.backgroundGraphicZIndex,i.graphicWidth=i.backgroundWidth||i.graphicWidth,i.graphicHeight=i.backgroundHeight||i.graphicHeight,i.backgroundGraphic=null,i.backgroundXOffset=null,i.backgroundYOffset=null,i.backgroundGraphicZIndex=null,this.redrawNode(e+this.BACKGROUND_ID_SUFFIX,t,i,null)},drawGeometryNode:function(e,t,i){i=i||e._style;var n,s={isFilled:void 0===i.fill||i.fill,isStroked:void 0===i.stroke?!!i.strokeWidth:i.stroke};switch(t.CLASS_NAME){case"OpenLayers.Geometry.Point":!1===i.graphic&&(s.isFilled=!1,s.isStroked=!1),n=this.drawPoint(e,t);break;case"OpenLayers.Geometry.LineString":s.isFilled=!1,n=this.drawLineString(e,t);break;case"OpenLayers.Geometry.LinearRing":n=this.drawLinearRing(e,t);break;case"OpenLayers.Geometry.Polygon":n=this.drawPolygon(e,t);break;case"OpenLayers.Geometry.Rectangle":n=this.drawRectangle(e,t)}return e._options=s,0!=n&&{node:this.setStyle(e,i,s,t),complete:n}},postDraw:function(e){},drawPoint:function(e,t){},drawLineString:function(e,t){},drawLinearRing:function(e,t){},drawPolygon:function(e,t){},drawRectangle:function(e,t){},drawCircle:function(e,t){},removeText:function(e){var t=document.getElementById(e+this.LABEL_ID_SUFFIX);t&&this.textRoot.removeChild(t),(e=document.getElementById(e+this.LABEL_OUTLINE_SUFFIX))&&this.textRoot.removeChild(e)},getFeatureIdFromEvent:function(e){var t=e.target,i=t&&t.correspondingUseElement;return(i?i:t||e.srcElement)._featureId},eraseGeometry:function(e,t){if("OpenLayers.Geometry.MultiPoint"==e.CLASS_NAME||"OpenLayers.Geometry.MultiLineString"==e.CLASS_NAME||"OpenLayers.Geometry.MultiPolygon"==e.CLASS_NAME||"OpenLayers.Geometry.Collection"==e.CLASS_NAME)for(var i=0,n=e.components.length;i<n;i++)this.eraseGeometry(e.components[i],t);else(i=OpenLayers.Util.getElement(e.id))&&i.parentNode&&(i.geometry&&(i.geometry.destroy(),i.geometry=null),i.parentNode.removeChild(i),this.indexer&&this.indexer.remove(i),i._style.backgroundGraphic&&(i=OpenLayers.Util.getElement(e.id+this.BACKGROUND_ID_SUFFIX))&&i.parentNode&&i.parentNode.removeChild(i))},nodeFactory:function(e,t){var i=OpenLayers.Util.getElement(e);return i?this.nodeTypeCompare(i,t)||(i.parentNode.removeChild(i),i=this.nodeFactory(e,t)):i=this.createNode(t,e),i},nodeTypeCompare:function(e,t){},createNode:function(e,t){},moveRoot:function(e){var t=this.root;e.root.parentNode==this.rendererRoot&&(t=e.root),t.parentNode.removeChild(t),e.rendererRoot.appendChild(t)},getRenderLayerId:function(){return this.root.parentNode.parentNode.id},isComplexSymbol:function(e){return"circle"!=e&&!!e},CLASS_NAME:"OpenLayers.Renderer.Elements"}),OpenLayers.Renderer.SVG=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",MAX_PIXEL:15e3,translationParameters:null,symbolMetrics:null,initialize:function(e){this.supported()&&(OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments),this.translationParameters={x:0,y:0},this.symbolMetrics={})},supported:function(){return document.implementation&&(document.implementation.hasFeature("org.w3c.svg","1.0")||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#SVG","1.1")||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"))},inValidRange:function(e,t,i){return e+=i?0:this.translationParameters.x,t+=i?0:this.translationParameters.y,e>=-this.MAX_PIXEL&&e<=this.MAX_PIXEL&&t>=-this.MAX_PIXEL&&t<=this.MAX_PIXEL},setExtent:function(e,t){var i=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments),n=this.getResolution(),s=-e.left/n,n=e.top/n;return t?(this.left=s,this.top=n,this.rendererRoot.setAttributeNS(null,"viewBox","0 0 "+this.size.w+" "+this.size.h),this.translate(this.xOffset,0),!0):((s=this.translate(s-this.left+this.xOffset,n-this.top))||this.setExtent(e,!0),i&&s)},translate:function(e,t){if(this.inValidRange(e,t,!0)){var i="";return(e||t)&&(i="translate("+e+","+t+")"),this.root.setAttributeNS(null,"transform",i),this.translationParameters={x:e,y:t},!0}return!1},setSize:function(e){OpenLayers.Renderer.prototype.setSize.apply(this,arguments),this.rendererRoot.setAttributeNS(null,"width",this.size.w),this.rendererRoot.setAttributeNS(null,"height",this.size.h)},getNodeType:function(e,t){var i=null;switch(e.CLASS_NAME){case"OpenLayers.Geometry.Point":i=t.externalGraphic?"image":this.isComplexSymbol(t.graphicName)?"svg":"circle";break;case"OpenLayers.Geometry.Rectangle":i="rect";break;case"OpenLayers.Geometry.LineString":i="polyline";break;case"OpenLayers.Geometry.LinearRing":i="polygon";break;case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":i="path"}return i},setStyle:function(e,t,i){t=t||e._style,i=i||e._options;var n=t.title||t.graphicTitle;if(n){e.setAttributeNS(null,"title",n);var s=e.getElementsByTagName("title");0<s.length?s[0].firstChild.textContent=n:(s=this.nodeFactory(null,"title"),s.textContent=n,e.appendChild(s))}var r,s=parseFloat(e.getAttributeNS(null,"r")),n=1;if("OpenLayers.Geometry.Point"==e._geometryClass&&s){if(e.style.visibility="",!1===t.graphic)e.style.visibility="hidden";else if(t.externalGraphic){r=this.getPosition(e),t.graphicWidth&&t.graphicHeight&&e.setAttributeNS(null,"preserveAspectRatio","none");var s=t.graphicWidth||t.graphicHeight,a=t.graphicHeight||t.graphicWidth,s=s?s:2*t.pointRadius,a=a?a:2*t.pointRadius,o=void 0!=t.graphicYOffset?t.graphicYOffset:-(.5*a),l=t.graphicOpacity||t.fillOpacity;e.setAttributeNS(null,"x",(r.x+(void 0!=t.graphicXOffset?t.graphicXOffset:-(.5*s))).toFixed()),e.setAttributeNS(null,"y",(r.y+o).toFixed()),e.setAttributeNS(null,"width",s),e.setAttributeNS(null,"height",a),e.setAttributeNS(this.xlinkns,"xlink:href",t.externalGraphic),e.setAttributeNS(null,"style","opacity: "+l),e.onclick=OpenLayers.Event.preventDefault}else if(this.isComplexSymbol(t.graphicName)){var s=3*t.pointRadius,a=2*s,h=this.importSymbol(t.graphicName);r=this.getPosition(e),n=3*this.symbolMetrics[h.id][0]/a,o=e.parentNode,l=e.nextSibling,o&&o.removeChild(e),e.firstChild&&e.removeChild(e.firstChild),e.appendChild(h.firstChild.cloneNode(!0)),e.setAttributeNS(null,"viewBox",h.getAttributeNS(null,"viewBox")),e.setAttributeNS(null,"width",a),e.setAttributeNS(null,"height",a),e.setAttributeNS(null,"x",r.x-s),e.setAttributeNS(null,"y",r.y-s),l?o.insertBefore(e,l):o&&o.appendChild(e)}else e.setAttributeNS(null,"r",t.pointRadius);s=t.rotation,void 0===s&&void 0===e._rotation||!r||(e._rotation=s,s|=0,"svg"!==e.nodeName?e.setAttributeNS(null,"transform","rotate("+s+" "+r.x+" "+r.y+")"):(r=this.symbolMetrics[h.id],e.firstChild.setAttributeNS(null,"transform","rotate("+s+" "+r[1]+" "+r[2]+")")))}return i.isFilled?(e.setAttributeNS(null,"fill",t.fillColor),e.setAttributeNS(null,"fill-opacity",t.fillOpacity)):e.setAttributeNS(null,"fill","none"),i.isStroked?(e.setAttributeNS(null,"stroke",t.strokeColor),e.setAttributeNS(null,"stroke-opacity",t.strokeOpacity),e.setAttributeNS(null,"stroke-width",t.strokeWidth*n),e.setAttributeNS(null,"stroke-linecap",t.strokeLinecap||"round"),e.setAttributeNS(null,"stroke-linejoin","round"),t.strokeDashstyle&&e.setAttributeNS(null,"stroke-dasharray",this.dashStyle(t,n))):e.setAttributeNS(null,"stroke","none"),t.pointerEvents&&e.setAttributeNS(null,"pointer-events",t.pointerEvents),null!=t.cursor&&e.setAttributeNS(null,"cursor",t.cursor),e},dashStyle:function(e,t){var i=e.strokeWidth*t,n=e.strokeDashstyle;switch(n){case"solid":return"none";case"dot":return[1,4*i].join();case"dash":return[4*i,4*i].join();case"dashdot":return[4*i,4*i,1,4*i].join();case"longdash":return[8*i,4*i].join();case"longdashdot":return[8*i,4*i,1,4*i].join();default:return OpenLayers.String.trim(n).replace(/\s+/g,",")}},createNode:function(e,t){var i=document.createElementNS(this.xmlns,e);return t&&i.setAttributeNS(null,"id",t),i},nodeTypeCompare:function(e,t){return t==e.nodeName},createRenderRoot:function(){var e=this.nodeFactory(this.container.id+"_svgRoot","svg");return e.style.display="block",e},createRoot:function(e){return this.nodeFactory(this.container.id+e,"g")},createDefs:function(){var e=this.nodeFactory(this.container.id+"_defs","defs");return this.rendererRoot.appendChild(e),e},drawPoint:function(e,t){return this.drawCircle(e,t,1)},drawCircle:function(e,t,i){var n=this.getResolution(),s=(t.x-this.featureDx)/n+this.left;return t=this.top-t.y/n,!!this.inValidRange(s,t)&&(e.setAttributeNS(null,"cx",s),e.setAttributeNS(null,"cy",t),e.setAttributeNS(null,"r",i),e)},drawLineString:function(e,t){var i=this.getComponentsString(t.components);return!!i.path&&(e.setAttributeNS(null,"points",i.path),i.complete?e:null)},drawLinearRing:function(e,t){var i=this.getComponentsString(t.components);return!!i.path&&(e.setAttributeNS(null,"points",i.path),i.complete?e:null)},drawPolygon:function(e,t){for(var i,n,s="",r=!0,a=!0,o=0,l=t.components.length;o<l;o++)s+=" M",i=this.getComponentsString(t.components[o].components," "),(n=i.path)?(s+=" "+n,a=i.complete&&a):r=!1;return!!r&&(e.setAttributeNS(null,"d",s+" z"),e.setAttributeNS(null,"fill-rule","evenodd"),a?e:null)},drawRectangle:function(e,t){var i=this.getResolution(),n=(t.x-this.featureDx)/i+this.left,s=this.top-t.y/i;return!!this.inValidRange(n,s)&&(e.setAttributeNS(null,"x",n),e.setAttributeNS(null,"y",s),e.setAttributeNS(null,"width",t.width/i),e.setAttributeNS(null,"height",t.height/i),e)},drawText:function(e,t,i){var n=!!t.labelOutlineWidth;if(n){var s=OpenLayers.Util.extend({},t);s.fontColor=s.labelOutlineColor,s.fontStrokeColor=s.labelOutlineColor,s.fontStrokeWidth=t.labelOutlineWidth,t.labelOutlineOpacity&&(s.fontOpacity=t.labelOutlineOpacity),delete s.labelOutlineWidth,this.drawText(e,s,i)}var r=this.getResolution(),s=(i.x-this.featureDx)/r+this.left,a=i.y/r-this.top,n=n?this.LABEL_OUTLINE_SUFFIX:this.LABEL_ID_SUFFIX,r=this.nodeFactory(e+n,"text");r.setAttributeNS(null,"x",s),r.setAttributeNS(null,"y",-a),t.fontColor&&r.setAttributeNS(null,"fill",t.fontColor),t.fontStrokeColor&&r.setAttributeNS(null,"stroke",t.fontStrokeColor),t.fontStrokeWidth&&r.setAttributeNS(null,"stroke-width",t.fontStrokeWidth),t.fontOpacity&&r.setAttributeNS(null,"opacity",t.fontOpacity),t.fontFamily&&r.setAttributeNS(null,"font-family",t.fontFamily),t.fontSize&&r.setAttributeNS(null,"font-size",t.fontSize),t.fontWeight&&r.setAttributeNS(null,"font-weight",t.fontWeight),t.fontStyle&&r.setAttributeNS(null,"font-style",t.fontStyle),!0===t.labelSelect?(r.setAttributeNS(null,"pointer-events","visible"),r._featureId=e):r.setAttributeNS(null,"pointer-events","none"),a=t.labelAlign||OpenLayers.Renderer.defaultSymbolizer.labelAlign,r.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG.LABEL_ALIGN[a[0]]||"middle"),!0===OpenLayers.IS_GECKO&&r.setAttributeNS(null,"dominant-baseline",OpenLayers.Renderer.SVG.LABEL_ALIGN[a[1]]||"central");for(var o=t.label.split("\n"),l=o.length;r.childNodes.length>l;)r.removeChild(r.lastChild);for(var h=0;h<l;h++){var u=this.nodeFactory(e+n+"_tspan_"+h,"tspan");if(!0===t.labelSelect&&(u._featureId=e,u._geometry=i,u._geometryClass=i.CLASS_NAME),!1===OpenLayers.IS_GECKO&&u.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG.LABEL_VSHIFT[a[1]]||"-35%"),u.setAttribute("x",s),0==h){var p=OpenLayers.Renderer.SVG.LABEL_VFACTOR[a[1]];null==p&&(p=-.5),u.setAttribute("dy",p*(l-1)+"em")}else u.setAttribute("dy","1em");u.textContent=""===o[h]?" ":o[h],u.parentNode||r.appendChild(u)}r.parentNode||this.textRoot.appendChild(r)},getComponentsString:function(e,t){for(var i,n=[],s=!0,r=e.length,a=[],o=0;o<r;o++)i=e[o],n.push(i),(i=this.getShortString(i))?a.push(i):(0<o&&this.getShortString(e[o-1])&&a.push(this.clipLine(e[o],e[o-1])),o<r-1&&this.getShortString(e[o+1])&&a.push(this.clipLine(e[o],e[o+1])),s=!1);return{path:a.join(t||","),complete:s}},clipLine:function(e,t){if(t.equals(e))return"";var i,n=this.getResolution(),s=this.MAX_PIXEL-this.translationParameters.x,r=this.MAX_PIXEL-this.translationParameters.y,a=(t.x-this.featureDx)/n+this.left,o=this.top-t.y/n,l=(e.x-this.featureDx)/n+this.left,n=this.top-e.y/n;return(l<-s||l>s)&&(i=(n-o)/(l-a),l=0>l?-s:s,n=o+(l-a)*i),(n<-r||n>r)&&(i=(l-a)/(n-o),n=0>n?-r:r,l=a+(n-o)*i),l+","+n},getShortString:function(e){var t=this.getResolution(),i=(e.x-this.featureDx)/t+this.left;return e=this.top-e.y/t,!!this.inValidRange(i,e)&&i+","+e},getPosition:function(e){return{x:parseFloat(e.getAttributeNS(null,"cx")),y:parseFloat(e.getAttributeNS(null,"cy"))}},importSymbol:function(e){this.defs||(this.defs=this.createDefs());var t=this.container.id+"-"+e,i=document.getElementById(t);if(null!=i)return i;var n=OpenLayers.Renderer.symbol[e];if(!n)throw Error(e+" is not a valid symbol name");e=this.nodeFactory(t,"symbol");var s=this.nodeFactory(null,"polygon");e.appendChild(s);for(var r,a,i=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),o=[],l=0;l<n.length;l+=2)r=n[l],a=n[l+1],i.left=Math.min(i.left,r),i.bottom=Math.min(i.bottom,a),i.right=Math.max(i.right,r),i.top=Math.max(i.top,a),o.push(r,",",a);return s.setAttributeNS(null,"points",o.join(" ")),n=i.getWidth(),s=i.getHeight(),e.setAttributeNS(null,"viewBox",[i.left-n,i.bottom-s,3*n,3*s].join(" ")),this.symbolMetrics[t]=[Math.max(n,s),i.getCenterLonLat().lon,i.getCenterLonLat().lat],this.defs.appendChild(e),e},getFeatureIdFromEvent:function(e){var t=OpenLayers.Renderer.Elements.prototype.getFeatureIdFromEvent.apply(this,arguments);return t||(t=e.target,t=t.parentNode&&t!=this.rendererRoot?t.parentNode._featureId:void 0),t},CLASS_NAME:"OpenLayers.Renderer.SVG"}),OpenLayers.Renderer.SVG.LABEL_ALIGN={l:"start",r:"end",b:"bottom",t:"hanging"},OpenLayers.Renderer.SVG.LABEL_VSHIFT={t:"-70%",b:"0"},OpenLayers.Renderer.SVG.LABEL_VFACTOR={t:0,b:-1},OpenLayers.Renderer.SVG.preventDefault=function(e){OpenLayers.Event.preventDefault(e)},OpenLayers.Popup=OpenLayers.Class({events:null,id:"",lonlat:null,div:null,contentSize:null,size:null,contentHTML:null,backgroundColor:"",opacity:"",border:"",contentDiv:null,groupDiv:null,closeDiv:null,autoSize:!1,minSize:null,maxSize:null,displayClass:"olPopup",contentDisplayClass:"olPopupContent",padding:0,disableFirefoxOverflowHack:!1,fixPadding:function(){"number"==typeof this.padding&&(this.padding=new OpenLayers.Bounds(this.padding,this.padding,this.padding,this.padding))},panMapIfOutOfView:!1,keepInMap:!1,closeOnMove:!1,map:null,initialize:function(e,t,i,n,s,r){null==e&&(e=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")),this.id=e,this.lonlat=t,this.contentSize=null!=i?i:new OpenLayers.Size(OpenLayers.Popup.WIDTH,OpenLayers.Popup.HEIGHT),null!=n&&(this.contentHTML=n),this.backgroundColor=OpenLayers.Popup.COLOR,this.opacity=OpenLayers.Popup.OPACITY,this.border=OpenLayers.Popup.BORDER,this.div=OpenLayers.Util.createDiv(this.id,null,null,null,null,null,"hidden"),this.div.className=this.displayClass,this.groupDiv=OpenLayers.Util.createDiv(this.id+"_GroupDiv",null,null,null,"relative",null,"hidden"),e=this.div.id+"_contentDiv",this.contentDiv=OpenLayers.Util.createDiv(e,null,this.contentSize.clone(),null,"relative"),this.contentDiv.className=this.contentDisplayClass,this.groupDiv.appendChild(this.contentDiv),this.div.appendChild(this.groupDiv),s&&this.addCloseBox(r),this.registerEvents()},destroy:function(){this.border=this.opacity=this.backgroundColor=this.contentHTML=this.size=this.lonlat=this.id=null,this.closeOnMove&&this.map&&this.map.events.unregister("movestart",this,this.hide),this.events.destroy(),this.events=null,this.closeDiv&&(OpenLayers.Event.stopObservingElement(this.closeDiv),this.groupDiv.removeChild(this.closeDiv)),this.closeDiv=null,this.div.removeChild(this.groupDiv),this.groupDiv=null,null!=this.map&&this.map.removePopup(this),this.panMapIfOutOfView=this.padding=this.maxSize=this.minSize=this.autoSize=this.div=this.map=null},draw:function(e){return null==e&&null!=this.lonlat&&null!=this.map&&(e=this.map.getLayerPxFromLonLat(this.lonlat)),this.closeOnMove&&this.map.events.register("movestart",this,this.hide),this.disableFirefoxOverflowHack||"firefox"!=OpenLayers.BROWSER_NAME||(this.map.events.register("movestart",this,function(){var e=document.defaultView.getComputedStyle(this.contentDiv,null).getPropertyValue("overflow");"hidden"!=e&&(this.contentDiv._oldOverflow=e,this.contentDiv.style.overflow="hidden")}),this.map.events.register("moveend",this,function(){var e=this.contentDiv._oldOverflow;e&&(this.contentDiv.style.overflow=e,this.contentDiv._oldOverflow=null)})),this.moveTo(e),this.autoSize||this.size||this.setSize(this.contentSize),this.setBackgroundColor(),this.setOpacity(),this.setBorder(),this.setContentHTML(),this.panMapIfOutOfView&&this.panIntoView(),this.div},updatePosition:function(){if(this.lonlat&&this.map){var e=this.map.getLayerPxFromLonLat(this.lonlat);e&&this.moveTo(e)}},moveTo:function(e){null!=e&&null!=this.div&&(this.div.style.left=e.x+"px",this.div.style.top=e.y+"px")},visible:function(){return OpenLayers.Element.visible(this.div)},toggle:function(){this.visible()?this.hide():this.show()},show:function(){this.div.style.display="",this.panMapIfOutOfView&&this.panIntoView()},hide:function(){this.div.style.display="none"},setSize:function(e){this.size=e.clone();var t=this.getContentDivPadding(),i=t.left+t.right,n=t.top+t.bottom;if(this.fixPadding(),i+=this.padding.left+this.padding.right,n+=this.padding.top+this.padding.bottom,this.closeDiv)var s=parseInt(this.closeDiv.style.width),i=i+(s+t.right);this.size.w+=i,this.size.h+=n,"msie"==OpenLayers.BROWSER_NAME&&(this.contentSize.w+=t.left+t.right,this.contentSize.h+=t.bottom+t.top),null!=this.div&&(this.div.style.width=this.size.w+"px",this.div.style.height=this.size.h+"px"),null!=this.contentDiv&&(this.contentDiv.style.width=e.w+"px",this.contentDiv.style.height=e.h+"px")},updateSize:function(){var e="<div class='"+this.contentDisplayClass+"'>"+this.contentDiv.innerHTML+"</div>",t=this.map?this.map.div:document.body,i=OpenLayers.Util.getRenderedDimensions(e,null,{displayClass:this.displayClass,containerElement:t}),n=this.getSafeContentSize(i);n.equals(i)?n=i:(i={w:n.w<i.w?n.w:null,h:n.h<i.h?n.h:null},i.w&&i.h||(e=OpenLayers.Util.getRenderedDimensions(e,i,{displayClass:this.contentDisplayClass,containerElement:t}),"hidden"!=OpenLayers.Element.getStyle(this.contentDiv,"overflow")&&e.equals(n)&&(n=OpenLayers.Util.getScrollbarWidth(),i.w?e.h+=n:e.w+=n),n=this.getSafeContentSize(e))),this.setSize(n)},setBackgroundColor:function(e){void 0!=e&&(this.backgroundColor=e),null!=this.div&&(this.div.style.backgroundColor=this.backgroundColor)},setOpacity:function(e){void 0!=e&&(this.opacity=e),null!=this.div&&(this.div.style.opacity=this.opacity,this.div.style.filter="alpha(opacity="+100*this.opacity+")")},setBorder:function(e){void 0!=e&&(this.border=e),null!=this.div&&(this.div.style.border=this.border)},setContentHTML:function(e){null!=e&&(this.contentHTML=e),null!=this.contentDiv&&null!=this.contentHTML&&this.contentHTML!=this.contentDiv.innerHTML&&(this.contentDiv.innerHTML=this.contentHTML,this.autoSize&&(this.registerImageListeners(),this.updateSize()))},registerImageListeners:function(){for(var e=function(){null!==this.popup.id&&(this.popup.updateSize(),this.popup.visible()&&this.popup.panMapIfOutOfView&&this.popup.panIntoView(),OpenLayers.Event.stopObserving(this.img,"load",this.img._onImgLoad))},t=this.contentDiv.getElementsByTagName("img"),i=0,n=t.length;i<n;i++){var s=t[i];0!=s.width&&0!=s.height||(s._onImgLoad=OpenLayers.Function.bind(e,{popup:this,img:s}),OpenLayers.Event.observe(s,"load",s._onImgLoad))}},getSafeContentSize:function(e){e=e.clone();var t=this.getContentDivPadding(),i=t.left+t.right,n=t.top+t.bottom;if(this.fixPadding(),i+=this.padding.left+this.padding.right,n+=this.padding.top+this.padding.bottom,this.closeDiv)var s=parseInt(this.closeDiv.style.width),i=i+(s+t.right);if(this.minSize&&(e.w=Math.max(e.w,this.minSize.w-i),e.h=Math.max(e.h,this.minSize.h-n)),this.maxSize&&(e.w=Math.min(e.w,this.maxSize.w-i),e.h=Math.min(e.h,this.maxSize.h-n)),this.map&&this.map.size){if(s=t=0,this.keepInMap&&!this.panMapIfOutOfView)switch(s=this.map.getPixelFromLonLat(this.lonlat),this.relativePosition){case"tr":t=s.x,s=this.map.size.h-s.y;break;case"tl":t=this.map.size.w-s.x,s=this.map.size.h-s.y;break;case"bl":t=this.map.size.w-s.x,s=s.y;break;case"br":t=s.x,s=s.y;break;default:t=s.x,s=this.map.size.h-s.y}n=this.map.size.h-this.map.paddingForPopups.top-this.map.paddingForPopups.bottom-n-s,e.w=Math.min(e.w,this.map.size.w-this.map.paddingForPopups.left-this.map.paddingForPopups.right-i-t),e.h=Math.min(e.h,n)}return e},getContentDivPadding:function(){var e=this._contentDivPadding;return e||(null==this.div.parentNode&&(this.div.style.display="none",document.body.appendChild(this.div)),this._contentDivPadding=e=new OpenLayers.Bounds(OpenLayers.Element.getStyle(this.contentDiv,"padding-left"),OpenLayers.Element.getStyle(this.contentDiv,"padding-bottom"),OpenLayers.Element.getStyle(this.contentDiv,"padding-right"),OpenLayers.Element.getStyle(this.contentDiv,"padding-top")),this.div.parentNode==document.body&&(document.body.removeChild(this.div),this.div.style.display="")),e},addCloseBox:function(e){this.closeDiv=OpenLayers.Util.createDiv(this.id+"_close",null,{w:17,h:17}),this.closeDiv.className="olPopupCloseBox";var t=this.getContentDivPadding();this.closeDiv.style.right=t.right+"px",this.closeDiv.style.top=t.top+"px",this.groupDiv.appendChild(this.closeDiv),e=e||function(e){this.hide(),OpenLayers.Event.stop(e)},OpenLayers.Event.observe(this.closeDiv,"touchend",OpenLayers.Function.bindAsEventListener(e,this)),OpenLayers.Event.observe(this.closeDiv,"click",OpenLayers.Function.bindAsEventListener(e,this))},panIntoView:function(){var e=this.map.getSize(),t=this.map.getViewPortPxFromLayerPx(new OpenLayers.Pixel(parseInt(this.div.style.left),parseInt(this.div.style.top))),i=t.clone();t.x<this.map.paddingForPopups.left?i.x=this.map.paddingForPopups.left:t.x+this.size.w>e.w-this.map.paddingForPopups.right&&(i.x=e.w-this.map.paddingForPopups.right-this.size.w),t.y<this.map.paddingForPopups.top?i.y=this.map.paddingForPopups.top:t.y+this.size.h>e.h-this.map.paddingForPopups.bottom&&(i.y=e.h-this.map.paddingForPopups.bottom-this.size.h),this.map.pan(t.x-i.x,t.y-i.y)},registerEvents:function(){this.events=new OpenLayers.Events(this,this.div,null,!0),this.events.on({mousedown:this.onmousedown,mousemove:this.onmousemove,mouseup:this.onmouseup,click:this.onclick,mouseout:this.onmouseout,dblclick:this.ondblclick,touchstart:function(e){OpenLayers.Event.stop(e,!0)},scope:this})},onmousedown:function(e){this.mousedown=!0,OpenLayers.Event.stop(e,!0)},onmousemove:function(e){this.mousedown&&OpenLayers.Event.stop(e,!0)},onmouseup:function(e){this.mousedown&&(this.mousedown=!1,OpenLayers.Event.stop(e,!0))},onclick:function(e){OpenLayers.Event.stop(e,!0)},onmouseout:function(e){this.mousedown=!1},ondblclick:function(e){OpenLayers.Event.stop(e,!0)},CLASS_NAME:"OpenLayers.Popup"}),OpenLayers.Popup.WIDTH=200,OpenLayers.Popup.HEIGHT=200,OpenLayers.Popup.COLOR="white",OpenLayers.Popup.OPACITY=1,OpenLayers.Popup.BORDER="0px",OpenLayers.Popup.Anchored=OpenLayers.Class(OpenLayers.Popup,{relativePosition:null,keepInMap:!0,anchor:null,initialize:function(e,t,i,n,s,r,a){OpenLayers.Popup.prototype.initialize.apply(this,[e,t,i,n,r,a]),this.anchor=null!=s?s:{size:new OpenLayers.Size(0,0),offset:new OpenLayers.Pixel(0,0)}},destroy:function(){this.relativePosition=this.anchor=null,OpenLayers.Popup.prototype.destroy.apply(this,arguments)},show:function(){this.updatePosition(),OpenLayers.Popup.prototype.show.apply(this,arguments)},moveTo:function(e){var t=this.relativePosition;this.relativePosition=this.calculateRelativePosition(e),OpenLayers.Popup.prototype.moveTo.call(this,this.calculateNewPx(e)),this.relativePosition!=t&&this.updateRelativePosition()},setSize:function(e){if(OpenLayers.Popup.prototype.setSize.apply(this,arguments),this.lonlat&&this.map){var t=this.map.getLayerPxFromLonLat(this.lonlat);this.moveTo(t)}},calculateRelativePosition:function(e){return e=this.map.getLonLatFromLayerPx(e),e=this.map.getExtent().determineQuadrant(e),OpenLayers.Bounds.oppositeQuadrant(e)},updateRelativePosition:function(){},calculateNewPx:function(e){e=e.offset(this.anchor.offset);var t=this.size||this.contentSize,i="t"==this.relativePosition.charAt(0);return e.y+=i?-t.h:this.anchor.size.h,i="l"==this.relativePosition.charAt(1),e.x+=i?-t.w:this.anchor.size.w,e},CLASS_NAME:"OpenLayers.Popup.Anchored"}),OpenLayers.Popup.Framed=OpenLayers.Class(OpenLayers.Popup.Anchored,{imageSrc:null,imageSize:null,isAlphaImage:!1,positionBlocks:null,blocks:null,fixedRelativePosition:!1,initialize:function(e,t,i,n,s,r,a){OpenLayers.Popup.Anchored.prototype.initialize.apply(this,arguments),this.fixedRelativePosition&&(this.updateRelativePosition(),this.calculateRelativePosition=function(e){return this.relativePosition}),this.contentDiv.style.position="absolute",this.contentDiv.style.zIndex=1,r&&(this.closeDiv.style.zIndex=1),this.groupDiv.style.position="absolute",this.groupDiv.style.top="0px",this.groupDiv.style.left="0px",this.groupDiv.style.height="100%",this.groupDiv.style.width="100%"},destroy:function(){this.isAlphaImage=this.imageSize=this.imageSrc=null,this.fixedRelativePosition=!1,this.positionBlocks=null;for(var e=0;e<this.blocks.length;e++){var t=this.blocks[e];t.image&&t.div.removeChild(t.image),t.image=null,t.div&&this.groupDiv.removeChild(t.div),t.div=null}this.blocks=null,OpenLayers.Popup.Anchored.prototype.destroy.apply(this,arguments)},setBackgroundColor:function(e){},setBorder:function(){},setOpacity:function(e){},setSize:function(e){OpenLayers.Popup.Anchored.prototype.setSize.apply(this,arguments),this.updateBlocks()},updateRelativePosition:function(){if(this.padding=this.positionBlocks[this.relativePosition].padding,this.closeDiv){var e=this.getContentDivPadding();this.closeDiv.style.right=e.right+this.padding.right+"px",this.closeDiv.style.top=e.top+this.padding.top+"px"}this.updateBlocks()},calculateNewPx:function(e){var t=OpenLayers.Popup.Anchored.prototype.calculateNewPx.apply(this,arguments);return t=t.offset(this.positionBlocks[this.relativePosition].offset)},createBlocks:function(){this.blocks=[];var e,t=null;for(e in this.positionBlocks){t=e;break}for(t=this.positionBlocks[t],e=0;e<t.blocks.length;e++){var i={};this.blocks.push(i),i.div=OpenLayers.Util.createDiv(this.id+"_FrameDecorationDiv_"+e,null,null,null,"absolute",null,"hidden",null),i.image=(this.isAlphaImage?OpenLayers.Util.createAlphaImageDiv:OpenLayers.Util.createImage)(this.id+"_FrameDecorationImg_"+e,null,this.imageSize,this.imageSrc,"absolute",null,null,null),i.div.appendChild(i.image),this.groupDiv.appendChild(i.div)}},updateBlocks:function(){if(this.blocks||this.createBlocks(),this.size&&this.relativePosition){for(var e=this.positionBlocks[this.relativePosition],t=0;t<e.blocks.length;t++){var i=e.blocks[t],n=this.blocks[t],s=i.anchor.left,r=i.anchor.bottom,a=i.anchor.right,o=i.anchor.top,l=isNaN(i.size.w)?this.size.w-(a+s):i.size.w,h=isNaN(i.size.h)?this.size.h-(r+o):i.size.h;n.div.style.width=(0>l?0:l)+"px",n.div.style.height=(0>h?0:h)+"px",n.div.style.left=null!=s?s+"px":"",n.div.style.bottom=null!=r?r+"px":"",n.div.style.right=null!=a?a+"px":"",n.div.style.top=null!=o?o+"px":"",n.image.style.left=i.position.x+"px",n.image.style.top=i.position.y+"px"}this.contentDiv.style.left=this.padding.left+"px",this.contentDiv.style.top=this.padding.top+"px"}},CLASS_NAME:"OpenLayers.Popup.Framed"}),OpenLayers.Popup.FramedCloud=OpenLayers.Class(OpenLayers.Popup.Framed,{contentDisplayClass:"olFramedCloudPopupContent",autoSize:!0,panMapIfOutOfView:!0,imageSize:new OpenLayers.Size(1276,736),isAlphaImage:!1,fixedRelativePosition:!1,positionBlocks:{tl:{offset:new OpenLayers.Pixel(44,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,18),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-632)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(0,-688)}]},tr:{offset:new OpenLayers.Pixel(-45,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,19),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-631)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(0,0,null,null),position:new OpenLayers.Pixel(-215,-687)}]},bl:{offset:new OpenLayers.Pixel(45,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(null,null,0,0),position:new OpenLayers.Pixel(-101,-674)}]
},br:{offset:new OpenLayers.Pixel(-44,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(0,null,null,0),position:new OpenLayers.Pixel(-311,-674)}]}},minSize:new OpenLayers.Size(105,10),maxSize:new OpenLayers.Size(1200,660),initialize:function(e,t,i,n,s,r,a){this.imageSrc=OpenLayers.Util.getImageLocation("cloud-popup-relative.png"),OpenLayers.Popup.Framed.prototype.initialize.apply(this,arguments),this.contentDiv.className=this.contentDisplayClass},CLASS_NAME:"OpenLayers.Popup.FramedCloud"}),OpenLayers.Protocol=OpenLayers.Class({format:null,options:null,autoDestroy:!0,defaultFilter:null,initialize:function(e){e=e||{},OpenLayers.Util.extend(this,e),this.options=e},mergeWithDefaultFilter:function(e){return e&&this.defaultFilter?new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.defaultFilter,e]}):e||this.defaultFilter||void 0},destroy:function(){this.format=this.options=null},read:function(e){e=e||{},e.filter=this.mergeWithDefaultFilter(e.filter)},create:function(){},update:function(){},delete:function(){},commit:function(){},abort:function(e){},createCallback:function(e,t,i){return OpenLayers.Function.bind(function(){e.apply(this,[t,i])},this)},CLASS_NAME:"OpenLayers.Protocol"}),OpenLayers.Protocol.Response=OpenLayers.Class({code:null,requestType:null,last:!0,features:null,data:null,reqFeatures:null,priv:null,error:null,initialize:function(e){OpenLayers.Util.extend(this,e)},success:function(){return 0<this.code},CLASS_NAME:"OpenLayers.Protocol.Response"}),OpenLayers.Protocol.Response.SUCCESS=1,OpenLayers.Protocol.Response.FAILURE=0,OpenLayers.ProxyHost="",OpenLayers.Request||(OpenLayers.Request={}),OpenLayers.Util.extend(OpenLayers.Request,{DEFAULT_CONFIG:{method:"GET",url:window.location.href,async:!0,user:void 0,password:void 0,params:null,proxy:OpenLayers.ProxyHost,headers:{},data:null,callback:function(){},success:null,failure:null,scope:null},URL_SPLIT_REGEX:/([^:]*:)\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/,events:new OpenLayers.Events(this),makeSameOrigin:function(e,t){var i=0!==e.indexOf("http"),n=!i&&e.match(this.URL_SPLIT_REGEX);if(n){var s=window.location,i=n[1]==s.protocol&&n[3]==s.hostname,n=n[4],s=s.port;(80!=n&&""!=n||"80"!=s&&""!=s)&&(i=i&&n==s)}return i||t&&(e="function"==typeof t?t(e):t+encodeURIComponent(e)),e},issue:function(e){var t=OpenLayers.Util.extend(this.DEFAULT_CONFIG,{proxy:OpenLayers.ProxyHost});e=e||{},e.headers=e.headers||{},e=OpenLayers.Util.applyDefaults(e,t),e.headers=OpenLayers.Util.applyDefaults(e.headers,t.headers);var i,t=!1;for(i in e.headers)e.headers.hasOwnProperty(i)&&"x-requested-with"===i.toLowerCase()&&(t=!0);!1===t&&(e.headers["X-Requested-With"]="XMLHttpRequest");var n=new OpenLayers.Request.XMLHttpRequest,s=OpenLayers.Util.urlAppend(e.url,OpenLayers.Util.getParameterString(e.params||{})),s=OpenLayers.Request.makeSameOrigin(s,e.proxy);n.open(e.method,s,e.async,e.user,e.password);for(var r in e.headers)n.setRequestHeader(r,e.headers[r]);var a=this.events,o=this;return n.onreadystatechange=function(){n.readyState==OpenLayers.Request.XMLHttpRequest.DONE&&!1!==a.triggerEvent("complete",{request:n,config:e,requestUrl:s})&&o.runCallbacks({request:n,config:e,requestUrl:s})},!1===e.async?n.send(e.data):window.setTimeout(function(){0!==n.readyState&&n.send(e.data)},0),n},runCallbacks:function(e){var t,i=e.request,n=e.config,s=n.scope?OpenLayers.Function.bind(n.callback,n.scope):n.callback;n.success&&(t=n.scope?OpenLayers.Function.bind(n.success,n.scope):n.success);var r;n.failure&&(r=n.scope?OpenLayers.Function.bind(n.failure,n.scope):n.failure),"file:"==OpenLayers.Util.createUrlObject(n.url).protocol&&i.responseText&&(i.status=200),s(i),(!i.status||200<=i.status&&300>i.status)&&(this.events.triggerEvent("success",e),t&&t(i)),i.status&&(200>i.status||300<=i.status)&&(this.events.triggerEvent("failure",e),r&&r(i))},GET:function(e){return e=OpenLayers.Util.extend(e,{method:"GET"}),OpenLayers.Request.issue(e)},POST:function(e){return e=OpenLayers.Util.extend(e,{method:"POST"}),e.headers=e.headers?e.headers:{},"CONTENT-TYPE"in OpenLayers.Util.upperCaseObject(e.headers)||(e.headers["Content-Type"]="application/xml"),OpenLayers.Request.issue(e)},PUT:function(e){return e=OpenLayers.Util.extend(e,{method:"PUT"}),e.headers=e.headers?e.headers:{},"CONTENT-TYPE"in OpenLayers.Util.upperCaseObject(e.headers)||(e.headers["Content-Type"]="application/xml"),OpenLayers.Request.issue(e)},DELETE:function(e){return e=OpenLayers.Util.extend(e,{method:"DELETE"}),OpenLayers.Request.issue(e)},HEAD:function(e){return e=OpenLayers.Util.extend(e,{method:"HEAD"}),OpenLayers.Request.issue(e)},OPTIONS:function(e){return e=OpenLayers.Util.extend(e,{method:"OPTIONS"}),OpenLayers.Request.issue(e)}}),function(){function e(){this._object=r&&!l?new r:new window.ActiveXObject("Microsoft.XMLHTTP"),this._listeners=[]}function t(){return new e}function i(e){t.onreadystatechange&&t.onreadystatechange.apply(e),e.dispatchEvent({type:"readystatechange",bubbles:!1,cancelable:!1,timeStamp:new Date+0})}function n(e){try{e.responseText=e._object.responseText}catch(e){}try{var t,i=e._object,n=i.responseXML,s=i.responseText;o&&s&&n&&!n.documentElement&&i.getResponseHeader("Content-Type").match(/[^\/]+\/[^\+]+\+xml/)&&(n=new window.ActiveXObject("Microsoft.XMLDOM"),n.async=!1,n.validateOnParse=!1,n.loadXML(s)),t=n&&(o&&0!=n.parseError||!n.documentElement||n.documentElement&&"parsererror"==n.documentElement.tagName)?null:n,e.responseXML=t}catch(e){}try{e.status=e._object.status}catch(e){}try{e.statusText=e._object.statusText}catch(e){}}function s(e){e._object.onreadystatechange=new window.Function}var r=window.XMLHttpRequest,a=!!window.controllers,o=window.document.all&&!window.opera,l=o&&window.navigator.userAgent.match(/MSIE 7.0/);t.prototype=e.prototype,a&&r.wrapped&&(t.wrapped=r.wrapped),t.UNSENT=0,t.OPENED=1,t.HEADERS_RECEIVED=2,t.LOADING=3,t.DONE=4,t.prototype.readyState=t.UNSENT,t.prototype.responseText="",t.prototype.responseXML=null,t.prototype.status=0,t.prototype.statusText="",t.prototype.priority="NORMAL",t.prototype.onreadystatechange=null,t.onreadystatechange=null,t.onopen=null,t.onsend=null,t.onabort=null,t.prototype.open=function(e,r,l,h,u){delete this._headers,3>arguments.length&&(l=!0),this._async=l;var p,c=this,y=this.readyState;o&&l&&(p=function(){y!=t.DONE&&(s(c),c.abort())},window.attachEvent("onunload",p)),t.onopen&&t.onopen.apply(this,arguments),4<arguments.length?this._object.open(e,r,l,h,u):3<arguments.length?this._object.open(e,r,l,h):this._object.open(e,r,l),this.readyState=t.OPENED,i(this),this._object.onreadystatechange=function(){a&&!l||(c.readyState=c._object.readyState,n(c),c._aborted?c.readyState=t.UNSENT:(c.readyState==t.DONE&&(delete c._data,s(c),o&&l&&window.detachEvent("onunload",p)),y!=c.readyState&&i(c),y=c.readyState))}},t.prototype.send=function(e){t.onsend&&t.onsend.apply(this,arguments),arguments.length||(e=null),e&&e.nodeType&&(e=window.XMLSerializer?(new window.XMLSerializer).serializeToString(e):e.xml,this._headers["Content-Type"]||this._object.setRequestHeader("Content-Type","application/xml")),this._data=e;e:if(this._object.send(this._data),a&&!this._async)for(this.readyState=t.OPENED,n(this);this.readyState<t.DONE;)if(this.readyState++,i(this),this._aborted)break e},t.prototype.abort=function(){t.onabort&&t.onabort.apply(this,arguments),this.readyState>t.UNSENT&&(this._aborted=!0),this._object.abort(),s(this),this.readyState=t.UNSENT,delete this._data},t.prototype.getAllResponseHeaders=function(){return this._object.getAllResponseHeaders()},t.prototype.getResponseHeader=function(e){return this._object.getResponseHeader(e)},t.prototype.setRequestHeader=function(e,t){return this._headers||(this._headers={}),this._headers[e]=t,this._object.setRequestHeader(e,t)},t.prototype.addEventListener=function(e,t,i){for(var n,s=0;n=this._listeners[s];s++)if(n[0]==e&&n[1]==t&&n[2]==i)return;this._listeners.push([e,t,i])},t.prototype.removeEventListener=function(e,t,i){for(var n,s=0;(n=this._listeners[s])&&(n[0]!=e||n[1]!=t||n[2]!=i);s++);n&&this._listeners.splice(s,1)},t.prototype.dispatchEvent=function(e){e={type:e.type,target:this,currentTarget:this,eventPhase:2,bubbles:e.bubbles,cancelable:e.cancelable,timeStamp:e.timeStamp,stopPropagation:function(){},preventDefault:function(){},initEvent:function(){}},"readystatechange"==e.type&&this.onreadystatechange&&(this.onreadystatechange.handleEvent||this.onreadystatechange).apply(this,[e]);for(var t,i=0;t=this._listeners[i];i++)t[0]!=e.type||t[2]||(t[1].handleEvent||t[1]).apply(this,[e])},t.prototype.toString=function(){return"[object XMLHttpRequest]"},t.toString=function(){return"[XMLHttpRequest]"},window.Function.prototype.apply||(window.Function.prototype.apply=function(e,t){t||(t=[]),e.__func=this,e.__func(t[0],t[1],t[2],t[3],t[4]),delete e.__func}),OpenLayers.Request||(OpenLayers.Request={}),OpenLayers.Request.XMLHttpRequest=t}(),OpenLayers.Protocol.HTTP=OpenLayers.Class(OpenLayers.Protocol,{url:null,headers:null,params:null,callback:null,scope:null,readWithPOST:!1,updateWithPOST:!1,deleteWithPOST:!1,wildcarded:!1,srsInBBOX:!1,initialize:function(e){if(e=e||{},this.params={},this.headers={},OpenLayers.Protocol.prototype.initialize.apply(this,arguments),!this.filterToParams&&OpenLayers.Format.QueryStringFilter){var t=new OpenLayers.Format.QueryStringFilter({wildcarded:this.wildcarded,srsInBBOX:this.srsInBBOX});this.filterToParams=function(e,i){return t.write(e,i)}}},destroy:function(){this.headers=this.params=null,OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(e){OpenLayers.Protocol.prototype.read.apply(this,arguments),e=e||{},e.params=OpenLayers.Util.applyDefaults(e.params,this.options.params),e=OpenLayers.Util.applyDefaults(e,this.options),e.filter&&this.filterToParams&&(e.params=this.filterToParams(e.filter,e.params));var t=void 0!==e.readWithPOST?e.readWithPOST:this.readWithPOST,i=new OpenLayers.Protocol.Response({requestType:"read"});return t?(t=e.headers||{},t["Content-Type"]="application/x-www-form-urlencoded",i.priv=OpenLayers.Request.POST({url:e.url,callback:this.createCallback(this.handleRead,i,e),data:OpenLayers.Util.getParameterString(e.params),headers:t})):i.priv=OpenLayers.Request.GET({url:e.url,callback:this.createCallback(this.handleRead,i,e),params:e.params,headers:e.headers}),i},handleRead:function(e,t){this.handleResponse(e,t)},create:function(e,t){t=OpenLayers.Util.applyDefaults(t,this.options);var i=new OpenLayers.Protocol.Response({reqFeatures:e,requestType:"create"});return i.priv=OpenLayers.Request.POST({url:t.url,callback:this.createCallback(this.handleCreate,i,t),headers:t.headers,data:this.format.write(e)}),i},handleCreate:function(e,t){this.handleResponse(e,t)},update:function(e,t){t=t||{};var i=t.url||e.url||this.options.url+"/"+e.fid;t=OpenLayers.Util.applyDefaults(t,this.options);var n=new OpenLayers.Protocol.Response({reqFeatures:e,requestType:"update"});return n.priv=OpenLayers.Request[this.updateWithPOST?"POST":"PUT"]({url:i,callback:this.createCallback(this.handleUpdate,n,t),headers:t.headers,data:this.format.write(e)}),n},handleUpdate:function(e,t){this.handleResponse(e,t)},delete:function(e,t){t=t||{};var i=t.url||e.url||this.options.url+"/"+e.fid;t=OpenLayers.Util.applyDefaults(t,this.options);var n=new OpenLayers.Protocol.Response({reqFeatures:e,requestType:"delete"}),s=this.deleteWithPOST?"POST":"DELETE",i={url:i,callback:this.createCallback(this.handleDelete,n,t),headers:t.headers};return this.deleteWithPOST&&(i.data=this.format.write(e)),n.priv=OpenLayers.Request[s](i),n},handleDelete:function(e,t){this.handleResponse(e,t)},handleResponse:function(e,t){var i=e.priv;t.callback&&(200<=i.status&&300>i.status?("delete"!=e.requestType&&(e.features=this.parseFeatures(i)),e.code=OpenLayers.Protocol.Response.SUCCESS):e.code=OpenLayers.Protocol.Response.FAILURE,t.callback.call(t.scope,e))},parseFeatures:function(e){var t=e.responseXML;return t&&t.documentElement||(t=e.responseText),!t||0>=t.length?null:this.format.read(t)},commit:function(e,t){function i(e){for(var t=e.features?e.features.length:0,i=Array(t),s=0;s<t;++s)i[s]=e.features[s].fid;d.insertIds=i,n.apply(this,[e])}function n(e){this.callUserCallback(e,t),y=y&&e.success(),r++,r>=c&&t.callback&&(d.code=y?OpenLayers.Protocol.Response.SUCCESS:OpenLayers.Protocol.Response.FAILURE,t.callback.apply(t.scope,[d]))}t=OpenLayers.Util.applyDefaults(t,this.options);var s=[],r=0,a={};a[OpenLayers.State.INSERT]=[],a[OpenLayers.State.UPDATE]=[],a[OpenLayers.State.DELETE]=[];for(var o,l,h=[],u=0,p=e.length;u<p;++u)o=e[u],(l=a[o.state])&&(l.push(o),h.push(o));var c=(0<a[OpenLayers.State.INSERT].length?1:0)+a[OpenLayers.State.UPDATE].length+a[OpenLayers.State.DELETE].length,y=!0,d=new OpenLayers.Protocol.Response({reqFeatures:h});for(o=a[OpenLayers.State.INSERT],0<o.length&&s.push(this.create(o,OpenLayers.Util.applyDefaults({callback:i,scope:this},t.create))),o=a[OpenLayers.State.UPDATE],u=o.length-1;0<=u;--u)s.push(this.update(o[u],OpenLayers.Util.applyDefaults({callback:n,scope:this},t.update)));for(o=a[OpenLayers.State.DELETE],u=o.length-1;0<=u;--u)s.push(this.delete(o[u],OpenLayers.Util.applyDefaults({callback:n,scope:this},t.delete)));return s},abort:function(e){e&&e.priv.abort()},callUserCallback:function(e,t){var i=t[e.requestType];i&&i.callback&&i.callback.call(i.scope,e)},CLASS_NAME:"OpenLayers.Protocol.HTTP"}),OpenLayers.Geometry=OpenLayers.Class({id:null,parent:null,bounds:null,initialize:function(){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){this.bounds=this.id=null},clone:function(){return new OpenLayers.Geometry},setBounds:function(e){e&&(this.bounds=e.clone())},clearBounds:function(){this.bounds=null,this.parent&&this.parent.clearBounds()},extendBounds:function(e){this.getBounds()?this.bounds.extend(e):this.setBounds(e)},getBounds:function(){return null==this.bounds&&this.calculateBounds(),this.bounds},calculateBounds:function(){},distanceTo:function(e,t){},getVertices:function(e){},atPoint:function(e,t,i){var n=!1;return null!=this.getBounds()&&null!=e&&(t=null!=t?t:0,i=null!=i?i:0,n=new OpenLayers.Bounds(this.bounds.left-t,this.bounds.bottom-i,this.bounds.right+t,this.bounds.top+i).containsLonLat(e)),n},getLength:function(){return 0},getArea:function(){return 0},getCentroid:function(){return null},toString:function(){return OpenLayers.Format&&OpenLayers.Format.WKT?OpenLayers.Format.WKT.prototype.write(new OpenLayers.Feature.Vector(this)):Object.prototype.toString.call(this)},CLASS_NAME:"OpenLayers.Geometry"}),OpenLayers.Geometry.fromWKT=function(e){var t;if(OpenLayers.Format&&OpenLayers.Format.WKT){var i=OpenLayers.Geometry.fromWKT.format;if(i||(i=new OpenLayers.Format.WKT,OpenLayers.Geometry.fromWKT.format=i),e=i.read(e),e instanceof OpenLayers.Feature.Vector)t=e.geometry;else if(OpenLayers.Util.isArray(e)){t=e.length;for(var i=Array(t),n=0;n<t;++n)i[n]=e[n].geometry;t=new OpenLayers.Geometry.Collection(i)}}return t},OpenLayers.Geometry.segmentsIntersect=function(e,t,i){var n=i&&i.point;i=i&&i.tolerance;var s=!1,r=e.x1-t.x1,a=e.y1-t.y1,o=e.x2-e.x1,l=e.y2-e.y1,h=t.y2-t.y1,u=t.x2-t.x1,p=h*o-u*l,h=u*a-h*r,a=o*a-l*r;if(0==p?0==h&&0==a&&(s=!0):(r=h/p,p=a/p,0<=r&&1>=r&&0<=p&&1>=p&&(n?(o=e.x1+r*o,p=e.y1+r*l,s=new OpenLayers.Geometry.Point(o,p)):s=!0)),i)if(s){if(n)e:for(e=[e,t],t=0;2>t;++t)for(r=e[t],l=1;3>l;++l)if(o=r["x"+l],p=r["y"+l],n=Math.sqrt(Math.pow(o-s.x,2)+Math.pow(p-s.y,2)),n<i){s.x=o,s.y=p;break e}}else e:for(e=[e,t],t=0;2>t;++t)for(o=e[t],p=e[(t+1)%2],l=1;3>l;++l)if(r={x:o["x"+l],y:o["y"+l]},a=OpenLayers.Geometry.distanceToSegment(r,p),a.distance<i){s=!n||new OpenLayers.Geometry.Point(r.x,r.y);break e}return s},OpenLayers.Geometry.distanceToSegment=function(e,t){var i=OpenLayers.Geometry.distanceSquaredToSegment(e,t);return i.distance=Math.sqrt(i.distance),i},OpenLayers.Geometry.distanceSquaredToSegment=function(e,t){var i=e.x,n=e.y,s=t.x1,r=t.y1,a=t.x2,o=t.y2,l=a-s,h=o-r,u=0==l&&0==h?0:(l*(i-s)+h*(n-r))/(Math.pow(l,2)+Math.pow(h,2));return 0>=u||(1<=u?(s=a,r=o):(s+=u*l,r+=u*h)),{distance:Math.pow(s-i,2)+Math.pow(r-n,2),x:s,y:r,along:u}},OpenLayers.Geometry.Collection=OpenLayers.Class(OpenLayers.Geometry,{components:null,componentTypes:null,initialize:function(e){OpenLayers.Geometry.prototype.initialize.apply(this,arguments),this.components=[],null!=e&&this.addComponents(e)},destroy:function(){this.components.length=0,this.components=null,OpenLayers.Geometry.prototype.destroy.apply(this,arguments)},clone:function(){for(var e=new(OpenLayers.Util.getConstructor(this.CLASS_NAME)),t=0,i=this.components.length;t<i;t++)e.addComponent(this.components[t].clone());return OpenLayers.Util.applyDefaults(e,this),e},getComponentsString:function(){for(var e=[],t=0,i=this.components.length;t<i;t++)e.push(this.components[t].toShortString());return e.join(",")},calculateBounds:function(){this.bounds=null;var e=new OpenLayers.Bounds,t=this.components;if(t)for(var i=0,n=t.length;i<n;i++)e.extend(t[i].getBounds());null!=e.left&&null!=e.bottom&&null!=e.right&&null!=e.top&&this.setBounds(e)},addComponents:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=0,i=e.length;t<i;t++)this.addComponent(e[t])},addComponent:function(e,t){var i=!1;if(e&&(null==this.componentTypes||-1<OpenLayers.Util.indexOf(this.componentTypes,e.CLASS_NAME))){if(null!=t&&t<this.components.length){var i=this.components.slice(0,t),n=this.components.slice(t,this.components.length);i.push(e),this.components=i.concat(n)}else this.components.push(e);e.parent=this,this.clearBounds(),i=!0}return i},removeComponents:function(e){var t=!1;OpenLayers.Util.isArray(e)||(e=[e]);for(var i=e.length-1;0<=i;--i)t=this.removeComponent(e[i])||t;return t},removeComponent:function(e){return OpenLayers.Util.removeItem(this.components,e),this.clearBounds(),!0},getLength:function(){for(var e=0,t=0,i=this.components.length;t<i;t++)e+=this.components[t].getLength();return e},getArea:function(){for(var e=0,t=0,i=this.components.length;t<i;t++)e+=this.components[t].getArea();return e},getGeodesicArea:function(e){for(var t=0,i=0,n=this.components.length;i<n;i++)t+=this.components[i].getGeodesicArea(e);return t},getCentroid:function(e){if(!e)return this.components.length&&this.components[0].getCentroid();if(e=this.components.length,!e)return!1;for(var t,i=[],n=[],s=0,r=Number.MAX_VALUE,a=0;a<e;++a){t=this.components[a];var o=t.getArea();t=t.getCentroid(!0),isNaN(o)||isNaN(t.x)||isNaN(t.y)||(i.push(o),s+=o,r=o<r&&0<o?o:r,n.push(t))}if(e=i.length,0===s){for(a=0;a<e;++a)i[a]=1;s=i.length}else{for(a=0;a<e;++a)i[a]/=r;s/=r}for(var l=r=0,a=0;a<e;++a)t=n[a],o=i[a],r+=t.x*o,l+=t.y*o;return new OpenLayers.Geometry.Point(r/s,l/s)},getGeodesicLength:function(e){for(var t=0,i=0,n=this.components.length;i<n;i++)t+=this.components[i].getGeodesicLength(e);return t},move:function(e,t){for(var i=0,n=this.components.length;i<n;i++)this.components[i].move(e,t)},rotate:function(e,t){for(var i=0,n=this.components.length;i<n;++i)this.components[i].rotate(e,t)},resize:function(e,t,i){for(var n=0;n<this.components.length;++n)this.components[n].resize(e,t,i);return this},distanceTo:function(e,t){for(var i,n,s,r=!(t&&!1===t.edge)&&t&&t.details,a=Number.POSITIVE_INFINITY,o=0,l=this.components.length;o<l&&(i=this.components[o].distanceTo(e,t),s=r?i.distance:i,!(s<a&&(a=s,n=i,0==a)));++o);return n},equals:function(e){var t=!0;if(e&&e.CLASS_NAME&&this.CLASS_NAME==e.CLASS_NAME)if(OpenLayers.Util.isArray(e.components)&&e.components.length==this.components.length){for(var i=0,n=this.components.length;i<n;++i)if(!this.components[i].equals(e.components[i])){t=!1;break}}else t=!1;else t=!1;return t},transform:function(e,t){if(e&&t){for(var i=0,n=this.components.length;i<n;i++)this.components[i].transform(e,t);this.bounds=null}return this},intersects:function(e){for(var t=!1,i=0,n=this.components.length;i<n&&!(t=e.intersects(this.components[i]));++i);return t},getVertices:function(e){for(var t=[],i=0,n=this.components.length;i<n;++i)Array.prototype.push.apply(t,this.components[i].getVertices(e));return t},CLASS_NAME:"OpenLayers.Geometry.Collection"}),OpenLayers.Geometry.Point=OpenLayers.Class(OpenLayers.Geometry,{x:null,y:null,initialize:function(e,t){OpenLayers.Geometry.prototype.initialize.apply(this,arguments),this.x=parseFloat(e),this.y=parseFloat(t)},clone:function(e){return null==e&&(e=new OpenLayers.Geometry.Point(this.x,this.y)),OpenLayers.Util.applyDefaults(e,this),e},calculateBounds:function(){this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x,this.y)},distanceTo:function(e,t){var i,n,s,r,a,o=!(t&&!1===t.edge)&&t&&t.details;return e instanceof OpenLayers.Geometry.Point?(n=this.x,s=this.y,r=e.x,a=e.y,i=Math.sqrt(Math.pow(n-r,2)+Math.pow(s-a,2)),i=o?{x0:n,y0:s,x1:r,y1:a,distance:i}:i):(i=e.distanceTo(this,t),o&&(i={x0:i.x1,y0:i.y1,x1:i.x0,y1:i.y0,distance:i.distance})),i},equals:function(e){var t=!1;return null!=e&&(t=this.x==e.x&&this.y==e.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(e.x)&&isNaN(e.y)),t},toShortString:function(){return this.x+", "+this.y},move:function(e,t){this.x+=e,this.y+=t,this.clearBounds()},rotate:function(e,t){e*=Math.PI/180;var i=this.distanceTo(t),n=e+Math.atan2(this.y-t.y,this.x-t.x);this.x=t.x+i*Math.cos(n),this.y=t.y+i*Math.sin(n),this.clearBounds()},getCentroid:function(){return new OpenLayers.Geometry.Point(this.x,this.y)},resize:function(e,t,i){return this.x=t.x+e*(void 0==i?1:i)*(this.x-t.x),this.y=t.y+e*(this.y-t.y),this.clearBounds(),this},intersects:function(e){return"OpenLayers.Geometry.Point"==e.CLASS_NAME?this.equals(e):e.intersects(this)},transform:function(e,t){return e&&t&&(OpenLayers.Projection.transform(this,e,t),this.bounds=null),this},getVertices:function(e){return[this]},CLASS_NAME:"OpenLayers.Geometry.Point"}),OpenLayers.Geometry.MultiPoint=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Point"],addPoint:function(e,t){this.addComponent(e,t)},removePoint:function(e){this.removeComponent(e)},CLASS_NAME:"OpenLayers.Geometry.MultiPoint"}),OpenLayers.Geometry.Curve=OpenLayers.Class(OpenLayers.Geometry.MultiPoint,{componentTypes:["OpenLayers.Geometry.Point"],getLength:function(){var e=0;if(this.components&&1<this.components.length)for(var t=1,i=this.components.length;t<i;t++)e+=this.components[t-1].distanceTo(this.components[t]);return e},getGeodesicLength:function(e){var t=this;if(e){var i=new OpenLayers.Projection("EPSG:4326");i.equals(e)||(t=this.clone().transform(e,i))}if(e=0,t.components&&1<t.components.length)for(var n,s=1,r=t.components.length;s<r;s++)i=t.components[s-1],n=t.components[s],e+=OpenLayers.Util.distVincenty({lon:i.x,lat:i.y},{lon:n.x,lat:n.y});return 1e3*e},CLASS_NAME:"OpenLayers.Geometry.Curve"}),OpenLayers.Geometry.LineString=OpenLayers.Class(OpenLayers.Geometry.Curve,{removeComponent:function(e){var t=this.components&&2<this.components.length;return t&&OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments),t},intersects:function(e){var t=!1,i=e.CLASS_NAME;if("OpenLayers.Geometry.LineString"==i||"OpenLayers.Geometry.LinearRing"==i||"OpenLayers.Geometry.Point"==i){var n=this.getSortedSegments();e="OpenLayers.Geometry.Point"==i?[{x1:e.x,y1:e.y,x2:e.x,y2:e.y}]:e.getSortedSegments();var s,r,a,o,l,h,u,p=0,c=n.length;e:for(;p<c;++p){i=n[p],s=i.x1,r=i.x2,a=i.y1,o=i.y2;for(var y=0,d=e.length;y<d&&(l=e[y],!(l.x1>r));++y)if(!(l.x2<s||(h=l.y1,u=l.y2,Math.min(h,u)>Math.max(a,o)||Math.max(h,u)<Math.min(a,o)||!OpenLayers.Geometry.segmentsIntersect(i,l)))){t=!0;break e}}}else t=e.intersects(this);return t},getSortedSegments:function(){for(var e,t,i=this.components.length-1,n=Array(i),s=0;s<i;++s)e=this.components[s],t=this.components[s+1],n[s]=e.x<t.x?{x1:e.x,y1:e.y,x2:t.x,y2:t.y}:{x1:t.x,y1:t.y,x2:e.x,y2:e.y};return n.sort(function(e,t){return e.x1-t.x1})},splitWithSegment:function(e,t){for(var i,n,s,r=!(t&&!1===t.edge),a=t&&t.tolerance,o=[],l=this.getVertices(),h=[],u=[],p=!1,c={point:!0,tolerance:a},y=null,d=0,m=l.length-2;d<=m;++d)a=l[d],h.push(a.clone()),i=l[d+1],n={x1:a.x,y1:a.y,x2:i.x,y2:i.y},n=OpenLayers.Geometry.segmentsIntersect(e,n,c),n instanceof OpenLayers.Geometry.Point&&((s=!!(n.x===e.x1&&n.y===e.y1||n.x===e.x2&&n.y===e.y2||n.equals(a)||n.equals(i)))||r)&&(n.equals(u[u.length-1])||u.push(n.clone()),0===d&&n.equals(a)||n.equals(i)||(p=!0,n.equals(a)||h.push(n),o.push(new OpenLayers.Geometry.LineString(h)),h=[n.clone()]));if(p&&(h.push(i.clone()),o.push(new OpenLayers.Geometry.LineString(h))),0<u.length)var f=e.x1<e.x2?1:-1,g=e.y1<e.y2?1:-1,y={lines:o,points:u.sort(function(e,t){return f*e.x-f*t.x||g*e.y-g*t.y})};return y},split:function(e,t){var i,n,s,r,a=null,o=t&&t.mutual;if(e instanceof OpenLayers.Geometry.LineString){var l,h,u,p,c,y=this.getVertices(),d=[];s=[];for(var m=0,f=y.length-2;m<=f;++m){l=y[m],h=y[m+1],u={x1:l.x,y1:l.y,x2:h.x,y2:h.y},r=r||[e],o&&d.push(l.clone());for(var g=0;g<r.length;++g)if((p=r[g].splitWithSegment(u,t))&&(c=p.lines,0<c.length&&(c.unshift(g,1),Array.prototype.splice.apply(r,c),g+=c.length-2),o))for(var v=0,L=p.points.length;v<L;++v)c=p.points[v],c.equals(l)||(d.push(c),s.push(new OpenLayers.Geometry.LineString(d)),d=c.equals(h)?[]:[c.clone()])}o&&0<s.length&&0<d.length&&(d.push(h.clone()),s.push(new OpenLayers.Geometry.LineString(d)))}else a=e.splitWith(this,t);return r&&1<r.length?n=!0:r=[],s&&1<s.length?i=!0:s=[],(n||i)&&(a=o?[s,r]:r),a},splitWith:function(e,t){return e.split(this,t)},getVertices:function(e){return!0===e?[this.components[0],this.components[this.components.length-1]]:!1===e?this.components.slice(1,this.components.length-1):this.components.slice()},distanceTo:function(e,t){var i,n=!(t&&!1===t.edge)&&t&&t.details,s={},r=Number.POSITIVE_INFINITY;if(e instanceof OpenLayers.Geometry.Point)for(var a,o=this.getSortedSegments(),l=e.x,h=e.y,u=0,p=o.length;u<p&&(a=o[u],i=OpenLayers.Geometry.distanceToSegment(e,a),!(i.distance<r&&(r=i.distance,s=n?{distance:r,x0:i.x,y0:i.y,x1:l,y1:h,index:u,indexDistance:new OpenLayers.Geometry.Point(a.x1,a.y1).distanceTo(e)}:r,0===r)));++u);else if(e instanceof OpenLayers.Geometry.LineString){var c,y,o=this.getSortedSegments(),l=e.getSortedSegments(),d=l.length,m={point:!0},u=0,p=o.length;e:for(;u<p;++u){h=o[u],a=h.x1,y=h.y1;for(var f=0;f<d;++f){if(i=l[f],c=OpenLayers.Geometry.segmentsIntersect(h,i,m)){r=0,s={distance:0,x0:c.x,y0:c.y,x1:c.x,y1:c.y};break e}i=OpenLayers.Geometry.distanceToSegment({x:a,y:y},i),i.distance<r&&(r=i.distance,s={distance:r,x0:a,y0:y,x1:i.x,y1:i.y})}}n||(s=s.distance),0!==r&&h&&(i=e.distanceTo(new OpenLayers.Geometry.Point(h.x2,h.y2),t),u=n?i.distance:i,u<r&&(s=n?{distance:r,x0:i.x1,y0:i.y1,x1:i.x0,y1:i.y0}:u))}else s=e.distanceTo(this,t),n&&(s={distance:s.distance,x0:s.x1,y0:s.y1,x1:s.x0,y1:s.y0});return s},simplify:function(e){if(this&&null!==this){var t=this.getVertices();if(3>t.length)return this;var i=function(e,t,n,r){for(var a,o=0,l=0,h=t;h<n;h++){a=e[t];var u=e[n],p=e[h];a=Math.abs(.5*(a.x*u.y+u.x*p.y+p.x*a.y-u.x*a.y-p.x*u.y-a.x*p.y))/Math.sqrt(Math.pow(a.x-u.x,2)+Math.pow(a.y-u.y,2))*2,a>o&&(o=a,l=h)}o>r&&l!=t&&(s.push(l),i(e,t,l,r),i(e,l,n,r))},n=t.length-1,s=[];for(s.push(0),s.push(n);t[0].equals(t[n]);)n--,s.push(n);for(i(t,0,n,e),e=[],s.sort(function(e,t){return e-t}),n=0;n<s.length;n++)e.push(t[s[n]]);return new OpenLayers.Geometry.LineString(e)}return this},CLASS_NAME:"OpenLayers.Geometry.LineString"}),OpenLayers.Geometry.LineString.geodesic=function(e,t,i){for(var n,s,r,a,o,l=[],h=e(0),u=e(1),p=t(h),c=t(u),y=[u,h],d=[c,p],m=[1,0],f={},g=1e5;0<--g&&0<m.length;)r=m.pop(),h=y.pop(),p=d.pop(),u=r.toString(),u in f||(l.push(p),f[u]=!0),a=m.pop(),u=y.pop(),c=d.pop(),o=(r+a)/2,n=e(o),s=t(n),OpenLayers.Geometry.distanceSquaredToSegment(s,{x1:p.x,y1:p.y,x2:c.x,y2:c.y}).distance<i?(l.push(c),u=a.toString(),f[u]=!0):(m.push(a,o,o,r),d.push(c,s,s,p),y.push(u,n,n,h));return new OpenLayers.Geometry.LineString(l)},OpenLayers.Geometry.LineString.geodesicMeridian=function(e,t,i,n,s){var r=new OpenLayers.Projection("EPSG:4326");return OpenLayers.Geometry.LineString.geodesic(function(n){return new OpenLayers.Geometry.Point(e,t+(i-t)*n)},function(e){return e.transform(r,n)},s)},OpenLayers.Geometry.LineString.geodesicParallel=function(e,t,i,n,s){var r=new OpenLayers.Projection("EPSG:4326");return OpenLayers.Geometry.LineString.geodesic(function(n){return new OpenLayers.Geometry.Point(t+(i-t)*n,e)},function(e){return e.transform(r,n)},s)},OpenLayers.Geometry.LinearRing=OpenLayers.Class(OpenLayers.Geometry.LineString,{componentTypes:["OpenLayers.Geometry.Point"],addComponent:function(e,t){var i=!1,n=this.components.pop();return null==t&&e.equals(n)||(i=OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,arguments)),OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[this.components[0]]),i},removeComponent:function(e){var t=this.components&&3<this.components.length;return t&&(this.components.pop(),OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments),OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[this.components[0]])),t},move:function(e,t){for(var i=0,n=this.components.length;i<n-1;i++)this.components[i].move(e,t)},rotate:function(e,t){for(var i=0,n=this.components.length;i<n-1;++i)this.components[i].rotate(e,t)},resize:function(e,t,i){for(var n=0,s=this.components.length;n<s-1;++n)this.components[n].resize(e,t,i);return this},transform:function(e,t){if(e&&t){for(var i=0,n=this.components.length;i<n-1;i++)this.components[i].transform(e,t);this.bounds=null}return this},getCentroid:function(){if(this.components){var e=this.components.length;if(0<e&&2>=e)return this.components[0].clone();if(2<e){var t=0,i=0,n=this.components[0].x,s=this.components[0].y,r=-1*this.getArea();if(0!=r){for(var a=0;a<e-1;a++)var o=this.components[a],l=this.components[a+1],t=t+(o.x+l.x-2*n)*((o.x-n)*(l.y-s)-(l.x-n)*(o.y-s)),i=i+(o.y+l.y-2*s)*((o.x-n)*(l.y-s)-(l.x-n)*(o.y-s));t=n+t/(6*r),e=s+i/(6*r)}else{for(a=0;a<e-1;a++)t+=this.components[a].x,i+=this.components[a].y;t/=e-1,e=i/(e-1)}return new OpenLayers.Geometry.Point(t,e)}return null}},getArea:function(){var e=0;if(this.components&&2<this.components.length){for(var t=e=0,i=this.components.length;t<i-1;t++)var n=this.components[t],s=this.components[t+1],e=e+(n.x+s.x)*(s.y-n.y);e=-e/2}return e},getGeodesicArea:function(e){var t=this;if(e){var i=new OpenLayers.Projection("EPSG:4326");i.equals(e)||(t=this.clone().transform(e,i))}if(e=0,i=t.components&&t.components.length,2<i){for(var n,s,r=0;r<i-1;r++)n=t.components[r],s=t.components[r+1],e+=OpenLayers.Util.rad(s.x-n.x)*(2+Math.sin(OpenLayers.Util.rad(n.y))+Math.sin(OpenLayers.Util.rad(s.y)));e=e*OpenLayers.Util.VincentyConstants.a*OpenLayers.Util.VincentyConstants.a/2}return e},containsPoint:function(e){var t=OpenLayers.Number.limitSigDigs,i=t(e.x,14);e=t(e.y,14);for(var n,s,r,a,o,l=this.components.length-1,h=0,u=0;u<l;++u)if(n=this.components[u],r=t(n.x,14),n=t(n.y,14),s=this.components[u+1],a=t(s.x,14),s=t(s.y,14),n==s){if(e==n&&(r<=a&&i>=r&&i<=a||r>=a&&i<=r&&i>=a)){h=-1;break}}else{if(o=t((a-r)/(s-n)*(e-s)+a,14),o==i&&(n<s&&e>=n&&e<=s||n>s&&e<=n&&e>=s)){h=-1;break}o<=i||r!=a&&(o<Math.min(r,a)||o>Math.max(r,a))||(n<s&&e>=n&&e<s||n>s&&e<n&&e>=s)&&++h}return-1==h?1:!!(1&h)},intersects:function(e){var t=!1;if("OpenLayers.Geometry.Point"==e.CLASS_NAME)t=this.containsPoint(e);else if("OpenLayers.Geometry.LineString"==e.CLASS_NAME)t=e.intersects(this);else if("OpenLayers.Geometry.LinearRing"==e.CLASS_NAME)t=OpenLayers.Geometry.LineString.prototype.intersects.apply(this,[e]);else for(var i=0,n=e.components.length;i<n&&!(t=e.components[i].intersects(this));++i);
return t},getVertices:function(e){return!0===e?[]:this.components.slice(0,this.components.length-1)},CLASS_NAME:"OpenLayers.Geometry.LinearRing"}),OpenLayers.Geometry.Polygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LinearRing"],getArea:function(){var e=0;if(this.components&&0<this.components.length)for(var e=e+Math.abs(this.components[0].getArea()),t=1,i=this.components.length;t<i;t++)e-=Math.abs(this.components[t].getArea());return e},getGeodesicArea:function(e){var t=0;if(this.components&&0<this.components.length)for(var t=t+Math.abs(this.components[0].getGeodesicArea(e)),i=1,n=this.components.length;i<n;i++)t-=Math.abs(this.components[i].getGeodesicArea(e));return t},containsPoint:function(e){var t=this.components.length,i=!1;if(0<t&&(i=this.components[0].containsPoint(e),1!==i&&i&&1<t))for(var n,s=1;s<t;++s)if(n=this.components[s].containsPoint(e)){i=1===n&&1;break}return i},intersects:function(e){var t,i,n=!1;if("OpenLayers.Geometry.Point"==e.CLASS_NAME)n=this.containsPoint(e);else if("OpenLayers.Geometry.LineString"==e.CLASS_NAME||"OpenLayers.Geometry.LinearRing"==e.CLASS_NAME){for(t=0,i=this.components.length;t<i&&!(n=e.intersects(this.components[t]));++t);if(!n)for(t=0,i=e.components.length;t<i&&!(n=this.containsPoint(e.components[t]));++t);}else for(t=0,i=e.components.length;t<i&&!(n=this.intersects(e.components[t]));++t);if(!n&&"OpenLayers.Geometry.Polygon"==e.CLASS_NAME){var s=this.components[0];for(t=0,i=s.components.length;t<i&&!(n=e.containsPoint(s.components[t]));++t);}return n},distanceTo:function(e,t){return t&&!1===t.edge&&this.intersects(e)?0:OpenLayers.Geometry.Collection.prototype.distanceTo.apply(this,[e,t])},CLASS_NAME:"OpenLayers.Geometry.Polygon"}),OpenLayers.Geometry.Polygon.createRegularPolygon=function(e,t,i,n){var s=Math.PI*(1/i-.5);n&&(s+=n/180*Math.PI);for(var r,a=[],o=0;o<i;++o)r=s+2*o*Math.PI/i,n=e.x+t*Math.cos(r),r=e.y+t*Math.sin(r),a.push(new OpenLayers.Geometry.Point(n,r));return e=new OpenLayers.Geometry.LinearRing(a),new OpenLayers.Geometry.Polygon([e])},OpenLayers.Geometry.MultiPolygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Polygon"],CLASS_NAME:"OpenLayers.Geometry.MultiPolygon"}),OpenLayers.Feature=OpenLayers.Class({layer:null,id:null,lonlat:null,data:null,marker:null,popupClass:null,popup:null,initialize:function(e,t,i){this.layer=e,this.lonlat=t,this.data=null!=i?i:{},this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){null!=this.layer&&null!=this.layer.map&&null!=this.popup&&this.layer.map.removePopup(this.popup),null!=this.layer&&null!=this.marker&&this.layer.removeMarker(this.marker),this.data=this.lonlat=this.id=this.layer=null,null!=this.marker&&(this.destroyMarker(this.marker),this.marker=null),null!=this.popup&&(this.destroyPopup(this.popup),this.popup=null)},onScreen:function(){var e=!1;return null!=this.layer&&null!=this.layer.map&&(e=this.layer.map.getExtent().containsLonLat(this.lonlat)),e},createMarker:function(){return null!=this.lonlat&&(this.marker=new OpenLayers.Marker(this.lonlat,this.data.icon)),this.marker},destroyMarker:function(){this.marker.destroy()},createPopup:function(e){return null!=this.lonlat&&(this.popup||(this.popup=new(this.popupClass?this.popupClass:OpenLayers.Popup.Anchored)(this.id+"_popup",this.lonlat,this.data.popupSize,this.data.popupContentHTML,this.marker?this.marker.icon:null,e)),null!=this.data.overflow&&(this.popup.contentDiv.style.overflow=this.data.overflow),this.popup.feature=this),this.popup},destroyPopup:function(){this.popup&&(this.popup.feature=null,this.popup.destroy(),this.popup=null)},CLASS_NAME:"OpenLayers.Feature"}),OpenLayers.State={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"},OpenLayers.Feature.Vector=OpenLayers.Class(OpenLayers.Feature,{fid:null,geometry:null,attributes:null,bounds:null,state:null,style:null,url:null,renderIntent:"default",modified:null,initialize:function(e,t,i){OpenLayers.Feature.prototype.initialize.apply(this,[null,null,t]),this.lonlat=null,this.geometry=e?e:null,this.state=null,this.attributes={},t&&(this.attributes=OpenLayers.Util.extend(this.attributes,t)),this.style=i?i:null},destroy:function(){this.layer&&(this.layer.removeFeatures(this),this.layer=null),this.modified=this.geometry=null,OpenLayers.Feature.prototype.destroy.apply(this,arguments)},clone:function(){return new OpenLayers.Feature.Vector(this.geometry?this.geometry.clone():null,this.attributes,this.style)},onScreen:function(e){var t=!1;return this.layer&&this.layer.map&&(t=this.layer.map.getExtent(),e?(e=this.geometry.getBounds(),t=t.intersectsBounds(e)):t=t.toGeometry().intersects(this.geometry)),t},getVisibility:function(){return!(this.style&&"none"==this.style.display||!this.layer||this.layer&&this.layer.styleMap&&"none"==this.layer.styleMap.createSymbolizer(this,this.renderIntent).display||this.layer&&!this.layer.getVisibility())},createMarker:function(){return null},destroyMarker:function(){},createPopup:function(){return null},atPoint:function(e,t,i){var n=!1;return this.geometry&&(n=this.geometry.atPoint(e,t,i)),n},destroyPopup:function(){},move:function(e){if(this.layer&&this.geometry.move){e="OpenLayers.LonLat"==e.CLASS_NAME?this.layer.getViewPortPxFromLonLat(e):e;var t=this.layer.getViewPortPxFromLonLat(this.geometry.getBounds().getCenterLonLat()),i=this.layer.map.getResolution();return this.geometry.move(i*(e.x-t.x),i*(t.y-e.y)),this.layer.drawFeature(this),t}},toState:function(e){if(e==OpenLayers.State.UPDATE)switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.DELETE:this.state=e}else if(e==OpenLayers.State.INSERT)switch(this.state){case OpenLayers.State.UNKNOWN:break;default:this.state=e}else if(e==OpenLayers.State.DELETE)switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.UPDATE:this.state=e}else e==OpenLayers.State.UNKNOWN&&(this.state=e)},CLASS_NAME:"OpenLayers.Feature.Vector"}),OpenLayers.Feature.Vector.style={default:{fillColor:"#ee9900",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},select:{fillColor:"blue",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},temporary:{fillColor:"#66cccc",fillOpacity:.2,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#66cccc",strokeOpacity:1,strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},delete:{display:"none"}},OpenLayers.Style=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:!1,rules:null,context:null,defaultStyle:null,defaultsPerSymbolizer:!1,propertyStyles:null,initialize:function(e,t){OpenLayers.Util.extend(this,t),this.rules=[],t&&t.rules&&this.addRules(t.rules),this.setDefaultStyle(e||OpenLayers.Feature.Vector.style.default),this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var e=0,t=this.rules.length;e<t;e++)this.rules[e].destroy(),this.rules[e]=null;this.defaultStyle=this.rules=null},createSymbolizer:function(e){for(var t,i=this.defaultsPerSymbolizer?{}:this.createLiterals(OpenLayers.Util.extend({},this.defaultStyle),e),n=this.rules,s=[],r=!1,a=0,o=n.length;a<o;a++)t=n[a],t.evaluate(e)&&(t instanceof OpenLayers.Rule&&t.elseFilter?s.push(t):(r=!0,this.applySymbolizer(t,i,e)));if(0==r&&0<s.length)for(r=!0,a=0,o=s.length;a<o;a++)this.applySymbolizer(s[a],i,e);return 0<n.length&&0==r&&(i.display="none"),null!=i.label&&"string"!=typeof i.label&&(i.label=String(i.label)),i},applySymbolizer:function(e,t,i){var n=i.geometry?this.getSymbolizerPrefix(i.geometry):OpenLayers.Style.SYMBOLIZER_PREFIXES[0];return e=e.symbolizer[n]||e.symbolizer,!0===this.defaultsPerSymbolizer&&(n=this.defaultStyle,OpenLayers.Util.applyDefaults(e,{pointRadius:n.pointRadius}),!0!==e.stroke&&!0!==e.graphic||OpenLayers.Util.applyDefaults(e,{strokeWidth:n.strokeWidth,strokeColor:n.strokeColor,strokeOpacity:n.strokeOpacity,strokeDashstyle:n.strokeDashstyle,strokeLinecap:n.strokeLinecap}),!0!==e.fill&&!0!==e.graphic||OpenLayers.Util.applyDefaults(e,{fillColor:n.fillColor,fillOpacity:n.fillOpacity}),!0===e.graphic&&OpenLayers.Util.applyDefaults(e,{pointRadius:this.defaultStyle.pointRadius,externalGraphic:this.defaultStyle.externalGraphic,graphicName:this.defaultStyle.graphicName,graphicOpacity:this.defaultStyle.graphicOpacity,graphicWidth:this.defaultStyle.graphicWidth,graphicHeight:this.defaultStyle.graphicHeight,graphicXOffset:this.defaultStyle.graphicXOffset,graphicYOffset:this.defaultStyle.graphicYOffset})),this.createLiterals(OpenLayers.Util.extend(t,e),i)},createLiterals:function(e,t){var i=OpenLayers.Util.extend({},t.attributes||t.data);OpenLayers.Util.extend(i,this.context);for(var n in this.propertyStyles)e[n]=OpenLayers.Style.createLiteral(e[n],i,t,n);return e},findPropertyStyles:function(){var e={};this.addPropertyStyles(e,this.defaultStyle);for(var t,i,n=this.rules,s=0,r=n.length;s<r;s++){t=n[s].symbolizer;for(var a in t){if(i=t[a],"object"!=typeof i){this.addPropertyStyles(e,t);break}this.addPropertyStyles(e,i)}}return e},addPropertyStyles:function(e,t){var i,n;for(n in t)i=t[n],"string"==typeof i&&i.match(/\$\{\w+\}/)&&(e[n]=!0);return e},addRules:function(e){Array.prototype.push.apply(this.rules,e),this.propertyStyles=this.findPropertyStyles()},setDefaultStyle:function(e){this.defaultStyle=e,this.propertyStyles=this.findPropertyStyles()},getSymbolizerPrefix:function(e){for(var t=OpenLayers.Style.SYMBOLIZER_PREFIXES,i=0,n=t.length;i<n;i++)if(-1!=e.CLASS_NAME.indexOf(t[i]))return t[i]},clone:function(){var e=OpenLayers.Util.extend({},this);if(this.rules){e.rules=[];for(var t=0,i=this.rules.length;t<i;++t)e.rules.push(this.rules[t].clone())}return e.context=this.context&&OpenLayers.Util.extend({},this.context),t=OpenLayers.Util.extend({},this.defaultStyle),new OpenLayers.Style(t,e)},CLASS_NAME:"OpenLayers.Style"}),OpenLayers.Style.createLiteral=function(e,t,i,n){return"string"==typeof e&&-1!=e.indexOf("${")&&(e=OpenLayers.String.format(e,t,[i,n]),e=isNaN(e)||!e?e:parseFloat(e)),e},OpenLayers.Style.SYMBOLIZER_PREFIXES=["Point","Line","Polygon","Text","Raster"],OpenLayers.StyleMap=OpenLayers.Class({styles:null,extendDefault:!0,initialize:function(e,t){if(this.styles={default:new OpenLayers.Style(OpenLayers.Feature.Vector.style.default),select:new OpenLayers.Style(OpenLayers.Feature.Vector.style.select),temporary:new OpenLayers.Style(OpenLayers.Feature.Vector.style.temporary),delete:new OpenLayers.Style(OpenLayers.Feature.Vector.style.delete)},e instanceof OpenLayers.Style)this.styles.default=e,this.styles.select=e,this.styles.temporary=e,this.styles.delete=e;else if("object"==typeof e)for(var i in e)if(e[i]instanceof OpenLayers.Style)this.styles[i]=e[i];else{if("object"!=typeof e[i]){this.styles.default=new OpenLayers.Style(e),this.styles.select=new OpenLayers.Style(e),this.styles.temporary=new OpenLayers.Style(e),this.styles.delete=new OpenLayers.Style(e);break}this.styles[i]=new OpenLayers.Style(e[i])}OpenLayers.Util.extend(this,t)},destroy:function(){for(var e in this.styles)this.styles[e].destroy();this.styles=null},createSymbolizer:function(e,t){e||(e=new OpenLayers.Feature.Vector),this.styles[t]||(t="default"),e.renderIntent=t;var i={};return this.extendDefault&&"default"!=t&&(i=this.styles.default.createSymbolizer(e)),OpenLayers.Util.extend(i,this.styles[t].createSymbolizer(e))},addUniqueValueRules:function(e,t,i,n){var s,r=[];for(s in i)r.push(new OpenLayers.Rule({symbolizer:i[s],context:n,filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:t,value:s})}));this.styles[e].addRules(r)},CLASS_NAME:"OpenLayers.StyleMap"}),OpenLayers.Layer.Vector=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,isFixed:!1,features:null,filter:null,selectedFeatures:null,unrenderedFeatures:null,reportError:!0,style:null,styleMap:null,strategies:null,protocol:null,renderers:["SVG","VML","Canvas"],renderer:null,rendererOptions:null,geometryType:null,drawn:!1,ratio:1,initialize:function(e,t){if(OpenLayers.Layer.prototype.initialize.apply(this,arguments),this.renderer&&this.renderer.supported()||this.assignRenderer(),this.renderer&&this.renderer.supported()||(this.renderer=null,this.displayError()),this.styleMap||(this.styleMap=new OpenLayers.StyleMap),this.features=[],this.selectedFeatures=[],this.unrenderedFeatures={},this.strategies)for(var i=0,n=this.strategies.length;i<n;i++)this.strategies[i].setLayer(this)},destroy:function(){if(this.strategies){var e,t,i;for(t=0,i=this.strategies.length;t<i;t++)e=this.strategies[t],e.autoDestroy&&e.destroy();this.strategies=null}this.protocol&&(this.protocol.autoDestroy&&this.protocol.destroy(),this.protocol=null),this.destroyFeatures(),this.unrenderedFeatures=this.selectedFeatures=this.features=null,this.renderer&&this.renderer.destroy(),this.drawn=this.geometryType=this.renderer=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(e){null==e&&(e=new OpenLayers.Layer.Vector(this.name,this.getOptions())),e=OpenLayers.Layer.prototype.clone.apply(this,[e]);for(var t=this.features,i=t.length,n=Array(i),s=0;s<i;++s)n[s]=t[s].clone();return e.features=n,e},refresh:function(e){this.calculateInRange()&&this.visibility&&this.events.triggerEvent("refresh",e)},assignRenderer:function(){for(var e=0,t=this.renderers.length;e<t;e++){var i=this.renderers[e];if((i="function"==typeof i?i:OpenLayers.Renderer[i])&&i.prototype.supported()){this.renderer=new i(this.div,this.rendererOptions);break}}},displayError:function(){this.reportError&&OpenLayers.Console.userError(OpenLayers.i18n("browserNotSupported",{renderers:this.renderers.join("\n")}))},setMap:function(e){if(OpenLayers.Layer.prototype.setMap.apply(this,arguments),this.renderer){this.renderer.map=this.map;var t=this.map.getSize();t.w*=this.ratio,t.h*=this.ratio,this.renderer.setSize(t)}else this.map.removeLayer(this)},afterAdd:function(){if(this.strategies){var e,t,i;for(t=0,i=this.strategies.length;t<i;t++)e=this.strategies[t],e.autoActivate&&e.activate()}},removeMap:function(e){if(this.drawn=!1,this.strategies){var t,i;for(t=0,i=this.strategies.length;t<i;t++)e=this.strategies[t],e.autoActivate&&e.deactivate()}},onMapResize:function(){OpenLayers.Layer.prototype.onMapResize.apply(this,arguments);var e=this.map.getSize();e.w*=this.ratio,e.h*=this.ratio,this.renderer.setSize(e)},moveTo:function(e,t,i){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var n=!0;if(!i){this.renderer.root.style.visibility="hidden";var n=this.map.getSize(),s=n.w,n=n.h,s=s/2*this.ratio-s/2,n=n/2*this.ratio-n/2,s=s+this.map.layerContainerOriginPx.x,s=-Math.round(s),n=n+this.map.layerContainerOriginPx.y,n=-Math.round(n);if(this.div.style.left=s+"px",this.div.style.top=n+"px",s=this.map.getExtent().scale(this.ratio),n=this.renderer.setExtent(s,t),this.renderer.root.style.visibility="visible",!0===OpenLayers.IS_GECKO&&(this.div.scrollLeft=this.div.scrollLeft),!t&&n)for(var r in this.unrenderedFeatures)s=this.unrenderedFeatures[r],this.drawFeature(s)}if(!this.drawn||t||!n)for(this.drawn=!0,r=0,n=this.features.length;r<n;r++)this.renderer.locked=r!==n-1,s=this.features[r],this.drawFeature(s)},display:function(e){OpenLayers.Layer.prototype.display.apply(this,arguments);var t=this.div.style.display;t!=this.renderer.root.style.display&&(this.renderer.root.style.display=t)},addFeatures:function(e,t){OpenLayers.Util.isArray(e)||(e=[e]);var i=!t||!t.silent;if(i){var n={features:e};if(!1===this.events.triggerEvent("beforefeaturesadded",n))return;e=n.features}for(var n=[],s=0,r=e.length;s<r;s++){this.renderer.locked=s!=e.length-1;var a=e[s];if(this.geometryType&&!(a.geometry instanceof this.geometryType))throw new TypeError("addFeatures: component should be an "+this.geometryType.prototype.CLASS_NAME);if(a.layer=this,!a.style&&this.style&&(a.style=OpenLayers.Util.extend({},this.style)),i){if(!1===this.events.triggerEvent("beforefeatureadded",{feature:a}))continue;this.preFeatureInsert(a)}n.push(a),this.features.push(a),this.drawFeature(a),i&&(this.events.triggerEvent("featureadded",{feature:a}),this.onFeatureInsert(a))}i&&this.events.triggerEvent("featuresadded",{features:n})},removeFeatures:function(e,t){if(e&&0!==e.length){if(e===this.features)return this.removeAllFeatures(t);OpenLayers.Util.isArray(e)||(e=[e]),e===this.selectedFeatures&&(e=e.slice());var i=!t||!t.silent;i&&this.events.triggerEvent("beforefeaturesremoved",{features:e});for(var n=e.length-1;0<=n;n--){this.renderer.locked=!(0==n||!e[n-1].geometry);var s=e[n];delete this.unrenderedFeatures[s.id],i&&this.events.triggerEvent("beforefeatureremoved",{feature:s}),this.features=OpenLayers.Util.removeItem(this.features,s),s.layer=null,s.geometry&&this.renderer.eraseFeatures(s),-1!=OpenLayers.Util.indexOf(this.selectedFeatures,s)&&OpenLayers.Util.removeItem(this.selectedFeatures,s),i&&this.events.triggerEvent("featureremoved",{feature:s})}i&&this.events.triggerEvent("featuresremoved",{features:e})}},removeAllFeatures:function(e){e=!e||!e.silent;var t=this.features;e&&this.events.triggerEvent("beforefeaturesremoved",{features:t});for(var i,n=t.length-1;0<=n;n--)i=t[n],e&&this.events.triggerEvent("beforefeatureremoved",{feature:i}),i.layer=null,e&&this.events.triggerEvent("featureremoved",{feature:i});this.renderer.clear(),this.features=[],this.unrenderedFeatures={},this.selectedFeatures=[],e&&this.events.triggerEvent("featuresremoved",{features:t})},destroyFeatures:function(e,t){if(void 0==e&&(e=this.features),e){this.removeFeatures(e,t);for(var i=e.length-1;0<=i;i--)e[i].destroy()}},drawFeature:function(e,t){if(this.drawn){if("object"!=typeof t){t||e.state!==OpenLayers.State.DELETE||(t="delete");var i=t||e.renderIntent;(t=e.style||this.style)||(t=this.styleMap.createSymbolizer(e,i))}i=this.renderer.drawFeature(e,t),!1===i||null===i?this.unrenderedFeatures[e.id]=e:delete this.unrenderedFeatures[e.id]}},eraseFeatures:function(e){this.renderer.eraseFeatures(e)},getFeatureFromEvent:function(e){if(!this.renderer)throw Error("getFeatureFromEvent called on layer with no renderer. This usually means you destroyed a layer, but not some handler which is associated with it.");var t=null;return(e=this.renderer.getFeatureIdFromEvent(e))&&(t="string"==typeof e?this.getFeatureById(e):e),t},getFeatureBy:function(e,t){for(var i=null,n=0,s=this.features.length;n<s;++n)if(this.features[n][e]==t){i=this.features[n];break}return i},getFeatureById:function(e){return this.getFeatureBy("id",e)},getFeatureByFid:function(e){return this.getFeatureBy("fid",e)},getFeaturesByAttribute:function(e,t){var i,n,s=this.features.length,r=[];for(i=0;i<s;i++)(n=this.features[i])&&n.attributes&&n.attributes[e]===t&&r.push(n);return r},onFeatureInsert:function(e){},preFeatureInsert:function(e){},getDataExtent:function(){var e=null,t=this.features;if(t&&0<t.length)for(var i,n=0,s=t.length;n<s;n++)(i=t[n].geometry)&&(null===e&&(e=new OpenLayers.Bounds),e.extend(i.getBounds()));return e},CLASS_NAME:"OpenLayers.Layer.Vector"}),OpenLayers.Layer.Markers=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,markers:null,drawn:!1,initialize:function(e,t){OpenLayers.Layer.prototype.initialize.apply(this,arguments),this.markers=[]},destroy:function(){this.clearMarkers(),this.markers=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setOpacity:function(e){if(e!=this.opacity){this.opacity=e,e=0;for(var t=this.markers.length;e<t;e++)this.markers[e].setOpacity(this.opacity)}},moveTo:function(e,t,i){if(OpenLayers.Layer.prototype.moveTo.apply(this,arguments),t||!this.drawn){for(var n=0,s=this.markers.length;n<s;n++)this.drawMarker(this.markers[n]);this.drawn=!0}},addMarker:function(e){this.markers.push(e),1>this.opacity&&e.setOpacity(this.opacity),this.map&&this.map.getExtent()&&(e.map=this.map,this.drawMarker(e))},removeMarker:function(e){this.markers&&this.markers.length&&(OpenLayers.Util.removeItem(this.markers,e),e.erase())},clearMarkers:function(){if(null!=this.markers)for(;0<this.markers.length;)this.removeMarker(this.markers[0])},drawMarker:function(e){var t=this.map.getLayerPxFromLonLat(e.lonlat);null==t?e.display(!1):e.isDrawn()?e.icon&&e.icon.moveTo(t):(e=e.draw(t),this.div.appendChild(e))},getDataExtent:function(){var e=null;if(this.markers&&0<this.markers.length)for(var e=new OpenLayers.Bounds,t=0,i=this.markers.length;t<i;t++)e.extend(this.markers[t].lonlat);return e},CLASS_NAME:"OpenLayers.Layer.Markers"}),OpenLayers.Layer.Zoomify=OpenLayers.Class(OpenLayers.Layer.Grid,{size:null,isBaseLayer:!0,standardTileSize:256,tileOriginCorner:"tl",numberOfTiers:0,tileCountUpToTier:null,tierSizeInTiles:null,tierImageSize:null,initialize:function(e,t,i,n){this.initializeZoomify(i),OpenLayers.Layer.Grid.prototype.initialize.apply(this,[e,t,{},n])},initializeZoomify:function(e){var t=e.clone();for(this.size=e.clone(),e=new OpenLayers.Size(Math.ceil(t.w/this.standardTileSize),Math.ceil(t.h/this.standardTileSize)),this.tierSizeInTiles=[e],this.tierImageSize=[t];t.w>this.standardTileSize||t.h>this.standardTileSize;)t=new OpenLayers.Size(Math.floor(t.w/2),Math.floor(t.h/2)),e=new OpenLayers.Size(Math.ceil(t.w/this.standardTileSize),Math.ceil(t.h/this.standardTileSize)),this.tierSizeInTiles.push(e),this.tierImageSize.push(t);for(this.tierSizeInTiles.reverse(),this.tierImageSize.reverse(),this.numberOfTiers=this.tierSizeInTiles.length,t=[1],this.tileCountUpToTier=[0],e=1;e<this.numberOfTiers;e++)t.unshift(Math.pow(2,e)),this.tileCountUpToTier.push(this.tierSizeInTiles[e-1].w*this.tierSizeInTiles[e-1].h+this.tileCountUpToTier[e-1]);this.serverResolutions||(this.serverResolutions=t)},destroy:function(){OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments),this.tileCountUpToTier.length=0,this.tierSizeInTiles.length=0,this.tierImageSize.length=0},clone:function(e){return null==e&&(e=new OpenLayers.Layer.Zoomify(this.name,this.url,this.size,this.options)),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},createBackBuffer:function(){var e=OpenLayers.Layer.Grid.prototype.createBackBuffer.apply(this,arguments);if(e)for(var t,i=e.childNodes.length-1;0<=i;--i)t=e.childNodes[i],t._w=t.width,t._h=t.height;return e},getURL:function(e){e=this.adjustBounds(e);var t=this.getServerResolution(),i=Math.round((e.left-this.tileOrigin.lon)/(t*this.tileSize.w));return e=Math.round((this.tileOrigin.lat-e.top)/(t*this.tileSize.h)),t=this.getZoomForResolution(t),i="TileGroup"+Math.floor((i+e*this.tierSizeInTiles[t].w+this.tileCountUpToTier[t])/256)+"/"+t+"-"+i+"-"+e+".jpg",t=this.url,OpenLayers.Util.isArray(t)&&(t=this.selectUrl(i,t)),t+i},getImageSize:function(){if(0<arguments.length){var e=this.adjustBounds(arguments[0]),t=this.getServerResolution(),i=Math.round((e.left-this.tileOrigin.lon)/(t*this.tileSize.w)),e=Math.round((this.tileOrigin.lat-e.top)/(t*this.tileSize.h)),t=this.getZoomForResolution(t),n=this.standardTileSize,s=this.standardTileSize;return i==this.tierSizeInTiles[t].w-1&&(n=this.tierImageSize[t].w%this.standardTileSize,0==n&&(n=this.standardTileSize)),e==this.tierSizeInTiles[t].h-1&&(s=this.tierImageSize[t].h%this.standardTileSize,0==s&&(s=this.standardTileSize)),i==this.tierSizeInTiles[t].w&&(n=Math.ceil(this.size.w/Math.pow(2,this.numberOfTiers-1-t)-this.tierImageSize[t].w)),e==this.tierSizeInTiles[t].h&&(s=Math.ceil(this.size.h/Math.pow(2,this.numberOfTiers-1-t)-this.tierImageSize[t].h)),new OpenLayers.Size(n,s)}return this.tileSize},setMap:function(e){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.top)},CLASS_NAME:"OpenLayers.Layer.Zoomify"}),OpenLayers.Layer.TMS=OpenLayers.Class(OpenLayers.Layer.Grid,{serviceVersion:"1.0.0",layername:null,type:null,isBaseLayer:!0,tileOrigin:null,serverResolutions:null,zoomOffset:0,initialize:function(e,t,i){var n=[];n.push(e,t,{},i),OpenLayers.Layer.Grid.prototype.initialize.apply(this,n)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.TMS(this.name,this.url,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},getURL:function(e){e=this.adjustBounds(e);var t=this.getServerResolution(),i=Math.round((e.left-this.tileOrigin.lon)/(t*this.tileSize.w));return e=Math.round((e.bottom-this.tileOrigin.lat)/(t*this.tileSize.h)),t=this.getServerZoom(),i=this.serviceVersion+"/"+this.layername+"/"+t+"/"+i+"/"+e+"."+this.type,e=this.url,OpenLayers.Util.isArray(e)&&(e=this.selectUrl(i,e)),e+i},setMap:function(e){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.bottom))},CLASS_NAME:"OpenLayers.Layer.TMS"}),OpenLayers.Format=OpenLayers.Class({options:null,externalProjection:null,internalProjection:null,data:null,keepData:!1,initialize:function(e){OpenLayers.Util.extend(this,e),this.options=e},destroy:function(){},read:function(e){throw Error("Read not implemented.")},write:function(e){throw Error("Write not implemented.")},CLASS_NAME:"OpenLayers.Format"}),OpenLayers.Format.JSON=OpenLayers.Class(OpenLayers.Format,{indent:"    ",space:" ",newline:"\n",level:0,pretty:!1,nativeJSON:function(){return!(!window.JSON||"function"!=typeof JSON.parse||"function"!=typeof JSON.stringify)}(),read:function(a,b){var c;if(this.nativeJSON)c=JSON.parse(a,b);else try{if(/^[\],:{}\s]*$/.test(a.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))&&(c=eval("("+a+")"),"function"==typeof b)){var d=function(e,t){if(t&&"object"==typeof t)for(var i in t)t.hasOwnProperty(i)&&(t[i]=d(i,t[i]));return b(e,t)};c=d("",c)}}catch(e){}return this.keepData&&(this.data=c),c},write:function(e,t){this.pretty=!!t;var i=null,n=typeof e;if(this.serialize[n])try{i=!this.pretty&&this.nativeJSON?JSON.stringify(e):this.serialize[n].apply(this,[e])}catch(e){OpenLayers.Console.error("Trouble serializing: "+e)}return i},writeIndent:function(){var e=[];if(this.pretty)for(var t=0;t<this.level;++t)e.push(this.indent);return e.join("")},writeNewline:function(){return this.pretty?this.newline:""},writeSpace:function(){return this.pretty?this.space:""},serialize:{object:function(e){if(null==e)return"null";if(e.constructor==Date)return this.serialize.date.apply(this,[e]);if(e.constructor==Array)return this.serialize.array.apply(this,[e]);var t=["{"];this.level+=1;var i,n,s,r=!1;for(i in e)e.hasOwnProperty(i)&&(n=OpenLayers.Format.JSON.prototype.write.apply(this,[i,this.pretty]),s=OpenLayers.Format.JSON.prototype.write.apply(this,[e[i],this.pretty]),null!=n&&null!=s&&(r&&t.push(","),t.push(this.writeNewline(),this.writeIndent(),n,":",this.writeSpace(),s),r=!0));return--this.level,t.push(this.writeNewline(),this.writeIndent(),"}"),t.join("")},array:function(e){var t,i=["["];this.level+=1;for(var n=0,s=e.length;n<s;++n)t=OpenLayers.Format.JSON.prototype.write.apply(this,[e[n],this.pretty]),null!=t&&(0<n&&i.push(","),i.push(this.writeNewline(),this.writeIndent(),t));return--this.level,i.push(this.writeNewline(),this.writeIndent(),"]"),i.join("")},string:function(e){var t={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return/["\\\x00-\x1f]/.test(e)?'"'+e.replace(/([\x00-\x1f\\"])/g,function(e,i){var n=t[i];return n?n:(n=i.charCodeAt(),"\\u00"+Math.floor(n/16).toString(16)+(n%16).toString(16))})+'"':'"'+e+'"'},number:function(e){return isFinite(e)?String(e):"null"},boolean:function(e){return String(e)},date:function(e){function t(e){return 10>e?"0"+e:e}return'"'+e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+"T"+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())+'"'}},CLASS_NAME:"OpenLayers.Format.JSON"}),OpenLayers.Geometry.MultiLineString=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LineString"],split:function(e,t){for(var i,n,s,r,a=null,o=t&&t.mutual,l=[],h=[e],u=0,p=this.components.length;u<p;++u){n=this.components[u],s=!1;for(var c=0;c<h.length;++c)if(i=n.split(h[c],t)){if(o){s=i[0];for(var y=0,d=s.length;y<d;++y)0===y&&l.length?l[l.length-1].addComponent(s[y]):l.push(new OpenLayers.Geometry.MultiLineString([s[y]]));s=!0,i=i[1]}if(i.length){i.unshift(c,1),Array.prototype.splice.apply(h,i);break}}s||(l.length?l[l.length-1].addComponent(n.clone()):l=[new OpenLayers.Geometry.MultiLineString(n.clone())])}return l&&1<l.length?s=!0:l=[],h&&1<h.length?r=!0:h=[],(s||r)&&(a=o?[l,h]:h),a},splitWith:function(e,t){var i,n,s,r,a,o,l=null,h=t&&t.mutual;if(e instanceof OpenLayers.Geometry.LineString){o=[],a=[e];for(var u=0,p=this.components.length;u<p;++u){s=!1,n=this.components[u];for(var c=0;c<a.length;++c)if(i=a[c].split(n,t)){h&&(s=i[0],s.length&&(s.unshift(c,1),Array.prototype.splice.apply(a,s),c+=s.length-2),i=i[1],0===i.length&&(i=[n.clone()])),s=0;for(var y=i.length;s<y;++s)0===s&&o.length?o[o.length-1].addComponent(i[s]):o.push(new OpenLayers.Geometry.MultiLineString([i[s]]));s=!0}s||(o.length?o[o.length-1].addComponent(n.clone()):o=[new OpenLayers.Geometry.MultiLineString([n.clone()])])}}else l=e.split(this);return a&&1<a.length?r=!0:a=[],o&&1<o.length?s=!0:o=[],(r||s)&&(l=h?[a,o]:o),l},CLASS_NAME:"OpenLayers.Geometry.MultiLineString"}),OpenLayers.Format.GeoJSON=OpenLayers.Class(OpenLayers.Format.JSON,{ignoreExtraDims:!1,read:function(e,t,i){t=t?t:"FeatureCollection";var n=null;if(i="string"==typeof e?OpenLayers.Format.JSON.prototype.read.apply(this,[e,i]):e){if("string"!=typeof i.type)OpenLayers.Console.error("Bad GeoJSON - no type: "+e);else if(this.isValidType(i,t))switch(t){case"Geometry":try{n=this.parseGeometry(i)}catch(e){OpenLayers.Console.error(e)}break;case"Feature":try{n=this.parseFeature(i),n.type="Feature"}catch(e){OpenLayers.Console.error(e)}break;case"FeatureCollection":switch(n=[],i.type){case"Feature":try{n.push(this.parseFeature(i))}catch(e){n=null,OpenLayers.Console.error(e)}break;case"FeatureCollection":for(e=0,t=i.features.length;e<t;++e)try{n.push(this.parseFeature(i.features[e]))}catch(e){n=null,OpenLayers.Console.error(e)}break;default:try{var s=this.parseGeometry(i);n.push(new OpenLayers.Feature.Vector(s))}catch(e){n=null,OpenLayers.Console.error(e)}}}}else OpenLayers.Console.error("Bad JSON: "+e);return n},isValidType:function(e,t){var i=!1;switch(t){case"Geometry":-1==OpenLayers.Util.indexOf("Point MultiPoint LineString MultiLineString Polygon MultiPolygon Box GeometryCollection".split(" "),e.type)?OpenLayers.Console.error("Unsupported geometry type: "+e.type):i=!0;break;case"FeatureCollection":i=!0;break;default:e.type==t?i=!0:OpenLayers.Console.error("Cannot convert types from "+e.type+" to "+t)}return i},parseFeature:function(e){var t,i,n;i=e.properties?e.properties:{},n=e.geometry&&e.geometry.bbox||e.bbox;try{t=this.parseGeometry(e.geometry)}catch(e){throw e}return t=new OpenLayers.Feature.Vector(t,i),n&&(t.bounds=OpenLayers.Bounds.fromArray(n)),e.id&&(t.fid=e.id),t},parseGeometry:function(e){if(null==e)return null;var t,i=!1;if("GeometryCollection"==e.type){if(!OpenLayers.Util.isArray(e.geometries))throw"GeometryCollection must have geometries array: "+e;t=e.geometries.length;for(var i=Array(t),n=0;n<t;++n)i[n]=this.parseGeometry.apply(this,[e.geometries[n]]);
t=new OpenLayers.Geometry.Collection(i),i=!0}else{if(!OpenLayers.Util.isArray(e.coordinates))throw"Geometry must have coordinates array: "+e;if(!this.parseCoords[e.type.toLowerCase()])throw"Unsupported geometry type: "+e.type;try{t=this.parseCoords[e.type.toLowerCase()].apply(this,[e.coordinates])}catch(e){throw e}}return this.internalProjection&&this.externalProjection&&!i&&t.transform(this.externalProjection,this.internalProjection),t},parseCoords:{point:function(e){if(0==this.ignoreExtraDims&&2!=e.length)throw"Only 2D points are supported: "+e;return new OpenLayers.Geometry.Point(e[0],e[1])},multipoint:function(e){for(var t=[],i=null,n=0,s=e.length;n<s;++n){try{i=this.parseCoords.point.apply(this,[e[n]])}catch(e){throw e}t.push(i)}return new OpenLayers.Geometry.MultiPoint(t)},linestring:function(e){for(var t=[],i=null,n=0,s=e.length;n<s;++n){try{i=this.parseCoords.point.apply(this,[e[n]])}catch(e){throw e}t.push(i)}return new OpenLayers.Geometry.LineString(t)},multilinestring:function(e){for(var t=[],i=null,n=0,s=e.length;n<s;++n){try{i=this.parseCoords.linestring.apply(this,[e[n]])}catch(e){throw e}t.push(i)}return new OpenLayers.Geometry.MultiLineString(t)},polygon:function(e){for(var t,i,n=[],s=0,r=e.length;s<r;++s){try{i=this.parseCoords.linestring.apply(this,[e[s]])}catch(e){throw e}t=new OpenLayers.Geometry.LinearRing(i.components),n.push(t)}return new OpenLayers.Geometry.Polygon(n)},multipolygon:function(e){for(var t=[],i=null,n=0,s=e.length;n<s;++n){try{i=this.parseCoords.polygon.apply(this,[e[n]])}catch(e){throw e}t.push(i)}return new OpenLayers.Geometry.MultiPolygon(t)},box:function(e){if(2!=e.length)throw"GeoJSON box coordinates must have 2 elements";return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(e[0][0],e[0][1]),new OpenLayers.Geometry.Point(e[1][0],e[0][1]),new OpenLayers.Geometry.Point(e[1][0],e[1][1]),new OpenLayers.Geometry.Point(e[0][0],e[1][1]),new OpenLayers.Geometry.Point(e[0][0],e[0][1])])])}},write:function(e,t){var i={type:null};if(OpenLayers.Util.isArray(e)){i.type="FeatureCollection";var n=e.length;i.features=Array(n);for(var s=0;s<n;++s){var r=e[s];if(!r instanceof OpenLayers.Feature.Vector)throw"FeatureCollection only supports collections of features: "+r;i.features[s]=this.extract.feature.apply(this,[r])}}else 0==e.CLASS_NAME.indexOf("OpenLayers.Geometry")?i=this.extract.geometry.apply(this,[e]):e instanceof OpenLayers.Feature.Vector&&(i=this.extract.feature.apply(this,[e]),e.layer&&e.layer.projection&&(i.crs=this.createCRSObject(e)));return OpenLayers.Format.JSON.prototype.write.apply(this,[i,t])},createCRSObject:function(e){e=e.layer.projection.toString();var t={};return e.match(/epsg:/i)&&(e=parseInt(e.substring(e.indexOf(":")+1)),t=4326==e?{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}}:{type:"name",properties:{name:"EPSG:"+e}}),t},extract:{feature:function(e){var t=this.extract.geometry.apply(this,[e.geometry]),t={type:"Feature",properties:e.attributes,geometry:t};return null!=e.fid&&(t.id=e.fid),t},geometry:function(e){if(null==e)return null;this.internalProjection&&this.externalProjection&&(e=e.clone(),e.transform(this.internalProjection,this.externalProjection));var t=e.CLASS_NAME.split(".")[2];return e=this.extract[t.toLowerCase()].apply(this,[e]),"Collection"==t?{type:"GeometryCollection",geometries:e}:{type:t,coordinates:e}},point:function(e){return[e.x,e.y]},multipoint:function(e){for(var t=[],i=0,n=e.components.length;i<n;++i)t.push(this.extract.point.apply(this,[e.components[i]]));return t},linestring:function(e){for(var t=[],i=0,n=e.components.length;i<n;++i)t.push(this.extract.point.apply(this,[e.components[i]]));return t},multilinestring:function(e){for(var t=[],i=0,n=e.components.length;i<n;++i)t.push(this.extract.linestring.apply(this,[e.components[i]]));return t},polygon:function(e){for(var t=[],i=0,n=e.components.length;i<n;++i)t.push(this.extract.linestring.apply(this,[e.components[i]]));return t},multipolygon:function(e){for(var t=[],i=0,n=e.components.length;i<n;++i)t.push(this.extract.polygon.apply(this,[e.components[i]]));return t},collection:function(e){for(var t=e.components.length,i=Array(t),n=0;n<t;++n)i[n]=this.extract.geometry.apply(this,[e.components[n]]);return i}},CLASS_NAME:"OpenLayers.Format.GeoJSON"}),OpenLayers.Control=OpenLayers.Class({id:null,map:null,div:null,type:null,allowSelection:!1,displayClass:"",title:"",autoActivate:!1,active:null,handlerOptions:null,handler:null,eventListeners:null,events:null,initialize:function(e){this.displayClass=this.CLASS_NAME.replace("OpenLayers.","ol").replace(/\./g,""),OpenLayers.Util.extend(this,e),this.events=new OpenLayers.Events(this),this.eventListeners instanceof Object&&this.events.on(this.eventListeners),null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"))},destroy:function(){if(this.events&&(this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy(),this.events=null),this.eventListeners=null,this.handler&&(this.handler.destroy(),this.handler=null),this.handlers){for(var e in this.handlers)this.handlers.hasOwnProperty(e)&&"function"==typeof this.handlers[e].destroy&&this.handlers[e].destroy();this.handlers=null}this.map&&(this.map.removeControl(this),this.map=null),this.div=null},setMap:function(e){this.map=e,this.handler&&this.handler.setMap(e)},draw:function(e){return null==this.div&&(this.div=OpenLayers.Util.createDiv(this.id),this.div.className=this.displayClass,this.allowSelection||(this.div.className+=" olControlNoSelect",this.div.setAttribute("unselectable","on",0),this.div.onselectstart=OpenLayers.Function.False),""!=this.title&&(this.div.title=this.title)),null!=e&&(this.position=e.clone()),this.moveTo(this.position),this.div},moveTo:function(e){null!=e&&null!=this.div&&(this.div.style.left=e.x+"px",this.div.style.top=e.y+"px")},activate:function(){return!this.active&&(this.handler&&this.handler.activate(),this.active=!0,this.map&&OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active"),this.events.triggerEvent("activate"),!0)},deactivate:function(){return!!this.active&&(this.handler&&this.handler.deactivate(),this.active=!1,this.map&&OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active"),this.events.triggerEvent("deactivate"),!0)},CLASS_NAME:"OpenLayers.Control"}),OpenLayers.Control.TYPE_BUTTON=1,OpenLayers.Control.TYPE_TOGGLE=2,OpenLayers.Control.TYPE_TOOL=3,OpenLayers.Control.DrawFeature=OpenLayers.Class(OpenLayers.Control,{layer:null,callbacks:null,multi:!1,featureAdded:function(){},initialize:function(e,t,i){OpenLayers.Control.prototype.initialize.apply(this,[i]),this.callbacks=OpenLayers.Util.extend({done:this.drawFeature,modify:function(e,t){this.layer.events.triggerEvent("sketchmodified",{vertex:e,feature:t})},create:function(e,t){this.layer.events.triggerEvent("sketchstarted",{vertex:e,feature:t})}},this.callbacks),this.layer=e,this.handlerOptions=this.handlerOptions||{},this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{renderers:e.renderers,rendererOptions:e.rendererOptions}),"multi"in this.handlerOptions||(this.handlerOptions.multi=this.multi),(e=this.layer.styleMap&&this.layer.styleMap.styles.temporary)&&(this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new OpenLayers.StyleMap({default:e})})),this.handler=new t(this,this.callbacks,this.handlerOptions)},drawFeature:function(e){e=new OpenLayers.Feature.Vector(e),!1!==this.layer.events.triggerEvent("sketchcomplete",{feature:e})&&(e.state=OpenLayers.State.INSERT,this.layer.addFeatures([e]),this.featureAdded(e),this.events.triggerEvent("featureadded",{feature:e}))},insertXY:function(e,t){this.handler&&this.handler.line&&this.handler.insertXY(e,t)},insertDeltaXY:function(e,t){this.handler&&this.handler.line&&this.handler.insertDeltaXY(e,t)},insertDirectionLength:function(e,t){this.handler&&this.handler.line&&this.handler.insertDirectionLength(e,t)},insertDeflectionLength:function(e,t){this.handler&&this.handler.line&&this.handler.insertDeflectionLength(e,t)},undo:function(){return this.handler.undo&&this.handler.undo()},redo:function(){return this.handler.redo&&this.handler.redo()},finishSketch:function(){this.handler.finishGeometry()},cancel:function(){this.handler.cancel()},CLASS_NAME:"OpenLayers.Control.DrawFeature"}),OpenLayers.Control.MousePosition=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,element:null,prefix:"",separator:", ",suffix:"",numDigits:5,granularity:10,emptyString:null,lastXy:null,displayProjection:null,destroy:function(){this.deactivate(),OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return!!OpenLayers.Control.prototype.activate.apply(this,arguments)&&(this.map.events.register("mousemove",this,this.redraw),this.map.events.register("mouseout",this,this.reset),this.redraw(),!0)},deactivate:function(){return!!OpenLayers.Control.prototype.deactivate.apply(this,arguments)&&(this.map.events.unregister("mousemove",this,this.redraw),this.map.events.unregister("mouseout",this,this.reset),this.element.innerHTML="",!0)},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.element||(this.div.left="",this.div.top="",this.element=this.div),this.div},redraw:function(e){var t;null==e?this.reset():null==this.lastXy||Math.abs(e.xy.x-this.lastXy.x)>this.granularity||Math.abs(e.xy.y-this.lastXy.y)>this.granularity?this.lastXy=e.xy:(t=this.map.getLonLatFromPixel(e.xy))&&(this.displayProjection&&t.transform(this.map.getProjectionObject(),this.displayProjection),this.lastXy=e.xy,e=this.formatOutput(t),e!=this.element.innerHTML&&(this.element.innerHTML=e))},reset:function(e){null!=this.emptyString&&(this.element.innerHTML=this.emptyString)},formatOutput:function(e){var t=parseInt(this.numDigits);return this.prefix+e.lon.toFixed(t)+this.separator+e.lat.toFixed(t)+this.suffix},CLASS_NAME:"OpenLayers.Control.MousePosition"}),OpenLayers.Events.buttonclick=OpenLayers.Class({target:null,events:"mousedown mouseup click dblclick touchstart touchmove touchend keydown".split(" "),startRegEx:/^mousedown|touchstart$/,cancelRegEx:/^touchmove$/,completeRegEx:/^mouseup|touchend$/,isDeviceTouchCapable:"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch,initialize:function(e){for(this.target=e,e=this.events.length-1;0<=e;--e)this.target.register(this.events[e],this,this.buttonClick,{extension:!0})},destroy:function(){for(var e=this.events.length-1;0<=e;--e)this.target.unregister(this.events[e],this,this.buttonClick);delete this.target},getPressedButton:function(e){var t,i=3;do{if(OpenLayers.Element.hasClass(e,"olButton")){t=e;break}e=e.parentNode}while(0<--i&&e);return t},ignore:function(e){var t=3,i=!1;do{if("a"===e.nodeName.toLowerCase()){i=!0;break}e=e.parentNode}while(0<--t&&e);return i},buttonClick:function(e){var t=!0,i=OpenLayers.Event.element(e);if(i&&(OpenLayers.Event.isLeftClick(e)&&!this.isDeviceTouchCapable||!~e.type.indexOf("mouse")))if(i=this.getPressedButton(i)){if("keydown"===e.type)switch(e.keyCode){case OpenLayers.Event.KEY_RETURN:case OpenLayers.Event.KEY_SPACE:this.target.triggerEvent("buttonclick",{buttonElement:i}),OpenLayers.Event.stop(e),t=!1}else if(this.startEvt){if(this.completeRegEx.test(e.type)){var t=OpenLayers.Util.pagePosition(i),n=OpenLayers.Util.getViewportElement(),s=window.pageYOffset||n.scrollTop;t[0]-=window.pageXOffset||n.scrollLeft,t[1]-=s,this.target.triggerEvent("buttonclick",{buttonElement:i,buttonXY:{x:this.startEvt.clientX-t[0],y:this.startEvt.clientY-t[1]}})}this.cancelRegEx.test(e.type)&&e.touches&&this.startEvt.touches&&4<(4<Math.abs(e.touches[0].olClientX-this.startEvt.touches[0].olClientX)||Math.abs(e.touches[0].olClientY-this.startEvt.touches[0].olClientY))&&delete this.startEvt,OpenLayers.Event.stop(e),t=!1}this.startRegEx.test(e.type)&&(this.startEvt=e,OpenLayers.Event.stop(e),t=!1)}else t=!this.ignore(OpenLayers.Event.element(e)),delete this.startEvt;return t}}),OpenLayers.Control.Zoom=OpenLayers.Class(OpenLayers.Control,{zoomInText:"+",zoomInId:"olZoomInLink",zoomOutText:"−",zoomOutId:"olZoomOutLink",draw:function(){var e=OpenLayers.Control.prototype.draw.apply(this),t=this.getOrCreateLinks(e),i=t.zoomIn,t=t.zoomOut,n=this.map.events;return t.parentNode!==e&&(n=this.events,n.attachToElement(t.parentNode)),n.register("buttonclick",this,this.onZoomClick),this.zoomInLink=i,this.zoomOutLink=t,e},getOrCreateLinks:function(e){var t=document.getElementById(this.zoomInId),i=document.getElementById(this.zoomOutId);return t||(t=document.createElement("a"),t.href="#zoomIn",t.appendChild(document.createTextNode(this.zoomInText)),t.className="olControlZoomIn",e.appendChild(t)),OpenLayers.Element.addClass(t,"olButton"),i||(i=document.createElement("a"),i.href="#zoomOut",i.appendChild(document.createTextNode(this.zoomOutText)),i.className="olControlZoomOut",e.appendChild(i)),OpenLayers.Element.addClass(i,"olButton"),{zoomIn:t,zoomOut:i}},onZoomClick:function(e){e=e.buttonElement,e===this.zoomInLink?this.map.zoomIn():e===this.zoomOutLink&&this.map.zoomOut()},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onZoomClick),delete this.zoomInLink,delete this.zoomOutLink,OpenLayers.Control.prototype.destroy.apply(this)},CLASS_NAME:"OpenLayers.Control.Zoom"}),OpenLayers.Handler.Feature=OpenLayers.Class(OpenLayers.Handler,{EVENTMAP:{click:{in:"click",out:"clickout"},mousemove:{in:"over",out:"out"},dblclick:{in:"dblclick",out:null},mousedown:{in:null,out:null},mouseup:{in:null,out:null},touchstart:{in:"click",out:"clickout"}},feature:null,lastFeature:null,down:null,up:null,clickTolerance:4,geometryTypes:null,stopClick:!0,stopDown:!0,stopUp:!1,initialize:function(e,t,i,n){OpenLayers.Handler.prototype.initialize.apply(this,[e,i,n]),this.layer=t},touchstart:function(e){return this.startTouch(),!!OpenLayers.Event.isMultiTouch(e)||this.mousedown(e)},touchmove:function(e){OpenLayers.Event.preventDefault(e)},mousedown:function(e){return(OpenLayers.Event.isLeftClick(e)||OpenLayers.Event.isSingleTouch(e))&&(this.down=e.xy),!this.handle(e)||!this.stopDown},mouseup:function(e){return this.up=e.xy,!this.handle(e)||!this.stopUp},click:function(e){return!this.handle(e)||!this.stopClick},mousemove:function(e){return!this.callbacks.over&&!this.callbacks.out||(this.handle(e),!0)},dblclick:function(e){return!this.handle(e)},geometryTypeMatches:function(e){return null==this.geometryTypes||-1<OpenLayers.Util.indexOf(this.geometryTypes,e.geometry.CLASS_NAME)},handle:function(e){this.feature&&!this.feature.layer&&(this.feature=null);var t=e.type,i=!1,n=!!this.feature,s="click"==t||"dblclick"==t||"touchstart"==t;return(this.feature=this.layer.getFeatureFromEvent(e))&&!this.feature.layer&&(this.feature=null),this.lastFeature&&!this.lastFeature.layer&&(this.lastFeature=null),this.feature?("touchstart"===t&&OpenLayers.Event.preventDefault(e),e=this.feature!=this.lastFeature,this.geometryTypeMatches(this.feature)?(n&&e?(this.lastFeature&&this.triggerCallback(t,"out",[this.lastFeature]),this.triggerCallback(t,"in",[this.feature])):n&&!s||this.triggerCallback(t,"in",[this.feature]),this.lastFeature=this.feature,i=!0):(this.lastFeature&&(n&&e||s)&&this.triggerCallback(t,"out",[this.lastFeature]),this.feature=null)):this.lastFeature&&(n||s)&&this.triggerCallback(t,"out",[this.lastFeature]),i},triggerCallback:function(e,t,i){(t=this.EVENTMAP[e][t])&&("click"==e&&this.up&&this.down?(Math.sqrt(Math.pow(this.up.x-this.down.x,2)+Math.pow(this.up.y-this.down.y,2))<=this.clickTolerance&&this.callback(t,i),this.up=this.down=null):this.callback(t,i))},activate:function(){var e=!1;return OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.moveLayerToTop(),this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),e=!0),e},deactivate:function(){var e=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.moveLayerBack(),this.up=this.down=this.lastFeature=this.feature=null,this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),e=!0),e},handleMapEvents:function(e){"removelayer"!=e.type&&"order"!=e.property||this.moveLayerToTop()},moveLayerToTop:function(){var e=Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1;this.layer.setZIndex(e)},moveLayerBack:function(){var e=this.layer.getZIndex()-1;e>=this.map.Z_INDEX_BASE.Feature?this.layer.setZIndex(e):this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))},CLASS_NAME:"OpenLayers.Handler.Feature"}),OpenLayers.Layer.Vector.RootContainer=OpenLayers.Class(OpenLayers.Layer.Vector,{displayInLayerSwitcher:!1,layers:null,display:function(){},getFeatureFromEvent:function(e){for(var t,i=this.layers,n=0;n<i.length;n++)if(t=i[n].getFeatureFromEvent(e))return t},setMap:function(e){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments),this.collectRoots(),e.events.register("changelayer",this,this.handleChangeLayer)},removeMap:function(e){e.events.unregister("changelayer",this,this.handleChangeLayer),this.resetRoots(),OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments)},collectRoots:function(){for(var e,t=0;t<this.map.layers.length;++t)e=this.map.layers[t],-1!=OpenLayers.Util.indexOf(this.layers,e)&&e.renderer.moveRoot(this.renderer)},resetRoots:function(){for(var e,t=0;t<this.layers.length;++t)e=this.layers[t],this.renderer&&e.renderer.getRenderLayerId()==this.id&&this.renderer.moveRoot(e.renderer)},handleChangeLayer:function(e){var t=e.layer;"order"==e.property&&-1!=OpenLayers.Util.indexOf(this.layers,t)&&(this.resetRoots(),this.collectRoots())},CLASS_NAME:"OpenLayers.Layer.Vector.RootContainer"}),OpenLayers.Control.SelectFeature=OpenLayers.Class(OpenLayers.Control,{multipleKey:null,toggleKey:null,multiple:!1,clickout:!0,toggle:!1,hover:!1,highlightOnly:!1,box:!1,onBeforeSelect:function(){},onSelect:function(){},onUnselect:function(){},scope:null,geometryTypes:null,layer:null,layers:null,callbacks:null,selectStyle:null,renderIntent:"select",handlers:null,initialize:function(e,t){OpenLayers.Control.prototype.initialize.apply(this,[t]),null===this.scope&&(this.scope=this),this.initLayer(e);var i={click:this.clickFeature,clickout:this.clickoutFeature};this.hover&&(i.over=this.overFeature,i.out=this.outFeature),this.callbacks=OpenLayers.Util.extend(i,this.callbacks),this.handlers={feature:new OpenLayers.Handler.Feature(this,this.layer,this.callbacks,{geometryTypes:this.geometryTypes})},this.box&&(this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},{boxDivClassName:"olHandlerBoxSelectFeature"}))},initLayer:function(e){OpenLayers.Util.isArray(e)?(this.layers=e,this.layer=new OpenLayers.Layer.Vector.RootContainer(this.id+"_container",{layers:e})):this.layer=e},destroy:function(){this.active&&this.layers&&this.map.removeLayer(this.layer),OpenLayers.Control.prototype.destroy.apply(this,arguments),this.layers&&this.layer.destroy()},activate:function(){return this.active||(this.layers&&this.map.addLayer(this.layer),this.handlers.feature.activate(),this.box&&this.handlers.box&&this.handlers.box.activate()),OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.active&&(this.handlers.feature.deactivate(),this.handlers.box&&this.handlers.box.deactivate(),this.layers&&this.map.removeLayer(this.layer)),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},unselectAll:function(e){var t,i,n,s,r=this.layers||[this.layer];for(n=0;n<r.length;++n)if(t=r[n],s=0,null!=t.selectedFeatures)for(;t.selectedFeatures.length>s;)i=t.selectedFeatures[s],e&&e.except==i?++s:this.unselect(i)},clickFeature:function(e){this.hover||(-1<OpenLayers.Util.indexOf(e.layer.selectedFeatures,e)?this.toggleSelect()?this.unselect(e):this.multipleSelect()||this.unselectAll({except:e}):(this.multipleSelect()||this.unselectAll({except:e}),this.select(e)))},multipleSelect:function(){return this.multiple||this.handlers.feature.evt&&this.handlers.feature.evt[this.multipleKey]},toggleSelect:function(){return this.toggle||this.handlers.feature.evt&&this.handlers.feature.evt[this.toggleKey]},clickoutFeature:function(e){!this.hover&&this.clickout&&this.unselectAll()},overFeature:function(e){var t=e.layer;this.hover&&(this.highlightOnly?this.highlight(e):-1==OpenLayers.Util.indexOf(t.selectedFeatures,e)&&this.select(e))},outFeature:function(e){if(this.hover)if(this.highlightOnly){if(e._lastHighlighter==this.id)if(e._prevHighlighter&&e._prevHighlighter!=this.id){delete e._lastHighlighter;var t=this.map.getControl(e._prevHighlighter);t&&t.highlight(e)}else this.unhighlight(e)}else this.unselect(e)},highlight:function(e){var t=e.layer;!1!==this.events.triggerEvent("beforefeaturehighlighted",{feature:e})&&(e._prevHighlighter=e._lastHighlighter,e._lastHighlighter=this.id,t.drawFeature(e,this.selectStyle||this.renderIntent),this.events.triggerEvent("featurehighlighted",{feature:e}))},unhighlight:function(e){var t=e.layer;void 0==e._prevHighlighter?delete e._lastHighlighter:(e._prevHighlighter!=this.id&&(e._lastHighlighter=e._prevHighlighter),delete e._prevHighlighter),t.drawFeature(e,e.style||e.layer.style||"default"),this.events.triggerEvent("featureunhighlighted",{feature:e})},select:function(e){var t=this.onBeforeSelect.call(this.scope,e),i=e.layer;!1!==t&&(t=i.events.triggerEvent("beforefeatureselected",{feature:e}),!1!==t&&(i.selectedFeatures.push(e),this.highlight(e),this.handlers.feature.lastFeature||(this.handlers.feature.lastFeature=i.selectedFeatures[0]),i.events.triggerEvent("featureselected",{feature:e}),this.onSelect.call(this.scope,e)))},unselect:function(e){var t=e.layer;this.unhighlight(e),OpenLayers.Util.removeItem(t.selectedFeatures,e),t.events.triggerEvent("featureunselected",{feature:e}),this.onUnselect.call(this.scope,e)},selectBox:function(e){if(e instanceof OpenLayers.Bounds){var t=this.map.getLonLatFromPixel({x:e.left,y:e.bottom});e=this.map.getLonLatFromPixel({x:e.right,y:e.top}),t=new OpenLayers.Bounds(t.lon,t.lat,e.lon,e.lat),this.multipleSelect()||this.unselectAll(),e=this.multiple,this.multiple=!0;var i=this.layers||[this.layer];this.events.triggerEvent("boxselectionstart",{layers:i});for(var n,s=0;s<i.length;++s){n=i[s];for(var r=0,a=n.features.length;r<a;++r){var o=n.features[r];o.getVisibility()&&(null==this.geometryTypes||-1<OpenLayers.Util.indexOf(this.geometryTypes,o.geometry.CLASS_NAME))&&t.toGeometry().intersects(o.geometry)&&-1==OpenLayers.Util.indexOf(n.selectedFeatures,o)&&this.select(o)}}this.multiple=e,this.events.triggerEvent("boxselectionend",{layers:i})}},setMap:function(e){this.handlers.feature.setMap(e),this.box&&this.handlers.box.setMap(e),OpenLayers.Control.prototype.setMap.apply(this,arguments)},setLayer:function(e){var t=this.active;this.unselectAll(),this.deactivate(),this.layers&&(this.layer.destroy(),this.layers=null),this.initLayer(e),this.handlers.feature.layer=this.layer,t&&this.activate()},addLayer:function(e){var t=this.active;this.deactivate(),null==this.layers?null!=this.layer?(this.layers=[this.layer],this.layers.push(e)):this.layers=[e]:this.layers.push(e),this.initLayer(this.layers),this.handlers.feature.layer=this.layer,t&&this.activate()},CLASS_NAME:"OpenLayers.Control.SelectFeature"}),OpenLayers.Handler.Drag=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!0,dragging:!1,last:null,start:null,lastMoveEvt:null,oldOnselectstart:null,interval:0,timeoutId:null,documentDrag:!1,documentEvents:null,initialize:function(e,t,i){if(OpenLayers.Handler.prototype.initialize.apply(this,arguments),!0===this.documentDrag){var n=this;this._docMove=function(e){n.mousemove({xy:{x:e.clientX,y:e.clientY},element:document})},this._docUp=function(e){n.mouseup({xy:{x:e.clientX,y:e.clientY}})}}},dragstart:function(e){var t=!0;return this.dragging=!1,this.checkModifiers(e)&&this._pointerId==e.pointerId&&(OpenLayers.Event.isLeftClick(e)||OpenLayers.Event.isSingleTouch(e))?(this.started=!0,this.last=this.start=e.xy,OpenLayers.Element.addClass(this.map.viewPortDiv,"olDragDown"),this.down(e),this.callback("down",[e.xy]),OpenLayers.Event.preventDefault(e),this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart?document.onselectstart:OpenLayers.Function.True),document.onselectstart=OpenLayers.Function.False,t=!this.stopDown):(delete this._pointerId,this.started=!1,this.last=this.start=null),t},dragmove:function(e){return this.lastMoveEvt=e,!this.started||this._pointerId!=e.pointerId||this.timeoutId||e.xy.x==this.last.x&&e.xy.y==this.last.y||(!0===this.documentDrag&&this.documentEvents&&(e.element===document?(this.adjustXY(e),this.setEvent(e)):this.removeDocumentEvents()),0<this.interval&&(this.timeoutId=setTimeout(OpenLayers.Function.bind(this.removeTimeout,this),this.interval)),this.dragging=!0,this.move(e),this.callback("move",[e.xy]),this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart,document.onselectstart=OpenLayers.Function.False),this.last=e.xy),!0},dragend:function(e){if(this.started&&this._pointerId==e.pointerId){!0===this.documentDrag&&this.documentEvents&&(this.adjustXY(e),this.removeDocumentEvents());var t=this.start!=this.last;this.dragging=this.started=!1,delete this._pointerId,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown"),this.up(e),this.callback("up",[e.xy]),t&&this.callback("done",[e.xy]),document.onselectstart=this.oldOnselectstart}return!0},down:function(e){},move:function(e){},up:function(e){},out:function(e){},mousedown:function(e){return this.dragstart(e)},touchstart:function(e){return this.startTouch(),"_pointerId"in this||(this._pointerId=e.pointerId),this.dragstart(e)},mousemove:function(e){return this.dragmove(e)},touchmove:function(e){return this.dragmove(e)},removeTimeout:function(){this.timeoutId=null,this.dragging&&this.mousemove(this.lastMoveEvt)},mouseup:function(e){return this.dragend(e)},touchend:function(e){return e.xy=this.last,this.dragend(e)},mouseout:function(e){if(this.started&&OpenLayers.Util.mouseLeft(e,this.map.viewPortDiv))if(!0===this.documentDrag)this.addDocumentEvents();else{var t=this.start!=this.last;this.dragging=this.started=!1,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown"),this.out(e),this.callback("out",[]),t&&this.callback("done",[e.xy]),document.onselectstart&&(document.onselectstart=this.oldOnselectstart)}return!0},click:function(e){return this.start==this.last},activate:function(){var e=!1;return OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.dragging=!1,e=!0),e},deactivate:function(){var e=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.dragging=this.started=!1,this.last=this.start=null,e=!0,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown")),e},adjustXY:function(e){var t=OpenLayers.Util.pagePosition(this.map.viewPortDiv);e.xy.x-=t[0],e.xy.y-=t[1]},addDocumentEvents:function(){OpenLayers.Element.addClass(document.body,"olDragDown"),this.documentEvents=!0,OpenLayers.Event.observe(document,"mousemove",this._docMove),OpenLayers.Event.observe(document,"mouseup",this._docUp)},removeDocumentEvents:function(){OpenLayers.Element.removeClass(document.body,"olDragDown"),this.documentEvents=!1,OpenLayers.Event.stopObserving(document,"mousemove",this._docMove),OpenLayers.Event.stopObserving(document,"mouseup",this._docUp)},CLASS_NAME:"OpenLayers.Handler.Drag"}),OpenLayers.Handler.Box=OpenLayers.Class(OpenLayers.Handler,{dragHandler:null,boxDivClassName:"olHandlerBoxZoomBox",boxOffsets:null,initialize:function(e,t,i){OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.dragHandler=new OpenLayers.Handler.Drag(this,{down:this.startBox,move:this.moveBox,out:this.removeBox,up:this.endBox},{keyMask:this.keyMask})},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments),this.dragHandler&&(this.dragHandler.destroy(),this.dragHandler=null)},setMap:function(e){OpenLayers.Handler.prototype.setMap.apply(this,arguments),this.dragHandler&&this.dragHandler.setMap(e)},startBox:function(e){this.callback("start",[]),this.zoomBox=OpenLayers.Util.createDiv("zoomBox",{x:-9999,y:-9999}),this.zoomBox.className=this.boxDivClassName,this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1,this.map.viewPortDiv.appendChild(this.zoomBox),OpenLayers.Element.addClass(this.map.viewPortDiv,"olDrawBox")},moveBox:function(e){var t=this.dragHandler.start.x,i=this.dragHandler.start.y,n=Math.abs(t-e.x),s=Math.abs(i-e.y),r=this.getBoxOffsets();this.zoomBox.style.width=n+r.width+1+"px",this.zoomBox.style.height=s+r.height+1+"px",this.zoomBox.style.left=(e.x<t?t-n-r.left:t-r.left)+"px",this.zoomBox.style.top=(e.y<i?i-s-r.top:i-r.top)+"px"},endBox:function(e){if(5<Math.abs(this.dragHandler.start.x-e.x)||5<Math.abs(this.dragHandler.start.y-e.y)){var t=this.dragHandler.start;e=new OpenLayers.Bounds(Math.min(t.x,e.x),Math.max(t.y,e.y),Math.max(t.x,e.x),Math.min(t.y,e.y))}else e=this.dragHandler.start.clone();this.removeBox(),this.callback("done",[e])},removeBox:function(){this.map.viewPortDiv.removeChild(this.zoomBox),this.boxOffsets=this.zoomBox=null,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDrawBox")},activate:function(){return!!OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.dragHandler.activate(),!0)},deactivate:function(){return!!OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.dragHandler.deactivate()&&this.zoomBox&&this.removeBox(),!0)},getBoxOffsets:function(){if(!this.boxOffsets){var e=document.createElement("div");e.style.position="absolute",e.style.border="1px solid black",e.style.width="3px",document.body.appendChild(e);var t=3==e.clientWidth;document.body.removeChild(e);var e=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-left-width")),i=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-right-width")),n=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-top-width")),s=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-bottom-width"));this.boxOffsets={left:e,right:i,top:n,bottom:s,width:!1===t?e+i:0,height:!1===t?n+s:0}}return this.boxOffsets},CLASS_NAME:"OpenLayers.Handler.Box"}),OpenLayers.Control.ZoomBox=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,out:!1,keyMask:null,alwaysZoom:!1,zoomOnClick:!0,draw:function(){this.handler=new OpenLayers.Handler.Box(this,{done:this.zoomBox},{keyMask:this.keyMask})},zoomBox:function(e){if(e instanceof OpenLayers.Bounds){var t,i=e.getCenterPixel();if(this.out){t=Math.min(this.map.size.h/(e.bottom-e.top),this.map.size.w/(e.right-e.left));var n=this.map.getExtent(),s=this.map.getLonLatFromPixel(i),r=s.lon-n.getWidth()/2*t;e=s.lon+n.getWidth()/2*t;var a=s.lat-n.getHeight()/2*t;t=s.lat+n.getHeight()/2*t,t=new OpenLayers.Bounds(r,a,e,t)}else r=this.map.getLonLatFromPixel({x:e.left,y:e.bottom}),e=this.map.getLonLatFromPixel({x:e.right,y:e.top}),t=new OpenLayers.Bounds(r.lon,r.lat,e.lon,e.lat);r=this.map.getZoom(),a=this.map.getSize(),e=a.w/2,a=a.h/2,t=this.map.getZoomForExtent(t),n=this.map.getResolution(),s=this.map.getResolutionForZoom(t),n==s?this.map.setCenter(this.map.getLonLatFromPixel(i)):this.map.zoomTo(t,{x:(n*i.x-s*e)/(n-s),y:(n*i.y-s*a)/(n-s)}),r==this.map.getZoom()&&1==this.alwaysZoom&&this.map.zoomTo(r+(this.out?-1:1))}else this.zoomOnClick&&(this.out?this.map.zoomTo(this.map.getZoom()-1,e):this.map.zoomTo(this.map.getZoom()+1,e))},CLASS_NAME:"OpenLayers.Control.ZoomBox"}),OpenLayers.Control.DragPan=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,panned:!1,interval:0,documentDrag:!1,kinetic:null,enableKinetic:!0,kineticInterval:10,draw:function(){if(this.enableKinetic&&OpenLayers.Kinetic){var e={interval:this.kineticInterval};"object"==typeof this.enableKinetic&&(e=OpenLayers.Util.extend(e,this.enableKinetic)),this.kinetic=new OpenLayers.Kinetic(e)}this.handler=new OpenLayers.Handler.Drag(this,{move:this.panMap,
done:this.panMapDone,down:this.panMapStart},{interval:this.interval,documentDrag:this.documentDrag})},panMapStart:function(){this.kinetic&&this.kinetic.begin()},panMap:function(e){this.kinetic&&this.kinetic.update(e),this.panned=!0,this.map.pan(this.handler.last.x-e.x,this.handler.last.y-e.y,{dragging:!0,animate:!1})},panMapDone:function(e){if(this.panned){var t=null;if(this.kinetic&&(t=this.kinetic.end(e)),this.map.pan(this.handler.last.x-e.x,this.handler.last.y-e.y,{dragging:!!t,animate:!1}),t){var i=this;this.kinetic.move(t,function(e,t,n){i.map.pan(e,t,{dragging:!n,animate:!1})})}this.panned=!1}},CLASS_NAME:"OpenLayers.Control.DragPan"});OpenLayers.Handler.MouseWheel=OpenLayers.Class(OpenLayers.Handler,{wheelListener:null,interval:0,maxDelta:Number.POSITIVE_INFINITY,delta:0,cumulative:!0,initialize:function(e,t,i){OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.wheelListener=OpenLayers.Function.bindAsEventListener(this.onWheelEvent,this)},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments),this.wheelListener=null},onWheelEvent:function(e){if(this.map&&this.checkModifiers(e)){for(var t=!1,i=!1,n=!1,s=OpenLayers.Event.element(e);null!=s&&!n&&!t;){if(!t)try{var r,t=(r=s.currentStyle?s.currentStyle.overflow:document.defaultView.getComputedStyle(s,null).getPropertyValue("overflow"))&&"auto"==r||"scroll"==r}catch(e){}if(!i&&(i=OpenLayers.Element.hasClass(s,"olScrollable"),!i))for(var n=0,a=this.map.layers.length;n<a;n++){var o=this.map.layers[n];if(s==o.div||s==o.pane){i=!0;break}}n=s==this.map.div,s=s.parentNode}if(!t&&n){if(i)if(t=0,e.wheelDelta?(t=e.wheelDelta,0===t%160&&(t*=.75),t/=120):e.detail&&(t=-(e.detail/Math.abs(e.detail))),this.delta+=t,window.clearTimeout(this._timeoutId),this.interval&&Math.abs(this.delta)<this.maxDelta){var l=OpenLayers.Util.extend({},e);this._timeoutId=window.setTimeout(OpenLayers.Function.bind(function(){this.wheelZoom(l)},this),this.interval)}else this.wheelZoom(e);OpenLayers.Event.stop(e)}}},wheelZoom:function(e){var t=this.delta;this.delta=0,t&&(e.xy=this.map.events.getMousePosition(e),0>t?this.callback("down",[e,this.cumulative?Math.max(-this.maxDelta,t):-1]):this.callback("up",[e,this.cumulative?Math.min(this.maxDelta,t):1]))},activate:function(e){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){var t=this.wheelListener;return OpenLayers.Event.observe(window,"DOMMouseScroll",t),OpenLayers.Event.observe(window,"mousewheel",t),OpenLayers.Event.observe(document,"mousewheel",t),!0}return!1},deactivate:function(e){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){var t=this.wheelListener;return OpenLayers.Event.stopObserving(window,"DOMMouseScroll",t),OpenLayers.Event.stopObserving(window,"mousewheel",t),OpenLayers.Event.stopObserving(document,"mousewheel",t),!0}return!1},CLASS_NAME:"OpenLayers.Handler.MouseWheel"});OpenLayers.Handler.Click=OpenLayers.Class(OpenLayers.Handler,{delay:300,single:!0,double:!1,pixelTolerance:0,dblclickTolerance:13,stopSingle:!1,stopDouble:!1,timerId:null,down:null,last:null,first:null,rightclickTimerId:null,touchstart:function(e){return this.startTouch(),this.down=this.getEventInfo(e),this.last=this.getEventInfo(e),!0},touchmove:function(e){return this.last=this.getEventInfo(e),!0},touchend:function(e){return this.down&&(e.xy=this.last.xy,e.lastTouches=this.last.touches,this.handleSingle(e),this.down=null),!0},mousedown:function(e){return this.down=this.getEventInfo(e),this.last=this.getEventInfo(e),!0},mouseup:function(e){var t=!0;return this.checkModifiers(e)&&this.control.handleRightClicks&&OpenLayers.Event.isRightClick(e)&&(t=this.rightclick(e)),t},rightclick:function(e){if(this.passesTolerance(e)){if(null!=this.rightclickTimerId)return this.clearTimer(),this.callback("dblrightclick",[e]),!this.stopDouble;e=this.double?OpenLayers.Util.extend({},e):this.callback("rightclick",[e]),e=OpenLayers.Function.bind(this.delayedRightCall,this,e),this.rightclickTimerId=window.setTimeout(e,this.delay)}return!this.stopSingle},delayedRightCall:function(e){this.rightclickTimerId=null,e&&this.callback("rightclick",[e])},click:function(e){return this.last||(this.last=this.getEventInfo(e)),this.handleSingle(e),!this.stopSingle},dblclick:function(e){return this.handleDouble(e),!this.stopDouble},handleDouble:function(e){this.passesDblclickTolerance(e)&&(this.double&&this.callback("dblclick",[e]),this.clearTimer())},handleSingle:function(e){this.passesTolerance(e)&&(null!=this.timerId?(this.last.touches&&1===this.last.touches.length&&(this.double&&OpenLayers.Event.preventDefault(e),this.handleDouble(e)),this.last.touches&&2===this.last.touches.length||this.clearTimer()):(this.first=this.getEventInfo(e),e=this.single?OpenLayers.Util.extend({},e):null,this.queuePotentialClick(e)))},queuePotentialClick:function(e){this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,e),this.delay)},passesTolerance:function(e){var t=!0;if(null!=this.pixelTolerance&&this.down&&this.down.xy&&(t=this.pixelTolerance>=this.down.xy.distanceTo(e.xy))&&this.touch&&this.down.touches.length===this.last.touches.length){e=0;for(var i=this.down.touches.length;e<i;++e)if(this.getTouchDistance(this.down.touches[e],this.last.touches[e])>this.pixelTolerance){t=!1;break}}return t},getTouchDistance:function(e,t){return Math.sqrt(Math.pow(e.clientX-t.clientX,2)+Math.pow(e.clientY-t.clientY,2))},passesDblclickTolerance:function(e){return e=!0,this.down&&this.first&&(e=this.down.xy.distanceTo(this.first.xy)<=this.dblclickTolerance),e},clearTimer:function(){null!=this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null),null!=this.rightclickTimerId&&(window.clearTimeout(this.rightclickTimerId),this.rightclickTimerId=null)},delayedCall:function(e){this.timerId=null,e&&this.callback("click",[e])},getEventInfo:function(e){var t;if(e.touches){var i=e.touches.length;t=Array(i);for(var n,s=0;s<i;s++)n=e.touches[s],t[s]={clientX:n.olClientX,clientY:n.olClientY}}return{xy:e.xy,touches:t}},deactivate:function(){var e=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.clearTimer(),this.last=this.first=this.down=null,e=!0),e},CLASS_NAME:"OpenLayers.Handler.Click"}),OpenLayers.Control.Navigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,documentDrag:!1,zoomBox:null,zoomBoxEnabled:!0,zoomWheelEnabled:!0,mouseWheelOptions:null,handleRightClicks:!1,zoomBoxKeyMask:OpenLayers.Handler.MOD_SHIFT,autoActivate:!0,initialize:function(e){this.handlers={},OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate(),this.dragPan&&this.dragPan.destroy(),this.dragPan=null,this.zoomBox&&this.zoomBox.destroy(),this.zoomBox=null,this.pinchZoom&&this.pinchZoom.destroy(),this.pinchZoom=null,OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return this.dragPan.activate(),this.zoomWheelEnabled&&this.handlers.wheel.activate(),this.handlers.click.activate(),this.zoomBoxEnabled&&this.zoomBox.activate(),this.pinchZoom&&this.pinchZoom.activate(),OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.pinchZoom&&this.pinchZoom.deactivate(),this.zoomBox.deactivate(),this.dragPan.deactivate(),this.handlers.click.deactivate(),this.handlers.wheel.deactivate(),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},draw:function(){this.handleRightClicks&&(this.map.viewPortDiv.oncontextmenu=OpenLayers.Function.False),this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.defaultClick,dblclick:this.defaultDblClick,dblrightclick:this.defaultDblRightClick},{double:!0,stopDouble:!0}),this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions)),this.zoomBox=new OpenLayers.Control.ZoomBox({map:this.map,keyMask:this.zoomBoxKeyMask}),this.dragPan.draw(),this.zoomBox.draw(),this.handlers.wheel=new OpenLayers.Handler.MouseWheel(this,{up:this.wheelUp,down:this.wheelDown},OpenLayers.Util.extend(this.map.fractionalZoom?{}:{cumulative:!1,interval:50,maxDelta:6},this.mouseWheelOptions)),OpenLayers.Control.PinchZoom&&(this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},this.pinchZoomOptions)))},defaultClick:function(e){e.lastTouches&&2==e.lastTouches.length&&this.map.zoomOut()},defaultDblClick:function(e){this.map.zoomTo(this.map.zoom+1,e.xy)},defaultDblRightClick:function(e){this.map.zoomTo(this.map.zoom-1,e.xy)},wheelChange:function(e,t){this.map.fractionalZoom||(t=Math.round(t));var i,n=this.map.getZoom();i=Math.max(n+t,0),i=Math.min(i,this.map.getNumZoomLevels()),i!==n&&this.map.zoomTo(i,e.xy)},wheelUp:function(e,t){this.wheelChange(e,t||1)},wheelDown:function(e,t){this.wheelChange(e,t||-1)},disableZoomBox:function(){this.zoomBoxEnabled=!1,this.zoomBox.deactivate()},enableZoomBox:function(){this.zoomBoxEnabled=!0,this.active&&this.zoomBox.activate()},disableZoomWheel:function(){this.zoomWheelEnabled=!1,this.handlers.wheel.deactivate()},enableZoomWheel:function(){this.zoomWheelEnabled=!0,this.active&&this.handlers.wheel.activate()},CLASS_NAME:"OpenLayers.Control.Navigation"}),OpenLayers.Handler.Keyboard=OpenLayers.Class(OpenLayers.Handler,{KEY_EVENTS:["keydown","keyup"],eventListener:null,observeElement:null,initialize:function(e,t,i){OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.eventListener=OpenLayers.Function.bindAsEventListener(this.handleKeyEvent,this)},destroy:function(){this.deactivate(),this.eventListener=null,OpenLayers.Handler.prototype.destroy.apply(this,arguments)},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.observeElement=this.observeElement||document;for(var e=0,t=this.KEY_EVENTS.length;e<t;e++)OpenLayers.Event.observe(this.observeElement,this.KEY_EVENTS[e],this.eventListener);return!0}return!1},deactivate:function(){var e=!1;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){for(var e=0,t=this.KEY_EVENTS.length;e<t;e++)OpenLayers.Event.stopObserving(this.observeElement,this.KEY_EVENTS[e],this.eventListener);e=!0}return e},handleKeyEvent:function(e){this.checkModifiers(e)&&this.callback(e.type,[e])},CLASS_NAME:"OpenLayers.Handler.Keyboard"}),OpenLayers.Control.KeyboardDefaults=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,slideFactor:75,observeElement:null,draw:function(){this.handler=new OpenLayers.Handler.Keyboard(this,{keydown:this.defaultKeyPress},{observeElement:this.observeElement||document})},defaultKeyPress:function(e){var t,i=!0;if(t=OpenLayers.Event.element(e),!t||"INPUT"!=t.tagName&&"TEXTAREA"!=t.tagName&&"SELECT"!=t.tagName){switch(e.keyCode){case OpenLayers.Event.KEY_LEFT:this.map.pan(-this.slideFactor,0);break;case OpenLayers.Event.KEY_RIGHT:this.map.pan(this.slideFactor,0);break;case OpenLayers.Event.KEY_UP:this.map.pan(0,-this.slideFactor);break;case OpenLayers.Event.KEY_DOWN:this.map.pan(0,this.slideFactor);break;case 33:t=this.map.getSize(),this.map.pan(0,-.75*t.h);break;case 34:t=this.map.getSize(),this.map.pan(0,.75*t.h);break;case 35:t=this.map.getSize(),this.map.pan(.75*t.w,0);break;case 36:t=this.map.getSize(),this.map.pan(-.75*t.w,0);break;case 43:case 61:case 187:case 107:this.map.zoomIn();break;case 45:case 109:case 189:case 95:this.map.zoomOut();break;default:i=!1}i&&OpenLayers.Event.stop(e)}},CLASS_NAME:"OpenLayers.Control.KeyboardDefaults"}),OpenLayers.Control.Measure=OpenLayers.Class(OpenLayers.Control,{callbacks:null,displaySystem:"metric",geodesic:!1,displaySystemUnits:{geographic:["dd"],english:["mi","ft","in"],metric:["km","m"]},partialDelay:300,delayedTrigger:null,persist:!1,immediate:!1,initialize:function(e,t){OpenLayers.Control.prototype.initialize.apply(this,[t]);var i={done:this.measureComplete,point:this.measurePartial};this.immediate&&(i.modify=this.measureImmediate),this.callbacks=OpenLayers.Util.extend(i,this.callbacks),this.handlerOptions=OpenLayers.Util.extend({persist:this.persist},this.handlerOptions),this.handler=new e(this,this.callbacks,this.handlerOptions)},deactivate:function(){return this.cancelDelay(),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},cancel:function(){this.cancelDelay(),this.handler.cancel()},setImmediate:function(e){(this.immediate=e)?this.callbacks.modify=this.measureImmediate:delete this.callbacks.modify},updateHandler:function(e,t){var i=this.active;i&&this.deactivate(),this.handler=new e(this,this.callbacks,t),i&&this.activate()},measureComplete:function(e){this.cancelDelay(),this.measure(e,"measure")},measurePartial:function(e,t){this.cancelDelay(),t=t.clone(),this.handler.freehandMode(this.handler.evt)?this.measure(t,"measurepartial"):this.delayedTrigger=window.setTimeout(OpenLayers.Function.bind(function(){this.delayedTrigger=null,this.measure(t,"measurepartial")},this),this.partialDelay)},measureImmediate:function(e,t,i){i&&!this.handler.freehandMode(this.handler.evt)&&(this.cancelDelay(),this.measure(t.geometry,"measurepartial"))},cancelDelay:function(){null!==this.delayedTrigger&&(window.clearTimeout(this.delayedTrigger),this.delayedTrigger=null)},measure:function(e,t){var i,n;-1<e.CLASS_NAME.indexOf("LineString")?(i=this.getBestLength(e),n=1):(i=this.getBestArea(e),n=2),this.events.triggerEvent(t,{measure:i[0],units:i[1],order:n,geometry:e})},getBestArea:function(e){for(var t,i,n=this.displaySystemUnits[this.displaySystem],s=0,r=n.length;s<r&&(t=n[s],i=this.getArea(e,t),!(1<i));++s);return[i,t]},getArea:function(e,t){var i,n;this.geodesic?(i=e.getGeodesicArea(this.map.getProjectionObject()),n="m"):(i=e.getArea(),n=this.map.getUnits());var s=OpenLayers.INCHES_PER_UNIT[t];return s&&(i*=Math.pow(OpenLayers.INCHES_PER_UNIT[n]/s,2)),i},getBestLength:function(e){for(var t,i,n=this.displaySystemUnits[this.displaySystem],s=0,r=n.length;s<r&&(t=n[s],i=this.getLength(e,t),!(1<i));++s);return[i,t]},getLength:function(e,t){var i,n;this.geodesic?(i=e.getGeodesicLength(this.map.getProjectionObject()),n="m"):(i=e.getLength(),n=this.map.getUnits());var s=OpenLayers.INCHES_PER_UNIT[t];return s&&(i*=OpenLayers.INCHES_PER_UNIT[n]/s),i},CLASS_NAME:"OpenLayers.Control.Measure"}),OpenLayers.Control.LayerSwitcher=OpenLayers.Class(OpenLayers.Control,{layerStates:null,layersDiv:null,baseLayersDiv:null,baseLayers:null,dataLbl:null,dataLayersDiv:null,dataLayers:null,structuresCollapsed:!1,visionCollapsed:!1,minimizeDiv:null,maximizeDiv:null,ascending:!0,initialize:function(e){OpenLayers.Control.prototype.initialize.apply(this,arguments),this.layerStates=[]},destroy:function(){this.clearLayersArray("base"),this.clearLayersArray("data"),this.map.events.un({buttonclick:this.onButtonClick,addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this}),this.events.unregister("buttonclick",this,this.onButtonClick),OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(e){OpenLayers.Control.prototype.setMap.apply(this,arguments),this.map.events.on({addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this}),this.outsideViewport?(this.events.attachToElement(this.div),this.events.register("buttonclick",this,this.onButtonClick)):this.map.events.register("buttonclick",this,this.onButtonClick)},draw:function(){return OpenLayers.Control.prototype.draw.apply(this),this.loadContents(),this.outsideViewport||this.minimizeControl(),this.redraw(),this.div},onButtonClick:function(e){e=e.buttonElement,e===this.minimizeDiv?this.minimizeControl():e===this.maximizeDiv?this.maximizeControl():e._layerSwitcher===this.id&&(e.for&&(e=document.getElementById(e.for)),e.disabled||("radio"==e.type?(e.checked=!0,this.map.setBaseLayer(this.map.getLayer(e._layer))):(e.checked=!e.checked,this.updateMap())))},clearLayersArray:function(e){this[e+"LayersDiv"].innerHTML="",this[e+"Layers"]=[]},checkRedraw:function(){if(!this.layerStates.length||this.map.layers.length!=this.layerStates.length)return!0;for(var e=0,t=this.layerStates.length;e<t;e++){var i=this.layerStates[e],n=this.map.layers[e];if(i.name!=n.name||i.inRange!=n.inRange||i.id!=n.id||i.visibility!=n.visibility)return!0}return!1},toggleStructuresGroup:function(e){OpenLayers.Element.toggleClass(this.structuresElem,"collapsed"),OpenLayers.Element.hasClass(this.structuresElem,"collapsed")?(this.structuresHeader.innerHTML="+ Structures",this.structuresCollapsed=!0):(this.structuresHeader.innerHTML="&ndash; Structures",this.structuresCollapsed=!1),OpenLayers.Event.stop(e)},toggleVisionGroup:function(e){OpenLayers.Element.toggleClass(this.visionElem,"collapsed"),OpenLayers.Element.hasClass(this.visionElem,"collapsed")?(this.visionHeader.innerHTML="+ Vision",this.visionCollapsed=!0):(this.visionHeader.innerHTML="&ndash; Vision",this.visionCollapsed=!1),OpenLayers.Event.stop(e)},redraw:function(){if(!this.checkRedraw())return this.div;this.clearLayersArray("base"),this.clearLayersArray("data");var e=!1,t=!1,i=this.map.layers.length;this.layerStates=Array(i);for(var n=0;n<i;n++){var s=this.map.layers[n];this.layerStates[n]={name:s.name,visibility:s.visibility,inRange:s.inRange,id:s.id}}var r=this.map.layers.slice();for(this.ascending||r.reverse(),this.visionElem=document.createElement("li"),this.visionHeader=document.createElement("div"),this.visionHeader.innerHTML="&ndash; Vision",OpenLayers.Element.addClass(this.visionHeader,"header"),this.visionElem.appendChild(this.visionHeader),this.visionList=document.createElement("ul"),this.visionElem.appendChild(this.visionList),this.dataLayersDiv.appendChild(this.visionElem),this.visionCollapsed&&(OpenLayers.Element.addClass(this.visionElem,"collapsed"),this.visionHeader.innerHTML="+ Vision"),this.visionElem.addEventListener("click",this.toggleVisionGroup.bind(this),!1),this.visionElem.addEventListener("touchend",this.toggleVisionGroup.bind(this),!1),this.structuresElem=document.createElement("li"),this.structuresHeader=document.createElement("div"),this.structuresHeader.innerHTML="&ndash; Structures",OpenLayers.Element.addClass(this.structuresHeader,"header"),this.structuresElem.appendChild(this.structuresHeader),this.structuresList=document.createElement("ul"),this.structuresElem.appendChild(this.structuresList),this.dataLayersDiv.appendChild(this.structuresElem),this.structuresCollapsed&&(OpenLayers.Element.addClass(this.structuresElem,"collapsed"),this.structuresHeader.innerHTML="+ Structures"),this.structuresElem.addEventListener("click",this.toggleStructuresGroup.bind(this),!1),this.structuresElem.addEventListener("touchend",this.toggleStructuresGroup.bind(this),!1),n=0,i=r.length;n<i;n++){var s=r[n],a=s.isBaseLayer;if(s.displayInLayerSwitcher){a?t=!0:e=!0;var o=a?s==this.map.baseLayer:s.getVisibility(),l=document.createElement("input"),h=OpenLayers.Util.createUniqueID(this.id+"_input_");l.id=h,l.name=a?this.id+"_baseLayers":s.name,l.type=a?"radio":"checkbox",l.value=s.name,l.checked=o,l.defaultChecked=o,l.className="olButton",l._layer=s.id,l._layerSwitcher=this.id,a||s.inRange||(l.disabled=!0),o=document.createElement("label"),o.for=l.id,OpenLayers.Element.addClass(o,"labelSpan olButton"),o._layer=s.id,o._layerSwitcher=this.id,a||s.inRange||(o.style.color="gray"),o.innerHTML=s.name,o.insertBefore(l,o.firstChild);var u=document.createElement("ul"),h=a?this.baseLayers:this.dataLayers;if(h.push({layer:s,inputElem:l,labelSpan:o,subLayersElem:u,subLayers:[]}),l=a?this.baseLayersDiv:this.dataLayersDiv,a=document.createElement("li"),a.appendChild(o),this.overlayGrouping[s.name])if("Structures"==this.overlayGrouping[s.name])this.structuresList.appendChild(a);else if("Vision"==this.overlayGrouping[s.name])this.visionList.appendChild(a);else{var p=this.map.getLayersByName(this.overlayGrouping[s.name])[0];p?(s=h.filter(function(e){return p.name===e.layer.name})[0],0===s.subLayers.length&&s.labelSpan.appendChild(s.subLayersElem),s.subLayersElem.appendChild(a)):l.insertBefore(a,l.firstChild)}else l.insertBefore(a,l.firstChild)}}return this.dataLbl.style.display=e?"":"none",this.baseLbl.style.display=t?"":"none",this.div},updateMap:function(){for(var e=0,t=this.baseLayers.length;e<t;e++){var i=this.baseLayers[e];i.inputElem.checked&&this.map.setBaseLayer(i.layer,!1)}for(e=0,t=this.dataLayers.length;e<t;e++)i=this.dataLayers[e],i.layer.setVisibility(i.inputElem.checked)},maximizeControl:function(e){this.div.style.width="",this.div.style.height="",this.showControls(!1),null!=e&&OpenLayers.Event.stop(e)},minimizeControl:function(e){this.div.style.width="0px",this.div.style.height="0px",this.showControls(!0),null!=e&&OpenLayers.Event.stop(e)},showControls:function(e){this.maximizeDiv.style.display=e?"":"none",this.minimizeDiv.style.display=e?"none":"",this.layersDiv.style.display=e?"none":""},loadContents:function(){this.layersDiv=document.createElement("div"),this.layersDiv.id=this.id+"_layersDiv",OpenLayers.Element.addClass(this.layersDiv,"layersDiv"),this.baseLbl=document.createElement("div"),this.baseLbl.innerHTML=OpenLayers.i18n("Base Layer"),OpenLayers.Element.addClass(this.baseLbl,"baseLbl"),this.baseLayersDiv=document.createElement("ul"),OpenLayers.Element.addClass(this.baseLayersDiv,"controls-list baseLayersDiv right"),this.dataLbl=document.createElement("div"),this.dataLbl.innerHTML=OpenLayers.i18n("Overlays"),OpenLayers.Element.addClass(this.dataLbl,"dataLbl"),this.dataLayersDiv=document.createElement("ul"),OpenLayers.Element.addClass(this.dataLayersDiv,"controls-list right"),this.ascending?(this.layersDiv.appendChild(this.baseLbl),this.layersDiv.appendChild(this.baseLayersDiv),this.layersDiv.appendChild(this.dataLbl),this.layersDiv.appendChild(this.dataLayersDiv)):(this.layersDiv.appendChild(this.dataLbl),this.layersDiv.appendChild(this.dataLayersDiv),this.layersDiv.appendChild(this.baseLbl),this.layersDiv.appendChild(this.baseLayersDiv)),this.div.appendChild(this.layersDiv),this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MaximizeDiv",null,null,null,"absolute"),OpenLayers.Element.addClass(this.maximizeDiv,"maximizeDiv olButton"),this.maximizeDiv.style.display="none",this.div.appendChild(this.maximizeDiv),this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MinimizeDiv",null,null,null,"absolute"),OpenLayers.Element.addClass(this.minimizeDiv,"minimizeDiv olButton"),this.minimizeDiv.style.display="none",this.maximizeDiv.innerHTML="&equiv;",this.minimizeDiv.innerHTML="&times;",this.div.appendChild(this.minimizeDiv)},CLASS_NAME:"OpenLayers.Control.LayerSwitcher"}),OpenLayers.Handler.Pinch=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!1,pinching:!1,last:null,start:null,touchstart:function(e){var t=!0;if(this.pinching=!1,OpenLayers.Event.isMultiTouch(e))this.started=!0,this.last=this.start={distance:this.getDistance(e.touches),delta:0,scale:1},this.callback("start",[e,this.start]),t=!this.stopDown;else{if(this.started)return!1;this.started=!1,this.last=this.start=null}return OpenLayers.Event.preventDefault(e),t},touchmove:function(e){if(this.started&&OpenLayers.Event.isMultiTouch(e)){this.pinching=!0;var t=this.getPinchData(e);this.callback("move",[e,t]),this.last=t,OpenLayers.Event.stop(e)}else if(this.started)return!1;return!0},touchend:function(e){return!(this.started&&!OpenLayers.Event.isMultiTouch(e))||(this.pinching=this.started=!1,this.callback("done",[e,this.start,this.last]),this.last=this.start=null,!1)},activate:function(){var e=!1;return OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.pinching=!1,e=!0),e},deactivate:function(){var e=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.pinching=this.started=!1,this.last=this.start=null,e=!0),e},getDistance:function(e){var t=e[0];return e=e[1],Math.sqrt(Math.pow(t.olClientX-e.olClientX,2)+Math.pow(t.olClientY-e.olClientY,2))},getPinchData:function(e){return e=this.getDistance(e.touches),{distance:e,delta:this.last.distance-e,scale:e/this.start.distance}},CLASS_NAME:"OpenLayers.Handler.Pinch"}),OpenLayers.Control.PinchZoom=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,pinchOrigin:null,currentCenter:null,autoActivate:!0,preserveCenter:!1,initialize:function(e){OpenLayers.Control.prototype.initialize.apply(this,arguments),this.handler=new OpenLayers.Handler.Pinch(this,{start:this.pinchStart,move:this.pinchMove,done:this.pinchDone},this.handlerOptions)},pinchStart:function(e,t){var i=this.preserveCenter?this.map.getPixelFromLonLat(this.map.getCenter()):e.xy;this.currentCenter=this.pinchOrigin=i},pinchMove:function(e,t){var i=t.scale,n=this.map.layerContainerOriginPx,s=this.pinchOrigin,r=this.preserveCenter?this.map.getPixelFromLonLat(this.map.getCenter()):e.xy;this.map.applyTransform(Math.round(n.x+r.x-s.x+(i-1)*(n.x-s.x)),Math.round(n.y+r.y-s.y+(i-1)*(n.y-s.y)),i),this.currentCenter=r},pinchDone:function(e,t,i){if(this.map.applyTransform(),e=this.map.getZoomForResolution(this.map.getResolution()/i.scale,!0),e!==this.map.getZoom()||!this.currentCenter.equals(this.pinchOrigin)){t=this.map.getResolutionForZoom(e),i=this.map.getLonLatFromPixel(this.pinchOrigin);var n=this.currentCenter,s=this.map.getSize();i.lon+=t*(s.w/2-n.x),i.lat-=t*(s.h/2-n.y),this.map.div.clientWidth=this.map.div.clientWidth,this.map.setCenter(i,e)}},CLASS_NAME:"OpenLayers.Control.PinchZoom"}),OpenLayers.Control.TouchNavigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,clickHandlerOptions:null,documentDrag:!1,autoActivate:!0,initialize:function(e){this.handlers={},OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate(),this.dragPan&&this.dragPan.destroy(),this.dragPan=null,this.pinchZoom&&(this.pinchZoom.destroy(),delete this.pinchZoom),OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return!!OpenLayers.Control.prototype.activate.apply(this,arguments)&&(this.dragPan.activate(),this.handlers.click.activate(),this.pinchZoom.activate(),!0)},deactivate:function(){return!!OpenLayers.Control.prototype.deactivate.apply(this,arguments)&&(this.dragPan.deactivate(),this.handlers.click.deactivate(),this.pinchZoom.deactivate(),!0)},draw:function(){var e={click:this.defaultClick,dblclick:this.defaultDblClick},t=OpenLayers.Util.extend({double:!0,stopDouble:!0,pixelTolerance:2},this.clickHandlerOptions);this.handlers.click=new OpenLayers.Handler.Click(this,e,t),this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions)),this.dragPan.draw(),this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},this.pinchZoomOptions))},defaultClick:function(e){e.lastTouches&&2==e.lastTouches.length&&this.map.zoomOut()},defaultDblClick:function(e){this.map.zoomTo(this.map.zoom+1,e.xy)},CLASS_NAME:"OpenLayers.Control.TouchNavigation"}),OpenLayers.Strategy=OpenLayers.Class({layer:null,options:null,active:null,autoActivate:!0,autoDestroy:!0,initialize:function(e){OpenLayers.Util.extend(this,e),this.options=e,this.active=!1},destroy:function(){this.deactivate(),this.options=this.layer=null},setLayer:function(e){this.layer=e},activate:function(){return!this.active&&(this.active=!0)},deactivate:function(){return!!this.active&&(this.active=!1,!0)},CLASS_NAME:"OpenLayers.Strategy"}),OpenLayers.Strategy.Fixed=OpenLayers.Class(OpenLayers.Strategy,{preload:!1,activate:function(){var e=OpenLayers.Strategy.prototype.activate.apply(this,arguments);return e&&(this.layer.events.on({refresh:this.load,scope:this}),1==this.layer.visibility||this.preload?this.load():this.layer.events.on({visibilitychanged:this.load,scope:this})),e},deactivate:function(){var e=OpenLayers.Strategy.prototype.deactivate.call(this);return e&&this.layer.events.un({refresh:this.load,visibilitychanged:this.load,scope:this}),e},load:function(e){var t=this.layer;t.events.triggerEvent("loadstart",{filter:t.filter}),t.protocol.read(OpenLayers.Util.applyDefaults({callback:this.merge,filter:t.filter,scope:this},e)),t.events.un({visibilitychanged:this.load,scope:this})},merge:function(e){var t=this.layer;t.destroyFeatures();var i=e.features;if(i&&0<i.length){var n=t.projection,s=t.map.getProjectionObject();if(!s.equals(n))for(var r,a=0,o=i.length;a<o;++a)(r=i[a].geometry)&&r.transform(n,s);t.addFeatures(i)}t.events.triggerEvent("loadend",{response:e})},CLASS_NAME:"OpenLayers.Strategy.Fixed"}),OpenLayers.Handler.Point=OpenLayers.Class(OpenLayers.Handler,{point:null,layer:null,multi:!1,citeCompliant:!1,mouseDown:!1,stoppedDown:null,lastDown:null,lastUp:null,persist:!1,stopDown:!1,stopUp:!1,layerOptions:null,pixelTolerance:5,lastTouchPx:null,initialize:function(e,t,i){i&&i.layerOptions&&i.layerOptions.styleMap||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style.default,{})),OpenLayers.Handler.prototype.initialize.apply(this,arguments)},activate:function(){if(!OpenLayers.Handler.prototype.activate.apply(this,arguments))return!1;var e=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions);return this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,e),this.map.addLayer(this.layer),!0},createFeature:function(e){e=this.layer.getLonLatFromViewPortPx(e),e=new OpenLayers.Geometry.Point(e.lon,e.lat),this.point=new OpenLayers.Feature.Vector(e),this.callback("create",[this.point.geometry,this.point]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.point],{silent:!0})},deactivate:function(){return!!OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.cancel(),null!=this.layer.map&&(this.destroyFeature(!0),this.layer.destroy(!1)),this.layer=null,!0)},destroyFeature:function(e){!this.layer||!e&&this.persist||this.layer.destroyFeatures(),this.point=null},destroyPersistedFeature:function(){var e=this.layer;e&&1<e.features.length&&this.layer.features[0].destroy()},finalize:function(e){this.mouseDown=!1,this.lastTouchPx=this.lastUp=this.lastDown=null,this.callback(e?"cancel":"done",[this.geometryClone()]),this.destroyFeature(e)},cancel:function(){this.finalize(!0)},click:function(e){return OpenLayers.Event.stop(e),!1},dblclick:function(e){return OpenLayers.Event.stop(e),!1},modifyFeature:function(e){this.point||this.createFeature(e),e=this.layer.getLonLatFromViewPortPx(e),this.point.geometry.x=e.lon,this.point.geometry.y=e.lat,this.callback("modify",[this.point.geometry,this.point,!1]),this.point.geometry.clearBounds(),this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.point,this.style)},getGeometry:function(){var e=this.point&&this.point.geometry;return e&&this.multi&&(e=new OpenLayers.Geometry.MultiPoint([e])),e},geometryClone:function(){var e=this.getGeometry();return e&&e.clone()},mousedown:function(e){return this.down(e)},touchstart:function(e){return this.startTouch(),this.lastTouchPx=e.xy,this.down(e)},mousemove:function(e){return this.move(e)},touchmove:function(e){return this.lastTouchPx=e.xy,this.move(e)},mouseup:function(e){return this.up(e)},touchend:function(e){return e.xy=this.lastTouchPx,this.up(e)},down:function(e){return this.mouseDown=!0,this.lastDown=e.xy,this.touch||this.modifyFeature(e.xy),this.stoppedDown=this.stopDown,!this.stopDown},move:function(e){return this.touch||this.mouseDown&&!this.stoppedDown||this.modifyFeature(e.xy),!0},up:function(e){return this.mouseDown=!1,this.stoppedDown=this.stopDown,!(!(!this.checkModifiers(e)||this.lastUp&&this.lastUp.equals(e.xy))&&this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance))||(this.touch&&this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=e.xy,this.finalize(),!this.stopUp)},mouseout:function(e){OpenLayers.Util.mouseLeft(e,this.map.viewPortDiv)&&(this.stoppedDown=this.stopDown,this.mouseDown=!1)},passesTolerance:function(e,t,i){var n=!0;return null!=i&&e&&t&&e.distanceTo(t)>i&&(n=!1),n},CLASS_NAME:"OpenLayers.Handler.Point"
}),OpenLayers.Handler.Path=OpenLayers.Class(OpenLayers.Handler.Point,{line:null,maxVertices:null,doubleTouchTolerance:20,freehand:!1,freehandToggle:"shiftKey",timerId:null,redoStack:null,createFeature:function(e){e=this.layer.getLonLatFromViewPortPx(e),e=new OpenLayers.Geometry.Point(e.lon,e.lat),this.point=new OpenLayers.Feature.Vector(e),this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([this.point.geometry])),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.line,this.point],{silent:!0})},destroyFeature:function(e){OpenLayers.Handler.Point.prototype.destroyFeature.call(this,e),this.line=null},destroyPersistedFeature:function(){var e=this.layer;e&&2<e.features.length&&this.layer.features[0].destroy()},removePoint:function(){this.point&&this.layer.removeFeatures([this.point])},addPoint:function(e){this.layer.removeFeatures([this.point]),e=this.layer.getLonLatFromViewPortPx(e),this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(e.lon,e.lat)),this.line.geometry.addComponent(this.point.geometry,this.line.geometry.components.length),this.layer.addFeatures([this.point]),this.callback("point",[this.point.geometry,this.getGeometry()]),this.callback("modify",[this.point.geometry,this.getSketch()]),this.drawFeature(),delete this.redoStack},insertXY:function(e,t){this.line.geometry.addComponent(new OpenLayers.Geometry.Point(e,t),this.getCurrentPointIndex()),this.drawFeature(),delete this.redoStack},insertDeltaXY:function(e,t){var i=this.getCurrentPointIndex()-1,i=this.line.geometry.components[i];!i||isNaN(i.x)||isNaN(i.y)||this.insertXY(i.x+e,i.y+t)},insertDirectionLength:function(e,t){e*=Math.PI/180,this.insertDeltaXY(t*Math.cos(e),t*Math.sin(e))},insertDeflectionLength:function(e,t){var i=this.getCurrentPointIndex()-1;if(0<i){var n=this.line.geometry.components[i],i=this.line.geometry.components[i-1];this.insertDirectionLength(180*Math.atan2(n.y-i.y,n.x-i.x)/Math.PI+e,t)}},getCurrentPointIndex:function(){return this.line.geometry.components.length-1},undo:function(){var e=this.line.geometry,t=e.components,i=this.getCurrentPointIndex()-1,n=t[i],s=e.removeComponent(n);return s&&(this.touch&&0<i&&(t=e.components,e=t[i-1],i=this.getCurrentPointIndex(),t=t[i],t.x=e.x,t.y=e.y),this.redoStack||(this.redoStack=[]),this.redoStack.push(n),this.drawFeature()),s},redo:function(){var e=this.redoStack&&this.redoStack.pop();return e&&(this.line.geometry.addComponent(e,this.getCurrentPointIndex()),this.drawFeature()),!!e},freehandMode:function(e){return this.freehandToggle&&e[this.freehandToggle]?!this.freehand:this.freehand},modifyFeature:function(e,t){this.line||this.createFeature(e);var i=this.layer.getLonLatFromViewPortPx(e);this.point.geometry.x=i.lon,this.point.geometry.y=i.lat,this.callback("modify",[this.point.geometry,this.getSketch(),t]),this.point.geometry.clearBounds(),this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.line,this.style),this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.line},getGeometry:function(){var e=this.line&&this.line.geometry;return e&&this.multi&&(e=new OpenLayers.Geometry.MultiLineString([e])),e},touchstart:function(e){return this.timerId&&this.passesTolerance(this.lastTouchPx,e.xy,this.doubleTouchTolerance)?(this.finishGeometry(),window.clearTimeout(this.timerId),this.timerId=null,!1):(this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null),this.timerId=window.setTimeout(OpenLayers.Function.bind(function(){this.timerId=null},this),300),OpenLayers.Handler.Point.prototype.touchstart.call(this,e))},down:function(e){var t=this.stopDown;return this.freehandMode(e)&&(t=!0,this.touch&&(this.modifyFeature(e.xy,!!this.lastUp),OpenLayers.Event.stop(e))),this.touch||this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)||this.modifyFeature(e.xy,!!this.lastUp),this.mouseDown=!0,this.lastDown=e.xy,this.stoppedDown=t,!t},move:function(e){return this.stoppedDown&&this.freehandMode(e)?(this.persist&&this.destroyPersistedFeature(),this.maxVertices&&this.line&&this.line.geometry.components.length===this.maxVertices?(this.removePoint(),this.finalize()):this.addPoint(e.xy),!1):(this.touch||this.mouseDown&&!this.stoppedDown||this.modifyFeature(e.xy,!!this.lastUp),!0)},up:function(e){return!this.mouseDown||this.lastUp&&this.lastUp.equals(e.xy)||(this.stoppedDown&&this.freehandMode(e)?(this.persist&&this.destroyPersistedFeature(),this.removePoint(),this.finalize()):this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(e.xy),null==this.lastUp&&this.persist&&this.destroyPersistedFeature(),this.addPoint(e.xy),this.lastUp=e.xy,this.line.geometry.components.length===this.maxVertices+1&&this.finishGeometry())),this.stoppedDown=this.stopDown,this.mouseDown=!1,!this.stopUp},finishGeometry:function(){this.line.geometry.removeComponent(this.line.geometry.components[this.line.geometry.components.length-1]),this.removePoint(),this.finalize()},dblclick:function(e){return this.freehandMode(e)||this.finishGeometry(),!1},CLASS_NAME:"OpenLayers.Handler.Path"}),OpenLayers.Handler.Polygon=OpenLayers.Class(OpenLayers.Handler.Path,{holeModifier:null,drawingHole:!1,polygon:null,createFeature:function(e){e=this.layer.getLonLatFromViewPortPx(e),e=new OpenLayers.Geometry.Point(e.lon,e.lat),this.point=new OpenLayers.Feature.Vector(e),this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LinearRing([this.point.geometry])),this.polygon=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([this.line.geometry])),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.polygon,this.point],{silent:!0})},addPoint:function(e){if(!this.drawingHole&&this.holeModifier&&this.evt&&this.evt[this.holeModifier])for(var t,i=this.point.geometry,n=this.control.layer.features,s=n.length-1;0<=s;--s)if(t=n[s].geometry,(t instanceof OpenLayers.Geometry.Polygon||t instanceof OpenLayers.Geometry.MultiPolygon)&&t.intersects(i)){i=n[s],this.control.layer.removeFeatures([i],{silent:!0}),this.control.layer.events.registerPriority("sketchcomplete",this,this.finalizeInteriorRing),this.control.layer.events.registerPriority("sketchmodified",this,this.enforceTopology),i.geometry.addComponent(this.line.geometry),this.polygon=i,this.drawingHole=!0;break}OpenLayers.Handler.Path.prototype.addPoint.apply(this,arguments)},getCurrentPointIndex:function(){return this.line.geometry.components.length-2},enforceTopology:function(e){e=e.vertex;var t=this.line.geometry.components;this.polygon.geometry.intersects(e)||(t=t[t.length-3],e.x=t.x,e.y=t.y)},finishGeometry:function(){this.line.geometry.removeComponent(this.line.geometry.components[this.line.geometry.components.length-2]),this.removePoint(),this.finalize()},finalizeInteriorRing:function(){var e=this.line.geometry,t=0!==e.getArea();if(t){for(var i=this.polygon.geometry.components,n=i.length-2;0<=n;--n)if(e.intersects(i[n])){t=!1;break}if(t)e:for(n=i.length-2;0<n;--n)for(var s=i[n].components,r=0,a=s.length;r<a;++r)if(e.containsPoint(s[r])){t=!1;break e}}return t?this.polygon.state!==OpenLayers.State.INSERT&&(this.polygon.state=OpenLayers.State.UPDATE):this.polygon.geometry.removeComponent(e),this.restoreFeature(),!1},cancel:function(){return this.drawingHole&&(this.polygon.geometry.removeComponent(this.line.geometry),this.restoreFeature(!0)),OpenLayers.Handler.Path.prototype.cancel.apply(this,arguments)},restoreFeature:function(e){this.control.layer.events.unregister("sketchcomplete",this,this.finalizeInteriorRing),this.control.layer.events.unregister("sketchmodified",this,this.enforceTopology),this.layer.removeFeatures([this.polygon],{silent:!0}),this.control.layer.addFeatures([this.polygon],{silent:!0}),this.drawingHole=!1,e||this.control.layer.events.triggerEvent("sketchcomplete",{feature:this.polygon})},destroyFeature:function(e){OpenLayers.Handler.Path.prototype.destroyFeature.call(this,e),this.polygon=null},drawFeature:function(){this.layer.drawFeature(this.polygon,this.style),this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.polygon},getGeometry:function(){var e=this.polygon&&this.polygon.geometry;return e&&this.multi&&(e=new OpenLayers.Geometry.MultiPolygon([e])),e},CLASS_NAME:"OpenLayers.Handler.Polygon"}),OpenLayers.Handler.RegularPolygon=OpenLayers.Class(OpenLayers.Handler.Drag,{sides:4,radius:null,snapAngle:null,snapToggle:"shiftKey",layerOptions:null,persist:!1,irregular:!1,citeCompliant:!1,angle:null,fixedRadius:!1,feature:null,layer:null,origin:null,initialize:function(e,t,i){i&&i.layerOptions&&i.layerOptions.styleMap||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style.default,{})),OpenLayers.Handler.Drag.prototype.initialize.apply(this,[e,t,i]),this.options=i?i:{}},setOptions:function(e){OpenLayers.Util.extend(this.options,e),OpenLayers.Util.extend(this,e)},activate:function(){var e=!1;return OpenLayers.Handler.Drag.prototype.activate.apply(this,arguments)&&(e=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions),this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,e),this.map.addLayer(this.layer),e=!0),e},deactivate:function(){var e=!1;return OpenLayers.Handler.Drag.prototype.deactivate.apply(this,arguments)&&(this.dragging&&this.cancel(),null!=this.layer.map&&(this.layer.destroy(!1),this.feature&&this.feature.destroy()),this.feature=this.layer=null,e=!0),e},down:function(e){this.fixedRadius=!!this.radius,e=this.layer.getLonLatFromViewPortPx(e.xy),this.origin=new OpenLayers.Geometry.Point(e.lon,e.lat),this.fixedRadius&&!this.irregular||(this.radius=this.map.getResolution()),this.persist&&this.clear(),this.feature=new OpenLayers.Feature.Vector,this.createGeometry(),this.callback("create",[this.origin,this.feature]),this.layer.addFeatures([this.feature],{silent:!0}),this.layer.drawFeature(this.feature,this.style)},move:function(e){var t=this.layer.getLonLatFromViewPortPx(e.xy),t=new OpenLayers.Geometry.Point(t.lon,t.lat);this.irregular?(e=Math.sqrt(2)*Math.abs(t.y-this.origin.y)/2,this.radius=Math.max(this.map.getResolution()/2,e)):this.fixedRadius?this.origin=t:(this.calculateAngle(t,e),this.radius=Math.max(this.map.getResolution()/2,t.distanceTo(this.origin))),this.modifyGeometry(),this.irregular&&(e=t.x-this.origin.x,t=t.y-this.origin.y,this.feature.geometry.resize(1,this.origin,0==t?e/(this.radius*Math.sqrt(2)):e/t),this.feature.geometry.move(e/2,t/2)),this.layer.drawFeature(this.feature,this.style)},up:function(e){this.finalize(),this.start==this.last&&this.callback("done",[e.xy])},out:function(e){this.finalize()},createGeometry:function(){this.angle=Math.PI*(1/this.sides-.5),this.snapAngle&&(this.angle+=Math.PI/180*this.snapAngle),this.feature.geometry=OpenLayers.Geometry.Polygon.createRegularPolygon(this.origin,this.radius,this.sides,this.snapAngle)},modifyGeometry:function(){var e,t,i=this.feature.geometry.components[0];i.components.length!=this.sides+1&&(this.createGeometry(),i=this.feature.geometry.components[0]);for(var n=0;n<this.sides;++n)t=i.components[n],e=this.angle+2*n*Math.PI/this.sides,t.x=this.origin.x+this.radius*Math.cos(e),t.y=this.origin.y+this.radius*Math.sin(e),t.clearBounds()},calculateAngle:function(e,t){var i=Math.atan2(e.y-this.origin.y,e.x-this.origin.x);if(this.snapAngle&&this.snapToggle&&!t[this.snapToggle]){var n=Math.PI/180*this.snapAngle;this.angle=Math.round(i/n)*n}else this.angle=i},cancel:function(){this.callback("cancel",null),this.finalize()},finalize:function(){this.origin=null,this.radius=this.options.radius},clear:function(){this.layer&&(this.layer.renderer.clear(),this.layer.destroyFeatures())},callback:function(e,t){this.callbacks[e]&&this.callbacks[e].apply(this.control,[this.feature.geometry.clone()]),this.persist||"done"!=e&&"cancel"!=e||this.clear()},CLASS_NAME:"OpenLayers.Handler.RegularPolygon"}),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.InteractiveMap=e()}}(function(){return function e(t,i,n){function s(a,o){if(!i[a]){if(!t[a]){var l="function"==typeof require&&require;if(!o&&l)return l(a,!0);if(r)return r(a,!0);var h=new Error("Cannot find module '"+a+"'");throw h.code="MODULE_NOT_FOUND",h}var u=i[a]={exports:{}};t[a][0].call(u.exports,function(e){var i=t[a][1][e];return s(i?i:e)},u,u.exports,e,t,i,n)}return i[a].exports}for(var r="function"==typeof require&&require,a=0;a<n.length;a++)s(n[a]);return s}({1:[function(e,t,i){function n(t,i){function n(e){var t=ge(e.object.lonlat.lon,e.object.lonlat.lat),i=Ee.WorldXYtoGridXY(t.x,t.y);e.object.treeVisible=!e.object.treeVisible,e.object.setOpacity(e.object.treeVisible?1:.4),Ee.toggleTree(i.x,i.y),e.object.treeVisible?delete fe[e.object.tree_loc]:fe[e.object.tree_loc]=e.object,T()}function h(e,t){var i,n,s;if(e.object.showInfo)ne.removeFeatures(e.object.day_vision_feature),se.removeFeatures(e.object.night_vision_feature),re.removeFeatures(e.object.true_sight_feature),ae.removeFeatures(e.object.attack_range_feature),t||l.removeQueryStringValue("tower_vision",e.object.tower_loc.x+","+e.object.tower_loc.y);else{s=new OpenLayers.Geometry.Point(e.object.lonlat.lon,e.object.lonlat.lat),i=OpenLayers.Geometry.Polygon.createRegularPolygon(s,Oe(e.object.day_vision_radius),30),n=new OpenLayers.Feature.Vector(i),ne.addFeatures(n),e.object.day_vision_feature=n,i=OpenLayers.Geometry.Polygon.createRegularPolygon(s,Oe(e.object.true_sight_radius),30),n=new OpenLayers.Feature.Vector(i,null,ce.lightblue),re.addFeatures(n),e.object.true_sight_feature=n,i=OpenLayers.Geometry.Polygon.createRegularPolygon(s,Oe(e.object.night_vision_radius),30),n=new OpenLayers.Feature.Vector(i),se.addFeatures(n),e.object.night_vision_feature=n,i=OpenLayers.Geometry.Polygon.createRegularPolygon(s,Oe(e.object.attack_range_radius),30),n=new OpenLayers.Feature.Vector(i,null,ce.red),ae.addFeatures(n),e.object.attack_range_feature=n,t||l.addQueryStringValue("tower_vision",e.object.tower_loc.x+","+e.object.tower_loc.y);ve(e.object.tower_loc.x,e.object.tower_loc.y)}e.object.showInfo=!e.object.showInfo}function u(e){return function(t){var i=Y.getLonLatFromPixel(t.xy),n=p(i,e);l.addQueryStringValue(n.ward_type,n.ward_loc)}}function p(e,t,i){var n=H[t],s=L(n.icon_path,e),r=OpenLayers.Geometry.Polygon.createRegularPolygon(new OpenLayers.Geometry.Point(s.lonlat.lon,s.lonlat.lat),Oe(n.radius),40),a=new OpenLayers.Feature.Vector(r);if(ue.addMarker(s),le.addFeatures(a),s.radius_feature=a,s.events.register("click",this,c),s.events.register("touchend",this,c),s.ward_type=t,s.ward_loc=t,void 0==i){var o=ge(e.lon,e.lat);o.x=o.x.toFixed(0),o.y=o.y.toFixed(0),s.ward_loc=o.x+","+o.y}else s.ward_loc=i;return de&&"observer"==t&&N(e,s,H.observer.radius),s}function c(e){e.object.radius_feature&&le.removeFeatures(e.object.radius_feature),e.object.vision_feature&&he.removeFeatures(e.object.vision_feature),e.object.vision_center_feature&&he.removeFeatures(e.object.vision_center_feature),ue.removeMarker(e.object),OpenLayers.Event.stop(e),l.removeQueryStringValue(e.object.ward_type,e.object.ward_loc)}function y(e){}function d(e){var t="";t+=1==e.order?"Distance: "+xe(e.order,e.units,e.measure).toFixed(0)+" units":"Distance: "+xe(e.order,e.units,e.measure).toFixed(0)+" units<sup>2</sup>",document.getElementById("output").innerHTML=t,U=xe(e.order,e.units,e.measure),document.getElementById("traveltime").innerHTML=(U/document.getElementById("movespeed").value).toFixed(2),document.getElementById("traveltime-container").style.display=""}function m(e){var t=document.getElementById("output"),i="";i+=1==e.order?"Radius: "+xe(e.order,e.units,e.measure).toFixed(0)+" units":"Distance: "+xe(e.order,e.units,e.measure).toFixed(0)+" units<sup>2</sup>",t.innerHTML=i}function f(e){var t,i,n=document.getElementById("output"),s="",r=this;z.select.deactivate(),1==e.order?(e.measure>0&&(t="km"==e.units?OpenLayers.Geometry.Polygon.createRegularPolygon(new OpenLayers.Geometry.Point(e.geometry.components[0].x,e.geometry.components[0].y),1e3*e.measure,30):OpenLayers.Geometry.Polygon.createRegularPolygon(new OpenLayers.Geometry.Point(e.geometry.components[0].x,e.geometry.components[0].y),e.measure,30),i=new OpenLayers.Feature.Vector(t),oe.removeFeatures(e.geometry.circle_features),"circle_features"in e.geometry?(e.geometry.circle_features.length=0,e.geometry.circle_features.push(i)):e.geometry.circle_features=[i],i.measure_control=this,i.is_measuring=!0,oe.addFeatures(i),e.geometry.components.length>2&&setTimeout(function(){i.is_measuring=!1,z.select.activate(),r.cancel()},0)),s+="Radius: "+xe(e.order,e.units,e.measure).toFixed(0)+" units"):s+="Distance: "+xe(e.order,e.units,e.measure).toFixed(0)+" units<sup>2</sup>",n.innerHTML=s}function g(){var e;l.setQueryString("mode",null);for(var t in z)e=z[t],this.value==t&&this.checked?(l.setQueryString("mode",t),e.activate()):e.deactivate(),"polygonControl"!=this.value&&"circle"!=this.value||!this.checked?z.select.deactivate():z.select.activate();document.getElementById("output").innerHTML="",document.getElementById("traveltime-container").style.display="none"}function v(e,t,i,n,s,r){function a(e){null==this.popup?(this.popup=this.createPopup(this.closeBox),Y.addPopup(this.popup),this.popup.show()):this.popup.toggle(),currentPopup=this.popup,OpenLayers.Event.stop(e)}var o,l=new OpenLayers.Feature(e,t);return l.closeBox=s,l.popupClass=i,l.data.popupContentHTML=n,l.data.overflow=r?"auto":"hidden",o=l.createMarker(),"Towers"==e.name&&(o.events.register("mouseover",l,a),o.events.register("mouseout",l,a)),e.addMarker(o),o}function L(e,t){var i=new OpenLayers.Size(21,25),n=new OpenLayers.Pixel(-(i.w/2),-i.h),s=new OpenLayers.Icon(e,i,n),r=new OpenLayers.Marker(t,s);return r}function O(e,t){var i=ve(e.x-32,e.y-32),n=ve(e.x-32,e.y+32),s=ve(e.x+32,e.y+32),r=ve(e.x+32,e.y-32),a=[new OpenLayers.Geometry.Point(i.x,i.y),new OpenLayers.Geometry.Point(n.x,n.y),new OpenLayers.Geometry.Point(s.x,s.y),new OpenLayers.Geometry.Point(r.x,r.y)],o=new OpenLayers.Geometry.LinearRing(a),l=new OpenLayers.Feature.Vector(o,null,t);return l}function x(e,t){return function(i){var n=this.map.getResolution(),s=Math.round((i.left-this.maxExtent.left)/(n*this.tileSize.w)),r=Math.round((this.maxExtent.top-i.top)/(n*this.tileSize.h)),a=Y.getZoom(),o=a+"/tile_"+s+"_"+r+"."+this.type,l=this.url;return l instanceof Array&&(l=this.selectUrl(o,l)),l+e+"/"+t+"/"+o}}function w(){K.forEach(function(e){var t=Y.getLayersByName(Q[e])[0];t&&(Y.removeLayer(t),t.destroy())}),ne.destroyFeatures(),se.destroyFeatures(),re.destroyFeatures(),ae.destroyFeatures(),Y.events.unregister("changelayer",Y,S)}function E(e){var t,i={},n=Y.getLayersByName("Placed Wards")[0];K.forEach(function(n){if(e[n])if("trigger_multiple"!=n&&"ent_dota_tree"!=n&&"no_wards"!=n&&"ent_fow_blocker_node"!=n){i[n]=new OpenLayers.Layer.Markers(Q[n],{visibility:!1}),Y.addLayer(i[n]);for(var s=0;s<e[n].length;s++){var r=ve(e[n][s].x,e[n][s].y);t=v(i[n],new OpenLayers.LonLat(r.x,r.y),OpenLayers.Popup.FramedCloud,"Click to toggle range overlay",!1),t.day_vision_radius=G,t.night_vision_radius=j,t.true_sight_radius=V,t.attack_range_radius=W,t.showInfo=!1,"npc_dota_tower"==n&&(t.events.register("click",i[n],h),t.events.register("touchend",i[n],h),t.tower_loc=e[n][s])}}else"ent_dota_tree"==n?(i[n]=new OpenLayers.Layer.Markers(Q[n],{visibility:!1}),Y.addLayer(i[n]),i[n].data=e[n]):"trigger_multiple"==n&&C(i,n,"npc_dota_neutral_spawner_box",e[n]);else de&&("no_wards"===n?F(i,n,Q[n],ce.red):"ent_fow_blocker_node"===n&&F(i,n,Q[n],ce.lightblue))}),A=e,Y.raiseLayer(n,Y.layers.length),Y.events.register("changelayer",Y,S),P()}function S(e){"visibility"!==e.property||e.layer.name!=Q.ent_dota_tree||e.layer.loaded||b(),"visibility"===e.property&&(e.layer.isBaseLayer?l.setQueryString("BaseLayer",e.layer.name.replace(/ /g,"")):l.setQueryString(e.layer.name.replace(/ /g,""),!!e.layer.visibility||null))}function b(){for(var e=Y.getLayersByName(Q.ent_dota_tree)[0],t=0;t<e.data.length;t++){var i=ve(e.data[t].x,e.data[t].y);marker=v(e,new OpenLayers.LonLat(i.x,i.y),OpenLayers.Popup.FramedCloud,"Click to toggle tree as alive or cut-down.<br>This will affect the simulated placed wards vision.<br>Tree coordinate: "+e.data[t].x+", "+e.data[t].y,!1),marker.treeVisible=!0,marker.tree_loc=e.data[t].x+","+e.data[t].y,marker.events.register("click",e,n),ye[e.data[t].x+","+e.data[t].y]=marker}e.loaded=!e.loaded}function C(e,t,i,n){e[i]=new OpenLayers.Layer.Vector(Q[t]),Y.addLayer(e[i]),e[i].setVisibility(!1);for(var s=0;s<n.length;s++){pnt=[];for(var r=0;r<n[s].length;r++){var a=ve(n[s][r].x,n[s][r].y);pnt.push(new OpenLayers.Geometry.Point(a.x,a.y))}ln=new OpenLayers.Geometry.LinearRing(pnt),pf=new OpenLayers.Feature.Vector(ln,null,ce.green),e[i].addFeatures([pf])}}function P(){var e=l.getParameterByName("mode");if(e){var t=document.getElementById(e+"Toggle");t&&(t.checked=!0,g.call(t))}var i=l.getParameterByName("zoom");i&&Y.zoomTo(parseInt(i));var n=l.getParameterByName("x"),s=l.getParameterByName("y");if(n&&s){var r=ve(n,s);Y.setCenter(new OpenLayers.LonLat(r.x,r.y),void 0,!1,!1)}for(var a=["observer","sentry"],u=0;u<a.length;u++){var c=l.getParameterByName(a[u]);c&&(ward_coordinates=o(c," ;").split(";"),ward_coordinates.map(function(e){var t=e.split(","),i=ve(parseFloat(t[0]),parseFloat(t[1]));p(new OpenLayers.LonLat(i.x,i.y),a[u],e)}))}var y=l.getParameterByName("BaseLayer");if(y)for(var u=0;u<$.length;u++){var d=$[u],m=d.name.replace(/ /g,"");if(y===m){Y.setBaseLayer(d);break}}for(k in Q){var m=Q[k].replace(/ /g,"");if(value=l.getParameterByName(m),value){var d=Y.getLayersByName(Q[k])[0];d&&d.setVisibility("true"==value)}}var f=l.getParameterByName("cut_trees");if(f){var d=Y.getLayersByName(Q.ent_dota_tree)[0];d.loaded||b(),cut_tree_coordinates=o(f," ;").split(";");for(var u=0;u<cut_tree_coordinates.length;u++)ye[cut_tree_coordinates[u]]&&(ye[cut_tree_coordinates[u]].treeVisible=!1,ye[cut_tree_coordinates[u]].setOpacity(.4),fe[cut_tree_coordinates[u]]=ye[cut_tree_coordinates[u]])}var v=l.getParameterByName("tower_vision");if(v){var d=Y.getLayersByName(Q.npc_dota_tower)[0];tower_vision_coordinates=o(v," ;").split(";");for(var u=0;u<tower_vision_coordinates.length;u++)for(var L=0;L<d.markers.length;L++)d.markers[L].tower_loc.x+","+d.markers[L].tower_loc.y==tower_vision_coordinates[u]&&h({object:d.markers[L]},!0)}}function T(){var e=Object.keys(fe).join(";");l.setQueryString("cut_trees",e)}function M(e,t){var i=new XMLHttpRequest;return i.open("GET",e,!0),i.onload=function(){if(i.status>=200&&i.status<400){var e=JSON.parse(i.responseText);t(e)}else alert("Error loading page.")},i.onerror=function(){alert("Error loading page.")},i.send(),i}function _(e){document.querySelector(".controls").style.display="none",document.getElementById("controls-max").style.display="block",this.style.display="none",e&&e.preventDefault()}function I(){return(window.innerWidth>0?window.innerWidth:screen.width)<=768}function R(){var e=l.getParameterByName("data");e&&(document.getElementById("dataControl").value=e),de="687"!=e,document.getElementById("visionSimulationControl").disabled=!de,document.getElementById("alwaysSimulateControl").disabled=!de,M(X+D()+"/mapdata.json",E)}function D(){return document.getElementById("dataControl").value}function N(e,t,i){var n=ge(e.lon,e.lat),s=Ee.WorldXYtoGridXY(n.x,n.y);if(Ee.isValidXY(s.x,s.y,!0,!0,!0)){var r=O(Ee.GridXYtoWorldXY(s.x,s.y),ce.green);t&&(he.addFeatures([r]),t.vision_center_feature=r),Ee.updateVisibility(s.x,s.y,Le(i));var o=a(Ee.grid,Ee.lights),l=o.map(function(e){var t=e.map(function(e){var t=Ee.GridXYtoWorldXY(e.x,e.y),i=ve(t.x,t.y);return new OpenLayers.Geometry.Point(i.x,i.y)}),i=new OpenLayers.Geometry.LinearRing(t);return new OpenLayers.Geometry.Polygon([i])}),h=new OpenLayers.Geometry.MultiPolygon(l),u=new OpenLayers.Feature.Vector(h,null,ce.yellow);t?(he.addFeatures([u]),t.vision_feature=u):ie.addFeatures([u])}}function F(e,t,i,n){var s=X+D()+"/"+t+".json";e[t]=new OpenLayers.Layer.Vector(i,{strategies:[new OpenLayers.Strategy.Fixed],protocol:new OpenLayers.Protocol.HTTP({url:s,format:new OpenLayers.Format.GeoJSON}),visibility:!1}),e[t].style=n,Y.addLayer(e[t])}var A,z,U,B="img/",H={observer:{icon_path:B+"ward_observer.png",radius:1600},sentry:{icon_path:B+"ward_sentry.png",radius:850}},G=1900,j=800,V=900,W=700,X="data/",Z=e("./mapConstants"),q=e("./conversionFunctions"),Y=(new OpenLayers.Layer.Zoomify("Zoomify",t,new OpenLayers.Size(Z.map_w,Z.map_h)),new OpenLayers.Map("map",{theme:null,maxExtent:new OpenLayers.Bounds(0,0,Z.map_w,Z.map_h),numZoomLevels:5,maxResolution:Math.pow(2,4),units:"m"})),K=["no_wards","ent_fow_blocker_node","trigger_multiple","npc_dota_roshan_spawner","ent_dota_tree","dota_item_rune_spawner","dota_item_rune_spawner_bounty","ent_dota_shop","npc_dota_barracks","npc_dota_building","npc_dota_healer","npc_dota_fort","npc_dota_tower"],Q={npc_dota_roshan_spawner:"Roshan",dota_item_rune_spawner:"Runes",dota_item_rune_spawner_bounty:"Bounty Runes",ent_dota_tree:"Trees",npc_dota_healer:"Shrines",npc_dota_fort:"Ancients",ent_dota_shop:"Shops",npc_dota_tower:"Towers",npc_dota_barracks:"Barracks",npc_dota_building:"Buildings",trigger_multiple:"Neutral Camps Spawn Boxes",npc_dota_neutral_spawner:"Neutral Camps",no_wards:"Invalid Ward Locations",ent_fow_blocker_node:"Vision Blocker"},$=[new OpenLayers.Layer.TMS("7.00 Default",t,{type:"jpg",getURL:x("700","default")}),new OpenLayers.Layer.TMS("6.87 Default",t,{type:"jpg",getURL:x("687","default")}),new OpenLayers.Layer.TMS("6.87 Desert",t,{type:"jpg",getURL:x("687","desert")}),new OpenLayers.Layer.TMS("6.87 Immortal Gardens",t,{type:"jpg",getURL:x("687","immortalgardens")})],J={"Day Vision Range":"Towers","Night Vision Range":"Towers","True Sight Range":"Towers","Attack Range":"Towers",Towers:"Structures",Shrines:"Structures",Ancients:"Structures",Barracks:"Structures",Buildings:"Structures",Shops:"Structures","Invalid Ward Locations":"Vision","Vision Blocker":"Vision","Placed Wards":"Vision","Ward Vision":"Vision","Ward Vision with Fog":"Vision"},ee=new OpenLayers.Control.LayerSwitcher({ascending:!1,overlayGrouping:J}),te=new OpenLayers.Control.MousePosition,ie=new OpenLayers.Layer.Vector("Cursor",{displayInLayerSwitcher:!1}),ne=new OpenLayers.Layer.Vector("Day Vision Range"),se=new OpenLayers.Layer.Vector("Night Vision Range"),re=new OpenLayers.Layer.Vector("True Sight Range"),ae=new OpenLayers.Layer.Vector("Attack Range"),oe=new OpenLayers.Layer.Vector("Drawn Circles"),le=new OpenLayers.Layer.Vector("Ward Vision"),he=new OpenLayers.Layer.Vector("Ward Vision with Fog"),ue=new OpenLayers.Layer.Markers("Placed Wards"),pe=OpenLayers.Util.getParameters(window.location.href).renderer,ce=e("./styleConstants"),ye={},de=!0,me=!0,fe={},ge=(q.reverseLerp,q.latLonToWorld),ve=q.worldToLatLon,Le=q.getTileRadius,Oe=q.getScaledRadius,xe=q.calculateDistance;OpenLayers.ImgPath=B,$.forEach(function(e){Y.addLayer(e)}),Y.addLayer(ie),Y.addLayer(ne),Y.addLayer(se),Y.addLayer(re),Y.addLayer(ae),Y.addLayer(oe),Y.addLayer(le),Y.addLayer(he),Y.addLayer(ue),Y.addControl(te),Y.addControl(new OpenLayers.Control.TouchNavigation({dragPanOptions:{enableKinetic:!0}})),Y.addControl(new OpenLayers.Control.KeyboardDefaults),ee.onButtonClick=function(e){return function(t){var i=t.buttonElement;return i===this.maximizeDiv&&I()&&_.call(document.getElementById("controls-min")),e.apply(this,arguments)}}(ee.onButtonClick),Y.addControl(ee),ee.maximizeControl(),Y.getCenter()||Y.zoomToMaxExtent(),OpenLayers.Control.Click=OpenLayers.Class(OpenLayers.Control,{defaultHandlerOptions:{single:!0,double:!1,pixelTolerance:0,stopSingle:!1,stopDouble:!1},initialize:function(e){this.handlerOptions=OpenLayers.Util.extend({},this.defaultHandlerOptions),OpenLayers.Control.prototype.initialize.apply(this,arguments),this.handler=new OpenLayers.Handler.Click(this,{click:this.onClick,dblclick:this.onDblclick},this.handlerOptions)},onClick:y,onDblclick:function(e){var t=document.getElementById(this.key+"Output"),i="dblclick "+e.xy;t.value=t.value+i+"\n"}}),pe=pe?[pe]:OpenLayers.Layer.Vector.prototype.renderers,z={line:new OpenLayers.Control.Measure(OpenLayers.Handler.Path,{persist:!0,immediate:!0,handlerOptions:{layerOptions:{renderers:pe}}}),circle:new OpenLayers.Control.Measure(OpenLayers.Handler.Path,{persist:!1,immediate:!0,handlerOptions:{layerOptions:{renderers:pe}}}),observer:new OpenLayers.Control.Click({onClick:u("observer"),handlerOptions:{single:!0}}),sentry:new OpenLayers.Control.Click({onClick:u("sentry"),handlerOptions:{single:!0}}),polygonControl:new OpenLayers.Control.DrawFeature(oe,OpenLayers.Handler.RegularPolygon,{handlerOptions:{sides:30}}),select:new OpenLayers.Control.SelectFeature(oe,{hover:!0,highlightOnly:!1,callbacks:{click:function(e){var t=document.getElementById("output");e.measure_control&&e.is_measuring?(e.measure_control.cancel(),e.is_measuring=!1,this.highlight(e)):(t.innerHTML="",oe.removeFeatures(e))}},overFeature:function(e){var t=document.getElementById("output"),i="Radius: "+(.565352*Math.sqrt(e.geometry.getArea())*Z.scale).toFixed(0)+" units";t.innerHTML=i,this.highlight(e)},outFeature:function(e){var t=document.getElementById("output");t.innerHTML="",this.unhighlight(e)}})};for(var we in z)"line"==we&&z[we].events.on({measure:d,measurepartial:d}),"circle"==we&&z[we].events.on({measure:m,measurepartial:f}),Y.addControl(z[we]);Y.events.register("zoomend",Y,function(){l.setQueryString("zoom",Y.zoom)}),Y.events.register("moveend",Y,function(){var e=ge(Y.center.lon,Y.center.lat);l.setQueryString("x",e.x.toFixed(0)),l.setQueryString("y",e.y.toFixed(0))}),te.formatOutput=function(e){var t=ge(e.lon,e.lat);return t.x.toFixed(0)+", "+t.y.toFixed(0)},Y.events.register("mousemove",Y,function(e){if(ie.destroyFeatures(),de&&document.getElementById("observerToggle").checked){var t=Y.getLonLatFromPixel(e.xy),i=ge(t.lon,t.lat),n=Ee.WorldXYtoGridXY(i.x,i.y),s=Ee.tree_relations[n.key],r=!1;s&&(r=Ee.tree_state[s.key]);var a=ce.green;Ee.isValidXY(n.x,n.y,!0,!0,!0)||(a=ce.red);var o=O(Ee.GridXYtoWorldXY(n.x,n.y),a);ie.addFeatures([o]),me&&N(t,null,H.observer.radius)}}),document.getElementById("controls-max").addEventListener("click",function(e){document.querySelector(".controls").style.display="",document.getElementById("controls-min").style.display="block",this.style.display="none",I()&&ee.minimizeControl(),e&&e.preventDefault()},!1),document.getElementById("controls-min").addEventListener("click",_,!1),I()&&(_.call(document.getElementById("controls-min")),ee.minimizeControl()),document.getElementById("coordControl").addEventListener("change",function(e){this.checked?document.querySelector(".olControlMousePosition").style.display="block":document.querySelector(".olControlMousePosition").style.display="none"},!1),document.getElementById("visionSimulationControl").addEventListener("change",function(e){de=this.checked,document.getElementById("alwaysSimulateControl").disabled=!this.checked},!1),document.getElementById("alwaysSimulateControl").addEventListener("change",function(e){me=this.checked},!1),document.getElementById("movespeed").addEventListener("change",function(e){document.getElementById("traveltime").innerHTML=(U/document.getElementById("movespeed").value).toFixed(2)},!1),document.getElementById("navigateToggle").addEventListener("click",g,!1),document.getElementById("lineToggle").addEventListener("click",g,!1),document.getElementById("circleToggle").addEventListener("click",g,!1),document.getElementById("observerToggle").addEventListener("click",g,!1),document.getElementById("sentryToggle").addEventListener("click",g,!1),document.getElementById("dataControl").addEventListener("change",function(){l.setQueryString("data",document.getElementById("dataControl").value),
w(),R()},!1);var Ee=new s(r,i,function(){R()})}var s=e("dota-vision-simulation"),r=e("dota-vision-simulation/src/worlddata.json"),a=e("./getLightUnion"),o=e("./util/trim"),l=e("./util/queryString");t.exports=n},{"./conversionFunctions":2,"./getLightUnion":3,"./mapConstants":4,"./styleConstants":5,"./util/queryString":6,"./util/trim":7,"dota-vision-simulation":10,"dota-vision-simulation/src/worlddata.json":11}],2:[function(e,t,i){function n(e,t,i){return i*(t-e)+e}function s(e,t,i){return(i-e)/(t-e)}function r(e,t){var i=n(u.map_x_boundaries[0],u.map_x_boundaries[1],e/u.map_w),s=n(u.map_y_boundaries[0],u.map_y_boundaries[1],(u.map_h-t)/u.map_h);return{x:i,y:s}}function a(e,t){var i=s(u.map_x_boundaries[0],u.map_x_boundaries[1],e)*u.map_w,n=u.map_h-s(u.map_y_boundaries[0],u.map_y_boundaries[1],t)*u.map_h;return{x:i,y:n}}function o(e){return parseInt(Math.floor(e/64))}function l(e){return e/(u.map_x_boundaries[1]-u.map_x_boundaries[0])*u.map_w}function h(e,t,i){return 1==e&&"km"==t?i*u.scale*1e3:i*u.scale}var u=e("./mapConstants");t.exports={lerp:n,reverseLerp:s,latLonToWorld:r,worldToLatLon:a,getTileRadius:o,getScaledRadius:l,calculateDistance:h}},{"./mapConstants":4}],3:[function(e,t,i){function n(e,t,i,s,r){for(var a=c(s),o=[[1,0],[0,-1],[-1,0],[0,1]],l=0;l<o.length;l++){var h=a.x+o[l][0],u=a.y+o[l][1];if(e[h]&&e[h][u]){var p=e[h][u].key;!i[p]&&t[p]&&(i[p]=r,n(e,t,i,p,r))}}}function s(e,t){var i={},s=1;for(var r in t)i[r]||(i[r]=s,n(e,t,i,r,s),s++);for(var a=[],o=1;o<s;o++)a.push(l(e,i,o));return a}function r(e,t,i,n){var s=i.x+n[0],r=i.y+n[1];if(!e[s]||!e[s][r])return!0;var a=e[s][r].key;return!t[a]}function a(e,t,i){for(var n=0;n<8;n+=2){var s=i.x+Math.round(Math.cos(2*Math.PI-Math.PI/4*n)),r=i.y+Math.round(Math.sin(2*Math.PI-Math.PI/4*n));if(!e[s]||!e[s][r])return n;var a=e[s][r].key;if(!t[a])return n}return null}function o(e,t){return(e%t+t)%t}function l(e,t,i){var n,s=[],r=null;for(var o in t){var l=c(o);if(r=a(e,t,l),t[o]==i&&null!==r){n=o;break}}for(var h=u(e,t,n,r);n!==h.key||r!==h.dir;)s.push(h.point),h=u(e,t,h.key,h.dir);return s.push(h.point),s}function h(e,t,i,n,s,a,o){var l=i.x+s[0],h=i.y+s[1];if(e[l]&&e[l][h]){var u=e[i.x+s[0]][i.y+s[1]];return t[u.key]==t[n]&&r(e,t,u,o)?{key:u.key,dir:a}:void 0}}function u(e,t,i,n){var s,a=c(i),l=Math.round(Math.cos(2*Math.PI-Math.PI/4*n)),u=Math.round(Math.sin(2*Math.PI-Math.PI/4*n)),p=o(n+2,8),d=Math.round(Math.cos(2*Math.PI-Math.PI/4*p)),m=Math.round(Math.sin(2*Math.PI-Math.PI/4*p)),f=o(n-1,8),g=Math.round(Math.cos(2*Math.PI-Math.PI/4*f)),v=Math.round(Math.sin(2*Math.PI-Math.PI/4*f));if(r(e,t,a,[d,m]))return{key:i,dir:o(n+2,8),point:y(a.x+g/2,a.y+v/2)};if(s||(s=h(e,t,a,i,[d,m],n,[l,u])),!s){var L=o(n+1,8),O=Math.round(Math.cos(2*Math.PI-Math.PI/4*L)),x=Math.round(Math.sin(2*Math.PI-Math.PI/4*L)),w=o(n-2,8),E=Math.round(Math.cos(2*Math.PI-Math.PI/4*w)),S=Math.round(Math.sin(2*Math.PI-Math.PI/4*w));s=h(e,t,a,i,[O,x],w,[E,S])}return s?(s.point=y(a.x+g/2,a.y+v/2),s):void 0}var p=e("dota-vision-simulation"),c=p.prototype.key2pt,y=(p.prototype.xy2key,p.prototype.xy2pt);t.exports=s},{"dota-vision-simulation":10}],4:[function(e,t,i){var n={map_w:16384,map_h:16384,map_x_boundaries:[-8475.58617377,9327.49124559],map_y_boundaries:[9028.52473332,-8836.61406266]};n.scale=Math.abs(n.map_x_boundaries[1]-n.map_x_boundaries[0])/n.map_w,t.exports=n},{}],5:[function(e,t,i){t.exports={lightblue:{strokeColor:"#007FFF",strokeOpacity:1,strokeWidth:1,fillColor:"#007FFF",fillOpacity:.4},red:{strokeColor:"#FF0000",strokeOpacity:1,strokeWidth:1,fillColor:"#FF0000",fillOpacity:.4},green:{strokeColor:"#00FF00",strokeOpacity:1,strokeWidth:1,fillColor:"#00FF00",fillOpacity:.4},yellow:{strokeColor:"#FFFF00",strokeOpacity:1,strokeWidth:1,fillColor:"#FFFF00",fillOpacity:.4}}},{}],6:[function(e,t,i){function n(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),i=t.exec(location.search);return null==i?"":decodeURIComponent(i[1].replace(/\+/g," "))}function s(e,t){history.replaceState(null,"",o(e,t))}function r(e,t){var i=n(e);i=l(l(i," ;")+";"+t," ;"),history.replaceState(null,"",o(e,i))}function a(e,t){var i=n(e);i=l(l(i," ;").replace(t,"").replace(/;;/g,"")," ;"),history.replaceState(null,"",o(e,""!=i?i:null))}function o(e,t,i){i||(i=window.location.href);var n,s=new RegExp("([?&])"+e+"=.*?(&|#|$)(.*)","gi");if(s.test(i))return"undefined"!=typeof t&&null!==t?i.replace(s,"$1"+e+"="+t+"$2$3"):(n=i.split("#"),i=n[0].replace(s,"$1$3").replace(/(&|\?)$/,""),"undefined"!=typeof n[1]&&null!==n[1]&&(i+="#"+n[1]),i);if("undefined"!=typeof t&&null!==t){var r=i.indexOf("?")!==-1?"&":"?";return n=i.split("#"),i=n[0]+r+e+"="+t,"undefined"!=typeof n[1]&&null!==n[1]&&(i+="#"+n[1]),i}return i}var l=e("./trim");t.exports={getParameterByName:n,setQueryString:s,addQueryStringValue:r,removeQueryStringValue:a,updateQueryString:o}},{"./trim":7}],7:[function(e,t,i){function n(e){return e.replace(/[\[\](){}?*+\^$\\.|\-]/g,"\\$&")}var s=function(e,t,i){if(i=i||"g","string"!=typeof e||"string"!=typeof t||"string"!=typeof i)throw new TypeError("argument must be string");if(!/^[gi]*$/.test(i))throw new TypeError("Invalid flags supplied '"+i.match(new RegExp("[^gi]*"))+"'");return t=n(t),e.replace(new RegExp("^["+t+"]+|["+t+"]+$",i),"")};t.exports=s},{}],8:[function(e,t,i){function n(e){this.imagePath=e,this.image=null}n.prototype.load=function(e){var t=this;this.image=new Image,this.image.src=this.imagePath,this.image.onload=function(){t.canvas=document.createElement("canvas"),t.canvas.width=t.image.width,t.canvas.height=t.image.height,t.ctx=t.canvas.getContext("2d"),t.ctx.drawImage(t.image,0,0),e()}},n.prototype.scan=function(e,t,i,n,s){for(var r=this.ctx.getImageData(e,0,t,i),a=r.data,o=0;o<a.length;o+=4){var l=a[o],h=a[o+1],u=a[o+2],p=(a[o+3],Math.floor(o/4%t)),c=Math.floor(o/4/i);n(p,c,[l,h,u],s)}},t.exports=n},{}],9:[function(e,t,i){function n(e,t){return e>0&&t<0||!(t>0&&e<0)&&e<t}function s(e,t){return!n(e,t)}function r(e,t,i){return t<i?t<=e&&e<=i:t<=e&&e<=Math.PI||-Math.PI<=e&&e<=i}function a(e){return e>Math.PI?-(2*Math.PI-e):e<-Math.PI?2*Math.PI+e:e}function o(e,t){return e>0&&t<0?Math.abs(Math.PI-e-(-Math.PI-t)):t>0&&e<0?Math.abs(-e+t):e<=0&&t<=0?s(e,t)?-e+Math.PI-(-Math.PI-t):Math.abs(t-e):s(e,t)?Math.PI+(Math.PI-e)+t:Math.abs(t-e)}function l(e){for(var t=0,i=0;i<e.length;i++)t+=o(e[i][0],e[i][1]);return t}var h={DIRS:{4:[[0,-1],[1,0],[0,1],[-1,0]],8:[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],6:[[-1,-1],[1,-1],[2,0],[1,1],[-1,1],[-2,0]]}};Number.prototype.mod=function(e){return(this%e+e)%e},Object.create||(Object.create=function(e){var t=function(){};return t.prototype=e,new t}),Function.prototype.extend=function(e){return this.prototype=Object.create(e.prototype),this.prototype.constructor=this,this},"undefined"!=typeof window&&(window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return setTimeout(e,1e3/60)},window.cancelAnimationFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||function(e){return clearTimeout(e)}),h.FOV=function(e,t){this._lightPasses=e,this._options={topology:8};for(var i in t)this._options[i]=t[i]},h.FOV.prototype.compute=function(e,t,i,n){},h.FOV.prototype._getCircle=function(e,t,i){var n,s,r,a=[];switch(this._options.topology){case 4:s=1,r=[0,1],n=[h.DIRS[8][7],h.DIRS[8][1],h.DIRS[8][3],h.DIRS[8][5]];break;case 6:n=h.DIRS[6],s=1,r=[-1,1];break;case 8:n=h.DIRS[4],s=2,r=[-1,1]}for(var o=e+r[0]*i,l=t+r[1]*i,u=0;u<n.length;u++)for(var p=0;p<i*s;p++)a.push([o,l]),o+=n[u][0],l+=n[u][1];return a},h.FOV.PreciseShadowcasting=function(e,t){h.FOV.call(this,e,t)},h.FOV.PreciseShadowcasting.extend(h.FOV),h.FOV.PreciseShadowcasting.prototype.compute=function(e,t,i,n){if(n(e,t,0,1),n(e-1,t-1,0,1),n(e,t-1,0,1),n(e+1,t-1,0,1),n(e-1,t,0,1),n(e+1,t,0,1),n(e-1,t+1,0,1),n(e,t+1,0,1),n(e+1,t+1,0,1),n(e-1,t-2,0,1),n(e,t-2,0,1),n(e+1,t-2,0,1),n(e-2,t-1,0,1),n(e-2,t,0,1),n(e-2,t+1,0,1),n(e+2,t-1,0,1),n(e+2,t,0,1),n(e+2,t+1,0,1),n(e-1,t+2,0,1),n(e,t+2,0,1),n(e+1,t+2,0,1),this._lightPasses(e,t))for(var s,r,o,l,h,u,p,c,y,d,m,f,g,v,L,O,x=[],w={},E=1;E<=i;E++){var S=this._getCircle(e,t,E),b=S.length;w={};for(var C=0;C<b;C++){s=S[C][0],r=S[C][1];var P=s+","+r;if(O=this.walls[P],O&&"tree"==O[0]?(g=O[1],v=O[2],f=O[3]):(g=s,v=r,f=Math.SQRT2/2),p=g-e,c=v-t,y=Math.sqrt(p*p+c*c),y>.5)if(d=Math.asin(f/y),m=Math.atan2(c,p),l=a(m-d),h=a(m+d),o=!this._lightPasses(s,r),O&&"tree"==O[0])dx1=s-e,dy1=r-t,L=Math.sqrt(dx1*dx1+dy1*dy1),L<y&&(w[O[1]+","+O[2]]=[O[1],O[2]]),p=s-e,c=r-t,y=Math.sqrt(p*p+c*c),d=Math.asin(f/y),m=Math.atan2(c,p),l=a(m-d),h=a(m+d),u=this._checkVisibility(m,l,h,!1,x),u&&n(s,r,E,u);else if(u=this._checkVisibility(m,l,h,o,x),u&&n(s,r,E,u),this.done)return}for(var T in w)if(g=w[T][0],v=w[T][1],p=g-e,c=v-t,y=Math.sqrt(p*p+c*c),f=Math.SQRT2-.01,y>.5&&(d=Math.asin(f/y),m=Math.atan2(c,p),l=a(m-d),h=a(m+d),u=this._checkVisibility(m,l,h,!0,x),this.done))return}},h.FOV.PreciseShadowcasting.prototype._checkVisibility=function(e,t,i,n,s){for(var a=!n,o=0;o<s.length;o++){var l=s[o];if(r(e,l[0],l[1])){if(!n)return!1;a=!1}}return n&&(t<0&&i>=0?(this._mergeShadows(e,0,i,n,s),this.done=!1,this._mergeShadows(e,t,0,n,s)):this._mergeShadows(e,t,i,n,s),1!=s.length||r(t,s[0][0],s[0][1])&&r(i,s[0][0],s[0][1])||t==s[0][0]||i==s[0][1]||(this.done=!0)),a},h.FOV.PreciseShadowcasting.prototype._mergeShadows=function(e,t,i,s,a){for(var o=0,h=!1,u=0;o<a.length;){var p=a[o];if(u=o,r(t,p[0],p[1])){h=!0;break}if(o>0&&r(t,a[o-1][1],p[0])){h=!1;break}if(n(t,p[1])){if(n(t,p[0]))break;o++}else o++,u=o}for(var c=a.length-1,y=!1,d=0;c>=0;){var p=a[c];if(d=c,r(i,p[0],p[1])){y=!0;break}if(n(i,p[0]))c--,d=c;else{if(!n(i,p[1]))break;c--}}if(u==a.length&&!h&&0==d&&y&&(u=0),0==a.length)a.push([t,i]);else{var m=[h?a[u][0]:t,y?a[d][1]:i];d=Math.max(u,d);var f=l(a),g=!1;r(0,m[0],m[1])&&0!=m[0]&&0!=m[1]?(a.splice(u,u!=d||h!=y||h?d-u+1:0,[m[0],0]),0!=a[0][0]&&a[0][1]!=m[1]&&a.splice(u+1,0,[0,m[1]]),g=!0):a.splice(u,u!=d||h!=y||h?d-u+1:0,m);var v=l(a);if(v<f&&(this.done=!0),0==m[0]||g)for(var L=0;0!=a[0][0]&&(a.push(a.shift()),!(L>=a.length));)L++}},t.exports=h},{}],10:[function(e,t,i){function n(e){if(e in c)return c[e];var t=e.split(",").map(function(e){return parseInt(e)}),i={x:t[0],y:t[1],key:e};return c[e]=i,i}function s(e,t){return e+","+t}function r(e,t){return{x:e,y:t,key:e+","+t}}function a(e){return e.x+","+e.y}function o(e,t){var i=(Date.now(),{});for(var n in e){var s=e[n];if(s.z>t)e:for(var r=-1;r<=1;r++)for(var a=-1;a<=1;a++)if(0!==r||0!==a){var o=s.x+r+","+(s.y+a);if(e[o]&&e[o].z<=t){i[s.key]=s;break e}}}return i}function l(e,t,i,n,s,r){for(var a in i)t<n[a]&&s[a]&&r[a].forEach(function(t){e[t.x+","+t.y]=["tree",i[a].x,i[a].y,Math.SQRT2]})}function h(e,t,i,n){function s(e,t,i,n,s){var r={};return e.scan(t,i,n,s,r),r}function a(e,t,i,n){var s=y.ImageXYtoGridXY(e,t);0===i[0]&&(n[s.x+","+s.y]=s)}function o(e,t,i,n){var s=y.ImageXYtoGridXY(e,t);s.z=i[0],n[s.x+","+s.y]=s,y.elevationValues.indexOf(i[0])==-1&&y.elevationValues.push(i[0])}function h(e,t,i,n){var s=y.ImageXYtoGridXY(e,t);if(0==i[1]&&0==i[2]){var a=r(s.x-.5,s.y-.5),o=i[0]+40,l=a.key;y.tree[l]=a,y.tree_elevations[l]=o,y.tree_blocks[l]=[],y.tree_state[l]=!0,[Math.floor,Math.ceil].forEach(function(e){[Math.floor,Math.ceil].forEach(function(t){var i=r(e(a.x),t(a.y));y.tree_relations[i.key]=a,y.tree_blocks[l].push(i)})})}}var y=this;this.opts=n||{},this.grid=[],this.gridnav=null,this.ent_fow_blocker_node=null,this.tools_no_wards=null,this.elevationValues=[],this.elevationGrid=null,this.elevationWalls={},this.treeWalls={},this.tree={},this.tree_blocks={},this.tree_relations={},this.tree_elevations={},this.tree_state={},this.walls={},this.radius=this.opts.radius||parseInt(25),this.lights={},this.worldMinX=e.worldMinX,this.worldMinY=e.worldMinY,this.worldMaxX=e.worldMaxX,this.worldMaxY=e.worldMaxY,this.worldWidth=this.worldMaxX-this.worldMinX,this.worldHeight=this.worldMaxY-this.worldMinY,this.gridWidth=this.worldWidth/64+1,this.gridHeight=this.worldHeight/64+1,this.ready=!1,this.imageHandler=new u(t);Date.now();this.imageHandler.load(function(){Date.now();y.gridnav=s(y.imageHandler,2*y.gridWidth,y.gridWidth,y.gridHeight,a),y.ent_fow_blocker_node=s(y.imageHandler,3*y.gridWidth,y.gridWidth,y.gridHeight,a),y.tools_no_wards=s(y.imageHandler,4*y.gridWidth,y.gridWidth,y.gridHeight,a),s(y.imageHandler,y.gridWidth,y.gridWidth,y.gridHeight,h),y.elevationGrid=s(y.imageHandler,0,y.gridWidth,y.gridHeight,o);Date.now();y.elevationValues.forEach(function(e){y.treeWalls[e]={},l(y.treeWalls[e],e,y.tree,y.tree_elevations,y.tree_state,y.tree_blocks)});for(var e=(Date.now(),0);e<y.gridWidth;e++){y.grid[e]=[];for(var t=0;t<y.gridHeight;t++){var n=r(e,t);c[n.key]=n,y.grid[e].push(n)}}Date.now();y.ready=!0,i()}),this.lightPassesCallback=function(e,t){var i=e+","+t;return!(i in y.elevationWalls[y.elevation]||i in y.ent_fow_blocker_node||i in y.tools_no_wards||i in y.treeWalls[y.elevation])},this.fov=new p.FOV.PreciseShadowcasting(this.lightPassesCallback,{topology:8})}var u=e("./imageHandler.js"),p=e("./rot6.js"),c={};h.prototype.updateVisibility=function(e,t,i){var n=this,r=s(e,t);i=i||n.radius,this.elevation=this.elevationGrid[r].z,this.walls=this.treeWalls[this.elevation],this.elevationWalls[this.elevation]||(this.elevationWalls[this.elevation]=o(this.elevationGrid,this.elevation)),this.fov.walls=this.walls,this.lights={},this.fov.compute(e,t,i,function(r,a,o,l){var h=s(r,a);if(n.elevationGrid[h]){var u=n.tree_relations[h],p=!1;u&&(p=n.tree_state[u.key]&&n.tree_elevations[u.key]>n.elevation),1==l&&!n.ent_fow_blocker_node[h]&&!p&&(e-r)*(e-r)+(t-a)*(t-a)<i*i&&(n.lights[h]=255)}})},h.prototype.isValidXY=function(e,t,i,n,r){var a=s(e,t),o=!1;if(r){var l=this.tree_relations[a];l&&(o=this.tree_state[l.key])}return!(!(e>=0&&e<this.gridWidth&&t>=0&&t<this.gridHeight)||i&&this.gridnav[a]||n&&this.tools_no_wards[a]||r&&o)},h.prototype.toggleTree=function(e,t){var i=this,n=s(e,t),r=!!this.tree_relations[n];if(r){var a=this.tree_relations[n];this.tree_state[a.key]=!this.tree_state[a.key],this.elevationValues.forEach(function(e){e<i.tree_elevations[a.key]&&(i.tree_state[a.key]?i.tree_blocks[a.key].forEach(function(t){i.treeWalls[e][t.x+","+t.y]=["tree",a.x,a.y,Math.SQRT2]}):i.tree_blocks[a.key].forEach(function(t){delete i.treeWalls[e][t.x+","+t.y]}))})}return r},h.prototype.setRadius=function(e){this.radius=e},h.prototype.WorldXYtoGridXY=function(e,t,i){var n=(e-this.worldMinX)/64,s=(t-this.worldMinY)/64;return i||(n=parseInt(Math.round(n)),s=parseInt(Math.round(s))),{x:n,y:s,key:n+","+s}},h.prototype.GridXYtoWorldXY=function(e,t){return{x:64*e+this.worldMinX,y:64*t+this.worldMinY}},h.prototype.GridXYtoImageXY=function(e,t){return{x:e,y:this.gridHeight-t-1}},h.prototype.ImageXYtoGridXY=function(e,t){var i=this.gridHeight-t-1;return{x:e,y:i,key:e+","+i}},h.prototype.WorldXYtoImageXY=function(e,t){var i=this.WorldXYtoGridXY(e,t);return this.GridXYtoImageXY(i.x,i.y)},h.prototype.key2pt=n,h.prototype.xy2key=s,h.prototype.xy2pt=r,h.prototype.pt2key=a,t.exports=h},{"./imageHandler.js":8,"./rot6.js":9}],11:[function(e,t,i){t.exports={worldMinX:-8288,worldMaxX:8288,worldMinY:-8288,worldMaxY:8288}},{}]},{},[1])(1)});
